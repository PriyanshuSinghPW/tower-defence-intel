var er=Object.defineProperty;var yi=s=>{throw TypeError(s)};var tr=(s,e,t)=>e in s?er(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var R=(s,e,t)=>tr(s,typeof e!="symbol"?e+"":e,t),Ws=(s,e,t)=>e.has(s)||yi("Cannot "+t);var a=(s,e,t)=>(Ws(s,e,"read from private field"),t?t.call(s):e.get(s)),d=(s,e,t)=>e.has(s)?yi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),Vs=(s,e,t,i)=>(Ws(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),Ci=(s,e,t)=>(Ws(s,e,"access private method"),t);import{a as k,t as L,c as le,n as _o}from"../chunks/disclose-version.CjHx_-ZV.js";import{h as Q,a as xo,at as sr,au as ir,s as or,J as ci,af as Fo,X as Hs,A as fe,a7 as rr,B as ps,y as Bo,ah as ar,C as nr,I as lr,V as Ao,ac as cr,ad as bi,N as Zs,Q as dr,F as Eo,av as fs,ae as So,x as ws,$ as hr,a5 as Ti,aw as di,ax as _i,ay as ur,U as mr,az as gr,aA as ko,aB as hi,aC as vr,M as pr,w as fr,aD as Mo,G as Po,aE as wr,ab as Do,n as Fe,aF as yr,aa as Cr,aG as br,aH as Tr,aI as _r,ag as $o,b as Io,aJ as xr,aK as Fr,D as xi,E as Fi,aL as Br,aM as Ar,a1 as v,g as r,Y as m,k as B,p as H,u as cs,t as q,m as Y,o as F,q as y,f as X,v as A,aN as ui,aO as Er,aP as Sr}from"../chunks/runtime.B-KhZ9vM.js";import{a as kr,l as Mr,w as Pr,e as Ys,r as jo,d as ds,s as re,b as Dr}from"../chunks/render.B_UAeRXo.js";import{a as C,p as Ee,b as Lo,i as W,c as $r,s as Ir,d as jr}from"../chunks/props.I6eiI-lL.js";import{o as mi,a as Ro}from"../chunks/index-client.CJTKJ1g7.js";import{b as ti,w as Lr}from"../chunks/paths.draNjkzQ.js";import"../chunks/legacy.Fmo7cl6F.js";import{s as Rr}from"../chunks/slot.MATdhzzF.js";function si(s,e,t){Q&&xo();var i=s,o=rr,n,l=sr()?ir:or;ci(()=>{l(o,o=e())&&(n&&Fo(n),n=Hs(()=>t(i)))}),Q&&(i=fe)}function xe(s,e){Q&&ps(Bo(s)),ar(()=>{var t=e();for(var i in t){var o=t[i];o?s.style.setProperty(i,o):s.style.removeProperty(i)}}),nr(()=>{s.remove()})}function ys(s,e){return e}function qr(s,e,t,i){for(var o=[],n=e.length,l=0;l<n;l++)ur(e[l].e,o,!0);var c=n>0&&o.length===0&&t!==null;if(c){var g=t.parentNode;mr(g),g.append(t),i.clear(),ue(s,e[0].prev,e[n-1].next)}gr(o,()=>{for(var _=0;_<n;_++){var h=e[_];c||(i.delete(h.k),ue(s,h.prev,h.next)),ko(h.e,!c)}})}function ie(s,e,t,i,o,n=null){var l=s,c={flags:e,items:new Map,first:null},g=(e&Mo)!==0;if(g){var _=s;l=Q?ps(Bo(_)):_.appendChild(fr())}Q&&xo();var h=null,f=!1;ci(()=>{var w=t(),u=lr(w)?w:w==null?[]:Ao(w),T=u.length;if(f&&T===0)return;f=T===0;let p=!1;if(Q){var E=l.data===cr;E!==(T===0)&&(l=bi(),ps(l),Zs(!1),p=!0)}if(Q){for(var b=null,x,P=0;P<T;P++){if(fe.nodeType===8&&fe.data===dr){l=fe,p=!0,Zs(!1);break}var D=u[P],S=i(D,P);x=qo(fe,c,b,null,D,S,P,o,e),c.items.set(S,x),b=x}T>0&&ps(bi())}if(!Q){var $=Eo;Ur(u,c,l,o,e,($.f&fs)!==0,i)}n!==null&&(T===0?h?So(h):h=Hs(()=>n(l)):h!==null&&Fo(h,()=>{h=null})),p&&Zs(!0),t()}),Q&&(l=fe)}function Ur(s,e,t,i,o,n,l,c){var be,ke,Me,Pe;var g=(o&wr)!==0,_=(o&(hi|di))!==0,h=s.length,f=e.items,w=e.first,u=w,T,p=null,E,b=[],x=[],P,D,S,$;if(g)for($=0;$<h;$+=1)P=s[$],D=l(P,$),S=f.get(D),S!==void 0&&((be=S.a)==null||be.measure(),(E??(E=new Set)).add(S));for($=0;$<h;$+=1){if(P=s[$],D=l(P,$),S=f.get(D),S===void 0){var O=u?u.e.nodes_start:t;p=qo(O,e,p,p===null?e.first:p.next,P,D,$,i,o),f.set(D,p),b=[],x=[],u=p.next;continue}if(_&&Nr(S,P,$,o),S.e.f&fs&&(So(S.e),g&&((ke=S.a)==null||ke.unfix(),(E??(E=new Set)).delete(S))),S!==u){if(T!==void 0&&T.has(S)){if(b.length<x.length){var z=x[0],U;p=z.prev;var ae=b[0],ge=b[b.length-1];for(U=0;U<b.length;U+=1)Bi(b[U],z,t);for(U=0;U<x.length;U+=1)T.delete(x[U]);ue(e,ae.prev,ge.next),ue(e,p,ae),ue(e,ge,z),u=z,p=ge,$-=1,b=[],x=[]}else T.delete(S),Bi(S,u,t),ue(e,S.prev,S.next),ue(e,S,p===null?e.first:p.next),ue(e,p,S),p=S;continue}for(b=[],x=[];u!==null&&u.k!==D;)(n||!(u.e.f&fs))&&(T??(T=new Set)).add(u),x.push(u),u=u.next;if(u===null)continue;S=u}b.push(S),p=S,u=S.next}if(u!==null||T!==void 0){for(var ve=T===void 0?[]:Ao(T);u!==null;)(n||!(u.e.f&fs))&&ve.push(u),u=u.next;var Se=ve.length;if(Se>0){var Qs=o&Mo&&h===0?t:null;if(g){for($=0;$<Se;$+=1)(Me=ve[$].a)==null||Me.measure();for($=0;$<Se;$+=1)(Pe=ve[$].a)==null||Pe.fix()}qr(e,ve,Qs,f)}}g&&Po(()=>{var te;if(E!==void 0)for(S of E)(te=S.a)==null||te.apply()}),ws.first=e.first&&e.first.e,ws.last=p&&p.e}function Nr(s,e,t,i){i&hi&&_i(s.v,e),i&di?_i(s.i,t):s.i=t}function qo(s,e,t,i,o,n,l,c,g,_){var h=(g&hi)!==0,f=(g&vr)===0,w=h?f?hr(o):Ti(o):o,u=g&di?Ti(l):l,T={i:u,v:w,k:n,a:null,e:null,prev:t,next:i};try{return T.e=Hs(()=>c(s,w,u),Q),T.e.prev=t&&t.e,T.e.next=i&&i.e,t===null?e.first=T:(t.next=T,t.e.next=T.e),i!==null&&(i.prev=T,i.e.prev=T.e),T}finally{}}function Bi(s,e,t){for(var i=s.next?s.next.e.nodes_start:t,o=e?e.e.nodes_start:t,n=s.e.nodes_start;n!==i;){var l=pr(n);o.before(n),n=l}}function ue(s,e,t){e===null?s.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function zr(s,e,...t){var i=s,o=Fe,n;ci(()=>{o!==(o=e())&&(n&&(ko(n),n=null),n=Hs(()=>o(i,...t)))},Do),Q&&(i=fe)}function de(s,e,t,i){var o=s.__attributes??(s.__attributes={});Q&&(o[e]=s.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&s.nodeName==="LINK")||o[e]!==(o[e]=t)&&(e==="style"&&"__styles"in s&&(s.__styles={}),e==="loading"&&(s[yr]=t),t==null?s.removeAttribute(e):typeof t!="string"&&Or(s).includes(e)?s[e]=t:s.setAttribute(e,t))}var Ai=new Map;function Or(s){var e=Ai.get(s.nodeName);if(e)return e;Ai.set(s.nodeName,e=[]);for(var t,i=s,o=Element.prototype;o!==i;){t=br(i);for(var n in t)t[n].set&&e.push(n);i=Cr(i)}return e}function Uo(s,e,t){var i=s.__className,o=Gr(e);Q&&s.className===o?s.__className=o:(i!==o||Q&&s.className!==o)&&(e==null?s.removeAttribute("class"):s.className=o,s.__className=o)}function Gr(s,e){return(s??"")+""}function we(s,e,t){if(t){if(s.classList.contains(e))return;s.classList.add(e)}else{if(!s.classList.contains(e))return;s.classList.remove(e)}}function N(s,e,t,i){var o=s.__styles??(s.__styles={});o[e]!==t&&(o[e]=t,t==null?s.style.removeProperty(e):s.style.setProperty(e,t,""))}const Hr=()=>performance.now(),oe={tick:s=>requestAnimationFrame(s),now:()=>Hr(),tasks:new Set};function No(){const s=oe.now();oe.tasks.forEach(e=>{e.c(s)||(oe.tasks.delete(e),e.f())}),oe.tasks.size!==0&&oe.tick(No)}function zo(s){let e;return oe.tasks.size===0&&oe.tick(No),{promise:new Promise(t=>{oe.tasks.add(e={c:s,f:t})}),abort(){oe.tasks.delete(e)}}}function hs(s,e){s.dispatchEvent(new CustomEvent(e))}function Yr(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const e=s.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Ei(s){const e={},t=s.split(";");for(const i of t){const[o,n]=i.split(":");if(!o||n===void 0)break;const l=Yr(o.trim());e[l]=n.trim()}return e}const Qr=s=>s;function V(s,e,t,i){var o=(s&Br)!==0,n=(s&Ar)!==0,l=o&&n,c=(s&xr)!==0,g=l?"both":o?"in":"out",_,h=e.inert,f,w;function u(){var x=Eo,P=ws;xi(null),Fi(null);try{return _??(_=t()(e,(i==null?void 0:i())??{},{direction:g}))}finally{xi(x),Fi(P)}}var T={is_global:c,in(){var x;if(e.inert=h,!o){w==null||w.abort(),(x=w==null?void 0:w.reset)==null||x.call(w);return}n||f==null||f.abort(),hs(e,"introstart"),f=ii(e,u(),w,1,()=>{hs(e,"introend"),f==null||f.abort(),f=_=void 0})},out(x){if(!n){x==null||x(),_=void 0;return}e.inert=!0,hs(e,"outrostart"),w=ii(e,u(),f,0,()=>{hs(e,"outroend"),x==null||x()})},stop:()=>{f==null||f.abort(),w==null||w.abort()}},p=ws;if((p.transitions??(p.transitions=[])).push(T),o&&kr){var E=c;if(!E){for(var b=p.parent;b&&b.f&Do;)for(;(b=b.parent)&&!(b.f&Tr););E=!b||(b.f&_r)!==0}E&&$o(()=>{Io(()=>T.in())})}}function ii(s,e,t,i,o){var n=i===1;if(Fr(e)){var l,c=!1;return Po(()=>{if(!c){var E=e({direction:n?"in":"out"});l=ii(s,E,t,i,o)}}),{abort:()=>{c=!0,l==null||l.abort()},deactivate:()=>l.deactivate(),reset:()=>l.reset(),t:()=>l.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return o(),{abort:Fe,deactivate:Fe,reset:Fe,t:()=>i};const{delay:g=0,css:_,tick:h,easing:f=Qr}=e;var w=[];if(n&&t===void 0&&(h&&h(0,1),_)){var u=Ei(_(0,1));w.push(u,u)}var T=()=>1-i,p=s.animate(w,{duration:g});return p.onfinish=()=>{var E=(t==null?void 0:t.t())??1-i;t==null||t.abort();var b=i-E,x=e.duration*Math.abs(b),P=[];if(x>0){if(_)for(var D=Math.ceil(x/16.666666666666668),S=0;S<=D;S+=1){var $=E+b*f(S/D),O=_($,1-$);P.push(Ei(O))}T=()=>{var z=p.currentTime;return E+b*f(z/x)},h&&zo(()=>{if(p.playState!=="running")return!1;var z=T();return h(z,1-z),!0})}p=s.animate(P,{duration:x,fill:"forwards"}),p.onfinish=()=>{T=()=>i,h==null||h(i,1-i),o()}},{abort:()=>{p&&(p.cancel(),p.effect=null,p.onfinish=Fe)},deactivate:()=>{o=Fe},reset:()=>{i===0&&(h==null||h(1,0))},t:()=>T()}}var me,Ae,Ie,bs,Oo;const Ts=class Ts{constructor(e){d(this,bs);d(this,me,new WeakMap);d(this,Ae);d(this,Ie);Vs(this,Ie,e)}observe(e,t){var i=a(this,me).get(e)||new Set;return i.add(t),a(this,me).set(e,i),Ci(this,bs,Oo).call(this).observe(e,a(this,Ie)),()=>{var o=a(this,me).get(e);o.delete(t),o.size===0&&(a(this,me).delete(e),a(this,Ae).unobserve(e))}}};me=new WeakMap,Ae=new WeakMap,Ie=new WeakMap,bs=new WeakSet,Oo=function(){return a(this,Ae)??Vs(this,Ae,new ResizeObserver(e=>{for(var t of e){Ts.entries.set(t.target,t);for(var i of a(this,me).get(t.target)||[])i(t)}}))},R(Ts,"entries",new WeakMap);let oi=Ts;var Wr=new oi({box:"border-box"});function Si(s,e,t){var i=Wr.observe(s,()=>t(s[e]));$o(()=>(Io(()=>t(s[e])),i))}function ki(s,e){Mr(window,["resize"],()=>Pr(()=>e(window[s])))}var je;class Vr{constructor(){d(this,je,v(C({})));R(this,"setup",e=>{this.managers=e});R(this,"update",e=>{this.managers.stageManager.update(e),this.managers.entityManager.update(e),this.managers.collisionManager.update(),this.managers.questionManager&&this.managers.questionManager.update(e),this.managers.particleManager&&this.managers.particleManager.update(e)});R(this,"get",e=>typeof e=="string"?this.managers[e]:e.reduce((t,i)=>(t[i]=this.managers[i],t),{}))}get managers(){return r(a(this,je))}set managers(e){m(a(this,je),C(e))}}je=new WeakMap;const M=new Vr,Z=s=>`${ti}${s}`,Mi=["/enemies/BlueBlobElite/Die/0.svg","/enemies/BlueBlobElite/Die/1.svg","/enemies/BlueBlobElite/Die/2.svg"],Zr={name:"BlueBlobEliteDie",frames:Mi,framesAmount:Mi.length,frameRate:10,loop:!1},Pi=["/enemies/BlueBlobElite/Follow/0.svg","/enemies/BlueBlobElite/Follow/1.svg","/enemies/BlueBlobElite/Follow/2.svg","/enemies/BlueBlobElite/Follow/3.svg"],Xr={name:"BlueBlobEliteFollow",frames:Pi,framesAmount:Pi.length,frameRate:10,loop:!0},Di=["/enemies/BlueCircleElite/Die/0.svg","/enemies/BlueCircleElite/Die/1.svg","/enemies/BlueCircleElite/Die/2.svg"],Jr={name:"BlueCircleEliteDie",frames:Di,framesAmount:Di.length,frameRate:10,loop:!1},$i=["/enemies/BlueCircleElite/Follow/0.svg","/enemies/BlueCircleElite/Follow/1.svg","/enemies/BlueCircleElite/Follow/2.svg","/enemies/BlueCircleElite/Follow/3.svg"],Kr={name:"BlueCircleEliteFollow",frames:$i,framesAmount:$i.length,frameRate:10,loop:!0},Ii=["/enemies/GreenCircleElite/Die/0.svg","/enemies/GreenCircleElite/Die/1.svg","/enemies/GreenCircleElite/Die/2.svg"],ea={name:"GreenCircleEliteDie",frames:Ii,framesAmount:Ii.length,frameRate:10,loop:!1},ji=["/enemies/GreenCircleElite/Follow/0.svg","/enemies/GreenCircleElite/Follow/1.svg","/enemies/GreenCircleElite/Follow/2.svg","/enemies/GreenCircleElite/Follow/3.svg"],ta={name:"GreenCircleEliteFollow",frames:ji,framesAmount:ji.length,frameRate:10,loop:!0},Li=["/enemies/RedBlobElite/Die/0.svg","/enemies/RedBlobElite/Die/1.svg","/enemies/RedBlobElite/Die/2.svg"],sa={name:"RedBlobEliteDie",frames:Li,framesAmount:Li.length,frameRate:10,loop:!1},Ri=["/enemies/RedBlobElite/Follow/0.svg","/enemies/RedBlobElite/Follow/1.svg","/enemies/RedBlobElite/Follow/2.svg","/enemies/RedBlobElite/Follow/3.svg"],ia={name:"RedBlobEliteFollow",frames:Ri,framesAmount:Ri.length,frameRate:10,loop:!0},qi=["/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg"],oa={name:"BlueCommonDie",frames:qi,framesAmount:qi.length,frameRate:10,loop:!1},Ui=["/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg"],ra={name:"BlueCommonFollow",frames:Ui,framesAmount:Ui.length,frameRate:10,loop:!0},Ni=["/enemies/PurpleCommon/Die/0.svg","/enemies/PurpleCommon/Die/1.svg","/enemies/PurpleCommon/Die/2.svg"],aa={name:"PurpleCommonDie",frames:Ni,framesAmount:Ni.length,frameRate:10,loop:!1},zi=["/enemies/PurpleCommon/Follow/0.svg","/enemies/PurpleCommon/Follow/1.svg","/enemies/PurpleCommon/Follow/2.svg"],na={name:"PurpleCommonFollow",frames:zi,framesAmount:zi.length,frameRate:10,loop:!0},Oi=["/enemies/YellowCommon/Die/0.svg","/enemies/YellowCommon/Die/1.svg","/enemies/YellowCommon/Die/2.svg"],la={name:"YellowCommonDie",frames:Oi,framesAmount:Oi.length,frameRate:10,loop:!1},Gi=["/enemies/YellowCommon/Follow/0.svg","/enemies/YellowCommon/Follow/1.svg","/enemies/YellowCommon/Follow/2.svg","/enemies/YellowCommon/Follow/3.svg"],ca={name:"YellowCommonFollow",frames:Gi,framesAmount:Gi.length,frameRate:10,loop:!0},da=Object.freeze(Object.defineProperty({__proto__:null,BlueBlobEliteDie:Zr,BlueBlobEliteFollow:Xr,BlueCircleEliteDie:Jr,BlueCircleEliteFollow:Kr,BlueCommonDie:oa,BlueCommonFollow:ra,GreenCircleEliteDie:ea,GreenCircleEliteFollow:ta,PurpleCommonDie:aa,PurpleCommonFollow:na,RedBlobEliteDie:sa,RedBlobEliteFollow:ia,YellowCommonDie:la,YellowCommonFollow:ca},Symbol.toStringTag,{value:"Module"})),ha=["/towers/Base.svg"],ua={name:"TowerBase",frames:ha,framesAmount:1,frameRate:0,loop:!0},ma=["/towers/FireTower/Base0.svg"],ga={name:"FireTowerBase0",frames:ma,framesAmount:1,frameRate:0,loop:!0},va=["/towers/FireTower/Base1.svg"],pa={name:"FireTowerBase1",frames:va,framesAmount:1,frameRate:0,loop:!0},fa=["/towers/FireTower/Base2.svg"],wa={name:"FireTowerBase2",frames:fa,framesAmount:1,frameRate:0,loop:!0},Hi=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/FireTower/Base0.svg"],ya={name:"FireTowerUpgrade0",frames:Hi,framesAmount:Hi.length,frameRate:10,loop:!1},Yi=["/towers/FireTower/Base0.svg","/towers/FireTower/Upgrade1.svg","/towers/FireTower/Base1.svg"],Ca={name:"FireTowerUpgrade1",frames:Yi,framesAmount:Yi.length,frameRate:10,loop:!1},Qi=["/towers/FireTower/Base1.svg","/towers/FireTower/Upgrade2.svg","/towers/FireTower/Base2.svg"],ba={name:"FireTowerUpgrade2",frames:Qi,framesAmount:Qi.length,frameRate:10,loop:!1},Ta=["/towers/IceTower/Base0.svg"],_a={name:"IceTowerBase0",frames:Ta,framesAmount:1,frameRate:0,loop:!0},xa=["/towers/IceTower/Base1.svg"],Fa={name:"IceTowerBase1",frames:xa,framesAmount:1,frameRate:0,loop:!0},Ba=["/towers/IceTower/Base2.svg"],Aa={name:"IceTowerBase2",frames:Ba,framesAmount:1,frameRate:0,loop:!0},Wi=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/IceTower/Base0.svg"],Ea={name:"IceTowerUpgrade0",frames:Wi,framesAmount:Wi.length,frameRate:10,loop:!1},Vi=["/towers/IceTower/Base0.svg","/towers/IceTower/Upgrade1.svg","/towers/IceTower/Base1.svg"],Sa={name:"IceTowerUpgrade1",frames:Vi,framesAmount:Vi.length,frameRate:10,loop:!1},Zi=["/towers/IceTower/Base1.svg","/towers/IceTower/Upgrade2.svg","/towers/IceTower/Base2.svg"],ka={name:"IceTowerUpgrade2",frames:Zi,framesAmount:Zi.length,frameRate:10,loop:!1},Ma=["/towers/PoisonTower/Base0.svg"],Pa={name:"PoisonTowerBase0",frames:Ma,framesAmount:1,frameRate:0,loop:!0},Da=["/towers/PoisonTower/Base1.svg"],$a={name:"PoisonTowerBase1",frames:Da,framesAmount:1,frameRate:0,loop:!0},Ia=["/towers/PoisonTower/Base2.svg"],ja={name:"PoisonTowerBase2",frames:Ia,framesAmount:1,frameRate:0,loop:!0},Xi=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/PoisonTower/Base0.svg"],La={name:"PoisonTowerUpgrade0",frames:Xi,framesAmount:Xi.length,frameRate:10,loop:!1},Ji=["/towers/PoisonTower/Base0.svg","/towers/PoisonTower/Upgrade1.svg","/towers/PoisonTower/Base1.svg"],Ra={name:"PoisonTowerUpgrade1",frames:Ji,framesAmount:Ji.length,frameRate:10,loop:!1},Ki=["/towers/PoisonTower/Base1.svg","/towers/PoisonTower/Upgrade2.svg","/towers/PoisonTower/Base2.svg"],qa={name:"PoisonTowerUpgrade2",frames:Ki,framesAmount:Ki.length,frameRate:10,loop:!1},Ua=["/towers/ThunderTower/Base0.svg"],Na={name:"ThunderTowerBase0",frames:Ua,framesAmount:1,frameRate:0,loop:!0},za=["/towers/ThunderTower/Base1.svg"],Oa={name:"ThunderTowerBase1",frames:za,framesAmount:1,frameRate:0,loop:!0},Ga=["/towers/ThunderTower/Base2.svg"],Ha={name:"ThunderTowerBase2",frames:Ga,framesAmount:1,frameRate:0,loop:!0},eo=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/ThunderTower/Base0.svg"],Ya={name:"ThunderTowerUpgrade0",frames:eo,framesAmount:eo.length,frameRate:10,loop:!1},to=["/towers/ThunderTower/Base0.svg","/towers/ThunderTower/Upgrade1.svg","/towers/ThunderTower/Base1.svg"],Qa={name:"ThunderTowerUpgrade1",frames:to,framesAmount:to.length,frameRate:10,loop:!1},so=["/towers/ThunderTower/Base1.svg","/towers/ThunderTower/Upgrade2.svg","/towers/ThunderTower/Base2.svg"],Wa={name:"ThunderTowerUpgrade2",frames:so,framesAmount:so.length,frameRate:10,loop:!1},Va=Object.freeze(Object.defineProperty({__proto__:null,FireTowerBase0:ga,FireTowerBase1:pa,FireTowerBase2:wa,FireTowerUpgrade0:ya,FireTowerUpgrade1:Ca,FireTowerUpgrade2:ba,IceTowerBase0:_a,IceTowerBase1:Fa,IceTowerBase2:Aa,IceTowerUpgrade0:Ea,IceTowerUpgrade1:Sa,IceTowerUpgrade2:ka,PoisonTowerBase0:Pa,PoisonTowerBase1:$a,PoisonTowerBase2:ja,PoisonTowerUpgrade0:La,PoisonTowerUpgrade1:Ra,PoisonTowerUpgrade2:qa,ThunderTowerBase0:Na,ThunderTowerBase1:Oa,ThunderTowerBase2:Ha,ThunderTowerUpgrade0:Ya,ThunderTowerUpgrade1:Qa,ThunderTowerUpgrade2:Wa,TowerBase:ua},Symbol.toStringTag,{value:"Module"})),io=["/projectiles/Fireball/Die/0.svg","/projectiles/Fireball/Die/1.svg","/projectiles/Fireball/Die/2.svg"],Za={name:"FireballDie",frames:io,framesAmount:io.length,frameRate:10,loop:!1},oo=["/projectiles/Fireball/Follow/0.svg","/projectiles/Fireball/Follow/1.svg","/projectiles/Fireball/Follow/2.svg","/projectiles/Fireball/Follow/3.svg"],Xa={name:"FireballFollow",frames:oo,framesAmount:oo.length,frameRate:10,loop:!0},ro=["/projectiles/Icebolt/Die/0.svg","/projectiles/Icebolt/Die/1.svg","/projectiles/Icebolt/Die/2.svg"],Ja={name:"IceboltDie",frames:ro,framesAmount:ro.length,frameRate:10,loop:!1},ao=["/projectiles/Icebolt/Follow/0.svg","/projectiles/Icebolt/Follow/1.svg"],Ka={name:"IceboltFollow",frames:ao,framesAmount:ao.length,frameRate:10,loop:!0},no=["/projectiles/Poisonball/Die/0.svg","/projectiles/Poisonball/Die/1.svg","/projectiles/Poisonball/Die/2.svg"],en={name:"PoisonballDie",frames:no,framesAmount:no.length,frameRate:10,loop:!1},lo=["/projectiles/Poisonball/Follow/0.svg","/projectiles/Poisonball/Follow/1.svg","/projectiles/Poisonball/Follow/2.svg","/projectiles/Poisonball/Follow/3.svg"],tn={name:"PoisonballFollow",frames:lo,framesAmount:lo.length,frameRate:10,loop:!0},co=["/projectiles/Thunderbolt/Die/0.svg","/projectiles/Thunderbolt/Die/1.svg","/projectiles/Thunderbolt/Die/2.svg"],sn={name:"ThunderboltDie",frames:co,framesAmount:co.length,frameRate:10,loop:!1},ho=["/projectiles/Thunderbolt/Follow/0.svg","/projectiles/Thunderbolt/Follow/1.svg","/projectiles/Thunderbolt/Follow/2.svg","/projectiles/Thunderbolt/Follow/3.svg"],on={name:"ThunderboltFollow",frames:ho,framesAmount:ho.length,frameRate:10,loop:!0},uo=["/projectiles/Click/0.svg","/projectiles/Click/1.svg","/projectiles/Click/2.svg","/projectiles/Click/3.svg"],rn={name:"Click",frames:uo,framesAmount:uo.length,frameRate:10,loop:!1},an=Object.freeze(Object.defineProperty({__proto__:null,Click:rn,FireballDie:Za,FireballFollow:Xa,IceboltDie:Ja,IceboltFollow:Ka,PoisonballDie:en,PoisonballFollow:tn,ThunderboltDie:sn,ThunderboltFollow:on},Symbol.toStringTag,{value:"Module"})),mo=["/cursors/build0.svg","/cursors/build1.svg","/cursors/build2.svg"],nn={name:"TowerBuildCursor",frames:mo,framesAmount:mo.length,frameRate:7,loop:!1},ln=Object.freeze(Object.defineProperty({__proto__:null,TowerBuildCursor:nn},Symbol.toStringTag,{value:"Module"})),cn=["/throne.svg"],dn={name:"Throne",frames:cn,framesAmount:1,frameRate:0,loop:!0},hn=["/loot.svg"],un={name:"Loot",frames:hn,framesAmount:1,frameRate:0,loop:!0},go={Throne:dn,Loot:un,...da,...Va,...an,...ln},$e=s=>{if(!go[s])throw new Error(`Animation config not found for: ${s}`);const e=go[s];return{...e,frames:e.frames.map(t=>Z(t))}};var Le,Re,qe,Ue,Ne,_s,ze;class Go{constructor({name:e,framesAmount:t,frameRate:i,loop:o=!1}){R(this,"name");d(this,Le,v(0));d(this,Re,v(0));d(this,qe,v(!1));d(this,Ue,v(0));d(this,Ne,v(0));d(this,_s,B(()=>this.getIsAnimationComplete()));d(this,ze,v(()=>{}));this.name=e,this.framesAmount=t,this.frameRate=i,this.loop=o}get framesAmount(){return r(a(this,Le))}set framesAmount(e){m(a(this,Le),C(e))}get frameRate(){return r(a(this,Re))}set frameRate(e){m(a(this,Re),C(e))}get loop(){return r(a(this,qe))}set loop(e){m(a(this,qe),C(e))}get currentFrame(){return r(a(this,Ue))}set currentFrame(e){m(a(this,Ue),C(e))}get currentFrameTime(){return r(a(this,Ne))}set currentFrameTime(e){m(a(this,Ne),C(e))}get isComplete(){return r(a(this,_s))}get onFrameChange(){return r(a(this,ze))}set onFrameChange(e){m(a(this,ze),C(e))}update(e){this.frameRate!==0&&(this.currentFrameTime+=e,this.currentFrameTime>=1e3/this.frameRate&&(this.currentFrameTime=0,this.nextFrame()))}nextFrame(){this.onFrameChange(this.currentFrame),this.currentFrame>=this.framesAmount-1?this.loop?this.currentFrame=0:this.currentFrame=this.framesAmount-1:this.currentFrame+=1}getIsAnimationComplete(){return this.loop?!1:this.currentFrame===this.framesAmount-1}}Le=new WeakMap,Re=new WeakMap,qe=new WeakMap,Ue=new WeakMap,Ne=new WeakMap,_s=new WeakMap,ze=new WeakMap;const vo={arrow:Z("/cursors/cursor-arrow.svg"),hammer:Z("/cursors/cursor-hammer.svg")};var Oe,xs,Fs,Bs,As;class mn{constructor(){d(this,Oe,v());d(this,xs,B(()=>`url(${vo.arrow}), auto`));d(this,Fs,B(()=>`url(${vo.hammer}), auto`));d(this,Bs,B(()=>this.animation&&!this.animation.isComplete));d(this,As,B(()=>this.getCurrentFrame()))}get animation(){return r(a(this,Oe))}set animation(e){m(a(this,Oe),C(e))}get arrow(){return r(a(this,xs))}get hammer(){return r(a(this,Fs))}get inAnimation(){return r(a(this,Bs))}get currentFrame(){return r(a(this,As))}update(e){this.inAnimation&&this.animation.update(e)}get(e){return this.inAnimation?this.currentFrame:this[e]}setAnimation(e){if(!e){this.animation=null;return}const t=$e(e);this.animation=new Go({...t})}getCurrentFrame(){const{frames:e}=$e(this.animation.name);return`url(${e[this.animation.currentFrame]}), auto`}}Oe=new WeakMap,xs=new WeakMap,Fs=new WeakMap,Bs=new WeakMap,As=new WeakMap;const G=new mn;var Ge,He,Ye,Qe,We,Ve,Es;class gn{constructor(){d(this,Ge,v(0));d(this,He,v(0));d(this,Ye,v(0));d(this,Qe,v(0));d(this,We,v(0));d(this,Ve,v(0));d(this,Es,B(()=>this.width<768))}get width(){return r(a(this,Ge))}set width(e){m(a(this,Ge),C(e))}get height(){return r(a(this,He))}set height(e){m(a(this,He),C(e))}get gameAreaWidth(){return r(a(this,Ye))}set gameAreaWidth(e){m(a(this,Ye),C(e))}get gameAreaHeight(){return r(a(this,Qe))}set gameAreaHeight(e){m(a(this,Qe),C(e))}get gameXOffset(){return r(a(this,We))}set gameXOffset(e){m(a(this,We),C(e))}get gameYOffset(){return r(a(this,Ve))}set gameYOffset(e){m(a(this,Ve),C(e))}get isMobile(){return r(a(this,Es))}get screenBounds(){return{x1:0,y1:0,x2:this.width,y2:this.height}}get gameBoundingBox(){return{x1:this.gameXOffset,y1:this.gameYOffset,x2:this.width,y2:this.height}}isEntityInScreen(e){const{x1:t,y1:i,x2:o,y2:n}=this.screenBounds,{x:l,y:c}=e.position;return l+e.width/2>t&&l-e.width/2<o&&c+e.height>i&&c-e.height<n}}Ge=new WeakMap,He=new WeakMap,Ye=new WeakMap,Qe=new WeakMap,We=new WeakMap,Ve=new WeakMap,Es=new WeakMap;const I=new gn;var vn=L('<img alt="Enemy animation" class="svelte-94zyf5">');function Xs(s,e){H(e,!0);let t=Ee(e,"entity",7),i=v(void 0),o=B(()=>$e(t().animation.name)),n=B(()=>r(o).frames[t().animation.currentFrame]),l=v(!1);function c(){m(l,!0)}const g=B(()=>I.isMobile?t().scale-.2:t().scale),_=B(()=>t().position.x),h=B(()=>t().position.y),f=B(()=>`translate(${r(_)}px, ${r(h)}px) rotate(${t().rotation}deg) scale(${r(g)})`);cs(()=>{if(!r(i)||!r(l))return;let T=r(i).getBoundingClientRect();t().width=T.width,t().height=T.height});var w=vn();const u=B(()=>G.get("arrow"));Lo(w,T=>m(i,T),()=>r(i)),q(()=>{de(w,"src",r(n)),N(w,"left","0px"),N(w,"top","0px"),N(w,"transform",r(f)),N(w,"cursor",r(u))}),Ys("load",w,c),jo(w),k(s,w),Y()}var Ze,Xe;const ne=class ne{constructor(e=0,t=0){d(this,Ze,v(0));d(this,Xe,v(0));this.x=e,this.y=t}get x(){return r(a(this,Ze))}set x(e){m(a(this,Ze),C(e))}get y(){return r(a(this,Xe))}set y(e){m(a(this,Xe),C(e))}clone(){return new ne(this.x,this.y)}isEqual(e){return this.x===e.x&&this.y===e.y}add(e){return new ne(this.x+e.x,this.y+e.y)}subtract(e){return new ne(this.x-e.x,this.y-e.y)}multiply(e){return new ne(this.x*e,this.y*e)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return e?new ne(this.x/e,this.y/e):new ne}distance(e){return this.subtract(e).magnitude()}dot(e){return this.x*e.x+this.y*e.y}rotate(e){const t=Math.cos(e),i=Math.sin(e);return new ne(this.x*t-this.y*i,this.x*i+this.y*t)}};Ze=new WeakMap,Xe=new WeakMap;let J=ne;var pn=L('<img alt="Enemy animation" class="svelte-usgp6v">');function Js(s,e){H(e,!0);let t=Ee(e,"entity",7),i=v(void 0),o=B(()=>$e(t().animation.name)),n=B(()=>r(o).frames[t().animation.currentFrame]),l=v(!1);function c(){m(l,!0)}const g=B(()=>I.isMobile?t().scale-.2:t().scale),_=B(()=>`scale(${r(g)})`);cs(()=>{var u;if(!r(i)||!r(l))return;let f=r(i).getBoundingClientRect();const w=((u=r(i).offsetParent)==null?void 0:u.getBoundingClientRect())??{x:0,y:0};t().position=new J(f.x-w.x,f.y-w.y),t().width=f.width,t().height=f.height,console.log("entity.position",r(n),t().width,t().height,I.width)});var h=pn();h.__click=function(...f){var w;(w=e.onclick)==null||w.apply(this,f)},Lo(h,f=>m(i,f),()=>r(i)),q(()=>{de(h,"src",r(n)),N(h,"transform",r(_))}),Ys("load",h,c),jo(h),k(s,h),Y()}ds(["click"]);var fn=L('<div class="particle svelte-17cbyeb"></div>'),wn=L('<div class="particle-layer svelte-17cbyeb"><!></div>');function yn(s,e){H(e,!0);const t=B(()=>M.get("particleManager"));var i=wn(),o=F(i);{var n=l=>{var c=le(),g=X(c);ie(g,16,()=>r(t).particles,_=>_,(_,h)=>{var f=fn();q(()=>{N(f,"left",`${h.x??""}px`),N(f,"top",`${h.y??""}px`),N(f,"width",`${h.size??""}px`),N(f,"height",`${h.size??""}px`),N(f,"background-color",h.color),N(f,"opacity",h.life)}),k(_,f)}),k(l,c)};W(o,l=>{r(t)&&l(n)})}y(i),k(s,i),Y()}function Be(s,e){return s.x1<=e.x2&&s.x2>=e.x1&&s.y1<=e.y2&&s.y2>=e.y1}function Ho(s,e){return Math.atan2(e.y-s.y,e.x-s.x)}function gi(s){return new J(Math.cos(s),Math.sin(s))}const vi=(s,e,t)=>({x1:s.x-e/2,y1:s.y-t/2,x2:s.x+e/2,y2:s.y+t/2,center:new J(s.x,s.y),topMiddle:new J(s.x+e/2,s.y)}),Ks={bgSound:Z("/sound/bgSound.mp3"),effects:{pickUp:Z("/sound/sfx/pickUp.m4a"),towerUpgrade:Z("/sound/sfx/towerUpgrade.m4a"),clickEnemy:Z("/sound/sfx/clickEnemy.m4a"),towerShoot:Z("/sound/sfx/towerShoot.m4a"),clickMenu:Z("/sound/sfx/clickMenu.m4a"),lowResourse:Z("/sound/sfx/lowResourse.m4a"),shine:Z("/sound/sfx/shine.mp3"),magicBurst:Z("/sound/sfx/magic-burst.mp3")}},us=.3,Cn=.2;var Je,Ke,et,tt,st,it,ot,rt,Ss,ks;class bn{constructor(){d(this,Je,v({}));d(this,Ke,v(!1));d(this,et,v(0));d(this,tt,v(null));d(this,st,v(null));d(this,it,v(null));d(this,ot,v(!1));d(this,rt,v(0));d(this,Ss,B(()=>Object.keys(Ks.effects).length+1));d(this,ks,B(()=>Math.min(Math.floor(this.loadedCount/this.totalResources*100),100)));R(this,"preload",async()=>{const e=(t,i)=>new Promise((o,n)=>{const l=new Audio(i),c=()=>{this.sounds[t]=l,this.sounds[t].volume=t==="bgSound"?us:Cn,this.sounds[t].loop=t==="bgSound",this.loadedCount+=1,l.removeEventListener("canplaythrough",c),o()},g=_=>{l.removeEventListener("error",g),n(_)};l.addEventListener("canplaythrough",c),l.addEventListener("error",g),l.load()});try{await e("bgSound",Ks.bgSound);const t=Object.entries(Ks.effects).map(([i,o])=>e(i,o));await Promise.all(t),this.preloaded=!0,console.log("Sounds preloaded successfully.")}catch(t){throw console.error("Error preloading sounds:",t),t}});R(this,"reduceBgVolume",()=>{this.sounds.bgSound.volume=us-.2});R(this,"restoreBgVolume",()=>{this.sounds.bgSound.volume=us});R(this,"initAudioContext",()=>{if(this.audioContext)return;const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e;const t=this.sounds.bgSound;t&&(this.bgNode=this.audioContext.createMediaElementSource(t),this.bgFilter=this.audioContext.createBiquadFilter(),this.bgFilter.type="lowpass",this.bgFilter.frequency.value=22050,this.bgNode.connect(this.bgFilter),this.bgFilter.connect(this.audioContext.destination))});R(this,"play",(e,t=!1)=>{if(this.isMuted)return;const i=this.sounds[e];if(i){if(e==="bgSound"){this.initAudioContext(),this.audioContext.state==="suspended"&&this.audioContext.resume(),i.currentTime=0,i.play();return}if(!(navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"))&&(t||this.playingEffectsCount<10)){i.currentTime=0,i.play();const o=()=>{this.playingEffectsCount-=1,i.removeEventListener("ended",o)};i.addEventListener("ended",o),this.playingEffectsCount+=1}}})}get sounds(){return r(a(this,Je))}set sounds(e){m(a(this,Je),e)}get isMuted(){return r(a(this,Ke))}set isMuted(e){m(a(this,Ke),C(e))}get playingEffectsCount(){return r(a(this,et))}set playingEffectsCount(e){m(a(this,et),C(e))}get audioContext(){return r(a(this,tt))}set audioContext(e){m(a(this,tt),e)}get bgNode(){return r(a(this,st))}set bgNode(e){m(a(this,st),e)}get bgFilter(){return r(a(this,it))}set bgFilter(e){m(a(this,it),e)}get preloaded(){return r(a(this,ot))}set preloaded(e){m(a(this,ot),C(e))}get loadedCount(){return r(a(this,rt))}set loadedCount(e){m(a(this,rt),C(e))}get totalResources(){return r(a(this,Ss))}get preloadPercent(){return r(a(this,ks))}pause(e){const t=this.sounds[e];t&&t.pause()}toggleMute(){this.isMuted=!this.isMuted,this.isMuted?this.pause("bgSound"):this.play("bgSound")}reset(){if(this.isMuted)return;const e=this.sounds.bgSound;e&&(e.currentTime=0,e.volume=us,e.play())}setDistortion(e){if(!this.bgFilter||!this.audioContext)return;const t=this.audioContext.currentTime,i=e?600:22050;this.bgFilter.frequency.cancelScheduledValues(t),this.bgFilter.frequency.exponentialRampToValueAtTime(i,t+.5)}}Je=new WeakMap,Ke=new WeakMap,et=new WeakMap,tt=new WeakMap,st=new WeakMap,it=new WeakMap,ot=new WeakMap,rt=new WeakMap,Ss=new WeakMap,ks=new WeakMap;const j=new bn,Tn={click:5,upgrade:35};var at,nt,lt,ct,dt,ht;class _n{constructor(){d(this,at,v(100));d(this,nt,v(!1));d(this,lt,v(!1));d(this,ct,v(!1));d(this,dt,v(100));d(this,ht,v(0))}get collectedLoot(){return r(a(this,at))}set collectedLoot(e){m(a(this,at),C(e))}get playLowLootAnimation(){return r(a(this,nt))}set playLowLootAnimation(e){m(a(this,nt),C(e))}get playTowerUpgradeAnimation(){return r(a(this,lt))}set playTowerUpgradeAnimation(e){m(a(this,lt),C(e))}get playEnemyClickAnimation(){return r(a(this,ct))}set playEnemyClickAnimation(e){m(a(this,ct),C(e))}get score(){return r(a(this,dt))}set score(e){m(a(this,dt),C(e))}get killsEnemy(){return r(a(this,ht))}set killsEnemy(e){m(a(this,ht),C(e))}spendLoot(e){const t=Tn[e.type];if(e.type==="upgrade"){const{questionManager:i}=M.get(["questionManager"]),{tower:o}=e.payload;if(o.state.currentState.name==="NotBuilt"){i.buildPoints>0?(i.buildPoints--,o.state.setState("Guard"),o.stats.health=o.stats.maxHealth||3):this.playAnimation("LowLoot");return}else{this.collectedLoot>=t?i.buildPoints>0?(this.collectedLoot-=t,i.buildPoints--,o.state.setState("Upgrade"),this.playAnimation("TowerUpgrade"),G.setAnimation("TowerBuildCursor")):this.playAnimation("LowLoot"):this.playAnimation("LowLoot");return}}if(this.collectedLoot<t){this.playAnimation("LowLoot");return}if(e.type==="click"){const{collisionManager:i,stageManager:o}=M.get(["collisionManager","stageManager"]),{offset:n}=e.payload,l=vi(n,60,60),c=i.filterEnemiesByBounds(l);o.spawnEntity("ClickExplode",n),j.play("clickEnemy",!0),c.forEach(g=>{g.state.setState("Die")}),c.length>0&&(this.collectedLoot-=t)}}receiveLoot(e){this.collectedLoot+=e,this.score+=e,this.killsEnemy++}reset(){this.collectedLoot=100,this.killsEnemy=0}getAnimation(e){return`play${e}Animation`}playAnimation(e){const t=this.getAnimation(e);this[t]=!0}unsetAnimation(e){const t=this.getAnimation(e);this[t]=!1}}at=new WeakMap,nt=new WeakMap,lt=new WeakMap,ct=new WeakMap,dt=new WeakMap,ht=new WeakMap;const ce=new _n;var xn=L('<div class="segment-marker svelte-1syar9e"></div>'),Fn=L('<div class="health-bar-container svelte-1syar9e"><div class="health-bar-background svelte-1syar9e"><!> <div class="health-bar-fill svelte-1syar9e"></div></div></div>');function Bn(s,e){H(e,!0);const t=e.entity.stats.maxHealth||500,i=5,o=B(()=>Math.max(0,Math.min(100,e.entity.stats.health/t*100))),n=Array.from({length:i-1},(f,w)=>(w+1)*(100/i));var l=Fn();const c=B(()=>G.get("arrow"));q(()=>N(l,"cursor",r(c)));var g=F(l),_=F(g);ie(_,17,()=>n,ys,(f,w)=>{var u=xn();q(()=>N(u,"left",`${r(w)??""}%`)),k(f,u)});var h=A(_,2);y(g),y(l),q(()=>{we(h,"low",r(o)<=20),we(h,"medium",r(o)>20&&r(o)<=60),we(h,"high",r(o)>60),N(h,"width",`${r(o)??""}%`)}),k(s,l),Y()}var An=L('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),En=L('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Sn=L('<div class="tower-wrapper svelte-11at443"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div>'),kn=L('<div class="tower-wrapper svelte-11at443"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div>'),Mn=L('<section class="svelte-11at443"><!> <!> <!> <div class="towers svelte-11at443"></div> <div class="throne svelte-11at443"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="towers svelte-11at443"></div> <!></section>');function Pn(s,e){H(e,!0);const t=B(()=>M.get("entityManager")),i=p=>E=>{E.stopPropagation(),!(p.upgradeLevel===2||!p.isUpgradable||G.inAnimation)&&ce.spendLoot({type:"upgrade",payload:{tower:p}})};var o=Mn();const n=B(()=>G.get("arrow"));q(()=>N(o,"cursor",r(n)));var l=F(o);ie(l,17,()=>r(t).loot,p=>p.id,(p,E)=>{var b=An(),x=X(b);xe(x,()=>({"--z-index":11})),Xs(x.lastChild,{get entity(){return r(E)}}),y(x),k(p,b)});var c=A(l,2);ie(c,17,()=>r(t).projectiles,p=>p.id,(p,E)=>{var b=En(),x=X(b);xe(x,()=>({"--z-index":12})),Xs(x.lastChild,{get entity(){return r(E)}}),y(x),k(p,b)});var g=A(c,2);ie(g,17,()=>r(t).enemies,p=>p.id,(p,E)=>{Xs(p,{get entity(){return r(E)}})});var _=A(g,2);ie(_,23,()=>r(t).topTowers,p=>p.id,(p,E,b)=>{var x=Sn(),P=F(x),D=B(()=>i(r(E)));xe(P,()=>({"--cursor":G.get("hammer"),"--z-index":10,"--pointer-events":"auto","--margin-left":r(b)===0?"12px":"0","--margin-right":r(b)===1?"12px":"0"})),Js(P.lastChild,{get entity(){return r(E)},get onclick(){return r(D)}}),y(P),y(x),k(p,x)}),y(_);var h=A(_,2),f=F(h);xe(f,()=>({"--cursor":G.get("arrow")})),Js(f.lastChild,{get entity(){return r(t).throne}}),y(f);var w=A(f,2);xe(w,()=>({"--width":`${r(t).throne.width}px`})),Bn(w.lastChild,{get entity(){return r(t).throne}}),y(w),y(h);var u=A(h,2);ie(u,23,()=>r(t).bottomTowers,p=>p.id,(p,E,b)=>{var x=kn(),P=F(x),D=B(()=>i(r(E)));xe(P,()=>({"--cursor":G.get("hammer"),"--z-index":10,"--pointer-events":"auto","--margin-left":r(b)===0?"12px":"0","--margin-right":r(b)===1?"12px":"0"})),Js(P.lastChild,{get entity(){return r(E)},get onclick(){return r(D)}}),y(P),y(x),k(p,x)}),y(u);var T=A(u,2);yn(T,{}),y(o),k(s,o),Y()}const Dn=(s,e)=>{j!=null&&j.preloaded&&j.play("clickMenu",!0),e.onclick()};var $n=L('<button class="btn svelte-11ulr"> <div class="tab svelte-11ulr"></div></button>');function ye(s,e){H(e,!0);const t=Ee(e,"disabled",3,!1),i=Ee(e,"text",3,"");var o=$n();o.__click=[Dn,e];const n=B(()=>G.get("arrow"));var l=F(o);ui(),y(o),q(()=>{o.disabled=t(),N(o,"cursor",r(n)),re(l,`${i()??""} `)}),k(s,o),Y()}ds(["click"]);const In=s=>s;function Yo(s){const e=s-1;return e*e*e+1}function he(s,{delay:e=0,duration:t=400,easing:i=In}={}){const o=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:i,css:n=>`opacity: ${n*o}`}}function jn(s,{delay:e=0,duration:t=400,easing:i=Yo,axis:o="y"}={}){const n=getComputedStyle(s),l=+n.opacity,c=o==="y"?"height":"width",g=parseFloat(n[c]),_=o==="y"?["top","bottom"]:["left","right"],h=_.map(b=>`${b[0].toUpperCase()}${b.slice(1)}`),f=parseFloat(n[`padding${h[0]}`]),w=parseFloat(n[`padding${h[1]}`]),u=parseFloat(n[`margin${h[0]}`]),T=parseFloat(n[`margin${h[1]}`]),p=parseFloat(n[`border${h[0]}Width`]),E=parseFloat(n[`border${h[1]}Width`]);return{delay:e,duration:t,easing:i,css:b=>`overflow: hidden;opacity: ${Math.min(b*20,1)*l};${c}: ${b*g}px;padding-${_[0]}: ${b*f}px;padding-${_[1]}: ${b*w}px;margin-${_[0]}: ${b*u}px;margin-${_[1]}: ${b*T}px;border-${_[0]}-width: ${b*p}px;border-${_[1]}-width: ${b*E}px;`}}function Cs(s,{delay:e=0,duration:t=400,easing:i=Yo,start:o=0,opacity:n=0}={}){const l=getComputedStyle(s),c=+l.opacity,g=l.transform==="none"?"":l.transform,_=1-o,h=c*(1-n);return{delay:e,duration:t,easing:i,css:(f,w)=>`
			transform: ${g} scale(${1-_*w});
			opacity: ${c-h*w}
		`}}var Ln=L('<div class="menu-container svelte-n7rxky"><div class="grid-overlay svelte-n7rxky"></div> <div class="scan-line svelte-n7rxky"></div> <div class="menu-content svelte-n7rxky"><!></div></div>');function pi(s,e){H(e,!0);var t=Ln();const i=B(()=>G.get("arrow"));q(()=>N(t,"cursor",r(i)));var o=A(F(t),4),n=F(o);zr(n,()=>e.children),y(o),y(t),V(1,t,()=>he,()=>({duration:200})),V(2,t,()=>he,()=>({duration:200})),k(s,t),Y()}var Rn=_o('<svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="25" cy="25" r="24.5" fill="#FFD700" stroke="white"></circle><circle cx="25" cy="25" r="18" fill="#FFAE00"></circle><path d="M43 25C43 20.2261 41.1036 15.6477 37.7279 12.2721C34.3523 8.89642 29.7739 7 25 7C20.2261 7 15.6477 8.89642 12.2721 12.2721C8.89642 15.6477 7 20.2261 7 25H7.72C7.72 20.4171 9.54057 16.0218 12.7812 12.7812C16.0218 9.54057 20.4171 7.72 25 7.72C29.5829 7.72 33.9782 9.54057 37.2188 12.7812C40.4594 16.0218 42.28 20.4171 42.28 25H43Z" fill="#E17100"></path><path d="M43 25C43 29.7739 41.1036 34.3523 37.7279 37.7279C34.3523 41.1036 29.7739 43 25 43C20.2261 43 15.6477 41.1036 12.2721 37.7279C8.89642 34.3523 7 29.7739 7 25H7.72C7.72 29.5829 9.54057 33.9782 12.7812 37.2188C16.0218 40.4594 20.4171 42.28 25 42.28C29.5829 42.28 33.9782 40.4594 37.2188 37.2188C40.4594 33.9782 42.28 29.5829 42.28 25H43Z" fill="#FFF4BA"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 32.712C27.4385 32.7173 29.256 32.7221 30.6708 32.1912C32.8572 34.0388 35.4701 34.3689 36.5404 32.9185C37.6236 31.4507 36.7166 28.7153 34.5147 26.8087C34.237 26.5683 33.9521 26.3526 33.6639 26.1621C33.6294 19.4369 29.6875 14 24.83 14C19.951 14 15.9959 19.4851 15.9959 26.2512C15.9959 26.5311 16.0026 26.7988 16.0159 27.055C13.6344 28.6054 12.4107 31.1356 13.2796 32.7392C14.1577 34.3598 16.8404 34.4205 19.2715 32.8748C19.4834 32.7401 19.6864 32.5977 19.8798 32.4487C21.1345 32.7202 22.6195 32.7163 24.2217 32.712C24.4227 32.7115 24.6255 32.7109 24.83 32.7109C25.0344 32.7109 25.2373 32.7115 25.4383 32.712Z" fill="#E17100"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 30.712C27.4385 30.7173 29.256 30.7221 30.6708 30.1912C32.8572 32.0388 35.4701 32.3689 36.5404 30.9185C37.6236 29.4507 36.7166 26.7153 34.5147 24.8087C34.237 24.5683 33.9521 24.3526 33.6639 24.1621C33.6294 17.4369 29.6875 12 24.83 12C19.951 12 15.9959 17.4851 15.9959 24.2512C15.9959 24.5311 16.0026 24.7988 16.0159 25.055C13.6344 26.6054 12.4107 29.1356 13.2796 30.7392C14.1577 32.3598 16.8404 32.4205 19.2715 30.8748C19.4834 30.7401 19.6864 30.5977 19.8798 30.4487C21.1345 30.7202 22.6195 30.7163 24.2217 30.712C24.4227 30.7115 24.6255 30.7109 24.83 30.7109C25.0344 30.7109 25.2373 30.7115 25.4383 30.712Z" fill="#FFF4BA"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 31.712C27.4385 31.7173 29.256 31.7221 30.6708 31.1912C32.8572 33.0388 35.4701 33.3689 36.5404 31.9185C37.6236 30.4507 36.7166 27.7153 34.5147 25.8087C34.237 25.5683 33.9521 25.3526 33.6639 25.1621C33.6294 18.4369 29.6875 13 24.83 13C19.951 13 15.9959 18.4851 15.9959 25.2512C15.9959 25.5311 16.0026 25.7988 16.0159 26.055C13.6344 27.6054 12.4107 30.1356 13.2796 31.7392C14.1577 33.3598 16.8404 33.4205 19.2715 31.8748C19.4834 31.7401 19.6864 31.5977 19.8798 31.4487C21.1345 31.7202 22.6195 31.7163 24.2217 31.712C24.4227 31.7115 24.6255 31.7109 24.83 31.7109C25.0344 31.7109 25.2373 31.7115 25.4383 31.712Z" fill="#FFD700"></path><ellipse cx="24.9976" cy="22.982" rx="4.14994" ry="4.14994" fill="#FFF4BA"></ellipse><ellipse cx="25.0038" cy="22.9862" rx="2.62101" ry="2.62102" fill="#E17100"></ellipse><circle cx="25.0068" cy="22.9873" r="1.97166" fill="#FFD700"></circle><circle cx="25.0015" cy="22.9801" r="0.997639" fill="#E17100"></circle><mask id="path-12-inside-1_2401_1913" fill="white"><path d="M29.4521 22.9805C29.7547 22.9805 30.0031 22.7344 29.97 22.4336C29.8463 21.3087 29.3434 20.2528 28.5355 19.4449C27.5979 18.5073 26.3261 17.9805 25 17.9805C23.6739 17.9805 22.4021 18.5073 21.4645 19.4449C20.6566 20.2528 20.1537 21.3087 20.03 22.4336C19.9969 22.7344 20.2453 22.9805 20.5479 22.9805C20.8506 22.9805 21.0919 22.7339 21.1343 22.4343C21.252 21.6007 21.6372 20.822 22.2394 20.2198C22.9715 19.4877 23.9646 19.0764 25 19.0764C26.0354 19.0764 27.0285 19.4877 27.7606 20.2198C28.3628 20.822 28.748 21.6007 28.8657 22.4343C28.9081 22.7339 29.1494 22.9805 29.4521 22.9805Z"></path></mask><path d="M29.4521 22.9805C29.7547 22.9805 30.0031 22.7344 29.97 22.4336C29.8463 21.3087 29.3434 20.2528 28.5355 19.4449C27.5979 18.5073 26.3261 17.9805 25 17.9805C23.6739 17.9805 22.4021 18.5073 21.4645 19.4449C20.6566 20.2528 20.1537 21.3087 20.03 22.4336C19.9969 22.7344 20.2453 22.9805 20.5479 22.9805C20.8506 22.9805 21.0919 22.7339 21.1343 22.4343C21.252 21.6007 21.6372 20.822 22.2394 20.2198C22.9715 19.4877 23.9646 19.0764 25 19.0764C26.0354 19.0764 27.0285 19.4877 27.7606 20.2198C28.3628 20.822 28.748 21.6007 28.8657 22.4343C28.9081 22.7339 29.1494 22.9805 29.4521 22.9805Z" stroke="#E17100" stroke-width="2" mask="url(#path-12-inside-1_2401_1913)"></path><circle cx="24.3913" cy="21.9831" r="0.613932" fill="white"></circle><ellipse cx="26.0021" cy="24.2619" rx="0.283353" ry="0.283353" fill="white"></ellipse></svg>');function Ce(s,e){const t=Ee(e,"width",3,40),i=Ee(e,"height",3,40);var o=Rn();q(()=>{de(o,"width",t()),de(o,"height",i())}),k(s,o)}var qn=L('<div class="content svelte-1fxce1q"><h1 class="svelte-1fxce1q"> </h1> <div class="scores"><h2 class="svelte-1fxce1q"> </h2> <h2 class="svelte-1fxce1q"> </h2></div> <div class="hint svelte-1fxce1q"><h2 class="svelte-1fxce1q">Hint:</h2> <p>- Click on an Enemy to kill it</p> <p>- Click on a gray spot to build a Tower</p> <p>- Click on a Tower to upgrade</p> <div class="additional-hint svelte-1fxce1q"><div>Manage your resources carefully if you want to survive until the last wave!</div> <div class="cost svelte-1fxce1q"><div class="cost-item svelte-1fxce1q"><div>Upgrading towers costs 35</div> <div><!></div></div> <div class="cost-item svelte-1fxce1q"><div>Enemy click costs 5</div> <div><!></div></div></div></div></div> <!></div>');function Un(s,e){H(e,!0);const t=B(()=>M.get("stageManager"));mi(()=>{j.reduceBgVolume()}),Ro(()=>{j.restoreBgVolume()}),pi(s,{children:(i,o)=>{var n=qn(),l=F(n),c=F(l,!0);y(l);var g=A(l,2),_=F(g),h=F(_);y(_);var f=A(_,2),w=F(f);y(f),y(g);var u=A(g,2),T=A(F(u),8),p=A(F(T),2),E=F(p),b=A(F(E),2),x=F(b);Ce(x,{width:13,height:13}),y(b),y(E);var P=A(E,2),D=A(F(P),2),S=F(D);Ce(S,{width:13,height:13}),y(D),y(P),y(p),y(T),y(u);var $=A(u,2);ye($,{get onclick(){return e.onRestart},text:"Restart"}),y(n),q(()=>{re(c,r(t).stageResult==="win"?"You win!":"You lose!"),re(h,`Enemies killed: ${ce.killsEnemy??""}`),re(w,`Score: ${ce.score??""}`)}),V(1,n,()=>jn,()=>({duration:500})),V(2,n,()=>he,()=>({duration:300})),k(i,n)},$$slots:{default:!0}}),Y()}function Nn(s){return s}function zn(s){const e=s-1;return e*e*e+1}function Qo(s){return Math.sin(-13*(s+1)*Math.PI/2)*Math.pow(2,-10*s)+1}var On=L(`<div class="overlay svelte-thh9az"><div class="backdrop svelte-thh9az"></div> <div class="hud-container svelte-thh9az"><div class="content svelte-thh9az"><button class="close-btn svelte-thh9az">&times;</button> <div class="header-section svelte-thh9az"><h2 class="modal-header svelte-thh9az">Combat Manual</h2> <div class="decoration-bar svelte-thh9az"></div></div> <div class="scroll-content svelte-thh9az"><section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">üëë</span> Defend the Throne</h3> <p class="svelte-thh9az">Enemies will attack immediately. If your Throne is destroyed, it's Game Over!</p></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">‚öîÔ∏è</span> Combat Protocol</h3> <p class="svelte-thh9az"><strong class="svelte-thh9az">Click Enemies</strong> to neutralize them directly.</p> <div class="cost-row svelte-thh9az"><span>Cost: 5 <!></span> <span class="separator svelte-thh9az">|</span> <span>Reward: Gold <!></span></div></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">‚ùì</span> The "Chance" Event</h3> <p class="svelte-thh9az">Time dilates. A query appears. Your knowledge is your weapon.</p> <ul class="svelte-thh9az"><li class="good svelte-thh9az"><strong class="svelte-thh9az">Correct:</strong> +1 Build Point (Construct Defenses).</li> <li class="bad svelte-thh9az"><strong class="svelte-thh9az">Incorrect:</strong> Strike recorded. 3 Strikes = Tower Destruction.</li></ul></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">üèóÔ∏è</span> Construction</h3> <div class="construction-grid svelte-thh9az"><div class="construction-item svelte-thh9az"><strong class="svelte-thh9az">Build</strong> <span>Click gray nodes.</span> <span class="highlight svelte-thh9az">Unlocks with Build Points</span></div> <div class="construction-item svelte-thh9az"><strong class="svelte-thh9az">Upgrade</strong> <span>Click towers.</span> <span class="highlight svelte-thh9az">Costs Gold + BP</span></div></div></section></div> <div class="footer svelte-thh9az"><!></div></div></div></div>`);function Gn(s,e){var t=On(),i=F(t),o=A(i,2),n=F(o),l=F(n);l.__click=function(...E){var b;(b=e.onClose)==null||b.apply(this,E)};var c=A(l,4),g=A(F(c),2),_=A(F(g),4),h=F(_),f=A(F(h));Ce(f,{width:12,height:12}),y(h);var w=A(h,4),u=A(F(w));Ce(u,{width:12,height:12}),y(w),y(_),y(g),ui(4),y(c);var T=A(c,2),p=F(T);ye(p,{text:"Initialize",get onclick(){return e.onClose}}),y(T),y(n),y(o),y(t),V(3,i,()=>he,()=>({duration:500})),V(3,o,()=>Cs,()=>({duration:600,start:.8,easing:Qo})),V(3,t,()=>he,()=>({duration:200})),k(s,t)}ds(["click"]);var Hn=L('<div class="content svelte-pidkvq"><img alt="Knowledge Space" style="width: 80%; max-width: 500px;" class="svelte-pidkvq"> <div class="star-container svelte-pidkvq"><img alt="Shooting Star" class="shooting-star-art svelte-pidkvq"></div> <div class="svelte-pidkvq"><h2 class="svelte-pidkvq">Hint:</h2> <p class="svelte-pidkvq">- Click on an Enemy to kill it</p> <p class="svelte-pidkvq">- Click on a gray spot to build a Tower</p> <p class="svelte-pidkvq">- Click on a Tower to upgrade</p> <div class="additional-hint svelte-pidkvq"><div class="svelte-pidkvq">Manage your resources carefully if you want to survive until the last wave!</div> <div class="cost svelte-pidkvq"><div class="cost-item svelte-pidkvq"><div class="svelte-pidkvq">Upgrading towers costs 35</div> <div class="svelte-pidkvq"><!></div></div> <div class="cost-item svelte-pidkvq"><div class="svelte-pidkvq">Enemy click costs 5</div> <div class="svelte-pidkvq"><!></div></div></div></div></div> <div class="buttons-container svelte-pidkvq"><!> <div style="height: 10px;" class="svelte-pidkvq"></div> <!></div></div>'),Yn=L("<!> <!>",1);function Qn(s,e){H(e,!0);let t=v(!1);const i=B(()=>j.preloaded?"Start game":`${j.preloadPercent}%`);var o=Yn(),n=X(o);pi(n,{children:(g,_)=>{var h=Hn(),f=F(h);de(f,"src",`${ti??""}/logos/knowledge-space2.png`);var w=A(f,2),u=F(w);de(u,"src",`${ti??""}/logos/shooting-star-realistic.png`),y(w);var T=A(w,2),p=A(F(T),8),E=A(F(p),2),b=F(E),x=A(F(b),2),P=F(x);Ce(P,{width:13,height:13}),y(x),y(b);var D=A(b,2),S=A(F(D),2),$=F(S);Ce($,{width:13,height:13}),y(S),y(D),y(E),y(p),y(T);var O=A(T,2),z=F(O),U=B(()=>!j.preloaded);ye(z,{get disabled(){return r(U)},get text(){return r(i)},get onclick(){return e.onStart}});var ae=A(z,4);ye(ae,{text:"How to Play",onclick:()=>m(t,!0)}),y(O),y(h),V(2,h,()=>he,()=>({duration:300})),k(g,h)},$$slots:{default:!0}});var l=A(n,2);{var c=g=>{Gn(g,{onClose:()=>m(t,!1)})};W(l,g=>{r(t)&&g(c)})}k(s,o),Y()}class Wn{constructor(){R(this,"filterEnemiesByBounds",e=>M.get("entityManager").livingEnemies.filter(i=>Be(i.boundingBox,e)))}update(){const e=M.get("entityManager");this.handleEnemyCollisions(e.livingEnemies,e.livingProjectiles,e.throne),this.handleProjectileCollisions(e.livingProjectiles),this.handleLootCollisions(e.livingLoot,e.throne)}handleEnemyCollisions(e,t,i){for(const o of e){for(const n of t)this.checkCollision(n,o)&&(n.onCollide(o),o.onCollide(n));this.checkCollision(o,i)&&(o.onCollide(i),i.onCollide(o))}}handleProjectileCollisions(e){for(const t of e)if(!this.checkScreenBounds(t)){t.onCollide("OUT_OF_BOUNDS");continue}}handleLootCollisions(e,t){e.forEach(i=>{this.checkCollision(i,t)&&(i.onCollide(t),t.onCollide(i))})}checkCollision(e,t){return Be(e.boundingBox,t.boundingBox)}checkBounds(e,t){return Be(e.boundingBox,t)}checkScreenBounds(e){return Be(e.boundingBox,I.screenBounds)}checkGameBounds(e){return Be(e.boundingBox,I.gameBoundingBox)}}var ut,Ms,Ps,Ds,$s,Is,js,Ls,Rs,qs,Us;class Vn{constructor(){d(this,ut,v([]));d(this,Ms,B(()=>this.entities.filter(e=>e.type==="enemy")));d(this,Ps,B(()=>this.enemies.filter(e=>e.isInteractable)));d(this,Ds,B(()=>this.entities.filter(e=>e.type==="tower")));d(this,$s,B(()=>this.towers.filter((e,t)=>t<=1)));d(this,Is,B(()=>this.towers.filter((e,t)=>t>=2)));d(this,js,B(()=>this.entities.filter(e=>e.type==="projectile")));d(this,Ls,B(()=>this.projectiles.filter(e=>e.isInteractable)));d(this,Rs,B(()=>this.entities.find(e=>e.type==="throne")));d(this,qs,B(()=>this.entities.filter(e=>e.type==="loot")));d(this,Us,B(()=>this.loot.filter(e=>e.isInteractable)));R(this,"update",e=>{this.entities.forEach(t=>t.update(e))});R(this,"reset",()=>{this.entities=[]});R(this,"add",e=>{this.entities=[...this.entities,...Array.isArray(e)?e:[e]]});R(this,"destroy",e=>{this.entities=this.entities.filter(t=>t.id!==e)});R(this,"getByName",e=>this.entities.find(t=>t.name===e));R(this,"getById",e=>this.entities.find(t=>t.id===e))}get entities(){return r(a(this,ut))}set entities(e){m(a(this,ut),e)}get enemies(){return r(a(this,Ms))}get livingEnemies(){return r(a(this,Ps))}get towers(){return r(a(this,Ds))}get topTowers(){return r(a(this,$s))}get bottomTowers(){return r(a(this,Is))}get projectiles(){return r(a(this,js))}get livingProjectiles(){return r(a(this,Ls))}get throne(){return r(a(this,Rs))}get loot(){return r(a(this,qs))}get livingLoot(){return r(a(this,Us))}filterByName(e){return this.entities.filter(t=>Array.isArray(e)?e.includes(t.name):t.name===e)}findNearestEntity(e,t){const i=t.filter(c=>c.isInteractable);if(i.length===0)return;const o=i.map(c=>e.position.distance(c.position)),n=Math.min(...o),l=o.indexOf(n);return i[l]}findNearestEntities(e,t,i=3){const o=t.filter(c=>c.isInteractable);if(o.length===0)return;const n=o.map(c=>({target:c,distance:e.position.distance(c.position)}));n.sort((c,g)=>c.distance-g.distance);const l=Math.min(i,n.length);return n.slice(0,l).map(c=>c.target)}findByPosition(e){const t=vi(e,100,100);return this.entities.filter(i=>Be(i.boundingBox,t))}}ut=new WeakMap,Ms=new WeakMap,Ps=new WeakMap,Ds=new WeakMap,$s=new WeakMap,Is=new WeakMap,js=new WeakMap,Ls=new WeakMap,Rs=new WeakMap,qs=new WeakMap,Us=new WeakMap;const po=[{commonEnemies:["PurpleCommon","YellowCommon"],time:6e4,eliteEnemies:["RedBlobElite"],spawnDelays:{common:900,elite:1400},statsAmplify:{health:1,speed:1,damage:1}},{commonEnemies:["YellowCommon","BlueCommon"],eliteEnemies:["GreenCircleElite","BlueCircleElite"],time:12e4,spawnDelays:{common:800,elite:1300},statsAmplify:{health:1.2,speed:1.2,damage:1.2}},{commonEnemies:["PurpleCommon","YellowCommon","BlueCommon"],eliteEnemies:["BlueBlobElite","GreenCircleElite","BlueCircleElite"],time:12e4,spawnDelays:{common:600,elite:1100},statsAmplify:{health:1.7,speed:1.4,damage:1.5}},{commonEnemies:["PurpleCommon","YellowCommon","BlueCommon"],eliteEnemies:["BlueCircleElite","GreenCircleElite","BlueBlobElite","RedBlobElite"],time:12e4,spawnDelays:{common:400,elite:800},statsAmplify:{health:2.2,speed:1.6,damage:1.8}}],pe=(s,e)=>{s.takeDamage(e.stats.damage)},ms=(s,e)=>{s.state.setState("Explode")},Zn=(s,e)=>{e.type==="loot"?(ce.receiveLoot(1),j.play("pickUp")):e.type==="enemy"&&s.takeDamage(e.stats.damage)},gs=(s,e)=>{e.type==="enemy"&&(s.takeDamage(1),e.takeDamage(999))},Xn=(s,e)=>{s.stopInteractions(),M.get("entityManager").destroy(s.id)},Wo={PurpleCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.6,stateToAnimation:{FollowThrone:"PurpleCommonFollow",Die:"PurpleCommonDie"},stats:{health:20,speed:.03,damage:5},onCollide:pe},YellowCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.8,stateToAnimation:{FollowThrone:"YellowCommonFollow",Die:"YellowCommonDie"},stats:{health:15,speed:.025,damage:4},onCollide:pe},BlueCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.7,stateToAnimation:{FollowThrone:"BlueCommonFollow",Die:"BlueCommonDie"},stats:{health:25,speed:.02,damage:8},onCollide:pe},GreenCircleElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"GreenCircleEliteFollow",Die:"GreenCircleEliteDie"},stats:{health:80,speed:.01,damage:15},onCollide:pe},RedBlobElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.8,stateToAnimation:{FollowThrone:"RedBlobEliteFollow",Die:"RedBlobEliteDie"},stats:{health:30,speed:.015,damage:10},onCollide:pe},BlueBlobElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"BlueBlobEliteFollow",Die:"BlueBlobEliteDie"},stats:{health:60,speed:.04,damage:8},onCollide:pe},BlueCircleElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"BlueCircleEliteFollow",Die:"BlueCircleEliteDie"},stats:{health:70,speed:.02,damage:10},onCollide:pe}},Jn=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],Kn=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],el=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],tl=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=30,s.stats.projectileNumber+=1}],K={questionInterval:8e3,initialQuestionDelay:2e3,bulletTimeFactor:.05,questionDuration:1e4,maxStrikes:3,mainTowerHP:1e3,subTowerHP:3},vs={health:K.subTowerHP,maxHealth:K.subTowerHP,attackSpeed:800,projectileNumber:1},fi={Throne:{type:"throne",stats:{health:K.mainTowerHP,maxHealth:K.mainTowerHP,damage:999,speed:0},scale:.6,stateToAnimation:{Idle:"Throne",Die:"Throne"},initialState:"Idle",onCollide:Zn},FireTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"FireTowerBase0",Shoot:"FireTowerBase0",NotBuilt:"TowerBase",Upgrade:"FireTowerUpgrade0"},effects:[],stats:{...vs,projectileType:"Fireball"},scale:.8,upgrades:Jn,onCollide:gs},ThunderTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"ThunderTowerBase0",Shoot:"ThunderTowerBase0",NotBuilt:"TowerBase",Upgrade:"ThunderTowerUpgrade0"},effects:[],stats:{...vs,attackSpeed:750,projectileType:"Thunderbolt"},scale:.8,upgrades:el,onCollide:gs},PoisonTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"PoisonTowerBase0",Shoot:"PoisonTowerBase0",NotBuilt:"TowerBase",Upgrade:"PoisonTowerUpgrade0"},effects:[],stats:{...vs,projectileType:"Poisonball"},scale:.8,upgrades:Kn,onCollide:gs},IceTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"IceTowerBase0",Shoot:"IceTowerBase0",NotBuilt:"TowerBase",Upgrade:"IceTowerUpgrade0"},effects:[],stats:{...vs,attackSpeed:850,projectileType:"Icebolt"},scale:.8,upgrades:tl,onCollide:gs}},Vo={Fireball:{type:"projectile",width:20,height:22,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"FireballFollow",FollowAngle:"FireballFollow",Explode:"FireballDie"},scale:2,stats:{health:1,speed:.5,damage:11},onCollide:ms},Icebolt:{type:"projectile",width:10,height:27,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"IceboltFollow",FollowAngle:"IceboltFollow",Explode:"IceboltDie"},scale:2,stats:{health:1,speed:.3,damage:11},onCollide:ms},Poisonball:{type:"projectile",width:17,height:16,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"PoisonballFollow",FollowAngle:"PoisonballFollow",Explode:"PoisonballDie"},scale:2,stats:{health:1,speed:.4,damage:11},onCollide:ms},Thunderbolt:{type:"projectile",width:17,height:31,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"ThunderboltFollow",FollowAngle:"ThunderboltFollow",Explode:"ThunderboltDie"},scale:2,stats:{health:1,speed:.4,damage:11},onCollide:ms},Loot:{type:"loot",vfx:[],width:14,height:19,initialState:"FollowTarget",stateToAnimation:{FollowTarget:"Loot"},scale:1,stats:{health:1,damage:0,speed:.5},onCollide:Xn},ClickExplode:{type:"projectile",vfx:[],width:30,height:30,initialState:"Explode",stateToAnimation:{Explode:"Click"},scale:1,stats:{health:1,damage:10,speed:.5}}},ri={...Wo,...fi,...Vo},fo=Object.keys(Wo).length+Object.keys(fi).length+Object.keys(Vo).length,wo=Object.keys(ri).length;if(fo!==wo)throw new Error(`Entities defined and exported do not match. Check for duplicated Entity names : Total count: ${fo} / Exported count ${wo}`);const sl=s=>{if(!ri[s])throw new Error(`Entity config not found for: ${s}`);return ri[s]};var mt;class ee{constructor(e){d(this,mt,v());this.stateMachine=e}get stateMachine(){return r(a(this,mt))}set stateMachine(e){m(a(this,mt),C(e))}update(e,t){}get name(){return this.constructor.name}get entity(){return this.stateMachine.owner}}mt=new WeakMap;let il=class extends ee{constructor(e){super(e),e.owner.stopInteractions(),this.entity.removeCollider()}update(){if(this.entity.animation.isComplete){const{entityManager:e,stageManager:t}=M.get(["entityManager","stageManager"]);e.destroy(this.entity.id),t.spawnLoot(this.entity)}}};class ol extends ee{constructor(){super(...arguments);R(this,"lastAngle",0)}update(t){this.follow(t)}follow(t){const{throne:i}=this.stateMachine.context;if(!i.width||i.position.x===0&&i.position.y===0)return;const o=i.position;this.entity.rotation=Ho(this.entity.position,o);const l=gi(this.entity.rotation).multiply(this.entity.stats.speed*t);this.entity.position=this.entity.position.add(l)}}const rl=Object.freeze(Object.defineProperty({__proto__:null,Die:il,FollowThrone:ol},Symbol.toStringTag,{value:"Module"}));class al extends ee{constructor(){super(...arguments);R(this,"isSetup",!1)}update(t,i){this.isSetup||(I.isMobile?this.entity.position.y+=30:this.entity.position.y+=35,this.isSetup=!0)}}const Zo=s=>s===1?"1":s===2?"2":"0",nl=(s,e)=>`${s.name}Upgrade${Zo(e)}`,yo=(s,e)=>`${s.name}Base${Zo(e)}`;class ll extends ee{constructor(e){super(e),this.entity.upgradeLevel+=1;const t=this.entity.upgrades[this.entity.upgradeLevel];t(this.entity),this.entity.animation.onFrameChange=i=>{},j.play("towerUpgrade")}update(e){this.entity.animation.isComplete&&(this.entity.stateToAnimation={...this.entity.stateToAnimation,Guard:yo(this.entity,this.entity.upgradeLevel),Shoot:yo(this.entity,this.entity.upgradeLevel),Upgrade:nl(this.entity,this.entity.upgradeLevel+1)},this.entity.state.setState("Guard"),this.entity.animation.onFrameChange=()=>{})}}class cl extends ee{constructor(e){super(e);const t=M.get("gameLoop"),i=this.entity.stats.attackSpeed;this.cdId=t.setCD(i,!0)}update(){const{entityManager:e,gameLoop:t}=M.get(["entityManager","gameLoop"]),i=e.findNearestEntity(this.entity,e.enemies);t.isCDReady(this.cdId)&&i&&this.stateMachine.setState("Shoot",{spawner:this.entity,target:i})}}class dl extends ee{update(){this.shoot(),this.entity.addVFX("TowerShoot"),this.entity.state.setState("Guard")}shoot(){const e=M.get("stageManager"),{spawner:t}=this.stateMachine.context,i=t.stats.projectileType,o=this.entity.stats.projectileNumber,n=t.position.add(new J(t.width/2,0)),l=M.get("entityManager");l.findNearestEntities(t,l.enemies,o).forEach(g=>{e.spawnEntity(i,n,{spawner:t,target:g})}),j.play("towerShoot")}}const hl=Object.freeze(Object.defineProperty({__proto__:null,Guard:cl,NotBuilt:al,Shoot:dl,Upgrade:ll},Symbol.toStringTag,{value:"Module"}));class ul extends ee{update(e){this.follow(e)}follow(e){const{angle:t}=this.stateMachine.context,o=gi(t).multiply(this.entity.stats.speed*e);this.entity.position=this.entity.position.add(o),this.entity.rotation=t*180/Math.PI+90}}class ml extends ee{constructor(){super(...arguments);R(this,"lastAngle",0);R(this,"rotationOffset",90)}update(t){const{target:i}=this.stateMachine.context;i!=null&&i.isInteractable?this.followTarget(t,i):this.stateMachine.setState("FollowAngle",{angle:this.lastAngle})}getTopMiddlePoint(t){return vi(t.position,t.width,t.height).topMiddle}followTarget(t,i){const o=this.entity.boundingBox.center;this.getTopMiddlePoint(i),this.lastAngle=Ho(o,i.boundingBox.center),this.entity.rotation=this.lastAngle*180/Math.PI+this.rotationOffset;const l=gi(this.lastAngle).multiply(this.entity.stats.speed*t);this.entity.position=this.entity.position.add(l)}}class gl extends ee{constructor(e){super(e),this.entity.removeCollider(),this.entity.width=30,this.entity.height=30,this.entity.animation.onFrameChange=t=>{this.entity.scale+=.5},e.owner.stopInteractions()}update(){(!this.entity.animation||this.entity.animation&&this.entity.animation.isComplete)&&(M.get("entityManager").destroy(this.entity.id),this.entity.animation.onFrameChange=()=>{})}}const vl=Object.freeze(Object.defineProperty({__proto__:null,Explode:gl,FollowAngle:ul,FollowTarget:ml},Symbol.toStringTag,{value:"Module"}));class pl extends ee{update(){}}class fl extends ee{constructor(e){super(e),M.get("stageManager").gameOver("lose")}}const wl=Object.freeze(Object.defineProperty({__proto__:null,Die:fl,Idle:pl},Symbol.toStringTag,{value:"Module"})),Co=(s,e,t,i={})=>{let o={};e==="enemy"?o=rl:e==="tower"?o=hl:["projectile","loot"].includes(e)?o=vl:e==="throne"&&(o=wl);const n=o[t];if(!n)throw new Error(`Invalid entity type: ${e} with name ${t}`);return new n(s,i)};var gt,vt;class yl{constructor({owner:e,initialState:t,onEnter:i,context:o={}}){d(this,gt,v());d(this,vt,v());this.owner=e,this.onEnter=i,this.context=o,this.onEnter(t),this.currentState=Co(this,e.type,t,o)}get currentState(){return r(a(this,gt))}set currentState(e){m(a(this,gt),C(e))}get context(){return r(a(this,vt))}set context(e){m(a(this,vt),C(e))}update(e,t){this.currentState.update(e,this.owner,t)}setState(e,t={}){e!==this.currentState.name&&(this.onEnter(e),this.context={...this.context,...t},this.currentState=Co(this,this.owner.type,e,t))}}gt=new WeakMap,vt=new WeakMap;var pt,ft,wt,yt,Ct,bt,Tt,_t,xt,Ft,Bt,At,Et,St,kt,Mt,Pt,Dt,$t,Ns;const zs=class zs{constructor(e,t,{offsetPosition:i,staticSlot:o,width:n,height:l,scale:c,rotation:g,type:_,states:h,initialState:f,onCollide:w,stats:u,upgradeLevel:T,upgrades:p,vfx:E,effects:b,stateToAnimation:x},P){R(this,"id");d(this,pt,v(0));d(this,ft,v(0));d(this,wt,v(""));d(this,yt,v(""));d(this,Ct,v(0));d(this,bt,v(0));d(this,Tt,v([]));d(this,_t,v([]));d(this,xt,v());d(this,Ft,v());d(this,Bt,v());d(this,At,v(C({})));d(this,Et,v(0));d(this,St,v(1));d(this,kt,v(1));d(this,Mt,v(!0));d(this,Pt,v(C({})));d(this,Dt,v(-1));d(this,$t,v([]));d(this,Ns,B(()=>this.upgrades.length&&this.upgradeLevel<this.upgrades.length));R(this,"setPosition",e=>{this.position=e});this.id=zs.lastId++,this.name=e,this.type=_,this.width=n,this.height=l,this.scale=c||1,this.rotation=g||0,this.position=t,this.offsetPosition=i||null,this.staticSlot=o||null,this.stats={...u},this.upgradeLevel=T||-1,this.upgrades=p||[],this.vfx=E||[],this.effects=b||[],this.stateToAnimation=x||{},this.onCollide=S=>w(this,S);const D=S=>{this.stateToAnimation[S]&&this.setAnimation(S)};this.state=new yl({owner:this,states:h,initialState:f,onEnter:D,context:P})}get x(){return r(a(this,pt))}set x(e){m(a(this,pt),C(e))}get y(){return r(a(this,ft))}set y(e){m(a(this,ft),C(e))}get name(){return r(a(this,wt))}set name(e){m(a(this,wt),C(e))}get type(){return r(a(this,yt))}set type(e){m(a(this,yt),C(e))}get width(){return r(a(this,Ct))}set width(e){m(a(this,Ct),C(e))}get height(){return r(a(this,bt))}set height(e){m(a(this,bt),C(e))}get effects(){return r(a(this,Tt))}set effects(e){m(a(this,Tt),e)}get vfx(){return r(a(this,_t))}set vfx(e){m(a(this,_t),e)}get animation(){return r(a(this,xt))}set animation(e){m(a(this,xt),e)}get position(){return r(a(this,Ft))}set position(e){m(a(this,Ft),C(e))}get state(){return r(a(this,Bt))}set state(e){m(a(this,Bt),C(e))}get stats(){return r(a(this,At))}set stats(e){m(a(this,At),C(e))}get rotation(){return r(a(this,Et))}set rotation(e){m(a(this,Et),C(e))}get scale(){return r(a(this,St))}set scale(e){m(a(this,St),C(e))}get opacity(){return r(a(this,kt))}set opacity(e){m(a(this,kt),C(e))}get isInteractable(){return r(a(this,Mt))}set isInteractable(e){m(a(this,Mt),C(e))}get stateToAnimation(){return r(a(this,Pt))}set stateToAnimation(e){m(a(this,Pt),C(e))}get upgradeLevel(){return r(a(this,Dt))}set upgradeLevel(e){m(a(this,Dt),C(e))}get upgrades(){return r(a(this,$t))}set upgrades(e){m(a(this,$t),e)}get isUpgradable(){return r(a(this,Ns))}get boundingBox(){const e=this.position.x,t=this.position.y,i=this.position.x+this.width,o=this.position.y+this.height;return{x1:e,y1:t,x2:i,y2:o,center:new J(e+this.width/2,t+this.height/2),topMiddle:new J(e+this.width/2,o)}}update(e){this.isDestroyed||(this.state.update(e),this.effects.forEach(t=>{t(this)}),this.animation&&this.animation.update(e))}setAnimation(e){const t=this.stateToAnimation[e],i=$e(t);this.animation=new Go({...i,name:t})}addEffect(e){this.effects.includes(e)||(this.effects=[...this.effects,e])}removeEffect(e){this.effects=this.effects.filter(t=>t!==e)}cleanEffects(){this.effects=[]}addVFX(e){this.vfx.includes(e)||(this.vfx=[...this.vfx,e])}removeVFX(e){this.vfx=this.vfx.filter(t=>t!==e)}cleanVFX(){this.vfx=[]}takeDamage(e){this.stats.health-=e,this.stats.health<=0&&this.state.setState("Die")}stopInteractions(){this.isInteractable=!1}removeCollider(){this.onCollide=()=>{}}};pt=new WeakMap,ft=new WeakMap,wt=new WeakMap,yt=new WeakMap,Ct=new WeakMap,bt=new WeakMap,Tt=new WeakMap,_t=new WeakMap,xt=new WeakMap,Ft=new WeakMap,Bt=new WeakMap,At=new WeakMap,Et=new WeakMap,St=new WeakMap,kt=new WeakMap,Mt=new WeakMap,Pt=new WeakMap,Dt=new WeakMap,$t=new WeakMap,Ns=new WeakMap,R(zs,"lastId",0);let ai=zs;const Cl=(s,e,t={})=>{const{context:i={},...o}=sl(s),{initialState:n,...l}=t;return n&&(o.initialState=n),new ai(s,e.clone(),o,{...i,...l})},bl=B(()=>({top:[{x:I.width*.1,y:20},{x:I.width*.3,y:20},{x:I.width*.5,y:20},{x:I.width*.7,y:20},{x:I.width*.9,y:20}],bottom:[{x:I.width*.1,y:I.height-20},{x:I.width*.3,y:I.height-20},{x:I.width*.5,y:I.height-20},{x:I.width*.7,y:I.height-20},{x:I.width*.9,y:I.height-20}],left:[{x:20,y:I.height*.1},{x:20,y:I.height*.3},{x:20,y:I.height*.5},{x:20,y:I.height*.7},{x:20,y:I.height*.9}],right:[{x:I.width-20,y:I.height*.1},{x:I.width-20,y:I.height*.3},{x:I.width-20,y:I.height*.5},{x:I.width-20,y:I.height*.7},{x:I.width-20,y:I.height*.9}]})),Tl=()=>{const s=I.isMobile?["top","bottom"]:["top","bottom","left","right"],e=s[Math.floor(Math.random()*s.length)],t=r(bl)[e];return t[Math.floor(Math.random()*t.length)]},_l=s=>s[Math.floor(Math.random()*s.length)];var It,Os,jt,Lt;class xl{constructor(){d(this,It,v(0));d(this,Os,B(()=>po[this.stageNumber]));d(this,jt,v(0));R(this,"commonSpawnCd");R(this,"eliteSpawnCd");d(this,Lt,v(""));R(this,"init",()=>{const e=M.get("gameLoop");this.commonSpawnCd=e.setCD(this.stageConfig.spawnDelays.common,!0),this.eliteSpawnCd=e.setCD(this.stageConfig.spawnDelays.elite,!0),this.spawnTowers(),this.spawnEntity("Throne",new J(0,0))});R(this,"update",e=>{const t=M.get("gameLoop");t.isCDReady(this.commonSpawnCd)&&this.spawnEnemy("common"),t.isCDReady(this.eliteSpawnCd)&&this.spawnEnemy("elite"),this.checkStageTime()});R(this,"spawnEntity",(e,t,i={})=>{const o=M.get("entityManager"),n=Cl(e,t,i);return o.add(n),n})}get stageNumber(){return r(a(this,It))}set stageNumber(e){m(a(this,It),C(e))}get stageConfig(){return r(a(this,Os))}get stageStartTime(){return r(a(this,jt))}set stageStartTime(e){m(a(this,jt),C(e))}get stageResult(){return r(a(this,Lt))}set stageResult(e){m(a(this,Lt),C(e))}reset(){this.commonSpawnCd=null,this.eliteSpawnCd=null,this.stageNumber=0,this.stageResult="",this.init()}spawnTowers(){["IceTower","FireTower","PoisonTower","ThunderTower"].forEach((e,t)=>{this.spawnEntity(e,new J(0,0))})}apllyAmlify(e){const{statsAmplify:t}=this.stageConfig;e.stats.health*=t.health,e.stats.damage*=t.damage,e.stats.speed*=t.speed}spawnEnemy(e){const t=M.get("entityManager"),i=e==="common"?this.stageConfig.commonEnemies:this.stageConfig.eliteEnemies,o=_l(i),n=Tl(),l=new J(n.x,n.y),c=this.spawnEntity(o,l,{throne:t.throne});return this.apllyAmlify(c),c}spawnLoot(e){const i=M.get("entityManager").throne;this.spawnEntity("Loot",e.boundingBox.center,{target:i})}gameOver(e){this.stageResult=e,M.get("gameLoop").pause()}checkStageTime(){const e=M.get("gameLoop");this.stageStartTime+this.stageConfig.time<e.elapsedTime&&this.nextStage()}nextStage(){if(this.stageNumber<po.length-1){const e=M.get("gameLoop");this.stageNumber++,this.stageStartTime=e.elapsedTime,this.commonSpawnCd=e.setCD(this.stageConfig.spawnDelays.common,!0),this.eliteSpawnCd=e.setCD(this.stageConfig.spawnDelays.elite,!0)}else this.gameOver("win")}}It=new WeakMap,Os=new WeakMap,jt=new WeakMap,Lt=new WeakMap;const ei=16.666;var Rt,qt,Ut,Nt,zt,Ot;const Gs=class Gs{constructor(){d(this,Rt,v(C(performance.now())));d(this,qt,v(0));d(this,Ut,v(0));d(this,Nt,v(1));d(this,zt,v(null));d(this,Ot,v(C({})));this.loop=this.loop.bind(this),this.previousTime=0,this.elapsedTime=0,this.accumulator=0}get previousTime(){return r(a(this,Rt))}set previousTime(e){m(a(this,Rt),C(e))}get accumulator(){return r(a(this,qt))}set accumulator(e){m(a(this,qt),C(e))}get elapsedTime(){return r(a(this,Ut))}set elapsedTime(e){m(a(this,Ut),C(e))}get timeScale(){return r(a(this,Nt))}set timeScale(e){m(a(this,Nt),C(e))}get pauseState(){return r(a(this,zt))}set pauseState(e){m(a(this,zt),C(e))}get cooldowns(){return r(a(this,Ot))}set cooldowns(e){m(a(this,Ot),C(e))}get elapsedInSeconds(){return this.elapsedTime/1e3}start(e){this.update=e,requestAnimationFrame(this.loop)}reset(){this.previousTime=0,this.elapsedTime=0,this.accumulator=0}loop(e){if(this.pauseState){this.previousTime=e,requestAnimationFrame(this.loop);return}let t=e-this.previousTime;for(t>250&&(t=250),this.previousTime=e,this.accumulator+=t*this.timeScale,this.elapsedTime+=t*this.timeScale;this.accumulator>=ei;)this.update(ei),this.accumulator-=ei;requestAnimationFrame(this.loop)}setCD(e,t=!1){const i=Gs.lastCDId++;return this.cooldowns[i]={waitTime:e,isInfinite:t,startTime:this.elapsedTime},i}isCDReady(e){const t=this.cooldowns[e];return!t||this.pauseState||this.elapsedTime-t.startTime<=t.waitTime?!1:t.isInfinite?(this.cooldowns[e]={...t,startTime:this.elapsedTime},!0):(delete this.cooldowns[e],!0)}pause(){this.pauseState?this.resume():this.pauseState={pausedTime:this.elapsedTime}}resume(){if(!this.pauseState)return;const e=performance.now();this.previousTime=e,this.pauseState=null}};Rt=new WeakMap,qt=new WeakMap,Ut=new WeakMap,Nt=new WeakMap,zt=new WeakMap,Ot=new WeakMap,R(Gs,"lastCDId",0);let ni=Gs;const Fl=[{id:"q1",question:"What is the capital of France?",options:["London","Berlin","Paris","Madrid"],correctIndex:2,meta:{subject:"Geography",level:"Easy"}},{id:"q2",question:"What is 12 * 12?",options:["122","144","124","148"],correctIndex:1,meta:{subject:"Math",level:"Medium"}},{id:"q3",question:"Which planet is known as the Red Planet?",options:["Earth","Mars","Jupiter","Venus"],correctIndex:1,meta:{subject:"Astronomy",level:"Easy"}},{id:"q4",question:"What is the chemical symbol for Gold?",options:["Au","Ag","Fe","Cu"],correctIndex:0,meta:{subject:"Chemistry",level:"Medium"}},{id:"q5",question:"Who wrote 'Romeo and Juliet'?",options:["Charles Dickens","William Shakespeare","Mark Twain","Jane Austen"],correctIndex:1,meta:{subject:"Literature",level:"Easy"}},{id:"q6",question:"What is the square root of 64?",options:["6","7","8","9"],correctIndex:2,meta:{subject:"Math",level:"Easy"}},{id:"q7",question:"Physics: What is the unit of force?",options:["Joule","Watt","Newton","Pascal"],correctIndex:2,meta:{subject:"Physics",level:"Medium"}},{id:"q8",question:"Which element has the atomic number 1?",options:["Helium","Hydrogen","Lithium","Carbon"],correctIndex:1,meta:{subject:"Chemistry",level:"Easy"}},{id:"q9",question:"What year did World War II end?",options:["1942","1945","1948","1950"],correctIndex:1,meta:{subject:"History",level:"Hard"}},{id:"q10",question:"What is the largest ocean on Earth?",options:["Atlantic","Indian","Arctic","Pacific"],correctIndex:3,meta:{subject:"Geography",level:"Medium"}}];var Gt,Ht,Yt,Qt,Wt,Vt,Zt,Xt,Jt,Kt;class Xo{constructor(){d(this,Gt,v(C(Fl)));d(this,Ht,v(null));d(this,Yt,v(!1));d(this,Qt,v(1));d(this,Wt,v(0));d(this,Vt,v(0));d(this,Zt,v(0));d(this,Xt,v(0));d(this,Jt,v(0));d(this,Kt,v(!1));this.reset()}get questions(){return r(a(this,Gt))}set questions(e){m(a(this,Gt),C(e))}get currentQuestion(){return r(a(this,Ht))}set currentQuestion(e){m(a(this,Ht),C(e))}get isActive(){return r(a(this,Yt))}set isActive(e){m(a(this,Yt),C(e))}get timeScale(){return r(a(this,Qt))}set timeScale(e){m(a(this,Qt),C(e))}get timer(){return r(a(this,Wt))}set timer(e){m(a(this,Wt),C(e))}get strikes(){return r(a(this,Vt))}set strikes(e){m(a(this,Vt),C(e))}get gameTimeSinceLastQuestion(){return r(a(this,Zt))}set gameTimeSinceLastQuestion(e){m(a(this,Zt),C(e))}get buildPoints(){return r(a(this,Xt))}set buildPoints(e){m(a(this,Xt),C(e))}get wrongAnswerTrigger(){return r(a(this,Jt))}set wrongAnswerTrigger(e){m(a(this,Jt),C(e))}get distortedAudio(){return r(a(this,Kt))}set distortedAudio(e){m(a(this,Kt),C(e))}reset(){this.isActive=!1,this.timeScale=1,this.strikes=0,this.buildPoints=0,this.gameTimeSinceLastQuestion=K.questionInterval-K.initialQuestionDelay,this.currentQuestion=null}update(e){if(!this.isActive)this.gameTimeSinceLastQuestion+=e,this.gameTimeSinceLastQuestion>=K.questionInterval&&this.triggerQuestion();else{const t=e/this.timeScale;this.timer-=t,this.timer<=0&&this.handleTimeout()}}triggerQuestion(){const e=Math.floor(Math.random()*this.questions.length);this.currentQuestion=this.questions[e],this.isActive=!0,this.timeScale=K.bulletTimeFactor,M.get("gameLoop").timeScale=this.timeScale,this.timer=K.questionDuration,this.gameTimeSinceLastQuestion=0,this.distortedAudio=!0,j.setDistortion(!0)}answer(e){if(!this.currentQuestion)return;e===this.currentQuestion.correctIndex?this.handleCorrect():this.handleIncorrect(),this.closeQuestion()}handleCorrect(){if(this.buildPoints>=8){console.log("Correct! Max Points Reached -> +10 Gold");const e=M.get("lootTracker");e&&e.receiveLoot(10),j.play("towerUpgrade")}else console.log("Correct! +1 Build Point"),this.buildPoints++,j.play("towerUpgrade")}handleIncorrect(){console.log("Wrong!"),this.wrongAnswerTrigger++,j.play("lowResourse"),this.strikes++,this.strikes>=K.maxStrikes&&(this.punishPlayer(),this.strikes=0)}handleTimeout(){this.handleIncorrect(),this.closeQuestion()}punishPlayer(){var o,n;console.log("PUNISHMENT: Destroying Tower");const{entityManager:e}=M.get(["entityManager"]),i=e.towers.filter(l=>l.state.currentState!=="NotBuilt"&&l.type!=="throne");if(i.length>0){const l=i[0];console.log(`Destroying tower: ${l.name}`);const c=fi[l.name];c&&(l.stats={...c.stats},l.stateToAnimation={...c.stateToAnimation}),l.upgradeLevel=-1,l.state.setState("NotBuilt");const g=M.get("particleManager"),_=((o=l.position)==null?void 0:o.x)??l.x,h=((n=l.position)==null?void 0:n.y)??l.y;g&&g.spawnExplosion(_+l.width/2,h+l.height/2,"#ff0000",30)}}closeQuestion(){this.isActive=!1,this.timeScale=1,M.get("gameLoop").timeScale=1,this.currentQuestion=null,this.distortedAudio=!1,j.setDistortion(!1)}}Gt=new WeakMap,Ht=new WeakMap,Yt=new WeakMap,Qt=new WeakMap,Wt=new WeakMap,Vt=new WeakMap,Zt=new WeakMap,Xt=new WeakMap,Jt=new WeakMap,Kt=new WeakMap;new Xo;var es,ts,ss,is,os,rs,as;class Bl{constructor(e,t,i){d(this,es,v(0));d(this,ts,v(0));d(this,ss,v(0));d(this,is,v(0));d(this,os,v(1));d(this,rs,v("#ff0000"));d(this,as,v(5));R(this,"decay",.05);this.x=e,this.y=t,this.color=i;const o=Math.random()*Math.PI*2,n=Math.random()*5+2;this.vx=Math.cos(o)*n,this.vy=Math.sin(o)*n,this.size=Math.random()*6+4,this.decay=Math.random()*.03+.02}get x(){return r(a(this,es))}set x(e){m(a(this,es),C(e))}get y(){return r(a(this,ts))}set y(e){m(a(this,ts),C(e))}get vx(){return r(a(this,ss))}set vx(e){m(a(this,ss),C(e))}get vy(){return r(a(this,is))}set vy(e){m(a(this,is),C(e))}get life(){return r(a(this,os))}set life(e){m(a(this,os),C(e))}get color(){return r(a(this,rs))}set color(e){m(a(this,rs),C(e))}get size(){return r(a(this,as))}set size(e){m(a(this,as),C(e))}update(e){this.x+=this.vx,this.y+=this.vy,this.life-=this.decay,this.size*=.95}}es=new WeakMap,ts=new WeakMap,ss=new WeakMap,is=new WeakMap,os=new WeakMap,rs=new WeakMap,as=new WeakMap;var ns;class Al{constructor(){d(this,ns,v(C([])))}get particles(){return r(a(this,ns))}set particles(e){m(a(this,ns),C(e))}update(e){this.particles=this.particles.filter(t=>t.life>0);for(const t of this.particles)t.update(e)}spawnExplosion(e,t,i="#ff4400",o=10){for(let n=0;n<o;n++)this.particles.push(new Bl(e,t,i))}}ns=new WeakMap;var ls;class El{constructor(){d(this,ls,v(!1));R(this,"update",async e=>{M.update(e),G.update(e)});R(this,"start",async()=>{M.setup(Sl());const{gameLoop:e,stageManager:t,questionManager:i}=M.get(["gameLoop","stageManager","questionManager"]);t.init(),i.reset(),e.start(this.update),j.play("bgSound"),this.isStarted=!0});R(this,"restart",()=>{const{entityManager:e,gameLoop:t,stageManager:i,questionManager:o}=M.get(["entityManager","gameLoop","stageManager","questionManager"]);t.reset(),e.reset(),i.reset(),j.reset(),ce.reset(),o.reset(),t.resume()})}get isStarted(){return r(a(this,ls))}set isStarted(e){m(a(this,ls),C(e))}}ls=new WeakMap;const Sl=()=>(M.collisionManager=new Wn,M.entityManager=new Vn,M.gameLoop=new ni,M.stageManager=new xl,M.questionManager=new Xo,M.particleManager=new Al,M),De=new El;var kl=L('<div class="content svelte-tmojwr"><div class="title svelte-tmojwr"><h1>Paused</h1></div> <div class="buttons-container svelte-tmojwr"><!> <!> <!></div></div>'),Ml=L('<div class="pause-overlay svelte-tmojwr"><!></div>');function Pl(s,e){H(e,!0);const t=()=>{j.toggleMute()};mi(()=>{j.reduceBgVolume()}),Ro(()=>{j.restoreBgVolume()});var i=Ml(),o=F(i);pi(o,{children:(n,l)=>{var c=kl(),g=A(F(c),2),_=F(g);ye(_,{text:"Resume Game",get onclick(){return e.onResume}});var h=A(_,2);ye(h,{text:"Restart Game",get onclick(){return e.onRestart}});var f=A(h,2),w=B(()=>j.isMuted?"Sound: OFF":"Sound: ON");ye(f,{get text(){return r(w)},onclick:t}),y(g),y(c),k(n,c)},$$slots:{default:!0}}),y(i),k(s,i),Y()}var Dl=L('<div class="bg-container svelte-11qp6pd"><div class="gradient-bg svelte-11qp6pd">‚Ä¶</div> <div class="stars svelte-11qp6pd"></div></div>');function bo(s){var e=Dl();k(s,e)}var $l=L('<div class="bg-container svelte-1hdxkm"><div class="gradient-bg svelte-1hdxkm"></div> <div class="aurora svelte-1hdxkm"></div> <div class="stars svelte-1hdxkm"></div></div>');function Il(s){var e=$l();k(s,e)}var jl=L('<div class="bg-container svelte-7703io"><div class="gradient-bg svelte-7703io"></div> <div class="stars svelte-7703io"></div></div>');function Ll(s){var e=jl();k(s,e)}var Rl=L('<div class="bg-container svelte-10mh7j2"><div class="quantum-base svelte-10mh7j2"></div> <div class="energy-fields svelte-10mh7j2"></div> <div class="quantum-grid svelte-10mh7j2"></div> <div class="stars svelte-10mh7j2"></div></div>');function ql(s){var e=Rl();k(s,e)}var Ul=L('<div class="background-container svelte-5o0ex9"><!></div>');function Nl(s,e){const t=[bo,Il,Ll,ql];let i=B(()=>t[e.stageNumber]||bo);var o=le(),n=X(o);si(n,()=>e.stageNumber,l=>{var c=Ul(),g=F(c);$r(g,()=>r(i),(_,h)=>{h(_,{})}),y(c),V(1,c,()=>he,()=>({duration:400})),V(2,c,()=>he,()=>({duration:300})),k(l,c)}),k(s,o)}var zl=L('<div class="loot svelte-bipu4"><!> <span class="svelte-bipu4"> </span></div>');function Ol(s,e){H(e,!0);let t=B(()=>ce.playLowLootAnimation);var i=zl();const o=B(()=>G.get("arrow"));q(()=>N(i,"cursor",r(o)));var n=F(i);Ce(n,{});var l=A(n,2);const c=B(()=>G.get("arrow"));q(()=>N(l,"cursor",r(c)));var g=F(l,!0);y(l),y(i),q(()=>{we(i,"isAnimated",r(t)),re(g,ce.collectedLoot)}),Ys("animationend",i,_=>{ce.unsetAnimation("LowLoot")}),k(s,i),Y()}var Gl=_o('<svg width="54" height="54" viewBox="0 0 54 54" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="path-1-outside-1_0_1" maskUnits="userSpaceOnUse" x="0" y="0" width="54" height="54" fill="black"><rect fill="white" width="54" height="54"></rect><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z"></path></mask><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z" fill="#D685DA"></path><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z" stroke="white" stroke-width="2" mask="url(#path-1-outside-1_0_1)"></path><circle cx="27" cy="27" r="16.5" fill="#D685DA" stroke="white"></circle><circle cx="45" cy="44" r="4.5" fill="#D685DA" stroke="white"></circle><rect x="20.5" y="20.5" width="5" height="13" rx="2.5" fill="#FFDFFC" stroke="white"></rect><rect x="28.5" y="20.5" width="5" height="13" rx="2.5" fill="#FFDFFC" stroke="white"></rect></svg>');function Hl(s){var e=Gl();k(s,e)}function To(s){return Object.prototype.toString.call(s)==="[object Date]"}function li(s,e){if(s===e||s!==s)return()=>s;const t=typeof s;if(t!==typeof e||Array.isArray(s)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(s)){const i=e.map((o,n)=>li(s[n],o));return o=>i.map(n=>n(o))}if(t==="object"){if(!s||!e)throw new Error("Object cannot be null");if(To(s)&&To(e)){const n=s.getTime(),c=e.getTime()-n;return g=>new Date(n+g*c)}const i=Object.keys(e),o={};return i.forEach(n=>{o[n]=li(s[n],e[n])}),n=>{const l={};return i.forEach(c=>{l[c]=o[c](n)}),l}}if(t==="number"){const i=e-s;return o=>s+o*i}throw new Error(`Cannot interpolate ${t} values`)}function Yl(s,e={}){const t=Lr(s);let i,o=s;function n(l,c){if(o=l,s==null)return t.set(s=l),Promise.resolve();let g=i,_=!1,{delay:h=0,duration:f=400,easing:w=Nn,interpolate:u=li}={...e,...c};if(f===0)return g&&(g.abort(),g=null),t.set(s=o),Promise.resolve();const T=oe.now()+h;let p;return i=zo(E=>{if(E<T)return!0;_||(p=u(s,l),typeof f=="function"&&(f=f(s,l)),_=!0),g&&(g.abort(),g=null);const b=E-T;return b>f?(t.set(s=l),!1):(t.set(s=p(w(b/f))),!0)}),i.promise}return{set:n,update:(l,c)=>n(l(o,s),c),subscribe:t.subscribe}}var Ql=L('<div class="star-wrapper svelte-p9wbfv"><div class="shooting-star svelte-p9wbfv"><div class="trail-lavender svelte-p9wbfv"></div> <div class="trail-cyan svelte-p9wbfv"></div> <div class="star-head svelte-p9wbfv"></div> <div class="sparkles svelte-p9wbfv"></div></div></div>'),Wl=L('<div class="meta-tag svelte-p9wbfv"><span class="meta-label svelte-p9wbfv">Subject:</span> <span class="meta-separator svelte-p9wbfv">|</span> <span class="meta-label svelte-p9wbfv">Level:</span> </div>'),Vl=L('<button class="sci-fi-btn svelte-p9wbfv"><span class="btn-text svelte-p9wbfv"> </span></button>'),Zl=L("<div></div>"),Xl=L('<div class="hud-container svelte-p9wbfv"><div class="content svelte-p9wbfv"><div class="header-section svelte-p9wbfv"><h2 class="question-header svelte-p9wbfv">Incoming Transmission</h2> <div class="timer-container svelte-p9wbfv"><div class="timer-bar svelte-p9wbfv"></div></div></div> <div class="question-box svelte-p9wbfv"><p class="question-text svelte-p9wbfv"> </p> <!></div> <div class="options-grid svelte-p9wbfv"></div> <div class="footer-section svelte-p9wbfv"><div class="status-indicator svelte-p9wbfv"><span class="status-label svelte-p9wbfv">Strikes</span> <div class="strikes-container svelte-p9wbfv"></div></div></div></div></div>'),Jl=L('<div class="overlay svelte-p9wbfv"><div class="backdrop svelte-p9wbfv"></div> <!> <!></div>');function Kl(s,e){H(e,!0);const t=Ir(),i=()=>jr(l,"$progress",t),o=B(()=>M.get("questionManager")),n=B(()=>{var u;return(u=r(o))==null?void 0:u.currentQuestion}),l=Yl(100,{duration:400,easing:zn});let c=v("idle");cs(()=>{r(o)&&r(o).isActive?(l.set(r(o).timer/1e4*100),r(c)==="idle"&&(m(c,"incoming"),j!=null&&j.preloaded&&j.play("shine"),setTimeout(()=>{m(c,"impact"),j!=null&&j.preloaded&&j.play("magicBurst")},800),setTimeout(()=>{m(c,"active")},1100))):(l.set(100,{duration:0}),m(c,"idle"))});const g=B(()=>i()<30?"#ff3333":"#d685da");function _(u){j!=null&&j.preloaded&&j.play("clickMenu",!0),r(o).answer(u)}var h=le(),f=X(h);{var w=u=>{var T=Jl(),p=F(T),E=A(p,2);{var b=D=>{var S=Ql();q(()=>we(S,"impacting",r(c)==="impact")),k(D,S)};W(E,D=>{(r(c)==="incoming"||r(c)==="impact")&&D(b)})}var x=A(E,2);{var P=D=>{var S=Xl(),$=F(S),O=F($),z=A(F(O),2),U=F(z);y(z),y(O);var ae=A(O,2),ge=F(ae),ve=F(ge,!0);y(ge);var Se=A(ge,2);{var Qs=te=>{var Te=Wl(),_e=A(F(Te)),se=A(_e,4);y(Te),q(()=>{re(_e,` ${r(n).meta.subject??""} `),re(se,` ${r(n).meta.level??""}`)}),k(te,Te)};W(Se,te=>{r(n).meta&&te(Qs)})}y(ae);var be=A(ae,2);ie(be,21,()=>r(n).options,ys,(te,Te,_e)=>{var se=Vl();se.__click=()=>_(_e);const Jo=B(()=>G.get("arrow"));q(()=>N(se,"cursor",r(Jo)));var wi=F(se),Ko=F(wi,!0);y(wi),y(se),q(()=>re(Ko,r(Te))),k(te,se)}),y(be);var ke=A(be,2),Me=F(ke),Pe=A(F(Me),2);ie(Pe,20,()=>Array(3),ys,(te,Te,_e)=>{var se=Zl();q(()=>Uo(se,`strike-dot ${(_e<r(o).strikes?"active":"")??""} svelte-p9wbfv`)),k(te,se)}),y(Pe),y(Me),y(ke),y($),y(S),q(()=>{de(U,"style",`width: ${i()??""}%; background: ${r(g)??""}; box-shadow: 0 0 10px ${r(g)??""}`),re(ve,r(n).question)}),V(1,S,()=>Cs,()=>({duration:600,start:0,easing:Qo})),k(D,S)};W(x,D=>{r(c)==="active"&&D(P)})}y(T),V(3,p,()=>he,()=>({duration:500})),k(u,T)};W(f,u=>{r(o)&&r(o).isActive&&r(n)&&u(w)})}k(s,h),Y()}ds(["click"]);var ec=L('<div class="floating-text svelte-10t94eg">+1 BP</div>'),tc=L('<div class="points-badge svelte-10t94eg"><div class="badge-content svelte-10t94eg"><span class="icon svelte-10t94eg">üèóÔ∏è</span> <span class="count svelte-10t94eg"> </span> <span class="text svelte-10t94eg">Builds Available</span></div> <!></div>'),sc=L('<div class="indicator-container svelte-10t94eg"><div class="timer-section svelte-10t94eg"><div class="label svelte-10t94eg">Next Chance:</div> <div class="progress-bar-bg svelte-10t94eg"><div class="progress-bar-fill svelte-10t94eg"></div></div></div> <!></div>');function ic(s,e){H(e,!0);const t=B(()=>M.get("questionManager")),i=B(()=>r(t)?Math.min(100,r(t).gameTimeSinceLastQuestion/K.questionInterval*100):0),o=B(()=>{var h;return((h=r(t))==null?void 0:h.buildPoints)||0});let n=0,l=v(!1);cs(()=>{r(t)&&(r(t).buildPoints>n&&(m(l,!0),setTimeout(()=>m(l,!1),1500)),n=r(t).buildPoints)});var c=le(),g=X(c);{var _=h=>{var f=sc(),w=F(f),u=A(F(w),2),T=F(u);y(u),y(w);var p=A(w,2);{var E=b=>{var x=tc(),P=F(x),D=A(F(P),2),S=F(D,!0);y(D),ui(2),y(P);var $=A(P,2);{var O=z=>{var U=ec();k(z,U)};W($,z=>{r(l)&&z(O)})}y(x),q(()=>{we(x,"has-points",r(o)>0),re(S,r(o))}),V(1,x,()=>Cs,()=>({duration:300,start:.5,opacity:0})),V(2,x,()=>Cs,()=>({duration:200,start:.8,opacity:0})),k(b,x)};W(p,b=>{r(o)>0&&b(E)})}y(f),q(()=>de(T,"style",`width: ${r(i)??""}%`)),k(h,f)};W(g,h=>{r(t)&&!r(t).isActive&&h(_)})}k(s,c),Y()}var oc=L("<div><!> <!></div>");function rc(s,e){H(e,!0);let t=v(0),i=0,o=-1;cs(()=>{const c=M.get("questionManager");c&&c.wrongAnswerTrigger!==o&&(o!==-1&&Er(t),o=c.wrongAnswerTrigger);const g=M.get("entityManager");g&&g.throne});var n=le(),l=X(n);si(l,()=>r(t),c=>{var g=oc(),_=F(g);Rr(_,e,"default",{});var h=A(_,2);si(h,()=>i,f=>{var w=le(),u=X(w);W(u,T=>{}),k(f,w)}),y(g),q(()=>Uo(g,`feedback-layer ${(r(t)>0?"shake-effect":"")??""} svelte-10dqr7b`)),k(c,g)}),k(s,n),Y()}const ac=["/projectiles/Click/0.svg","/projectiles/Click/1.svg","/projectiles/Click/2.svg","/projectiles/Click/3.svg","/projectiles/Fireball/Die/0.svg","/projectiles/Fireball/Die/1.svg","/projectiles/Fireball/Die/2.svg","/projectiles/Fireball/Follow/0.svg","/projectiles/Fireball/Follow/1.svg","/projectiles/Fireball/Follow/2.svg","/projectiles/Fireball/Follow/3.svg","/projectiles/Icebolt/Die/0.svg","/projectiles/Icebolt/Die/1.svg","/projectiles/Icebolt/Die/2.svg","/projectiles/Icebolt/Follow/0.svg","/projectiles/Icebolt/Follow/1.svg","/projectiles/Poisonball/Die/0.svg","/projectiles/Poisonball/Die/1.svg","/projectiles/Poisonball/Die/2.svg","/projectiles/Poisonball/Follow/0.svg","/projectiles/Poisonball/Follow/1.svg","/projectiles/Poisonball/Follow/2.svg","/projectiles/Poisonball/Follow/3.svg","/projectiles/Thunderbolt/Die/0.svg","/projectiles/Thunderbolt/Die/1.svg","/projectiles/Thunderbolt/Die/2.svg","/projectiles/Thunderbolt/Follow/0.svg","/projectiles/Thunderbolt/Follow/1.svg","/projectiles/Thunderbolt/Follow/2.svg","/projectiles/Thunderbolt/Follow/3.svg","/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg","/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg","/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg","/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg","/towers/FireTower/Base0.svg","/towers/FireTower/Base1.svg","/towers/FireTower/Base2.svg","/towers/FireTower/Upgrade1.svg","/towers/FireTower/Upgrade2.svg","/towers/IceTower/Base0.svg","/towers/IceTower/Base1.svg","/towers/IceTower/Base2.svg","/towers/IceTower/Upgrade1.svg","/towers/IceTower/Upgrade2.svg","/towers/PoisonTower/Base0.svg","/towers/PoisonTower/Base1.svg","/towers/PoisonTower/Base2.svg","/towers/PoisonTower/Upgrade1.svg","/towers/PoisonTower/Upgrade2.svg","/towers/ThunderTower/Base0.svg","/towers/ThunderTower/Base1.svg","/towers/ThunderTower/Base2.svg","/towers/ThunderTower/Upgrade1.svg","/towers/ThunderTower/Upgrade2.svg","/towers/Base.svg","/towers/Upgrade0.svg","/throne.svg","/logos/knowledge-space2.png","/cursors/cursor-hammer.svg","/cursors/cursor-arrow.svg","/cursors/build0.svg","/cursors/build1.svg","/cursors/build2.svg"].map(Z),nc=s=>{ce.spendLoot({type:"click",payload:{offset:new J(s.clientX,s.clientY)}})},lc=(s,e)=>{j.play("clickMenu",!0),r(e).pause()};var cc=L('<link rel="preload" as="image">'),dc=L('<div class="window-wrapper"><div class="wrapper svelte-dz30ag"><!> <!> <!> <button tabindex="-1" class="btn-pause svelte-dz30ag"><!></button> <div class="game-container svelte-dz30ag"><!></div></div></div>'),hc=L("<!> <!> <!>",1);function Tc(s,e){H(e,!0);const t=B(()=>M.get("questionManager")),i=B(()=>M.get("gameLoop")),o=B(()=>M.get("stageManager")),n=u=>{u.key==="Escape"&&(r(i).pauseState?r(i).resume():r(i).pause())};mi(()=>{j.preload()});var l=hc();Ys("keydown",Sr,n),Dr(u=>{var T=le(),p=X(T);ie(p,17,()=>ac,ys,(E,b)=>{var x=cc();q(()=>de(x,"href",r(b))),k(E,x)}),k(u,T)});var c=X(l);{var g=u=>{Qn(u,{onStart:()=>De.start()})},_=u=>{var T=le(),p=X(T);{var E=x=>{Un(x,{onRestart:()=>De.restart()})},b=x=>{var P=le(),D=X(P);{var S=$=>{Pl($,{onResume:()=>r(i).resume(),onRestart:()=>De.restart()})};W(D,$=>{r(i).pauseState&&$(S)},!0)}k(x,P)};W(p,x=>{r(o).stageResult?x(E):x(b,!1)},!0)}k(u,T)};W(c,u=>{De.isStarted?u(_,!1):u(g)})}var h=A(c,2);{var f=u=>{var T=dc();T.__click=[nc];const p=B(()=>G.get("arrow"));q(()=>N(T,"cursor",r(p)));var E=F(T),b=F(E);Nl(b,{get stageNumber(){return r(o).stageNumber}});var x=A(b,2);Ol(x,{});var P=A(x,2);ic(P,{});var D=A(P,2);D.__click=[lc,i];const S=B(()=>G.get("arrow"));q(()=>N(D,"cursor",r(S)));var $=F(D);Hl($),y(D);var O=A(D,2);N(O,"transform-origin","center");var z=F(O);rc(z,{children:(U,ae)=>{Pn(U,{})},$$slots:{default:!0}}),y(O),y(E),y(T),q(()=>{var U;return we(E,"bullet-time",(U=r(t))==null?void 0:U.isActive)}),Si(O,"offsetHeight",U=>I.gameAreaHeight=U),Si(O,"offsetWidth",U=>I.gameAreaWidth=U),k(u,T)};W(h,u=>{De.isStarted&&j.preloaded&&u(f)})}var w=A(h,2);Kl(w,{}),ki("innerWidth",u=>I.width=u),ki("innerHeight",u=>I.height=u),k(s,l),Y()}ds(["click"]);export{Tc as component};
