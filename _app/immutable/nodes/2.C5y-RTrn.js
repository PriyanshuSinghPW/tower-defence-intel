var na=Object.defineProperty;var Ai=s=>{throw TypeError(s)};var la=(s,e,t)=>e in s?na(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var j=(s,e,t)=>la(s,typeof e!="symbol"?e+"":e,t),si=(s,e,t)=>e.has(s)||Ai("Cannot "+t);var n=(s,e,t)=>(si(s,e,"read from private field"),t?t.call(s):e.get(s)),d=(s,e,t)=>e.has(s)?Ai("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),ii=(s,e,t,i)=>(si(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),Si=(s,e,t)=>(si(s,e,"access private method"),t);import{a as k,t as D,c as he,n as Js}from"../chunks/disclose-version.CevxcIVZ.js";import{h as ee,a as Do,at as ca,au as da,s as ua,J as pi,af as Io,X as Ks,A as Ee,a7 as ha,B as _s,y as Lo,ah as ma,C as ga,I as va,V as Ro,ac as fa,ad as ki,N as oi,Q as pa,F as jo,av as Fs,ae as $o,x as Bs,$ as wa,a5 as Mi,aw as wi,ax as Pi,ay as ya,U as Ca,az as ba,aA as qo,aB as yi,aC as Ta,M as xa,w as _a,aD as No,G as Uo,aE as Fa,ab as zo,n as De,aF as Ba,aa as Ea,aG as Aa,aH as Sa,aI as ka,ag as Oo,b as Qo,aJ as Ma,aK as Pa,D as Di,E as Ii,aL as Da,aM as Ia,a1 as f,g as a,Y as m,k as F,p as Q,u as Se,t as $,m as G,aN as Ci,f as J,v as A,o as _,q as x,aO as bi,aP as La}from"../chunks/runtime.BL11IQWW.js";import{a as Ra,l as ja,w as $a,e as $e,r as Go,d as qe,s as le,b as qa}from"../chunks/render.BWQL7xXt.js";import{a as C,p as be,b as Ho,i as W,c as Na,s as Ua,d as za}from"../chunks/props.C_nab1LJ.js";import{o as ei,a as Wo}from"../chunks/index-client.C4s1iBsW.js";import{b as ci,w as Oa}from"../chunks/paths.WHAOpTqT.js";import"../chunks/legacy.BwMg7t2V.js";import{s as Qa}from"../chunks/slot.1_vvGQ04.js";function di(s,e,t){ee&&Do();var i=s,o=ha,r,l=ca()?da:ua;pi(()=>{l(o,o=e())&&(r&&Io(r),r=Ks(()=>t(i)))}),ee&&(i=Ee)}function Pe(s,e){ee&&_s(Lo(s)),ma(()=>{var t=e();for(var i in t){var o=t[i];o?s.style.setProperty(i,o):s.style.removeProperty(i)}}),ga(()=>{s.remove()})}function Es(s,e){return e}function Ga(s,e,t,i){for(var o=[],r=e.length,l=0;l<r;l++)ya(e[l].e,o,!0);var c=r>0&&o.length===0&&t!==null;if(c){var g=t.parentNode;Ca(g),g.append(t),i.clear(),ye(s,e[0].prev,e[r-1].next)}ba(o,()=>{for(var b=0;b<r;b++){var p=e[b];c||(i.delete(p.k),ye(s,p.prev,p.next)),qo(p.e,!c)}})}function ne(s,e,t,i,o,r=null){var l=s,c={flags:e,items:new Map,first:null},g=(e&No)!==0;if(g){var b=s;l=ee?_s(Lo(b)):b.appendChild(_a())}ee&&Do();var p=null,w=!1;pi(()=>{var y=t(),h=va(y)?y:y==null?[]:Ro(y),v=h.length;if(w&&v===0)return;w=v===0;let u=!1;if(ee){var E=l.data===fa;E!==(v===0)&&(l=ki(),_s(l),oi(!1),u=!0)}if(ee){for(var T=null,B,I=0;I<v;I++){if(Ee.nodeType===8&&Ee.data===pa){l=Ee,u=!0,oi(!1);break}var q=h[I],S=i(q,I);B=Yo(Ee,c,T,null,q,S,I,o,e),c.items.set(S,B),T=B}v>0&&_s(ki())}if(!ee){var P=jo;Ha(h,c,l,o,e,(P.f&Fs)!==0,i)}r!==null&&(v===0?p?$o(p):p=Ks(()=>r(l)):p!==null&&Io(p,()=>{p=null})),u&&oi(!0),t()}),ee&&(l=Ee)}function Ha(s,e,t,i,o,r,l,c){var xe,we,_e,Fe;var g=(o&Fa)!==0,b=(o&(yi|wi))!==0,p=s.length,w=e.items,y=e.first,h=y,v,u=null,E,T=[],B=[],I,q,S,P;if(g)for(P=0;P<p;P+=1)I=s[P],q=l(I,P),S=w.get(q),S!==void 0&&((xe=S.a)==null||xe.measure(),(E??(E=new Set)).add(S));for(P=0;P<p;P+=1){if(I=s[P],q=l(I,P),S=w.get(q),S===void 0){var Y=h?h.e.nodes_start:t;u=Yo(Y,e,u,u===null?e.first:u.next,I,q,P,i,o),w.set(q,u),T=[],B=[],h=u.next;continue}if(b&&Wa(S,I,P,o),S.e.f&Fs&&($o(S.e),g&&((we=S.a)==null||we.unfix(),(E??(E=new Set)).delete(S))),S!==h){if(v!==void 0&&v.has(S)){if(T.length<B.length){var U=B[0],H;u=U.prev;var z=T[0],K=T[T.length-1];for(H=0;H<T.length;H+=1)Li(T[H],U,t);for(H=0;H<B.length;H+=1)v.delete(B[H]);ye(e,z.prev,K.next),ye(e,u,z),ye(e,K,U),h=U,u=K,P-=1,T=[],B=[]}else v.delete(S),Li(S,h,t),ye(e,S.prev,S.next),ye(e,S,u===null?e.first:u.next),ye(e,u,S),u=S;continue}for(T=[],B=[];h!==null&&h.k!==q;)(r||!(h.e.f&Fs))&&(v??(v=new Set)).add(h),B.push(h),h=h.next;if(h===null)continue;S=h}T.push(S),u=S,h=S.next}if(h!==null||v!==void 0){for(var V=v===void 0?[]:Ro(v);h!==null;)(r||!(h.e.f&Fs))&&V.push(h),h=h.next;var oe=V.length;if(oe>0){var Te=o&No&&p===0?t:null;if(g){for(P=0;P<oe;P+=1)(_e=V[P].a)==null||_e.measure();for(P=0;P<oe;P+=1)(Fe=V[P].a)==null||Fe.fix()}Ga(e,V,Te,w)}}g&&Uo(()=>{var me;if(E!==void 0)for(S of E)(me=S.a)==null||me.apply()}),Bs.first=e.first&&e.first.e,Bs.last=u&&u.e}function Wa(s,e,t,i){i&yi&&Pi(s.v,e),i&wi?Pi(s.i,t):s.i=t}function Yo(s,e,t,i,o,r,l,c,g,b){var p=(g&yi)!==0,w=(g&Ta)===0,y=p?w?wa(o):Mi(o):o,h=g&wi?Mi(l):l,v={i:h,v:y,k:r,a:null,e:null,prev:t,next:i};try{return v.e=Ks(()=>c(s,y,h),ee),v.e.prev=t&&t.e,v.e.next=i&&i.e,t===null?e.first=v:(t.next=v,t.e.next=v.e),i!==null&&(i.prev=v,i.e.prev=v.e),v}finally{}}function Li(s,e,t){for(var i=s.next?s.next.e.nodes_start:t,o=e?e.e.nodes_start:t,r=s.e.nodes_start;r!==i;){var l=xa(r);o.before(r),r=l}}function ye(s,e,t){e===null?s.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ya(s,e,...t){var i=s,o=De,r;pi(()=>{o!==(o=e())&&(r&&(qo(r),r=null),r=Ks(()=>o(i,...t)))},zo),ee&&(i=Ee)}function se(s,e,t,i){var o=s.__attributes??(s.__attributes={});ee&&(o[e]=s.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&s.nodeName==="LINK")||o[e]!==(o[e]=t)&&(e==="style"&&"__styles"in s&&(s.__styles={}),e==="loading"&&(s[Ba]=t),t==null?s.removeAttribute(e):typeof t!="string"&&Va(s).includes(e)?s[e]=t:s.setAttribute(e,t))}var Ri=new Map;function Va(s){var e=Ri.get(s.nodeName);if(e)return e;Ri.set(s.nodeName,e=[]);for(var t,i=s,o=Element.prototype;o!==i;){t=Aa(i);for(var r in t)t[r].set&&e.push(r);i=Ea(i)}return e}function Vo(s,e,t){var i=s.__className,o=Xa(e);ee&&s.className===o?s.__className=o:(i!==o||ee&&s.className!==o)&&(e==null?s.removeAttribute("class"):s.className=o,s.__className=o)}function Xa(s,e){return(s??"")+""}function Ae(s,e,t){if(t){if(s.classList.contains(e))return;s.classList.add(e)}else{if(!s.classList.contains(e))return;s.classList.remove(e)}}function N(s,e,t,i){var o=s.__styles??(s.__styles={});o[e]!==t&&(o[e]=t,t==null?s.style.removeProperty(e):s.style.setProperty(e,t,""))}const Za=()=>performance.now(),ue={tick:s=>requestAnimationFrame(s),now:()=>Za(),tasks:new Set};function Xo(){const s=ue.now();ue.tasks.forEach(e=>{e.c(s)||(ue.tasks.delete(e),e.f())}),ue.tasks.size!==0&&ue.tick(Xo)}function Zo(s){let e;return ue.tasks.size===0&&ue.tick(Xo),{promise:new Promise(t=>{ue.tasks.add(e={c:s,f:t})}),abort(){ue.tasks.delete(e)}}}function ys(s,e){s.dispatchEvent(new CustomEvent(e))}function Ja(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const e=s.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function ji(s){const e={},t=s.split(";");for(const i of t){const[o,r]=i.split(":");if(!o||r===void 0)break;const l=Ja(o.trim());e[l]=r.trim()}return e}const Ka=s=>s;function O(s,e,t,i){var o=(s&Da)!==0,r=(s&Ia)!==0,l=o&&r,c=(s&Ma)!==0,g=l?"both":o?"in":"out",b,p=e.inert,w,y;function h(){var B=jo,I=Bs;Di(null),Ii(null);try{return b??(b=t()(e,(i==null?void 0:i())??{},{direction:g}))}finally{Di(B),Ii(I)}}var v={is_global:c,in(){var B;if(e.inert=p,!o){y==null||y.abort(),(B=y==null?void 0:y.reset)==null||B.call(y);return}r||w==null||w.abort(),ys(e,"introstart"),w=ui(e,h(),y,1,()=>{ys(e,"introend"),w==null||w.abort(),w=b=void 0})},out(B){if(!r){B==null||B(),b=void 0;return}e.inert=!0,ys(e,"outrostart"),y=ui(e,h(),w,0,()=>{ys(e,"outroend"),B==null||B()})},stop:()=>{w==null||w.abort(),y==null||y.abort()}},u=Bs;if((u.transitions??(u.transitions=[])).push(v),o&&Ra){var E=c;if(!E){for(var T=u.parent;T&&T.f&zo;)for(;(T=T.parent)&&!(T.f&Sa););E=!T||(T.f&ka)!==0}E&&Oo(()=>{Qo(()=>v.in())})}}function ui(s,e,t,i,o){var r=i===1;if(Pa(e)){var l,c=!1;return Uo(()=>{if(!c){var E=e({direction:r?"in":"out"});l=ui(s,E,t,i,o)}}),{abort:()=>{c=!0,l==null||l.abort()},deactivate:()=>l.deactivate(),reset:()=>l.reset(),t:()=>l.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return o(),{abort:De,deactivate:De,reset:De,t:()=>i};const{delay:g=0,css:b,tick:p,easing:w=Ka}=e;var y=[];if(r&&t===void 0&&(p&&p(0,1),b)){var h=ji(b(0,1));y.push(h,h)}var v=()=>1-i,u=s.animate(y,{duration:g});return u.onfinish=()=>{var E=(t==null?void 0:t.t())??1-i;t==null||t.abort();var T=i-E,B=e.duration*Math.abs(T),I=[];if(B>0){if(b)for(var q=Math.ceil(B/16.666666666666668),S=0;S<=q;S+=1){var P=E+T*w(S/q),Y=b(P,1-P);I.push(ji(Y))}v=()=>{var U=u.currentTime;return E+T*w(U/B)},p&&Zo(()=>{if(u.playState!=="running")return!1;var U=v();return p(U,1-U),!0})}u=s.animate(I,{duration:B,fill:"forwards"}),u.onfinish=()=>{v=()=>i,p==null||p(i,1-i),o()}},{abort:()=>{u&&(u.cancel(),u.effect=null,u.onfinish=De)},deactivate:()=>{o=De},reset:()=>{i===0&&(p==null||p(1,0))},t:()=>v()}}var Ce,Le,ze,As,Jo;const Ss=class Ss{constructor(e){d(this,As);d(this,Ce,new WeakMap);d(this,Le);d(this,ze);ii(this,ze,e)}observe(e,t){var i=n(this,Ce).get(e)||new Set;return i.add(t),n(this,Ce).set(e,i),Si(this,As,Jo).call(this).observe(e,n(this,ze)),()=>{var o=n(this,Ce).get(e);o.delete(t),o.size===0&&(n(this,Ce).delete(e),n(this,Le).unobserve(e))}}};Ce=new WeakMap,Le=new WeakMap,ze=new WeakMap,As=new WeakSet,Jo=function(){return n(this,Le)??ii(this,Le,new ResizeObserver(e=>{for(var t of e){Ss.entries.set(t.target,t);for(var i of n(this,Ce).get(t.target)||[])i(t)}}))},j(Ss,"entries",new WeakMap);let hi=Ss;var er=new hi({box:"border-box"});function $i(s,e,t){var i=er.observe(s,()=>t(s[e]));Oo(()=>(Qo(()=>t(s[e])),i))}function qi(s,e){ja(window,["resize"],()=>$a(()=>e(window[s])))}var Oe;class tr{constructor(){d(this,Oe,f(C({})));j(this,"setup",e=>{this.managers=e});j(this,"update",e=>{this.managers.stageManager.update(e),this.managers.entityManager.update(e),this.managers.collisionManager.update(),this.managers.questionManager&&this.managers.questionManager.update(e),this.managers.particleManager&&this.managers.particleManager.update(e)});j(this,"get",e=>typeof e=="string"?this.managers[e]:e.reduce((t,i)=>(t[i]=this.managers[i],t),{}))}get managers(){return a(n(this,Oe))}set managers(e){m(n(this,Oe),C(e))}}Oe=new WeakMap;const R=new tr,X=s=>`${ci}${s}`,Ni=["/enemies/BlueBlobElite/Die/0.svg","/enemies/BlueBlobElite/Die/1.svg","/enemies/BlueBlobElite/Die/2.svg"],sr={name:"BlueBlobEliteDie",frames:Ni,framesAmount:Ni.length,frameRate:10,loop:!1},Ui=["/enemies/BlueBlobElite/Follow/0.svg","/enemies/BlueBlobElite/Follow/1.svg","/enemies/BlueBlobElite/Follow/2.svg","/enemies/BlueBlobElite/Follow/3.svg"],ir={name:"BlueBlobEliteFollow",frames:Ui,framesAmount:Ui.length,frameRate:10,loop:!0},zi=["/enemies/BlueCircleElite/Die/0.svg","/enemies/BlueCircleElite/Die/1.svg","/enemies/BlueCircleElite/Die/2.svg"],or={name:"BlueCircleEliteDie",frames:zi,framesAmount:zi.length,frameRate:10,loop:!1},Oi=["/enemies/BlueCircleElite/Follow/0.svg","/enemies/BlueCircleElite/Follow/1.svg","/enemies/BlueCircleElite/Follow/2.svg","/enemies/BlueCircleElite/Follow/3.svg"],ar={name:"BlueCircleEliteFollow",frames:Oi,framesAmount:Oi.length,frameRate:10,loop:!0},Qi=["/enemies/GreenCircleElite/Die/0.svg","/enemies/GreenCircleElite/Die/1.svg","/enemies/GreenCircleElite/Die/2.svg"],rr={name:"GreenCircleEliteDie",frames:Qi,framesAmount:Qi.length,frameRate:10,loop:!1},Gi=["/enemies/GreenCircleElite/Follow/0.svg","/enemies/GreenCircleElite/Follow/1.svg","/enemies/GreenCircleElite/Follow/2.svg","/enemies/GreenCircleElite/Follow/3.svg"],nr={name:"GreenCircleEliteFollow",frames:Gi,framesAmount:Gi.length,frameRate:10,loop:!0},Hi=["/enemies/RedBlobElite/Die/0.svg","/enemies/RedBlobElite/Die/1.svg","/enemies/RedBlobElite/Die/2.svg"],lr={name:"RedBlobEliteDie",frames:Hi,framesAmount:Hi.length,frameRate:10,loop:!1},Wi=["/enemies/RedBlobElite/Follow/0.svg","/enemies/RedBlobElite/Follow/1.svg","/enemies/RedBlobElite/Follow/2.svg","/enemies/RedBlobElite/Follow/3.svg"],cr={name:"RedBlobEliteFollow",frames:Wi,framesAmount:Wi.length,frameRate:10,loop:!0},Yi=["/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg"],dr={name:"BlueCommonDie",frames:Yi,framesAmount:Yi.length,frameRate:10,loop:!1},Vi=["/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg"],ur={name:"BlueCommonFollow",frames:Vi,framesAmount:Vi.length,frameRate:10,loop:!0},Xi=["/enemies/PurpleCommon/Die/0.svg","/enemies/PurpleCommon/Die/1.svg","/enemies/PurpleCommon/Die/2.svg"],hr={name:"PurpleCommonDie",frames:Xi,framesAmount:Xi.length,frameRate:10,loop:!1},Zi=["/enemies/PurpleCommon/Follow/0.svg","/enemies/PurpleCommon/Follow/1.svg","/enemies/PurpleCommon/Follow/2.svg"],mr={name:"PurpleCommonFollow",frames:Zi,framesAmount:Zi.length,frameRate:10,loop:!0},Ji=["/enemies/YellowCommon/Die/0.svg","/enemies/YellowCommon/Die/1.svg","/enemies/YellowCommon/Die/2.svg"],gr={name:"YellowCommonDie",frames:Ji,framesAmount:Ji.length,frameRate:10,loop:!1},Ki=["/enemies/YellowCommon/Follow/0.svg","/enemies/YellowCommon/Follow/1.svg","/enemies/YellowCommon/Follow/2.svg","/enemies/YellowCommon/Follow/3.svg"],vr={name:"YellowCommonFollow",frames:Ki,framesAmount:Ki.length,frameRate:10,loop:!0},fr=Object.freeze(Object.defineProperty({__proto__:null,BlueBlobEliteDie:sr,BlueBlobEliteFollow:ir,BlueCircleEliteDie:or,BlueCircleEliteFollow:ar,BlueCommonDie:dr,BlueCommonFollow:ur,GreenCircleEliteDie:rr,GreenCircleEliteFollow:nr,PurpleCommonDie:hr,PurpleCommonFollow:mr,RedBlobEliteDie:lr,RedBlobEliteFollow:cr,YellowCommonDie:gr,YellowCommonFollow:vr},Symbol.toStringTag,{value:"Module"})),pr=["/towers/Base.svg"],wr={name:"TowerBase",frames:pr,framesAmount:1,frameRate:0,loop:!0},yr=["/towers/FireTower/Base0.svg"],Cr={name:"FireTowerBase0",frames:yr,framesAmount:1,frameRate:0,loop:!0},br=["/towers/FireTower/Base1.svg"],Tr={name:"FireTowerBase1",frames:br,framesAmount:1,frameRate:0,loop:!0},xr=["/towers/FireTower/Base2.svg"],_r={name:"FireTowerBase2",frames:xr,framesAmount:1,frameRate:0,loop:!0},eo=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/FireTower/Base0.svg"],Fr={name:"FireTowerUpgrade0",frames:eo,framesAmount:eo.length,frameRate:10,loop:!1},to=["/towers/FireTower/Base0.svg","/towers/FireTower/Upgrade1.svg","/towers/FireTower/Base1.svg"],Br={name:"FireTowerUpgrade1",frames:to,framesAmount:to.length,frameRate:10,loop:!1},so=["/towers/FireTower/Base1.svg","/towers/FireTower/Upgrade2.svg","/towers/FireTower/Base2.svg"],Er={name:"FireTowerUpgrade2",frames:so,framesAmount:so.length,frameRate:10,loop:!1},Ar=["/towers/IceTower/Base0.svg"],Sr={name:"IceTowerBase0",frames:Ar,framesAmount:1,frameRate:0,loop:!0},kr=["/towers/IceTower/Base1.svg"],Mr={name:"IceTowerBase1",frames:kr,framesAmount:1,frameRate:0,loop:!0},Pr=["/towers/IceTower/Base2.svg"],Dr={name:"IceTowerBase2",frames:Pr,framesAmount:1,frameRate:0,loop:!0},io=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/IceTower/Base0.svg"],Ir={name:"IceTowerUpgrade0",frames:io,framesAmount:io.length,frameRate:10,loop:!1},oo=["/towers/IceTower/Base0.svg","/towers/IceTower/Upgrade1.svg","/towers/IceTower/Base1.svg"],Lr={name:"IceTowerUpgrade1",frames:oo,framesAmount:oo.length,frameRate:10,loop:!1},ao=["/towers/IceTower/Base1.svg","/towers/IceTower/Upgrade2.svg","/towers/IceTower/Base2.svg"],Rr={name:"IceTowerUpgrade2",frames:ao,framesAmount:ao.length,frameRate:10,loop:!1},jr=["/towers/PoisonTower/Base0.svg"],$r={name:"PoisonTowerBase0",frames:jr,framesAmount:1,frameRate:0,loop:!0},qr=["/towers/PoisonTower/Base1.svg"],Nr={name:"PoisonTowerBase1",frames:qr,framesAmount:1,frameRate:0,loop:!0},Ur=["/towers/PoisonTower/Base2.svg"],zr={name:"PoisonTowerBase2",frames:Ur,framesAmount:1,frameRate:0,loop:!0},ro=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/PoisonTower/Base0.svg"],Or={name:"PoisonTowerUpgrade0",frames:ro,framesAmount:ro.length,frameRate:10,loop:!1},no=["/towers/PoisonTower/Base0.svg","/towers/PoisonTower/Upgrade1.svg","/towers/PoisonTower/Base1.svg"],Qr={name:"PoisonTowerUpgrade1",frames:no,framesAmount:no.length,frameRate:10,loop:!1},lo=["/towers/PoisonTower/Base1.svg","/towers/PoisonTower/Upgrade2.svg","/towers/PoisonTower/Base2.svg"],Gr={name:"PoisonTowerUpgrade2",frames:lo,framesAmount:lo.length,frameRate:10,loop:!1},Hr=["/towers/ThunderTower/Base0.svg"],Wr={name:"ThunderTowerBase0",frames:Hr,framesAmount:1,frameRate:0,loop:!0},Yr=["/towers/ThunderTower/Base1.svg"],Vr={name:"ThunderTowerBase1",frames:Yr,framesAmount:1,frameRate:0,loop:!0},Xr=["/towers/ThunderTower/Base2.svg"],Zr={name:"ThunderTowerBase2",frames:Xr,framesAmount:1,frameRate:0,loop:!0},co=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/ThunderTower/Base0.svg"],Jr={name:"ThunderTowerUpgrade0",frames:co,framesAmount:co.length,frameRate:10,loop:!1},uo=["/towers/ThunderTower/Base0.svg","/towers/ThunderTower/Upgrade1.svg","/towers/ThunderTower/Base1.svg"],Kr={name:"ThunderTowerUpgrade1",frames:uo,framesAmount:uo.length,frameRate:10,loop:!1},ho=["/towers/ThunderTower/Base1.svg","/towers/ThunderTower/Upgrade2.svg","/towers/ThunderTower/Base2.svg"],en={name:"ThunderTowerUpgrade2",frames:ho,framesAmount:ho.length,frameRate:10,loop:!1},tn=Object.freeze(Object.defineProperty({__proto__:null,FireTowerBase0:Cr,FireTowerBase1:Tr,FireTowerBase2:_r,FireTowerUpgrade0:Fr,FireTowerUpgrade1:Br,FireTowerUpgrade2:Er,IceTowerBase0:Sr,IceTowerBase1:Mr,IceTowerBase2:Dr,IceTowerUpgrade0:Ir,IceTowerUpgrade1:Lr,IceTowerUpgrade2:Rr,PoisonTowerBase0:$r,PoisonTowerBase1:Nr,PoisonTowerBase2:zr,PoisonTowerUpgrade0:Or,PoisonTowerUpgrade1:Qr,PoisonTowerUpgrade2:Gr,ThunderTowerBase0:Wr,ThunderTowerBase1:Vr,ThunderTowerBase2:Zr,ThunderTowerUpgrade0:Jr,ThunderTowerUpgrade1:Kr,ThunderTowerUpgrade2:en,TowerBase:wr},Symbol.toStringTag,{value:"Module"})),mo=["/projectiles/Fireball/Die/0.svg","/projectiles/Fireball/Die/1.svg","/projectiles/Fireball/Die/2.svg"],sn={name:"FireballDie",frames:mo,framesAmount:mo.length,frameRate:10,loop:!1},go=["/projectiles/Fireball/Follow/0.svg","/projectiles/Fireball/Follow/1.svg","/projectiles/Fireball/Follow/2.svg","/projectiles/Fireball/Follow/3.svg"],on={name:"FireballFollow",frames:go,framesAmount:go.length,frameRate:10,loop:!0},vo=["/projectiles/Icebolt/Die/0.svg","/projectiles/Icebolt/Die/1.svg","/projectiles/Icebolt/Die/2.svg"],an={name:"IceboltDie",frames:vo,framesAmount:vo.length,frameRate:10,loop:!1},fo=["/projectiles/Icebolt/Follow/0.svg","/projectiles/Icebolt/Follow/1.svg"],rn={name:"IceboltFollow",frames:fo,framesAmount:fo.length,frameRate:10,loop:!0},po=["/projectiles/Poisonball/Die/0.svg","/projectiles/Poisonball/Die/1.svg","/projectiles/Poisonball/Die/2.svg"],nn={name:"PoisonballDie",frames:po,framesAmount:po.length,frameRate:10,loop:!1},wo=["/projectiles/Poisonball/Follow/0.svg","/projectiles/Poisonball/Follow/1.svg","/projectiles/Poisonball/Follow/2.svg","/projectiles/Poisonball/Follow/3.svg"],ln={name:"PoisonballFollow",frames:wo,framesAmount:wo.length,frameRate:10,loop:!0},yo=["/projectiles/Thunderbolt/Die/0.svg","/projectiles/Thunderbolt/Die/1.svg","/projectiles/Thunderbolt/Die/2.svg"],cn={name:"ThunderboltDie",frames:yo,framesAmount:yo.length,frameRate:10,loop:!1},Co=["/projectiles/Thunderbolt/Follow/0.svg","/projectiles/Thunderbolt/Follow/1.svg","/projectiles/Thunderbolt/Follow/2.svg","/projectiles/Thunderbolt/Follow/3.svg"],dn={name:"ThunderboltFollow",frames:Co,framesAmount:Co.length,frameRate:10,loop:!0},bo=["/projectiles/Click/0.svg","/projectiles/Click/1.svg","/projectiles/Click/2.svg","/projectiles/Click/3.svg"],un={name:"Click",frames:bo,framesAmount:bo.length,frameRate:10,loop:!1},hn=Object.freeze(Object.defineProperty({__proto__:null,Click:un,FireballDie:sn,FireballFollow:on,IceboltDie:an,IceboltFollow:rn,PoisonballDie:nn,PoisonballFollow:ln,ThunderboltDie:cn,ThunderboltFollow:dn},Symbol.toStringTag,{value:"Module"})),To=["/cursors/build0.svg","/cursors/build1.svg","/cursors/build2.svg"],mn={name:"TowerBuildCursor",frames:To,framesAmount:To.length,frameRate:7,loop:!1},gn=Object.freeze(Object.defineProperty({__proto__:null,TowerBuildCursor:mn},Symbol.toStringTag,{value:"Module"})),vn=["/castle/castle.png"],fn={name:"Throne",frames:vn,framesAmount:1,frameRate:0,loop:!0},pn=["/castle/castle-broken.png"],wn={name:"ThroneDamaged1",frames:pn,framesAmount:1,frameRate:0,loop:!0},yn=["/castle/castle-broken2.png"],Cn={name:"ThroneDamaged2",frames:yn,framesAmount:1,frameRate:0,loop:!0},bn=["/castle/castle-broken3.png"],Tn={name:"ThroneDamaged3",frames:bn,framesAmount:1,frameRate:0,loop:!0},xn=["/castle/castle-destroyed.png"],_n={name:"ThroneDestroyed",frames:xn,framesAmount:1,frameRate:0,loop:!1},Fn=Object.freeze(Object.defineProperty({__proto__:null,Throne:fn,ThroneDamaged1:wn,ThroneDamaged2:Cn,ThroneDamaged3:Tn,ThroneDestroyed:_n},Symbol.toStringTag,{value:"Module"})),Bn=["/loot.svg"],En={name:"Loot",frames:Bn,framesAmount:1,frameRate:0,loop:!0},xo={...Fn,Loot:En,...fr,...tn,...hn,...gn},Re=s=>{if(!xo[s])throw new Error(`Animation config not found for: ${s}`);const e=xo[s];return{...e,frames:e.frames.map(t=>X(t))}};var Qe,Ge,He,We,Ye,ks,Ve;class Ti{constructor({name:e,framesAmount:t,frameRate:i,loop:o=!1}){j(this,"name");d(this,Qe,f(0));d(this,Ge,f(0));d(this,He,f(!1));d(this,We,f(0));d(this,Ye,f(0));d(this,ks,F(()=>this.getIsAnimationComplete()));d(this,Ve,f(()=>{}));this.name=e,this.framesAmount=t,this.frameRate=i,this.loop=o}get framesAmount(){return a(n(this,Qe))}set framesAmount(e){m(n(this,Qe),C(e))}get frameRate(){return a(n(this,Ge))}set frameRate(e){m(n(this,Ge),C(e))}get loop(){return a(n(this,He))}set loop(e){m(n(this,He),C(e))}get currentFrame(){return a(n(this,We))}set currentFrame(e){m(n(this,We),C(e))}get currentFrameTime(){return a(n(this,Ye))}set currentFrameTime(e){m(n(this,Ye),C(e))}get isComplete(){return a(n(this,ks))}get onFrameChange(){return a(n(this,Ve))}set onFrameChange(e){m(n(this,Ve),C(e))}update(e){this.frameRate!==0&&(this.currentFrameTime+=e,this.currentFrameTime>=1e3/this.frameRate&&(this.currentFrameTime=0,this.nextFrame()))}nextFrame(){this.onFrameChange(this.currentFrame),this.currentFrame>=this.framesAmount-1?this.loop?this.currentFrame=0:this.currentFrame=this.framesAmount-1:this.currentFrame+=1}getIsAnimationComplete(){return this.loop?!1:this.currentFrame===this.framesAmount-1}}Qe=new WeakMap,Ge=new WeakMap,He=new WeakMap,We=new WeakMap,Ye=new WeakMap,ks=new WeakMap,Ve=new WeakMap;const _o={arrow:X("/cursors/cursor-arrow.svg"),hammer:X("/cursors/cursor-hammer.svg")};var Xe,Ms,Ps,Ds,Is;class An{constructor(){d(this,Xe,f());d(this,Ms,F(()=>`url(${_o.arrow}), auto`));d(this,Ps,F(()=>`url(${_o.hammer}), auto`));d(this,Ds,F(()=>this.animation&&!this.animation.isComplete));d(this,Is,F(()=>this.getCurrentFrame()))}get animation(){return a(n(this,Xe))}set animation(e){m(n(this,Xe),C(e))}get arrow(){return a(n(this,Ms))}get hammer(){return a(n(this,Ps))}get inAnimation(){return a(n(this,Ds))}get currentFrame(){return a(n(this,Is))}update(e){this.inAnimation&&this.animation.update(e)}get(e){return this.inAnimation?this.currentFrame:this[e]}setAnimation(e){if(!e){this.animation=null;return}const t=Re(e);this.animation=new Ti({...t})}getCurrentFrame(){const{frames:e}=Re(this.animation.name);return`url(${e[this.animation.currentFrame]}), auto`}}Xe=new WeakMap,Ms=new WeakMap,Ps=new WeakMap,Ds=new WeakMap,Is=new WeakMap;const Z=new An;var Ze,Je,Ke,et,tt,st,Ls;class Sn{constructor(){d(this,Ze,f(0));d(this,Je,f(0));d(this,Ke,f(0));d(this,et,f(0));d(this,tt,f(0));d(this,st,f(0));d(this,Ls,F(()=>this.width<768))}get width(){return a(n(this,Ze))}set width(e){m(n(this,Ze),C(e))}get height(){return a(n(this,Je))}set height(e){m(n(this,Je),C(e))}get gameAreaWidth(){return a(n(this,Ke))}set gameAreaWidth(e){m(n(this,Ke),C(e))}get gameAreaHeight(){return a(n(this,et))}set gameAreaHeight(e){m(n(this,et),C(e))}get gameXOffset(){return a(n(this,tt))}set gameXOffset(e){m(n(this,tt),C(e))}get gameYOffset(){return a(n(this,st))}set gameYOffset(e){m(n(this,st),C(e))}get isMobile(){return a(n(this,Ls))}get screenBounds(){return{x1:0,y1:0,x2:this.width,y2:this.height}}get gameBoundingBox(){return{x1:this.gameXOffset,y1:this.gameYOffset,x2:this.width,y2:this.height}}isEntityInScreen(e){const{x1:t,y1:i,x2:o,y2:r}=this.screenBounds,{x:l,y:c}=e.position;return l+e.width/2>t&&l-e.width/2<o&&c+e.height>i&&c-e.height<r}}Ze=new WeakMap,Je=new WeakMap,Ke=new WeakMap,et=new WeakMap,tt=new WeakMap,st=new WeakMap,Ls=new WeakMap;const L=new Sn;var kn=D('<img alt="Enemy animation" class="svelte-94zyf5">');function ai(s,e){Q(e,!0);let t=be(e,"entity",7),i=f(void 0),o=F(()=>Re(t().animation.name)),r=F(()=>a(o).frames[t().animation.currentFrame]),l=f(!1);function c(){m(l,!0)}const g=F(()=>L.isMobile?t().scale-.2:t().scale),b=F(()=>t().position.x),p=F(()=>t().position.y),w=F(()=>`translate(${a(b)}px, ${a(p)}px) rotate(${t().rotation}deg) scale(${a(g)})`);Se(()=>{if(!a(i)||!a(l))return;let v=a(i).getBoundingClientRect();t().width=v.width,t().height=v.height});var y=kn();const h=F(()=>Z.get("arrow"));Ho(y,v=>m(i,v),()=>a(i)),$(()=>{se(y,"src",a(r)),N(y,"left","0px"),N(y,"top","0px"),N(y,"transform",a(w)),N(y,"cursor",a(h))}),$e("load",y,c),Go(y),k(s,y),G()}var it,ot;const ve=class ve{constructor(e=0,t=0){d(this,it,f(0));d(this,ot,f(0));this.x=e,this.y=t}get x(){return a(n(this,it))}set x(e){m(n(this,it),C(e))}get y(){return a(n(this,ot))}set y(e){m(n(this,ot),C(e))}clone(){return new ve(this.x,this.y)}isEqual(e){return this.x===e.x&&this.y===e.y}add(e){return new ve(this.x+e.x,this.y+e.y)}subtract(e){return new ve(this.x-e.x,this.y-e.y)}multiply(e){return new ve(this.x*e,this.y*e)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return e?new ve(this.x/e,this.y/e):new ve}distance(e){return this.subtract(e).magnitude()}dot(e){return this.x*e.x+this.y*e.y}rotate(e){const t=Math.cos(e),i=Math.sin(e);return new ve(this.x*t-this.y*i,this.x*i+this.y*t)}};it=new WeakMap,ot=new WeakMap;let te=ve;const Mn=s=>s;function Ko(s){const e=s-1;return e*e*e+1}function ie(s,{delay:e=0,duration:t=400,easing:i=Mn}={}){const o=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:i,css:r=>`opacity: ${r*o}`}}function Pn(s,{delay:e=0,duration:t=400,easing:i=Ko,axis:o="y"}={}){const r=getComputedStyle(s),l=+r.opacity,c=o==="y"?"height":"width",g=parseFloat(r[c]),b=o==="y"?["top","bottom"]:["left","right"],p=b.map(T=>`${T[0].toUpperCase()}${T.slice(1)}`),w=parseFloat(r[`padding${p[0]}`]),y=parseFloat(r[`padding${p[1]}`]),h=parseFloat(r[`margin${p[0]}`]),v=parseFloat(r[`margin${p[1]}`]),u=parseFloat(r[`border${p[0]}Width`]),E=parseFloat(r[`border${p[1]}Width`]);return{delay:e,duration:t,easing:i,css:T=>`overflow: hidden;opacity: ${Math.min(T*20,1)*l};${c}: ${T*g}px;padding-${b[0]}: ${T*w}px;padding-${b[1]}: ${T*y}px;margin-${b[0]}: ${T*h}px;margin-${b[1]}: ${T*v}px;border-${b[0]}-width: ${T*u}px;border-${b[1]}-width: ${T*E}px;`}}function je(s,{delay:e=0,duration:t=400,easing:i=Ko,start:o=0,opacity:r=0}={}){const l=getComputedStyle(s),c=+l.opacity,g=l.transform==="none"?"":l.transform,b=1-o,p=c*(1-r);return{delay:e,duration:t,easing:i,css:(w,y)=>`
			transform: ${g} scale(${1-b*y});
			opacity: ${c-p*y}
		`}}var Dn=D('<div class="shoot-effect svelte-1yv4put"></div>');function In(s,e){Q(e,!0);let i=F(()=>{switch(e.entity.name){case"IceTower":return"#9AD5FF";case"FireTower":return"#E45F01";case"ThunderTower":return"#FFF263";case"PoisonTower":return"#6CE966";default:return"#ffffff"}}),r=F(()=>e.entity.upgradeLevel===0?{x:e.entity.width/2,y:22}:e.entity.upgradeLevel===1?{x:e.entity.width/2,y:23}:{x:e.entity.width/2,y:24});var l=Dn();$(()=>{N(l,"--effect-color",a(i)),N(l,"left",`${a(r).x}px`),N(l,"top",`${a(r).y}px`)}),$e("animationend",l,()=>{e.entity.removeVFX("TowerShoot")}),O(2,l,()=>ie,()=>({duration:40})),k(s,l),G()}var Ln=D('<div class="smoke-effect svelte-1pfktwp"></div>');function Rn(s,e){Q(e,!0);const t=174,i=249.5,o=7,r=14,c=1e3/r;let g=f(0),b=F(()=>a(g)%o*t),p=F(()=>Math.floor(a(g)/o)*i);Se(()=>{const y=setInterval(()=>{a(g)<r-1?Ci(g):(clearInterval(y),e.entity.removeVFX("Smoke"))},c);return()=>clearInterval(y)});var w=Ln();N(w,"width",`${t}px`),N(w,"height",`${i}px`),$(()=>N(w,"background-position",`-${a(b)}px -${a(p)}px`)),k(s,w),G()}var jn=D('<div class="explosion-effect svelte-6va1lc"></div>');function $n(s,e){Q(e,!0);const t=320,i=344,o=4,r=8,c=1e3/r;let g=f(0),b=F(()=>a(g)%o*t),p=F(()=>Math.floor(a(g)/o)*i);Se(()=>{const y=setInterval(()=>{a(g)<r-1?Ci(g):(clearInterval(y),e.entity.removeVFX("Explosion"))},c);return()=>clearInterval(y)});var w=jn();N(w,"width",`${t}px`),N(w,"height",`${i}px`),$(()=>N(w,"background-position",`-${a(b)}px -${a(p)}px`)),k(s,w),G()}const qn=Object.freeze(Object.defineProperty({__proto__:null,Explosion:$n,Smoke:Rn,TowerShoot:In},Symbol.toStringTag,{value:"Module"}));function Nn(s,e){Q(e,!0);const t=qn[e.name];if(!t)throw new Error(`Effect with name ${e.name} not found for entity ${e.entity.name}`);t(s,{get entity(){return e.entity}}),G()}var Un=D('<img alt="Enemy animation" class="svelte-usgp6v"> <!>',1);function ri(s,e){Q(e,!0);let t=be(e,"entity",7),i=f(void 0),o=F(()=>Re(t().animation.name)),r=F(()=>a(o).frames[t().animation.currentFrame]),l=f(!1);function c(){m(l,!0)}const g=F(()=>L.isMobile?t().scale-.2:t().scale),b=F(()=>`scale(${a(g)})`);Se(()=>{var u;if(!a(i)||!a(l))return;let h=a(i).getBoundingClientRect();const v=((u=a(i).offsetParent)==null?void 0:u.getBoundingClientRect())??{x:0,y:0};t().position=new te(h.x-v.x,h.y-v.y),t().width=h.width,t().height=h.height,console.log("entity.position",a(r),t().width,t().height,L.width)});var p=Un(),w=J(p);w.__click=function(...h){var v;(v=e.onclick)==null||v.apply(this,h)},Ho(w,h=>m(i,h),()=>a(i));var y=A(w,2);ne(y,17,()=>t().vfx,h=>h+t().vfx.length,(h,v)=>{Nn(h,{get name(){return a(v)},get entity(){return t()}})}),$(()=>{se(w,"src",a(r)),N(w,"transform",a(b))}),$e("load",w,c),Go(w),k(s,p),G()}qe(["click"]);var zn=D('<div class="particle svelte-17cbyeb"></div>'),On=D('<div class="particle-layer svelte-17cbyeb"><!></div>');function Qn(s,e){Q(e,!0);const t=F(()=>R.get("particleManager"));var i=On(),o=_(i);{var r=l=>{var c=he(),g=J(c);ne(g,16,()=>a(t).particles,b=>b,(b,p)=>{var w=zn();$(()=>{N(w,"left",`${p.x??""}px`),N(w,"top",`${p.y??""}px`),N(w,"width",`${p.size??""}px`),N(w,"height",`${p.size??""}px`),N(w,"background-color",p.color),N(w,"opacity",p.life)}),k(b,w)}),k(l,c)};W(o,l=>{a(t)&&l(r)})}x(i),k(s,i),G()}function Ie(s,e){return s.x1<=e.x2&&s.x2>=e.x1&&s.y1<=e.y2&&s.y2>=e.y1}function ea(s,e){return Math.atan2(e.y-s.y,e.x-s.x)}function xi(s){return new te(Math.cos(s),Math.sin(s))}const _i=(s,e,t)=>({x1:s.x-e/2,y1:s.y-t/2,x2:s.x+e/2,y2:s.y+t/2,center:new te(s.x,s.y),topMiddle:new te(s.x+e/2,s.y)}),ni={bgSound:X("/sound/bgSound.mp3"),effects:{pickUp:X("/sound/sfx/pickUp.m4a"),towerUpgrade:X("/sound/sfx/towerUpgrade.m4a"),clickEnemy:X("/sound/sfx/clickEnemy.m4a"),towerShoot:X("/sound/sfx/towerShoot.m4a"),clickMenu:X("/sound/sfx/clickMenu.m4a"),lowResourse:X("/sound/sfx/lowResourse.m4a"),shine:X("/sound/sfx/shine.mp3"),chime:X("/sound/sfx/chime.mp3"),magicBurst:X("/sound/sfx/magic-burst.mp3"),break:X("/sound/sfx/break-sound.mp3"),destruction:X("/sound/sfx/destruction-sound.mp3")}},Cs=.2,Gn=.3;var at,rt,nt,lt,ct,dt,ut,ht,Rs,js;class Hn{constructor(){d(this,at,f({}));d(this,rt,f(!1));d(this,nt,f(0));d(this,lt,f(null));d(this,ct,f(null));d(this,dt,f(null));d(this,ut,f(!1));d(this,ht,f(0));d(this,Rs,F(()=>Object.keys(ni.effects).length+1));d(this,js,F(()=>Math.min(Math.floor(this.loadedCount/this.totalResources*100),100)));j(this,"preload",async()=>{const e=(t,i)=>new Promise((o,r)=>{const l=new Audio(i),c=()=>{this.sounds[t]=l,this.sounds[t].volume=t==="bgSound"?Cs:Gn,this.sounds[t].loop=t==="bgSound",this.loadedCount+=1,l.removeEventListener("canplaythrough",c),o()},g=b=>{l.removeEventListener("error",g),r(b)};l.addEventListener("canplaythrough",c),l.addEventListener("error",g),l.load()});try{await e("bgSound",ni.bgSound);const t=Object.entries(ni.effects).map(([i,o])=>e(i,o));await Promise.all(t),this.preloaded=!0,console.log("Sounds preloaded successfully.")}catch(t){throw console.error("Error preloading sounds:",t),t}});j(this,"reduceBgVolume",()=>{this.sounds.bgSound.volume=Cs-.2});j(this,"restoreBgVolume",()=>{this.sounds.bgSound.volume=Cs});j(this,"initAudioContext",()=>{if(this.audioContext)return;const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e;const t=this.sounds.bgSound;t&&(this.bgNode=this.audioContext.createMediaElementSource(t),this.bgFilter=this.audioContext.createBiquadFilter(),this.bgFilter.type="lowpass",this.bgFilter.frequency.value=22050,this.bgNode.connect(this.bgFilter),this.bgFilter.connect(this.audioContext.destination))});j(this,"play",(e,t=!1)=>{if(this.isMuted)return;const i=this.sounds[e];if(i){if(e==="bgSound"){this.initAudioContext(),this.audioContext.state==="suspended"&&this.audioContext.resume(),i.currentTime=0,i.play();return}if(!(navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"))&&(t||this.playingEffectsCount<10)){i.currentTime=0,i.play();const o=()=>{this.playingEffectsCount-=1,i.removeEventListener("ended",o)};i.addEventListener("ended",o),this.playingEffectsCount+=1}}})}get sounds(){return a(n(this,at))}set sounds(e){m(n(this,at),e)}get isMuted(){return a(n(this,rt))}set isMuted(e){m(n(this,rt),C(e))}get playingEffectsCount(){return a(n(this,nt))}set playingEffectsCount(e){m(n(this,nt),C(e))}get audioContext(){return a(n(this,lt))}set audioContext(e){m(n(this,lt),e)}get bgNode(){return a(n(this,ct))}set bgNode(e){m(n(this,ct),e)}get bgFilter(){return a(n(this,dt))}set bgFilter(e){m(n(this,dt),e)}get preloaded(){return a(n(this,ut))}set preloaded(e){m(n(this,ut),C(e))}get loadedCount(){return a(n(this,ht))}set loadedCount(e){m(n(this,ht),C(e))}get totalResources(){return a(n(this,Rs))}get preloadPercent(){return a(n(this,js))}pause(e){const t=this.sounds[e];t&&t.pause()}toggleMute(){this.isMuted=!this.isMuted,this.isMuted?this.pause("bgSound"):this.play("bgSound")}reset(){if(this.isMuted)return;const e=this.sounds.bgSound;e&&(e.currentTime=0,e.volume=Cs,e.play())}setDistortion(e){if(!this.bgFilter||!this.audioContext)return;const t=this.audioContext.currentTime,i=e?600:22050;this.bgFilter.frequency.cancelScheduledValues(t),this.bgFilter.frequency.exponentialRampToValueAtTime(i,t+.5)}}at=new WeakMap,rt=new WeakMap,nt=new WeakMap,lt=new WeakMap,ct=new WeakMap,dt=new WeakMap,ut=new WeakMap,ht=new WeakMap,Rs=new WeakMap,js=new WeakMap;const M=new Hn,Wn={click:5,upgrade:35};var mt,gt,vt,ft,pt,wt;class Yn{constructor(){d(this,mt,f(100));d(this,gt,f(!1));d(this,vt,f(!1));d(this,ft,f(!1));d(this,pt,f(100));d(this,wt,f(0))}get collectedLoot(){return a(n(this,mt))}set collectedLoot(e){m(n(this,mt),C(e))}get playLowLootAnimation(){return a(n(this,gt))}set playLowLootAnimation(e){m(n(this,gt),C(e))}get playTowerUpgradeAnimation(){return a(n(this,vt))}set playTowerUpgradeAnimation(e){m(n(this,vt),C(e))}get playEnemyClickAnimation(){return a(n(this,ft))}set playEnemyClickAnimation(e){m(n(this,ft),C(e))}get score(){return a(n(this,pt))}set score(e){m(n(this,pt),C(e))}get killsEnemy(){return a(n(this,wt))}set killsEnemy(e){m(n(this,wt),C(e))}spendLoot(e){const t=Wn[e.type];if(e.type==="upgrade"){const{questionManager:i}=R.get(["questionManager"]),{tower:o}=e.payload;if(o.state.currentState.name==="NotBuilt"){i.buildPoints>0?(i.buildPoints--,o.state.setState("Guard"),o.stats.health=o.stats.maxHealth||3):this.playAnimation("LowLoot");return}else{this.collectedLoot>=t?i.buildPoints>0?(this.collectedLoot-=t,i.buildPoints--,o.state.setState("Upgrade"),this.playAnimation("TowerUpgrade"),Z.setAnimation("TowerBuildCursor")):this.playAnimation("LowLoot"):this.playAnimation("LowLoot");return}}if(this.collectedLoot<t){this.playAnimation("LowLoot");return}if(e.type==="click"){const{collisionManager:i,stageManager:o}=R.get(["collisionManager","stageManager"]),{offset:r}=e.payload,l=_i(r,60,60),c=i.filterEnemiesByBounds(l);o.spawnEntity("ClickExplode",r),M.play("clickEnemy",!0),c.forEach(g=>{g.state.setState("Die")}),c.length>0&&(this.collectedLoot-=t)}}receiveLoot(e){this.collectedLoot+=e,this.score+=e,this.killsEnemy++}reset(){this.collectedLoot=100,this.killsEnemy=0}getAnimation(e){return`play${e}Animation`}playAnimation(e){const t=this.getAnimation(e);this[t]=!0}unsetAnimation(e){const t=this.getAnimation(e);this[t]=!1}}mt=new WeakMap,gt=new WeakMap,vt=new WeakMap,ft=new WeakMap,pt=new WeakMap,wt=new WeakMap;const pe=new Yn;var Vn=D('<div class="segment-marker svelte-1syar9e"></div>'),Xn=D('<div class="health-bar-container svelte-1syar9e"><div class="health-bar-background svelte-1syar9e"><!> <div class="health-bar-fill svelte-1syar9e"></div></div></div>');function Zn(s,e){Q(e,!0);const t=e.entity.stats.maxHealth||500,i=5,o=F(()=>Math.max(0,Math.min(100,e.entity.stats.health/t*100))),r=Array.from({length:i-1},(w,y)=>(y+1)*(100/i));var l=Xn();const c=F(()=>Z.get("arrow"));$(()=>N(l,"cursor",a(c)));var g=_(l),b=_(g);ne(b,17,()=>r,Es,(w,y)=>{var h=Vn();$(()=>N(h,"left",`${a(y)??""}%`)),k(w,h)});var p=A(b,2);x(g),x(l),$(()=>{Ae(p,"low",a(o)<=20),Ae(p,"medium",a(o)>20&&a(o)<=60),Ae(p,"high",a(o)>60),N(p,"width",`${a(o)??""}%`)}),k(s,l),G()}var Jn=D('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Kn=D('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),el=D('<div class="tower-wrapper svelte-1u5gm4i"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div>'),tl=D('<div class="tower-wrapper svelte-1u5gm4i"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div>'),sl=D('<section class="svelte-1u5gm4i"><div class="grid-plane svelte-1u5gm4i"></div> <!> <!> <!> <div class="towers svelte-1u5gm4i"></div> <div class="throne svelte-1u5gm4i"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="towers svelte-1u5gm4i"></div> <!></section>');function il(s,e){Q(e,!0);const t=F(()=>R.get("entityManager")),i=u=>E=>{E.stopPropagation(),!(u.upgradeLevel===2||!u.isUpgradable||Z.inAnimation)&&pe.spendLoot({type:"upgrade",payload:{tower:u}})};var o=sl();const r=F(()=>Z.get("arrow"));$(()=>N(o,"cursor",a(r)));var l=A(_(o),2);ne(l,17,()=>a(t).loot,u=>u.id,(u,E)=>{var T=Jn(),B=J(T);Pe(B,()=>({"--z-index":11})),ai(B.lastChild,{get entity(){return a(E)}}),x(B),k(u,T)});var c=A(l,2);ne(c,17,()=>a(t).projectiles,u=>u.id,(u,E)=>{var T=Kn(),B=J(T);Pe(B,()=>({"--z-index":12})),ai(B.lastChild,{get entity(){return a(E)}}),x(B),k(u,T)});var g=A(c,2);ne(g,17,()=>a(t).enemies,u=>u.id,(u,E)=>{ai(u,{get entity(){return a(E)}})});var b=A(g,2);ne(b,23,()=>a(t).topTowers,u=>u.id,(u,E,T)=>{var B=el(),I=_(B),q=F(()=>i(a(E)));Pe(I,()=>({"--cursor":Z.get("hammer"),"--z-index":10,"--pointer-events":"auto","--margin-left":a(T)===0?"12px":"0","--margin-right":a(T)===1?"12px":"0"})),ri(I.lastChild,{get entity(){return a(E)},get onclick(){return a(q)}}),x(I),x(B),k(u,B)}),x(b);var p=A(b,2),w=_(p);Pe(w,()=>({"--cursor":Z.get("arrow")})),ri(w.lastChild,{get entity(){return a(t).throne}}),x(w);var y=A(w,2);Pe(y,()=>({"--width":`${a(t).throne.width}px`})),Zn(y.lastChild,{get entity(){return a(t).throne}}),x(y),x(p);var h=A(p,2);ne(h,23,()=>a(t).bottomTowers,u=>u.id,(u,E,T)=>{var B=tl(),I=_(B),q=F(()=>i(a(E)));Pe(I,()=>({"--cursor":Z.get("hammer"),"--z-index":10,"--pointer-events":"auto","--margin-left":a(T)===0?"12px":"0","--margin-right":a(T)===1?"12px":"0"})),ri(I.lastChild,{get entity(){return a(E)},get onclick(){return a(q)}}),x(I),x(B),k(u,B)}),x(h);var v=A(h,2);Qn(v,{}),x(o),k(s,o),G()}const ol=(s,e)=>{M!=null&&M.preloaded&&M.play("clickMenu",!0),e.onclick()};var al=D('<button class="btn svelte-11ulr"> <div class="tab svelte-11ulr"></div></button>');function fe(s,e){Q(e,!0);const t=be(e,"disabled",3,!1),i=be(e,"text",3,"");var o=al();o.__click=[ol,e];const r=F(()=>Z.get("arrow"));var l=_(o);bi(),x(o),$(()=>{o.disabled=t(),N(o,"cursor",a(r)),le(l,`${i()??""} `)}),k(s,o),G()}qe(["click"]);var rl=D('<div class="menu-container svelte-n7rxky"><div class="grid-overlay svelte-n7rxky"></div> <div class="scan-line svelte-n7rxky"></div> <div class="menu-content svelte-n7rxky"><!></div></div>');function Fi(s,e){Q(e,!0);var t=rl();const i=F(()=>Z.get("arrow"));$(()=>N(t,"cursor",a(i)));var o=A(_(t),4),r=_(o);Ya(r,()=>e.children),x(o),x(t),O(1,t,()=>ie,()=>({duration:200})),O(2,t,()=>ie,()=>({duration:200})),k(s,t),G()}var nl=Js('<svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="25" cy="25" r="24.5" fill="#FFD700" stroke="white"></circle><circle cx="25" cy="25" r="18" fill="#FFAE00"></circle><path d="M43 25C43 20.2261 41.1036 15.6477 37.7279 12.2721C34.3523 8.89642 29.7739 7 25 7C20.2261 7 15.6477 8.89642 12.2721 12.2721C8.89642 15.6477 7 20.2261 7 25H7.72C7.72 20.4171 9.54057 16.0218 12.7812 12.7812C16.0218 9.54057 20.4171 7.72 25 7.72C29.5829 7.72 33.9782 9.54057 37.2188 12.7812C40.4594 16.0218 42.28 20.4171 42.28 25H43Z" fill="#E17100"></path><path d="M43 25C43 29.7739 41.1036 34.3523 37.7279 37.7279C34.3523 41.1036 29.7739 43 25 43C20.2261 43 15.6477 41.1036 12.2721 37.7279C8.89642 34.3523 7 29.7739 7 25H7.72C7.72 29.5829 9.54057 33.9782 12.7812 37.2188C16.0218 40.4594 20.4171 42.28 25 42.28C29.5829 42.28 33.9782 40.4594 37.2188 37.2188C40.4594 33.9782 42.28 29.5829 42.28 25H43Z" fill="#FFF4BA"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 32.712C27.4385 32.7173 29.256 32.7221 30.6708 32.1912C32.8572 34.0388 35.4701 34.3689 36.5404 32.9185C37.6236 31.4507 36.7166 28.7153 34.5147 26.8087C34.237 26.5683 33.9521 26.3526 33.6639 26.1621C33.6294 19.4369 29.6875 14 24.83 14C19.951 14 15.9959 19.4851 15.9959 26.2512C15.9959 26.5311 16.0026 26.7988 16.0159 27.055C13.6344 28.6054 12.4107 31.1356 13.2796 32.7392C14.1577 34.3598 16.8404 34.4205 19.2715 32.8748C19.4834 32.7401 19.6864 32.5977 19.8798 32.4487C21.1345 32.7202 22.6195 32.7163 24.2217 32.712C24.4227 32.7115 24.6255 32.7109 24.83 32.7109C25.0344 32.7109 25.2373 32.7115 25.4383 32.712Z" fill="#E17100"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 30.712C27.4385 30.7173 29.256 30.7221 30.6708 30.1912C32.8572 32.0388 35.4701 32.3689 36.5404 30.9185C37.6236 29.4507 36.7166 26.7153 34.5147 24.8087C34.237 24.5683 33.9521 24.3526 33.6639 24.1621C33.6294 17.4369 29.6875 12 24.83 12C19.951 12 15.9959 17.4851 15.9959 24.2512C15.9959 24.5311 16.0026 24.7988 16.0159 25.055C13.6344 26.6054 12.4107 29.1356 13.2796 30.7392C14.1577 32.3598 16.8404 32.4205 19.2715 30.8748C19.4834 30.7401 19.6864 30.5977 19.8798 30.4487C21.1345 30.7202 22.6195 30.7163 24.2217 30.712C24.4227 30.7115 24.6255 30.7109 24.83 30.7109C25.0344 30.7109 25.2373 30.7115 25.4383 30.712Z" fill="#FFF4BA"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 31.712C27.4385 31.7173 29.256 31.7221 30.6708 31.1912C32.8572 33.0388 35.4701 33.3689 36.5404 31.9185C37.6236 30.4507 36.7166 27.7153 34.5147 25.8087C34.237 25.5683 33.9521 25.3526 33.6639 25.1621C33.6294 18.4369 29.6875 13 24.83 13C19.951 13 15.9959 18.4851 15.9959 25.2512C15.9959 25.5311 16.0026 25.7988 16.0159 26.055C13.6344 27.6054 12.4107 30.1356 13.2796 31.7392C14.1577 33.3598 16.8404 33.4205 19.2715 31.8748C19.4834 31.7401 19.6864 31.5977 19.8798 31.4487C21.1345 31.7202 22.6195 31.7163 24.2217 31.712C24.4227 31.7115 24.6255 31.7109 24.83 31.7109C25.0344 31.7109 25.2373 31.7115 25.4383 31.712Z" fill="#FFD700"></path><ellipse cx="24.9976" cy="22.982" rx="4.14994" ry="4.14994" fill="#FFF4BA"></ellipse><ellipse cx="25.0038" cy="22.9862" rx="2.62101" ry="2.62102" fill="#E17100"></ellipse><circle cx="25.0068" cy="22.9873" r="1.97166" fill="#FFD700"></circle><circle cx="25.0015" cy="22.9801" r="0.997639" fill="#E17100"></circle><mask id="path-12-inside-1_2401_1913" fill="white"><path d="M29.4521 22.9805C29.7547 22.9805 30.0031 22.7344 29.97 22.4336C29.8463 21.3087 29.3434 20.2528 28.5355 19.4449C27.5979 18.5073 26.3261 17.9805 25 17.9805C23.6739 17.9805 22.4021 18.5073 21.4645 19.4449C20.6566 20.2528 20.1537 21.3087 20.03 22.4336C19.9969 22.7344 20.2453 22.9805 20.5479 22.9805C20.8506 22.9805 21.0919 22.7339 21.1343 22.4343C21.252 21.6007 21.6372 20.822 22.2394 20.2198C22.9715 19.4877 23.9646 19.0764 25 19.0764C26.0354 19.0764 27.0285 19.4877 27.7606 20.2198C28.3628 20.822 28.748 21.6007 28.8657 22.4343C28.9081 22.7339 29.1494 22.9805 29.4521 22.9805Z"></path></mask><path d="M29.4521 22.9805C29.7547 22.9805 30.0031 22.7344 29.97 22.4336C29.8463 21.3087 29.3434 20.2528 28.5355 19.4449C27.5979 18.5073 26.3261 17.9805 25 17.9805C23.6739 17.9805 22.4021 18.5073 21.4645 19.4449C20.6566 20.2528 20.1537 21.3087 20.03 22.4336C19.9969 22.7344 20.2453 22.9805 20.5479 22.9805C20.8506 22.9805 21.0919 22.7339 21.1343 22.4343C21.252 21.6007 21.6372 20.822 22.2394 20.2198C22.9715 19.4877 23.9646 19.0764 25 19.0764C26.0354 19.0764 27.0285 19.4877 27.7606 20.2198C28.3628 20.822 28.748 21.6007 28.8657 22.4343C28.9081 22.7339 29.1494 22.9805 29.4521 22.9805Z" stroke="#E17100" stroke-width="2" mask="url(#path-12-inside-1_2401_1913)"></path><circle cx="24.3913" cy="21.9831" r="0.613932" fill="white"></circle><ellipse cx="26.0021" cy="24.2619" rx="0.283353" ry="0.283353" fill="white"></ellipse></svg>');function Ue(s,e){const t=be(e,"width",3,40),i=be(e,"height",3,40);var o=nl();$(()=>{se(o,"width",t()),se(o,"height",i())}),k(s,o)}var ll=D('<div class="content svelte-1fxce1q"><h1 class="svelte-1fxce1q"> </h1> <div class="scores"><h2 class="svelte-1fxce1q"> </h2> <h2 class="svelte-1fxce1q"> </h2></div> <div class="hint svelte-1fxce1q"><h2 class="svelte-1fxce1q">Hint:</h2> <p>- Click on an Enemy to kill it</p> <p>- Click on a gray spot to build a Tower</p> <p>- Click on a Tower to upgrade</p> <div class="additional-hint svelte-1fxce1q"><div>Manage your resources carefully if you want to survive until the last wave!</div> <div class="cost svelte-1fxce1q"><div class="cost-item svelte-1fxce1q"><div>Upgrading towers costs 35</div> <div><!></div></div> <div class="cost-item svelte-1fxce1q"><div>Enemy click costs 5</div> <div><!></div></div></div></div></div> <!></div>');function cl(s,e){Q(e,!0);const t=F(()=>R.get("stageManager"));ei(()=>{M.reduceBgVolume()}),Wo(()=>{M.restoreBgVolume()}),Fi(s,{children:(i,o)=>{var r=ll(),l=_(r),c=_(l,!0);x(l);var g=A(l,2),b=_(g),p=_(b);x(b);var w=A(b,2),y=_(w);x(w),x(g);var h=A(g,2),v=A(_(h),8),u=A(_(v),2),E=_(u),T=A(_(E),2),B=_(T);Ue(B,{width:13,height:13}),x(T),x(E);var I=A(E,2),q=A(_(I),2),S=_(q);Ue(S,{width:13,height:13}),x(q),x(I),x(u),x(v),x(h);var P=A(h,2);fe(P,{get onclick(){return e.onRestart},text:"Restart"}),x(r),$(()=>{le(c,a(t).stageResult==="win"?"You win!":"You lose!"),le(p,`Enemies killed: ${pe.killsEnemy??""}`),le(y,`Score: ${pe.score??""}`)}),O(1,r,()=>Pn,()=>({duration:500})),O(2,r,()=>ie,()=>({duration:300})),k(i,r)},$$slots:{default:!0}}),G()}function dl(s){return s}function ul(s){const e=s-1;return e*e*e+1}function ti(s){return Math.sin(-13*(s+1)*Math.PI/2)*Math.pow(2,-10*s)+1}var hl=D(`<div class="overlay svelte-thh9az"><div class="backdrop svelte-thh9az"></div> <div class="hud-container svelte-thh9az"><div class="content svelte-thh9az"><button class="close-btn svelte-thh9az">&times;</button> <div class="header-section svelte-thh9az"><h2 class="modal-header svelte-thh9az">Combat Manual</h2> <div class="decoration-bar svelte-thh9az"></div></div> <div class="scroll-content svelte-thh9az"><section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">üëë</span> Defend the Throne</h3> <p class="svelte-thh9az">Enemies will attack immediately. If your Throne is destroyed, it's Game Over!</p></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">‚öîÔ∏è</span> Combat Protocol</h3> <p class="svelte-thh9az"><strong class="svelte-thh9az">Click Enemies</strong> to neutralize them directly.</p> <div class="cost-row svelte-thh9az"><span>Cost: 5 <!></span> <span class="separator svelte-thh9az">|</span> <span>Reward: Gold <!></span></div></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">‚ùì</span> The "Chance" Event</h3> <p class="svelte-thh9az">Time dilates. A query appears. Your knowledge is your weapon.</p> <ul class="svelte-thh9az"><li class="good svelte-thh9az"><strong class="svelte-thh9az">Correct:</strong> +1 Build Point (Construct Defenses).</li> <li class="bad svelte-thh9az"><strong class="svelte-thh9az">Incorrect:</strong> Strike recorded. 3 Strikes = Tower Destruction.</li></ul></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">üèóÔ∏è</span> Construction</h3> <div class="construction-grid svelte-thh9az"><div class="construction-item svelte-thh9az"><strong class="svelte-thh9az">Build</strong> <span>Click gray nodes.</span> <span class="highlight svelte-thh9az">Unlocks with Build Points</span></div> <div class="construction-item svelte-thh9az"><strong class="svelte-thh9az">Upgrade</strong> <span>Click towers.</span> <span class="highlight svelte-thh9az">Costs Gold + BP</span></div></div></section></div> <div class="footer svelte-thh9az"><!></div></div></div></div>`);function ml(s,e){var t=hl(),i=_(t),o=A(i,2),r=_(o),l=_(r);l.__click=function(...E){var T;(T=e.onClose)==null||T.apply(this,E)};var c=A(l,4),g=A(_(c),2),b=A(_(g),4),p=_(b),w=A(_(p));Ue(w,{width:12,height:12}),x(p);var y=A(p,4),h=A(_(y));Ue(h,{width:12,height:12}),x(y),x(b),x(g),bi(4),x(c);var v=A(c,2),u=_(v);fe(u,{text:"Initialize",get onclick(){return e.onClose}}),x(v),x(r),x(o),x(t),O(3,i,()=>ie,()=>({duration:500})),O(3,o,()=>je,()=>({duration:600,start:.8,easing:ti})),O(3,t,()=>ie,()=>({duration:200})),k(s,t)}qe(["click"]);var gl=D('<div class="content svelte-p6vcf4"><img alt="Knowledge Space" style="width: 80%; max-width: 500px;" class="svelte-p6vcf4"> <div class="star-container svelte-p6vcf4"><img alt="Shooting Star" class="shooting-star-art svelte-p6vcf4"></div> <div class="svelte-p6vcf4"><h2 class="svelte-p6vcf4">Hint:</h2> <p class="svelte-p6vcf4">- Click on an Enemy to kill it</p> <p class="svelte-p6vcf4">- Click on a gray spot to build a Tower</p> <p class="svelte-p6vcf4">- Click on a Tower to upgrade</p></div> <div class="buttons-container svelte-p6vcf4"><!> <div style="height: 10px;" class="svelte-p6vcf4"></div> <!></div></div>'),vl=D("<!> <!>",1);function fl(s,e){Q(e,!0);let t=f(!1);const i=F(()=>M.preloaded?"Start game":`${M.preloadPercent}%`);var o=vl(),r=J(o);Fi(r,{children:(g,b)=>{var p=gl(),w=_(p);se(w,"src",`${ci??""}/logos/knowledge-space2.png`);var y=A(w,2),h=_(y);se(h,"src",`${ci??""}/enemies/enemies-riding-art.png`),x(y);var v=A(y,4),u=_(v),E=F(()=>!M.preloaded);fe(u,{get disabled(){return a(E)},get text(){return a(i)},get onclick(){return e.onStart}});var T=A(u,4);fe(T,{text:"How to Play",onclick:()=>m(t,!0)}),x(v),x(p),O(2,p,()=>ie,()=>({duration:300})),k(g,p)},$$slots:{default:!0}});var l=A(r,2);{var c=g=>{ml(g,{onClose:()=>m(t,!1)})};W(l,g=>{a(t)&&g(c)})}k(s,o),G()}class pl{constructor(){j(this,"filterEnemiesByBounds",e=>R.get("entityManager").livingEnemies.filter(i=>Ie(i.boundingBox,e)))}update(){const e=R.get("entityManager");this.handleEnemyCollisions(e.livingEnemies,e.livingProjectiles,e.throne),this.handleProjectileCollisions(e.livingProjectiles),this.handleLootCollisions(e.livingLoot,e.throne)}handleEnemyCollisions(e,t,i){for(const o of e){for(const r of t)this.checkCollision(r,o)&&(r.onCollide(o),o.onCollide(r));this.checkCollision(o,i)&&(o.onCollide(i),i.onCollide(o))}}handleProjectileCollisions(e){for(const t of e)if(!this.checkScreenBounds(t)){t.onCollide("OUT_OF_BOUNDS");continue}}handleLootCollisions(e,t){e.forEach(i=>{this.checkCollision(i,t)&&(i.onCollide(t),t.onCollide(i))})}checkCollision(e,t){return Ie(e.boundingBox,t.boundingBox)}checkBounds(e,t){return Ie(e.boundingBox,t)}checkScreenBounds(e){return Ie(e.boundingBox,L.screenBounds)}checkGameBounds(e){return Ie(e.boundingBox,L.gameBoundingBox)}}var yt,$s,qs,Ns,Us,zs,Os,Qs,Gs,Hs,Ws;class wl{constructor(){d(this,yt,f([]));d(this,$s,F(()=>this.entities.filter(e=>e.type==="enemy")));d(this,qs,F(()=>this.enemies.filter(e=>e.isInteractable)));d(this,Ns,F(()=>this.entities.filter(e=>e.type==="tower")));d(this,Us,F(()=>this.towers.filter((e,t)=>t<=1)));d(this,zs,F(()=>this.towers.filter((e,t)=>t>=2)));d(this,Os,F(()=>this.entities.filter(e=>e.type==="projectile")));d(this,Qs,F(()=>this.projectiles.filter(e=>e.isInteractable)));d(this,Gs,F(()=>this.entities.find(e=>e.type==="throne")));d(this,Hs,F(()=>this.entities.filter(e=>e.type==="loot")));d(this,Ws,F(()=>this.loot.filter(e=>e.isInteractable)));j(this,"update",e=>{this.entities.forEach(t=>t.update(e))});j(this,"reset",()=>{this.entities=[]});j(this,"add",e=>{this.entities=[...this.entities,...Array.isArray(e)?e:[e]]});j(this,"destroy",e=>{this.entities=this.entities.filter(t=>t.id!==e)});j(this,"getByName",e=>this.entities.find(t=>t.name===e));j(this,"getById",e=>this.entities.find(t=>t.id===e))}get entities(){return a(n(this,yt))}set entities(e){m(n(this,yt),e)}get enemies(){return a(n(this,$s))}get livingEnemies(){return a(n(this,qs))}get towers(){return a(n(this,Ns))}get topTowers(){return a(n(this,Us))}get bottomTowers(){return a(n(this,zs))}get projectiles(){return a(n(this,Os))}get livingProjectiles(){return a(n(this,Qs))}get throne(){return a(n(this,Gs))}get loot(){return a(n(this,Hs))}get livingLoot(){return a(n(this,Ws))}filterByName(e){return this.entities.filter(t=>Array.isArray(e)?e.includes(t.name):t.name===e)}findNearestEntity(e,t){const i=t.filter(c=>c.isInteractable);if(i.length===0)return;const o=i.map(c=>e.position.distance(c.position)),r=Math.min(...o),l=o.indexOf(r);return i[l]}findNearestEntities(e,t,i=3){const o=t.filter(c=>c.isInteractable);if(o.length===0)return;const r=o.map(c=>({target:c,distance:e.position.distance(c.position)}));r.sort((c,g)=>c.distance-g.distance);const l=Math.min(i,r.length);return r.slice(0,l).map(c=>c.target)}findByPosition(e){const t=_i(e,100,100);return this.entities.filter(i=>Ie(i.boundingBox,t))}}yt=new WeakMap,$s=new WeakMap,qs=new WeakMap,Ns=new WeakMap,Us=new WeakMap,zs=new WeakMap,Os=new WeakMap,Qs=new WeakMap,Gs=new WeakMap,Hs=new WeakMap,Ws=new WeakMap;const Fo=[{commonEnemies:["PurpleCommon","YellowCommon"],time:6e4,eliteEnemies:["RedBlobElite"],spawnDelays:{common:900,elite:1400},statsAmplify:{health:1,speed:1,damage:1}},{commonEnemies:["YellowCommon","BlueCommon"],eliteEnemies:["GreenCircleElite","BlueCircleElite"],time:12e4,spawnDelays:{common:800,elite:1300},statsAmplify:{health:1.2,speed:1.2,damage:1.2}},{commonEnemies:["PurpleCommon","YellowCommon","BlueCommon"],eliteEnemies:["BlueBlobElite","GreenCircleElite","BlueCircleElite"],time:12e4,spawnDelays:{common:600,elite:1100},statsAmplify:{health:1.7,speed:1.4,damage:1.5}},{commonEnemies:["PurpleCommon","YellowCommon","BlueCommon"],eliteEnemies:["BlueCircleElite","GreenCircleElite","BlueBlobElite","RedBlobElite"],time:12e4,spawnDelays:{common:400,elite:800},statsAmplify:{health:2.2,speed:1.6,damage:1.8}}],Be=(s,e)=>{s.takeDamage(e.stats.damage)},bs=(s,e)=>{s.state.setState("Explode")},yl=(s,e)=>{e.type==="loot"?(pe.receiveLoot(1),M.play("pickUp")):e.type==="enemy"&&s.takeDamage(e.stats.damage)},Ts=(s,e)=>{e.type==="enemy"&&(s.takeDamage(1),e.takeDamage(999))},Cl=(s,e)=>{s.stopInteractions(),R.get("entityManager").destroy(s.id)},ta={PurpleCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.6,stateToAnimation:{FollowThrone:"PurpleCommonFollow",Die:"PurpleCommonDie"},stats:{health:20,speed:.03,damage:5},onCollide:Be},YellowCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.8,stateToAnimation:{FollowThrone:"YellowCommonFollow",Die:"YellowCommonDie"},stats:{health:15,speed:.025,damage:4},onCollide:Be},BlueCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.7,stateToAnimation:{FollowThrone:"BlueCommonFollow",Die:"BlueCommonDie"},stats:{health:25,speed:.02,damage:8},onCollide:Be},GreenCircleElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"GreenCircleEliteFollow",Die:"GreenCircleEliteDie"},stats:{health:80,speed:.01,damage:15},onCollide:Be},RedBlobElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.8,stateToAnimation:{FollowThrone:"RedBlobEliteFollow",Die:"RedBlobEliteDie"},stats:{health:30,speed:.015,damage:10},onCollide:Be},BlueBlobElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"BlueBlobEliteFollow",Die:"BlueBlobEliteDie"},stats:{health:60,speed:.04,damage:8},onCollide:Be},BlueCircleElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"BlueCircleEliteFollow",Die:"BlueCircleEliteDie"},stats:{health:70,speed:.02,damage:10},onCollide:Be}},bl=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],Tl=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],xl=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],_l=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=30,s.stats.projectileNumber+=1}],re={questionInterval:15e3,bulletTimeFactor:.05,questionDuration:1e4,maxStrikes:3,mainTowerHP:1e3,subTowerHP:3},xs={health:re.subTowerHP,maxHealth:re.subTowerHP,attackSpeed:800,projectileNumber:1},Bi={Throne:{type:"throne",stats:{health:re.mainTowerHP,maxHealth:re.mainTowerHP,damage:999,speed:0},scale:.6,stateToAnimation:{Idle:"Throne",Die:"ThroneDestroyed"},initialState:"Idle",onCollide:yl},FireTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"FireTowerBase0",Shoot:"FireTowerBase0",NotBuilt:"TowerBase",Upgrade:"FireTowerUpgrade0"},effects:[],stats:{...xs,projectileType:"Fireball"},scale:.8,upgrades:bl,onCollide:Ts},ThunderTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"ThunderTowerBase0",Shoot:"ThunderTowerBase0",NotBuilt:"TowerBase",Upgrade:"ThunderTowerUpgrade0"},effects:[],stats:{...xs,attackSpeed:750,projectileType:"Thunderbolt"},scale:.8,upgrades:xl,onCollide:Ts},PoisonTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"PoisonTowerBase0",Shoot:"PoisonTowerBase0",NotBuilt:"TowerBase",Upgrade:"PoisonTowerUpgrade0"},effects:[],stats:{...xs,projectileType:"Poisonball"},scale:.8,upgrades:Tl,onCollide:Ts},IceTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"IceTowerBase0",Shoot:"IceTowerBase0",NotBuilt:"TowerBase",Upgrade:"IceTowerUpgrade0"},effects:[],stats:{...xs,attackSpeed:850,projectileType:"Icebolt"},scale:.8,upgrades:_l,onCollide:Ts}},sa={Fireball:{type:"projectile",width:20,height:22,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"FireballFollow",FollowAngle:"FireballFollow",Explode:"FireballDie"},scale:2,stats:{health:1,speed:.5,damage:11},onCollide:bs},Icebolt:{type:"projectile",width:10,height:27,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"IceboltFollow",FollowAngle:"IceboltFollow",Explode:"IceboltDie"},scale:2,stats:{health:1,speed:.3,damage:11},onCollide:bs},Poisonball:{type:"projectile",width:17,height:16,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"PoisonballFollow",FollowAngle:"PoisonballFollow",Explode:"PoisonballDie"},scale:2,stats:{health:1,speed:.4,damage:11},onCollide:bs},Thunderbolt:{type:"projectile",width:17,height:31,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"ThunderboltFollow",FollowAngle:"ThunderboltFollow",Explode:"ThunderboltDie"},scale:2,stats:{health:1,speed:.4,damage:11},onCollide:bs},Loot:{type:"loot",vfx:[],width:14,height:19,initialState:"FollowTarget",stateToAnimation:{FollowTarget:"Loot"},scale:1,stats:{health:1,damage:0,speed:.5},onCollide:Cl},ClickExplode:{type:"projectile",vfx:[],width:30,height:30,initialState:"Explode",stateToAnimation:{Explode:"Click"},scale:1,stats:{health:1,damage:10,speed:.5}}},mi={...ta,...Bi,...sa},Bo=Object.keys(ta).length+Object.keys(Bi).length+Object.keys(sa).length,Eo=Object.keys(mi).length;if(Bo!==Eo)throw new Error(`Entities defined and exported do not match. Check for duplicated Entity names : Total count: ${Bo} / Exported count ${Eo}`);const Fl=s=>{if(!mi[s])throw new Error(`Entity config not found for: ${s}`);return mi[s]};var Ct;class ce{constructor(e){d(this,Ct,f());this.stateMachine=e}get stateMachine(){return a(n(this,Ct))}set stateMachine(e){m(n(this,Ct),C(e))}update(e,t){}get name(){return this.constructor.name}get entity(){return this.stateMachine.owner}}Ct=new WeakMap;let Bl=class extends ce{constructor(e){super(e),e.owner.stopInteractions(),this.entity.removeCollider()}update(){if(this.entity.animation.isComplete){const{entityManager:e,stageManager:t}=R.get(["entityManager","stageManager"]);e.destroy(this.entity.id),t.spawnLoot(this.entity)}}};class El extends ce{constructor(){super(...arguments);j(this,"lastAngle",0)}update(t){this.follow(t)}follow(t){const{throne:i}=this.stateMachine.context;if(!i.width||i.position.x===0&&i.position.y===0)return;const o=i.position;this.entity.rotation=ea(this.entity.position,o);const l=xi(this.entity.rotation).multiply(this.entity.stats.speed*t);this.entity.position=this.entity.position.add(l)}}const Al=Object.freeze(Object.defineProperty({__proto__:null,Die:Bl,FollowThrone:El},Symbol.toStringTag,{value:"Module"}));class Sl extends ce{constructor(){super(...arguments);j(this,"isSetup",!1)}update(t,i){this.isSetup||(L.isMobile?this.entity.position.y+=30:this.entity.position.y+=35,this.isSetup=!0)}}const ia=s=>s===1?"1":s===2?"2":"0",kl=(s,e)=>`${s.name}Upgrade${ia(e)}`,Ao=(s,e)=>`${s.name}Base${ia(e)}`;class Ml extends ce{constructor(e){super(e),this.entity.upgradeLevel+=1;const t=this.entity.upgrades[this.entity.upgradeLevel];t(this.entity),this.entity.animation.onFrameChange=i=>{},M.play("towerUpgrade")}update(e){this.entity.animation.isComplete&&(this.entity.stateToAnimation={...this.entity.stateToAnimation,Guard:Ao(this.entity,this.entity.upgradeLevel),Shoot:Ao(this.entity,this.entity.upgradeLevel),Upgrade:kl(this.entity,this.entity.upgradeLevel+1)},this.entity.state.setState("Guard"),this.entity.animation.onFrameChange=()=>{})}}class Pl extends ce{constructor(e){super(e);const t=R.get("gameLoop"),i=this.entity.stats.attackSpeed;this.cdId=t.setCD(i,!0)}update(){const{entityManager:e,gameLoop:t}=R.get(["entityManager","gameLoop"]),i=e.findNearestEntity(this.entity,e.enemies);t.isCDReady(this.cdId)&&i&&this.stateMachine.setState("Shoot",{spawner:this.entity,target:i})}}class Dl extends ce{update(){this.shoot(),this.entity.addVFX("TowerShoot"),this.entity.state.setState("Guard")}shoot(){const e=R.get("stageManager"),{spawner:t}=this.stateMachine.context,i=t.stats.projectileType,o=this.entity.stats.projectileNumber,r=t.position.add(new te(t.width/2,0)),l=R.get("entityManager");l.findNearestEntities(t,l.enemies,o).forEach(g=>{e.spawnEntity(i,r,{spawner:t,target:g})}),M.play("towerShoot")}}const Il=Object.freeze(Object.defineProperty({__proto__:null,Guard:Pl,NotBuilt:Sl,Shoot:Dl,Upgrade:Ml},Symbol.toStringTag,{value:"Module"}));class Ll extends ce{update(e){this.follow(e)}follow(e){const{angle:t}=this.stateMachine.context,o=xi(t).multiply(this.entity.stats.speed*e);this.entity.position=this.entity.position.add(o),this.entity.rotation=t*180/Math.PI+90}}class Rl extends ce{constructor(){super(...arguments);j(this,"lastAngle",0);j(this,"rotationOffset",90)}update(t){const{target:i}=this.stateMachine.context;i!=null&&i.isInteractable?this.followTarget(t,i):this.stateMachine.setState("FollowAngle",{angle:this.lastAngle})}getTopMiddlePoint(t){return _i(t.position,t.width,t.height).topMiddle}followTarget(t,i){const o=this.entity.boundingBox.center;this.getTopMiddlePoint(i),this.lastAngle=ea(o,i.boundingBox.center),this.entity.rotation=this.lastAngle*180/Math.PI+this.rotationOffset;const l=xi(this.lastAngle).multiply(this.entity.stats.speed*t);this.entity.position=this.entity.position.add(l)}}class jl extends ce{constructor(e){super(e),this.entity.removeCollider(),this.entity.width=30,this.entity.height=30,this.entity.animation.onFrameChange=t=>{this.entity.scale+=.5},e.owner.stopInteractions()}update(){(!this.entity.animation||this.entity.animation&&this.entity.animation.isComplete)&&(R.get("entityManager").destroy(this.entity.id),this.entity.animation.onFrameChange=()=>{})}}const $l=Object.freeze(Object.defineProperty({__proto__:null,Explode:jl,FollowAngle:Ll,FollowTarget:Rl},Symbol.toStringTag,{value:"Module"}));class ql extends ce{constructor(){super(...arguments);j(this,"lastAnimName","")}update(t,i){if(!i||!i.stats)return;const o=i.stats.health/i.stats.maxHealth;let r="Throne";if(o<=0?r="ThroneDestroyed":o<.25?r="ThroneDamaged3":o<.5?r="ThroneDamaged2":o<.75&&(r="ThroneDamaged1"),i.animation&&i.animation.name!==r){this.lastAnimName&&this.lastAnimName!==r&&(i.removeVFX("Smoke"),i.addVFX("Smoke"),M.play("break"));const l=Re(r);i.animation=new Ti(l),this.lastAnimName=r}else!this.lastAnimName&&i.animation&&(this.lastAnimName=i.animation.name)}}class Nl extends ce{constructor(e){super(e),this.entity.stopInteractions(),this.entity.addVFX("Explosion"),M.play("destruction"),setTimeout(()=>{R.get("stageManager").gameOver("lose")},2e3)}}const Ul=Object.freeze(Object.defineProperty({__proto__:null,Die:Nl,Idle:ql},Symbol.toStringTag,{value:"Module"})),So=(s,e,t,i={})=>{let o={};e==="enemy"?o=Al:e==="tower"?o=Il:["projectile","loot"].includes(e)?o=$l:e==="throne"&&(o=Ul);const r=o[t];if(!r)throw new Error(`Invalid entity type: ${e} with name ${t}`);return new r(s,i)};var bt,Tt;class zl{constructor({owner:e,initialState:t,onEnter:i,context:o={}}){d(this,bt,f());d(this,Tt,f());this.owner=e,this.onEnter=i,this.context=o,this.onEnter(t),this.currentState=So(this,e.type,t,o)}get currentState(){return a(n(this,bt))}set currentState(e){m(n(this,bt),C(e))}get context(){return a(n(this,Tt))}set context(e){m(n(this,Tt),C(e))}update(e,t){this.currentState.update(e,this.owner,t)}setState(e,t={}){e!==this.currentState.name&&(this.onEnter(e),this.context={...this.context,...t},this.currentState=So(this,this.owner.type,e,t))}}bt=new WeakMap,Tt=new WeakMap;var xt,_t,Ft,Bt,Et,At,St,kt,Mt,Pt,Dt,It,Lt,Rt,jt,$t,qt,Nt,Ut,Ys;const Vs=class Vs{constructor(e,t,{offsetPosition:i,staticSlot:o,width:r,height:l,scale:c,rotation:g,type:b,states:p,initialState:w,onCollide:y,stats:h,upgradeLevel:v,upgrades:u,vfx:E,effects:T,stateToAnimation:B},I){j(this,"id");d(this,xt,f(0));d(this,_t,f(0));d(this,Ft,f(""));d(this,Bt,f(""));d(this,Et,f(0));d(this,At,f(0));d(this,St,f([]));d(this,kt,f([]));d(this,Mt,f());d(this,Pt,f());d(this,Dt,f());d(this,It,f(C({})));d(this,Lt,f(0));d(this,Rt,f(1));d(this,jt,f(1));d(this,$t,f(!0));d(this,qt,f(C({})));d(this,Nt,f(-1));d(this,Ut,f([]));d(this,Ys,F(()=>this.upgrades.length&&this.upgradeLevel<this.upgrades.length));j(this,"setPosition",e=>{this.position=e});this.id=Vs.lastId++,this.name=e,this.type=b,this.width=r,this.height=l,this.scale=c||1,this.rotation=g||0,this.position=t,this.offsetPosition=i||null,this.staticSlot=o||null,this.stats={...h},this.upgradeLevel=v||-1,this.upgrades=u||[],this.vfx=E||[],this.effects=T||[],this.stateToAnimation=B||{},this.onCollide=S=>y(this,S);const q=S=>{this.stateToAnimation[S]&&this.setAnimation(S)};this.state=new zl({owner:this,states:p,initialState:w,onEnter:q,context:I})}get x(){return a(n(this,xt))}set x(e){m(n(this,xt),C(e))}get y(){return a(n(this,_t))}set y(e){m(n(this,_t),C(e))}get name(){return a(n(this,Ft))}set name(e){m(n(this,Ft),C(e))}get type(){return a(n(this,Bt))}set type(e){m(n(this,Bt),C(e))}get width(){return a(n(this,Et))}set width(e){m(n(this,Et),C(e))}get height(){return a(n(this,At))}set height(e){m(n(this,At),C(e))}get effects(){return a(n(this,St))}set effects(e){m(n(this,St),e)}get vfx(){return a(n(this,kt))}set vfx(e){m(n(this,kt),e)}get animation(){return a(n(this,Mt))}set animation(e){m(n(this,Mt),e)}get position(){return a(n(this,Pt))}set position(e){m(n(this,Pt),C(e))}get state(){return a(n(this,Dt))}set state(e){m(n(this,Dt),C(e))}get stats(){return a(n(this,It))}set stats(e){m(n(this,It),C(e))}get rotation(){return a(n(this,Lt))}set rotation(e){m(n(this,Lt),C(e))}get scale(){return a(n(this,Rt))}set scale(e){m(n(this,Rt),C(e))}get opacity(){return a(n(this,jt))}set opacity(e){m(n(this,jt),C(e))}get isInteractable(){return a(n(this,$t))}set isInteractable(e){m(n(this,$t),C(e))}get stateToAnimation(){return a(n(this,qt))}set stateToAnimation(e){m(n(this,qt),C(e))}get upgradeLevel(){return a(n(this,Nt))}set upgradeLevel(e){m(n(this,Nt),C(e))}get upgrades(){return a(n(this,Ut))}set upgrades(e){m(n(this,Ut),e)}get isUpgradable(){return a(n(this,Ys))}get boundingBox(){const e=this.position.x,t=this.position.y,i=this.position.x+this.width,o=this.position.y+this.height;return{x1:e,y1:t,x2:i,y2:o,center:new te(e+this.width/2,t+this.height/2),topMiddle:new te(e+this.width/2,o)}}update(e){this.isDestroyed||(this.state.update(e),this.effects.forEach(t=>{t(this)}),this.animation&&this.animation.update(e))}setAnimation(e){const t=this.stateToAnimation[e],i=Re(t);this.animation=new Ti({...i,name:t})}addEffect(e){this.effects.includes(e)||(this.effects=[...this.effects,e])}removeEffect(e){this.effects=this.effects.filter(t=>t!==e)}cleanEffects(){this.effects=[]}addVFX(e){this.vfx.includes(e)||(this.vfx=[...this.vfx,e])}removeVFX(e){this.vfx=this.vfx.filter(t=>t!==e)}cleanVFX(){this.vfx=[]}takeDamage(e){this.stats.health-=e,this.stats.health<=0&&this.state.setState("Die")}stopInteractions(){this.isInteractable=!1}removeCollider(){this.onCollide=()=>{}}};xt=new WeakMap,_t=new WeakMap,Ft=new WeakMap,Bt=new WeakMap,Et=new WeakMap,At=new WeakMap,St=new WeakMap,kt=new WeakMap,Mt=new WeakMap,Pt=new WeakMap,Dt=new WeakMap,It=new WeakMap,Lt=new WeakMap,Rt=new WeakMap,jt=new WeakMap,$t=new WeakMap,qt=new WeakMap,Nt=new WeakMap,Ut=new WeakMap,Ys=new WeakMap,j(Vs,"lastId",0);let gi=Vs;const Ol=(s,e,t={})=>{const{context:i={},...o}=Fl(s),{initialState:r,...l}=t;return r&&(o.initialState=r),new gi(s,e.clone(),o,{...i,...l})},Ql=F(()=>({top:[{x:L.width*.1,y:20},{x:L.width*.3,y:20},{x:L.width*.5,y:20},{x:L.width*.7,y:20},{x:L.width*.9,y:20}],bottom:[{x:L.width*.1,y:L.height-20},{x:L.width*.3,y:L.height-20},{x:L.width*.5,y:L.height-20},{x:L.width*.7,y:L.height-20},{x:L.width*.9,y:L.height-20}],left:[{x:20,y:L.height*.1},{x:20,y:L.height*.3},{x:20,y:L.height*.5},{x:20,y:L.height*.7},{x:20,y:L.height*.9}],right:[{x:L.width-20,y:L.height*.1},{x:L.width-20,y:L.height*.3},{x:L.width-20,y:L.height*.5},{x:L.width-20,y:L.height*.7},{x:L.width-20,y:L.height*.9}]})),Gl=()=>{const s=L.isMobile?["top","bottom"]:["top","bottom","left","right"],e=s[Math.floor(Math.random()*s.length)],t=a(Ql)[e];return t[Math.floor(Math.random()*t.length)]},Hl=s=>s[Math.floor(Math.random()*s.length)];var zt,Xs,Ot,Qt;class Wl{constructor(){d(this,zt,f(0));d(this,Xs,F(()=>Fo[this.stageNumber]));d(this,Ot,f(0));j(this,"commonSpawnCd");j(this,"eliteSpawnCd");d(this,Qt,f(""));j(this,"init",()=>{const e=R.get("gameLoop");this.commonSpawnCd=e.setCD(this.stageConfig.spawnDelays.common,!0),this.eliteSpawnCd=e.setCD(this.stageConfig.spawnDelays.elite,!0),this.spawnTowers(),this.spawnEntity("Throne",new te(0,0))});j(this,"update",e=>{const t=R.get("gameLoop");t.isCDReady(this.commonSpawnCd)&&this.spawnEnemy("common"),t.isCDReady(this.eliteSpawnCd)&&this.spawnEnemy("elite"),this.checkStageTime()});j(this,"spawnEntity",(e,t,i={})=>{const o=R.get("entityManager"),r=Ol(e,t,i);return o.add(r),r})}get stageNumber(){return a(n(this,zt))}set stageNumber(e){m(n(this,zt),C(e))}get stageConfig(){return a(n(this,Xs))}get stageStartTime(){return a(n(this,Ot))}set stageStartTime(e){m(n(this,Ot),C(e))}get stageResult(){return a(n(this,Qt))}set stageResult(e){m(n(this,Qt),C(e))}reset(){this.commonSpawnCd=null,this.eliteSpawnCd=null,this.stageNumber=0,this.stageResult="",this.init()}spawnTowers(){["IceTower","FireTower","PoisonTower","ThunderTower"].forEach((e,t)=>{this.spawnEntity(e,new te(0,0))})}apllyAmlify(e){const{statsAmplify:t}=this.stageConfig;e.stats.health*=t.health,e.stats.damage*=t.damage,e.stats.speed*=t.speed}spawnEnemy(e){const t=R.get("entityManager"),i=e==="common"?this.stageConfig.commonEnemies:this.stageConfig.eliteEnemies,o=Hl(i),r=Gl(),l=new te(r.x,r.y),c=this.spawnEntity(o,l,{throne:t.throne});return this.apllyAmlify(c),c}spawnLoot(e){const i=R.get("entityManager").throne;this.spawnEntity("Loot",e.boundingBox.center,{target:i})}gameOver(e){this.stageResult=e,R.get("gameLoop").pause()}checkStageTime(){const e=R.get("gameLoop");this.stageStartTime+this.stageConfig.time<e.elapsedTime&&this.nextStage()}nextStage(){if(this.stageNumber<Fo.length-1){const e=R.get("gameLoop");this.stageNumber++,this.stageStartTime=e.elapsedTime,this.commonSpawnCd=e.setCD(this.stageConfig.spawnDelays.common,!0),this.eliteSpawnCd=e.setCD(this.stageConfig.spawnDelays.elite,!0)}else this.gameOver("win")}}zt=new WeakMap,Xs=new WeakMap,Ot=new WeakMap,Qt=new WeakMap;const li=16.666;var Gt,Ht,Wt,Yt,Vt,Xt;const Zs=class Zs{constructor(){d(this,Gt,f(C(performance.now())));d(this,Ht,f(0));d(this,Wt,f(0));d(this,Yt,f(1));d(this,Vt,f(null));j(this,"isStopped",!1);d(this,Xt,f(C({})));this.loop=this.loop.bind(this),this.previousTime=0,this.elapsedTime=0,this.accumulator=0}get previousTime(){return a(n(this,Gt))}set previousTime(e){m(n(this,Gt),C(e))}get accumulator(){return a(n(this,Ht))}set accumulator(e){m(n(this,Ht),C(e))}get elapsedTime(){return a(n(this,Wt))}set elapsedTime(e){m(n(this,Wt),C(e))}get timeScale(){return a(n(this,Yt))}set timeScale(e){m(n(this,Yt),C(e))}get pauseState(){return a(n(this,Vt))}set pauseState(e){m(n(this,Vt),C(e))}get cooldowns(){return a(n(this,Xt))}set cooldowns(e){m(n(this,Xt),C(e))}get elapsedInSeconds(){return this.elapsedTime/1e3}start(e){this.isStopped=!1,this.pauseState=null,this.timeScale=1,this.update=e,this.previousTime=performance.now(),requestAnimationFrame(this.loop)}stop(){this.isStopped=!0,this.pauseState=null}reset(){this.previousTime=0,this.elapsedTime=0,this.accumulator=0}loop(e){if(this.isStopped)return;if(this.pauseState){this.previousTime=e,requestAnimationFrame(this.loop);return}let t=e-this.previousTime;for(t>250&&(t=250),this.previousTime=e,this.accumulator+=t*this.timeScale,this.elapsedTime+=t*this.timeScale;this.accumulator>=li;)this.update(li),this.accumulator-=li;requestAnimationFrame(this.loop)}setCD(e,t=!1){const i=Zs.lastCDId++;return this.cooldowns[i]={waitTime:e,isInfinite:t,startTime:this.elapsedTime},i}isCDReady(e){const t=this.cooldowns[e];return!t||this.pauseState||this.elapsedTime-t.startTime<=t.waitTime?!1:t.isInfinite?(this.cooldowns[e]={...t,startTime:this.elapsedTime},!0):(delete this.cooldowns[e],!0)}pause(){this.pauseState?this.resume():this.pauseState={pausedTime:this.elapsedTime}}resume(){if(!this.pauseState)return;const e=performance.now();this.previousTime=e,this.pauseState=null}};Gt=new WeakMap,Ht=new WeakMap,Wt=new WeakMap,Yt=new WeakMap,Vt=new WeakMap,Xt=new WeakMap,j(Zs,"lastCDId",0);let vi=Zs;const Yl=[{id:"q1",question:"What is the capital of France?",options:["London","Berlin","Paris","Madrid"],correctIndex:2,meta:{subject:"Geography",level:"Easy"}},{id:"q2",question:"What is 12 * 12?",options:["122","144","124","148"],correctIndex:1,meta:{subject:"Math",level:"Medium"}},{id:"q3",question:"Which planet is known as the Red Planet?",options:["Earth","Mars","Jupiter","Venus"],correctIndex:1,meta:{subject:"Astronomy",level:"Easy"}},{id:"q4",question:"What is the chemical symbol for Gold?",options:["Au","Ag","Fe","Cu"],correctIndex:0,meta:{subject:"Chemistry",level:"Medium"}},{id:"q5",question:"Who wrote 'Romeo and Juliet'?",options:["Charles Dickens","William Shakespeare","Mark Twain","Jane Austen"],correctIndex:1,meta:{subject:"Literature",level:"Easy"}},{id:"q6",question:"What is the square root of 64?",options:["6","7","8","9"],correctIndex:2,meta:{subject:"Math",level:"Easy"}},{id:"q7",question:"Physics: What is the unit of force?",options:["Joule","Watt","Newton","Pascal"],correctIndex:2,meta:{subject:"Physics",level:"Medium"}},{id:"q8",question:"Which element has the atomic number 1?",options:["Helium","Hydrogen","Lithium","Carbon"],correctIndex:1,meta:{subject:"Chemistry",level:"Easy"}},{id:"q9",question:"What year did World War II end?",options:["1942","1945","1948","1950"],correctIndex:1,meta:{subject:"History",level:"Hard"}},{id:"q10",question:"What is the largest ocean on Earth?",options:["Atlantic","Indian","Arctic","Pacific"],correctIndex:3,meta:{subject:"Geography",level:"Medium"}}];function ko(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){var e=Math.random()*16|0,t=s=="x"?e:e&3|8;return t.toString(16)})}class Vl{constructor(){this.pendingRequests=new Map,this.eventListeners=new Map,this.isReactNative=!!window.ReactNativeWebView,this._handleMessage=this._handleMessage.bind(this),this._setupMessageListener()}_postMessage(e,t,i={},o=null){const r={type:e,action:t,payload:i,requestId:o||ko()};return this.isReactNative?window.ReactNativeWebView.postMessage(JSON.stringify(r)):window.parent.postMessage(r,"*"),r.requestId}_sendRequest(e,t={}){return new Promise((i,o)=>{const r=ko();this.pendingRequests.set(r,{resolve:i,reject:o}),this._postMessage("IGNITE_GAME_EVENT",e,t,r),setTimeout(()=>{this.pendingRequests.has(r)&&(this.pendingRequests.delete(r),o(new Error(`Request timeout for action: ${e}`)))},1e4)})}_sendEvent(e,t={}){this._postMessage("IGNITE_GAME_EVENT",e,t)}_setupMessageListener(){window.addEventListener("message",this._handleMessage),document.addEventListener("message",this._handleMessage)}_handleMessage(e){let t=e.data;if(typeof t=="string")try{t=JSON.parse(t)}catch{return}if(!t||t.type!=="IGNITE_CLIENT_RESPONSE"&&t.type!=="IGNITE_CLIENT_EVENT")return;const{action:i,payload:o,requestId:r,error:l}=t;if(r&&this.pendingRequests.has(r)){const{resolve:c,reject:g}=this.pendingRequests.get(r);l?g(new Error(l)):c(o),this.pendingRequests.delete(r);return}this.eventListeners.has(i)&&this.eventListeners.get(i).forEach(c=>c(o))}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){if(!this.eventListeners.has(e))return;const i=this.eventListeners.get(e),o=i.indexOf(t);o>-1&&i.splice(o,1)}init(){return this._sendRequest("INIT_GAME",{})}getQuestions(e=10){return this._sendRequest("GET_QUESTION_BATCH",{limit:e})}submitAnswer(e,t,i){return this._sendRequest("SUBMIT_ANSWER",{questionUuid:e,isCorrect:t,timeTaken:i})}levelComplete(e,t){this._sendEvent("LEVEL_COMPLETE",{score:e,stars:t})}}const Ne=new Vl;typeof window<"u"&&(window.GameBridge=Ne);var Zt,Jt,Kt,es,ts,ss,is,os,as,rs,ns,ls,cs;class oa{constructor(){d(this,Zt,f(C(Yl)));d(this,Jt,f(C([])));d(this,Kt,f(!1));d(this,es,f(null));d(this,ts,f(!1));d(this,ss,f(1));d(this,is,f(0));d(this,os,f(0));d(this,as,f(0));d(this,rs,f(0));d(this,ns,f(0));d(this,ls,f(0));d(this,cs,f(!1));this.reset(),this.init()}get questions(){return a(n(this,Zt))}set questions(e){m(n(this,Zt),C(e))}get questionQueue(){return a(n(this,Jt))}set questionQueue(e){m(n(this,Jt),C(e))}get isLoadingQuestions(){return a(n(this,Kt))}set isLoadingQuestions(e){m(n(this,Kt),C(e))}get currentQuestion(){return a(n(this,es))}set currentQuestion(e){m(n(this,es),C(e))}get isActive(){return a(n(this,ts))}set isActive(e){m(n(this,ts),C(e))}get timeScale(){return a(n(this,ss))}set timeScale(e){m(n(this,ss),C(e))}get timer(){return a(n(this,is))}set timer(e){m(n(this,is),C(e))}get initialTimer(){return a(n(this,os))}set initialTimer(e){m(n(this,os),C(e))}get strikes(){return a(n(this,as))}set strikes(e){m(n(this,as),C(e))}get gameTimeSinceLastQuestion(){return a(n(this,rs))}set gameTimeSinceLastQuestion(e){m(n(this,rs),C(e))}get buildPoints(){return a(n(this,ns))}set buildPoints(e){m(n(this,ns),C(e))}get wrongAnswerTrigger(){return a(n(this,ls))}set wrongAnswerTrigger(e){m(n(this,ls),C(e))}get distortedAudio(){return a(n(this,cs))}set distortedAudio(e){m(n(this,cs),C(e))}async init(){try{console.log("[QuestionManager] Initializing Bridge..."),Ne.init().then(e=>{console.log("[QuestionManager] Bridge Config:",e),this.fetchQuestions()}).catch(e=>{console.warn("[QuestionManager] Bridge init failed (dev mode?):",e)})}catch(e){console.warn("[QuestionManager] Bridge init failed, using mock mode.",e)}}async fetchQuestions(){if(!this.isLoadingQuestions){this.isLoadingQuestions=!0;try{console.log("[QuestionManager] Fetching questions...");const e=await Ne.getQuestions(5);if(e&&e.questions){const t=e.questions.map(i=>this.adaptBridgeQuestion(i));this.questionQueue.push(...t),console.log(`[QuestionManager] Fetched ${t.length} questions. Queue size: ${this.questionQueue.length}`)}}catch(e){console.warn("[QuestionManager] Failed to fetch questions (using mocks)",e)}finally{this.isLoadingQuestions=!1}}}adaptBridgeQuestion(e){const t=e.content||{},i=t.options||[];let o=[],r=0;if(i.length>0&&typeof i[0]=="string")if(o=i,t.answer){const l=o.indexOf(t.answer);l!==-1&&(r=l)}else e.meta&&typeof e.meta.correctIndex=="number"&&(r=e.meta.correctIndex);else i.length>0&&typeof i[0]=="object"&&(o=i.map(l=>l.text||l.value||"Option"),r=i.findIndex(l=>l.isCorrect),r===-1&&(r=0));return{id:e.uuid||e._id||e.id,question:t.text||t.question||e.question||"Unknown Question?",options:o,correctIndex:r,meta:e.meta}}reset(){this.isActive=!1,this.timeScale=1,this.strikes=0,this.buildPoints=0,this.gameTimeSinceLastQuestion=re.questionInterval*.75,this.currentQuestion=null,this.questionQueue=[]}update(e){if(!this.isActive)this.gameTimeSinceLastQuestion+=e,this.gameTimeSinceLastQuestion>=re.questionInterval&&this.triggerQuestion();else{const t=e/this.timeScale;this.timer-=t,this.timer<=0&&this.handleTimeout()}}triggerQuestion(){let e=null;if(this.questionQueue.length>0)e=this.questionQueue.shift(),this.questionQueue.length<3&&this.fetchQuestions();else{const t=Math.floor(Math.random()*this.questions.length);e=this.questions[t],this.fetchQuestions()}this.currentQuestion=e,this.isActive=!0,this.timeScale=re.bulletTimeFactor,R.get("gameLoop").timeScale=this.timeScale,this.initialTimer=re.questionDuration,this.timer=this.initialTimer,this.gameTimeSinceLastQuestion=0,this.distortedAudio=!0,M.setDistortion(!0)}answer(e){if(!this.currentQuestion)return;const t=e===this.currentQuestion.correctIndex,i=Math.max(0,(this.initialTimer-this.timer)/1e3);this.currentQuestion.id&&this.currentQuestion.id.length>5&&Ne.submitAnswer(this.currentQuestion.id,t,i).catch(o=>console.error(o)),t?this.handleCorrect():this.handleIncorrect(),this.closeQuestion()}handleCorrect(){if(this.buildPoints>=8){console.log("Correct! Max Points Reached -> +10 Gold");const e=R.get("lootTracker");e&&e.receiveLoot(10),M.play("towerUpgrade")}else console.log("Correct! +1 Build Point"),this.buildPoints++,M.play("towerUpgrade")}handleIncorrect(){console.log("Wrong!"),this.wrongAnswerTrigger++,M.play("lowResourse"),this.strikes++,this.strikes>=re.maxStrikes&&(this.punishPlayer(),this.strikes=0)}handleTimeout(){this.currentQuestion&&this.currentQuestion.id&&this.currentQuestion.id.length>5&&Ne.submitAnswer(this.currentQuestion.id,!1,re.questionDuration).catch(e=>console.error(e)),this.handleIncorrect(),this.closeQuestion()}punishPlayer(){var o,r;console.log("PUNISHMENT: Destroying Tower");const{entityManager:e}=R.get(["entityManager"]),i=e.towers.filter(l=>l.state.currentState!=="NotBuilt"&&l.type!=="throne");if(i.length>0){const l=i[0];console.log(`Destroying tower: ${l.name}`);const c=Bi[l.name];c&&(l.stats={...c.stats},l.stateToAnimation={...c.stateToAnimation}),l.upgradeLevel=-1,l.state.setState("NotBuilt");const g=R.get("particleManager"),b=((o=l.position)==null?void 0:o.x)??l.x,p=((r=l.position)==null?void 0:r.y)??l.y;g&&g.spawnExplosion(b+l.width/2,p+l.height/2,"#ff0000",30)}}closeQuestion(){this.isActive=!1,this.timeScale=1,R.get("gameLoop").timeScale=1,this.currentQuestion=null,this.distortedAudio=!1,M.setDistortion(!1)}}Zt=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,es=new WeakMap,ts=new WeakMap,ss=new WeakMap,is=new WeakMap,os=new WeakMap,as=new WeakMap,rs=new WeakMap,ns=new WeakMap,ls=new WeakMap,cs=new WeakMap;new oa;var ds,us,hs,ms,gs,vs,fs;class Xl{constructor(e,t,i){d(this,ds,f(0));d(this,us,f(0));d(this,hs,f(0));d(this,ms,f(0));d(this,gs,f(1));d(this,vs,f("#ff0000"));d(this,fs,f(5));j(this,"decay",.05);this.x=e,this.y=t,this.color=i;const o=Math.random()*Math.PI*2,r=Math.random()*5+2;this.vx=Math.cos(o)*r,this.vy=Math.sin(o)*r,this.size=Math.random()*6+4,this.decay=Math.random()*.03+.02}get x(){return a(n(this,ds))}set x(e){m(n(this,ds),C(e))}get y(){return a(n(this,us))}set y(e){m(n(this,us),C(e))}get vx(){return a(n(this,hs))}set vx(e){m(n(this,hs),C(e))}get vy(){return a(n(this,ms))}set vy(e){m(n(this,ms),C(e))}get life(){return a(n(this,gs))}set life(e){m(n(this,gs),C(e))}get color(){return a(n(this,vs))}set color(e){m(n(this,vs),C(e))}get size(){return a(n(this,fs))}set size(e){m(n(this,fs),C(e))}update(e){this.x+=this.vx,this.y+=this.vy,this.life-=this.decay,this.size*=.95}}ds=new WeakMap,us=new WeakMap,hs=new WeakMap,ms=new WeakMap,gs=new WeakMap,vs=new WeakMap,fs=new WeakMap;var ps;class Zl{constructor(){d(this,ps,f(C([])))}get particles(){return a(n(this,ps))}set particles(e){m(n(this,ps),C(e))}update(e){this.particles=this.particles.filter(t=>t.life>0);for(const t of this.particles)t.update(e)}spawnExplosion(e,t,i="#ff4400",o=10){for(let r=0;r<o;r++)this.particles.push(new Xl(e,t,i))}}ps=new WeakMap;var ws;class Jl{constructor(){d(this,ws,f(!1));j(this,"update",async e=>{R.update(e),Z.update(e)});j(this,"start",async()=>{R.setup(Kl());const{gameLoop:e,stageManager:t,questionManager:i}=R.get(["gameLoop","stageManager","questionManager"]);t.init(),i.reset(),e.start(this.update),M.play("bgSound"),this.isStarted=!0});j(this,"restart",()=>{const{entityManager:e,gameLoop:t,stageManager:i,questionManager:o}=R.get(["entityManager","gameLoop","stageManager","questionManager"]);t.reset(),e.reset(),i.reset(),M.reset(),pe.reset(),o.reset(),t.resume()});j(this,"cleanup",async()=>{if(this.isStarted){M.pause("bgSound");try{const e=R.get("gameLoop");e&&e.stop()}catch{}this.isStarted=!1}})}get isStarted(){return a(n(this,ws))}set isStarted(e){m(n(this,ws),C(e))}}ws=new WeakMap;const Kl=()=>({collisionManager:new pl,entityManager:new wl,gameLoop:new vi,stageManager:new Wl,questionManager:new oa,particleManager:new Zl}),ae=new Jl,ec=()=>{M.toggleMute()};var tc=Js('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zm-4 0h-2.5l-5 5H1.5v7.5h5l5 5v-17.5zM16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"></path></svg>'),sc=Js('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></svg>'),ic=D('<div class="content svelte-2dge9i"><div class="title svelte-2dge9i"><h1 class="svelte-2dge9i">Paused</h1></div> <div class="buttons-container svelte-2dge9i"><!> <!> <!></div></div>'),oc=D('<div class="confirm-overlay svelte-2dge9i"><div class="backdrop svelte-2dge9i"></div> <div class="confirm-box svelte-2dge9i"><div class="confirm-headers svelte-2dge9i"><h2 class="confirm-title svelte-2dge9i">Exit Protocol</h2> <div class="decoration-bar svelte-2dge9i"></div></div> <div class="confirm-body svelte-2dge9i"><p>Are you sure you want to abort mission?</p> <p class="warning svelte-2dge9i">Current progress will be lost.</p></div> <div class="confirm-actions svelte-2dge9i"><!> <!></div></div></div>'),ac=D('<div class="pause-overlay svelte-2dge9i"><button class="sound-toggle svelte-2dge9i"><!></button> <!> <!></div>');function rc(s,e){Q(e,!0);let t=f(!1);const i=async()=>{ae.cleanup?await ae.cleanup():ae.isStarted=!1,m(t,!1)};ei(()=>{M.reduceBgVolume()}),Wo(()=>{M.restoreBgVolume()});var o=ac(),r=_(o);r.__click=[ec];var l=_(r);{var c=y=>{var h=tc();k(y,h)},g=y=>{var h=sc();k(y,h)};W(l,y=>{M.isMuted?y(g,!1):y(c)})}x(r);var b=A(r,2);Fi(b,{children:(y,h)=>{var v=ic(),u=A(_(v),2),E=_(u);fe(E,{text:"Resume Game",get onclick(){return e.onResume}});var T=A(E,2);fe(T,{text:"Restart Game",get onclick(){return e.onRestart}});var B=A(T,2);fe(B,{text:"Exit to Menu",onclick:()=>m(t,!0)}),x(u),x(v),k(y,v)},$$slots:{default:!0}});var p=A(b,2);{var w=y=>{var h=oc(),v=A(_(h),2),u=A(_(v),4),E=_(u);fe(E,{text:"Yes",onclick:i});var T=A(E,2);fe(T,{text:"No",onclick:()=>m(t,!1)}),x(u),x(v),x(h),O(3,v,()=>je,()=>({duration:400,start:.8,easing:ti})),O(3,h,()=>ie,()=>({duration:200})),k(y,h)};W(p,y=>{a(t)&&y(w)})}x(o),$(()=>{se(r,"aria-label",M.isMuted?"Unmute":"Mute"),se(r,"title",M.isMuted?"Unmute":"Mute")}),k(s,o),G()}qe(["click"]);var nc=D('<div class="bg-container svelte-11qp6pd"><div class="gradient-bg svelte-11qp6pd">‚Ä¶</div> <div class="stars svelte-11qp6pd"></div></div>');function Mo(s){var e=nc();k(s,e)}var lc=D('<div class="bg-container svelte-1hdxkm"><div class="gradient-bg svelte-1hdxkm"></div> <div class="aurora svelte-1hdxkm"></div> <div class="stars svelte-1hdxkm"></div></div>');function cc(s){var e=lc();k(s,e)}var dc=D('<div class="bg-container svelte-7703io"><div class="gradient-bg svelte-7703io"></div> <div class="stars svelte-7703io"></div></div>');function uc(s){var e=dc();k(s,e)}var hc=D('<div class="bg-container svelte-10mh7j2"><div class="quantum-base svelte-10mh7j2"></div> <div class="energy-fields svelte-10mh7j2"></div> <div class="quantum-grid svelte-10mh7j2"></div> <div class="stars svelte-10mh7j2"></div></div>');function mc(s){var e=hc();k(s,e)}var gc=D('<div class="background-container svelte-5o0ex9"><!></div>');function vc(s,e){const t=[Mo,cc,uc,mc];let i=F(()=>t[e.stageNumber]||Mo);var o=he(),r=J(o);di(r,()=>e.stageNumber,l=>{var c=gc(),g=_(c);Na(g,()=>a(i),(b,p)=>{p(b,{})}),x(c),O(1,c,()=>ie,()=>({duration:400})),O(2,c,()=>ie,()=>({duration:300})),k(l,c)}),k(s,o)}var fc=D('<div class="loot svelte-bipu4"><!> <span class="svelte-bipu4"> </span></div>');function pc(s,e){Q(e,!0);let t=F(()=>pe.playLowLootAnimation);var i=fc();const o=F(()=>Z.get("arrow"));$(()=>N(i,"cursor",a(o)));var r=_(i);Ue(r,{});var l=A(r,2);const c=F(()=>Z.get("arrow"));$(()=>N(l,"cursor",a(c)));var g=_(l,!0);x(l),x(i),$(()=>{Ae(i,"isAnimated",a(t)),le(g,pe.collectedLoot)}),$e("animationend",i,b=>{pe.unsetAnimation("LowLoot")}),k(s,i),G()}var wc=Js('<svg width="54" height="54" viewBox="0 0 54 54" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="path-1-outside-1_0_1" maskUnits="userSpaceOnUse" x="0" y="0" width="54" height="54" fill="black"><rect fill="white" width="54" height="54"></rect><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z"></path></mask><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z" fill="#D685DA"></path><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z" stroke="white" stroke-width="2" mask="url(#path-1-outside-1_0_1)"></path><circle cx="27" cy="27" r="16.5" fill="#D685DA" stroke="white"></circle><circle cx="45" cy="44" r="4.5" fill="#D685DA" stroke="white"></circle><rect x="20.5" y="20.5" width="5" height="13" rx="2.5" fill="#FFDFFC" stroke="white"></rect><rect x="28.5" y="20.5" width="5" height="13" rx="2.5" fill="#FFDFFC" stroke="white"></rect></svg>');function yc(s){var e=wc();k(s,e)}function Po(s){return Object.prototype.toString.call(s)==="[object Date]"}function fi(s,e){if(s===e||s!==s)return()=>s;const t=typeof s;if(t!==typeof e||Array.isArray(s)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(s)){const i=e.map((o,r)=>fi(s[r],o));return o=>i.map(r=>r(o))}if(t==="object"){if(!s||!e)throw new Error("Object cannot be null");if(Po(s)&&Po(e)){const r=s.getTime(),c=e.getTime()-r;return g=>new Date(r+g*c)}const i=Object.keys(e),o={};return i.forEach(r=>{o[r]=fi(s[r],e[r])}),r=>{const l={};return i.forEach(c=>{l[c]=o[c](r)}),l}}if(t==="number"){const i=e-s;return o=>s+o*i}throw new Error(`Cannot interpolate ${t} values`)}function Cc(s,e={}){const t=Oa(s);let i,o=s;function r(l,c){if(o=l,s==null)return t.set(s=l),Promise.resolve();let g=i,b=!1,{delay:p=0,duration:w=400,easing:y=dl,interpolate:h=fi}={...e,...c};if(w===0)return g&&(g.abort(),g=null),t.set(s=o),Promise.resolve();const v=ue.now()+p;let u;return i=Zo(E=>{if(E<v)return!0;b||(u=h(s,l),typeof w=="function"&&(w=w(s,l)),b=!0),g&&(g.abort(),g=null);const T=E-v;return T>w?(t.set(s=l),!1):(t.set(s=u(y(T/w))),!0)}),i.promise}return{set:r,update:(l,c)=>r(l(o,s),c),subscribe:t.subscribe}}var bc=D('<div class="video-container svelte-bkv8uq"><video autoplay playsinline="" class="star-video svelte-bkv8uq"><track kind="captions" class="svelte-bkv8uq"></video></div>',2),Tc=D('<div class="meta-tag svelte-bkv8uq"><span class="meta-label svelte-bkv8uq">Subject:</span> <span class="meta-separator svelte-bkv8uq">|</span> <span class="meta-label svelte-bkv8uq">Level:</span> </div>'),xc=D('<button class="sci-fi-btn svelte-bkv8uq"><span class="btn-text svelte-bkv8uq"> </span></button>'),_c=D("<div></div>"),Fc=D('<div class="hud-container svelte-bkv8uq"><div class="content svelte-bkv8uq"><div class="header-section svelte-bkv8uq"><h2 class="question-header svelte-bkv8uq">Incoming Transmission</h2> <div class="timer-container svelte-bkv8uq"><div class="timer-bar svelte-bkv8uq"></div></div></div> <div class="question-box svelte-bkv8uq"><p class="question-text svelte-bkv8uq"> </p> <!></div> <div class="options-grid svelte-bkv8uq"></div> <div class="footer-section svelte-bkv8uq"><div class="status-indicator svelte-bkv8uq"><span class="status-label svelte-bkv8uq">Strikes</span> <div class="strikes-container svelte-bkv8uq"></div></div></div></div></div>'),Bc=D('<div class="overlay svelte-bkv8uq"><div class="backdrop svelte-bkv8uq"></div> <!> <!></div>');function Ec(s,e){Q(e,!0);const t=Ua(),i=()=>za(l,"$progress",t),o=F(()=>R.get("questionManager")),r=F(()=>{var v;return(v=a(o))==null?void 0:v.currentQuestion}),l=Cc(100,{duration:400,easing:ul});let c=f("idle"),g=f(!1);Se(()=>{if(a(o)&&a(o).isActive){if(l.set(a(o).timer/1e4*100),a(c)==="idle"){m(c,"incoming"),m(g,!1),M!=null&&M.preloaded&&M.play("shine");const v=1600,u=1900;setTimeout(()=>{m(c,"impact"),M!=null&&M.preloaded&&M.play("magicBurst")},v),setTimeout(()=>{m(c,"active")},u)}}else l.set(100,{duration:0}),m(c,"idle")});const b=F(()=>i()<30?"#ff3333":"#d685da");function p(v){M!=null&&M.preloaded&&M.play("clickMenu",!0),a(o).answer(v)}var w=he(),y=J(w);{var h=v=>{var u=Bc(),E=_(u),T=A(E,2);{var B=S=>{var P=he(),Y=J(P);{var U=H=>{var z=bc(),K=_(z);$(()=>se(K,"src",X("/videos/star-video.mp4"))),K.muted=!0,x(z),$(()=>Ae(K,"visible",a(g))),$e("canplay",K,()=>m(g,!0)),O(2,z,()=>ie,()=>({duration:500})),k(H,z)};W(Y,H=>{H(U)})}k(S,P)};W(T,S=>{(a(c)==="incoming"||a(c)==="impact")&&S(B)})}var I=A(T,2);{var q=S=>{var P=Fc(),Y=_(P),U=_(Y),H=A(_(U),2),z=_(H);x(H),x(U);var K=A(U,2),V=_(K),oe=_(V,!0);x(V);var Te=A(V,2);{var xe=ge=>{var ke=Tc(),Me=A(_(ke)),de=A(Me,4);x(ke),$(()=>{le(Me,` ${a(r).meta.subject??""} `),le(de,` ${a(r).meta.level??""}`)}),k(ge,ke)};W(Te,ge=>{a(r).meta&&ge(xe)})}x(K);var we=A(K,2);ne(we,21,()=>a(r).options,Es,(ge,ke,Me)=>{var de=xc();de.__click=()=>p(Me);const aa=F(()=>Z.get("arrow"));$(()=>N(de,"cursor",a(aa)));var Ei=_(de),ra=_(Ei,!0);x(Ei),x(de),$(()=>le(ra,a(ke))),k(ge,de)}),x(we);var _e=A(we,2),Fe=_(_e),me=A(_(Fe),2);ne(me,20,()=>Array(3),Es,(ge,ke,Me)=>{var de=_c();$(()=>Vo(de,`strike-dot ${(Me<a(o).strikes?"active":"")??""} svelte-bkv8uq`)),k(ge,de)}),x(me),x(Fe),x(_e),x(Y),x(P),$(()=>{se(z,"style",`width: ${i()??""}%; background: ${a(b)??""}; box-shadow: 0 0 10px ${a(b)??""}`),le(oe,a(r).question)}),O(1,P,()=>je,()=>({duration:600,start:0,easing:ti})),k(S,P)};W(I,S=>{a(c)==="active"&&S(q)})}x(u),O(3,E,()=>ie,()=>({duration:500})),k(v,u)};W(y,v=>{a(o)&&a(o).isActive&&a(r)&&v(h)})}k(s,w),G()}qe(["click"]);var Ac=D('<div class="star-container svelte-1w5pxei"><div class="star-core svelte-1w5pxei"></div> <div class="star-rays svelte-1w5pxei"></div> <div class="star-glow svelte-1w5pxei"></div></div>');function Sc(s,e){Q(e,!0);const t=be(e,"x",3,50),i=be(e,"y",3,50);ei(()=>{M!=null&&M.preloaded&&M.play("chime")});var o=Ac();$(()=>se(o,"style",`left: ${t()??""}%; top: ${i()??""}%;`)),O(1,o,()=>je,()=>({duration:600,start:0,easing:ti})),O(2,o,()=>ie,()=>({duration:300})),k(s,o),G()}var kc=D('<div class="floating-text svelte-ut1t50">+1 BP</div>'),Mc=D('<div class="points-badge svelte-ut1t50"><div class="badge-content svelte-ut1t50"><span class="icon svelte-ut1t50">üõ†Ô∏è</span> <span class="count svelte-ut1t50"> </span> <div class="text svelte-ut1t50"><span class="svelte-ut1t50">Builds</span> <small class="svelte-ut1t50">Available</small></div></div> <!></div>'),Pc=D('<!> <div class="indicator-container svelte-ut1t50"><div class="timer-section svelte-ut1t50"><div class="label-row svelte-ut1t50"><span class="label svelte-ut1t50">Star Transmit</span> <span class="status-text svelte-ut1t50"> </span></div> <div class="progress-bar-bg svelte-ut1t50"><div class="progress-bar-fill svelte-ut1t50"></div></div></div> <!></div>',1);function Dc(s,e){Q(e,!0);const t=F(()=>R.get("questionManager")),i=F(()=>R.get("stageManager")),o=F(()=>a(t)?Math.min(100,a(t).gameTimeSinceLastQuestion/re.questionInterval*100):0),r=F(()=>{var u;return((u=a(t))==null?void 0:u.buildPoints)||0}),l=F(()=>{var u;return(u=a(i))==null?void 0:u.stageResult});let c=0,g=f(!1),b=f(!1),p=f(C({x:50,y:50})),w=f(!1);Se(()=>{a(t)&&a(o)&&(a(o)>=92&&!a(w)&&!a(t).isActive&&(m(w,!0),m(b,!0),m(p,C({x:15+Math.random()*70,y:15+Math.random()*70}))),a(o)<50&&(m(w,!1),m(b,!1)),a(t).buildPoints>c&&(m(g,!0),setTimeout(()=>m(g,!1),1500)),c=a(t).buildPoints)});var y=he(),h=J(y);{var v=u=>{var E=Pc(),T=J(E);{var B=V=>{Sc(V,{get x(){return a(p).x},get y(){return a(p).y}})};W(T,V=>{a(b)&&V(B)})}var I=A(T,2),q=_(I),S=_(q),P=A(_(S),2),Y=_(P);$(()=>le(Y,`${Math.floor(a(o))??""}%`)),x(P),x(S);var U=A(S,2),H=_(U);x(U),x(q);var z=A(q,2);{var K=V=>{var oe=Mc(),Te=_(oe),xe=A(_(Te),2),we=_(xe,!0);x(xe),bi(2),x(Te);var _e=A(Te,2);{var Fe=me=>{var ge=kc();k(me,ge)};W(_e,me=>{a(g)&&me(Fe)})}x(oe),$(()=>{Ae(oe,"has-points",a(r)>0),le(we,a(r))}),O(1,oe,()=>je,()=>({duration:300,start:.5,opacity:0})),O(2,oe,()=>je,()=>({duration:200,start:.8,opacity:0})),k(V,oe)};W(z,V=>{a(r)>0&&V(K)})}x(I),$(()=>se(H,"style",`width: ${a(o)??""}%`)),k(u,E)};W(h,u=>{a(t)&&!a(t).isActive&&!a(l)&&u(v)})}k(s,y),G()}var Ic=D("<div><!> <!></div>");function Lc(s,e){Q(e,!0);let t=f(0),i=0,o=-1;Se(()=>{const c=R.get("questionManager");c&&c.wrongAnswerTrigger!==o&&(o!==-1&&Ci(t),o=c.wrongAnswerTrigger);const g=R.get("entityManager");g&&g.throne});var r=he(),l=J(r);di(l,()=>a(t),c=>{var g=Ic(),b=_(g);Qa(b,e,"default",{});var p=A(b,2);di(p,()=>i,w=>{var y=he(),h=J(y);W(h,v=>{}),k(w,y)}),x(g),$(()=>Vo(g,`feedback-layer ${(a(t)>0?"shake-effect":"")??""} svelte-10dqr7b`)),k(c,g)}),k(s,r),G()}const Rc=["/projectiles/Click/0.svg","/projectiles/Click/1.svg","/projectiles/Click/2.svg","/projectiles/Click/3.svg","/projectiles/Fireball/Die/0.svg","/projectiles/Fireball/Die/1.svg","/projectiles/Fireball/Die/2.svg","/projectiles/Fireball/Follow/0.svg","/projectiles/Fireball/Follow/1.svg","/projectiles/Fireball/Follow/2.svg","/projectiles/Fireball/Follow/3.svg","/projectiles/Icebolt/Die/0.svg","/projectiles/Icebolt/Die/1.svg","/projectiles/Icebolt/Die/2.svg","/projectiles/Icebolt/Follow/0.svg","/projectiles/Icebolt/Follow/1.svg","/projectiles/Poisonball/Die/0.svg","/projectiles/Poisonball/Die/1.svg","/projectiles/Poisonball/Die/2.svg","/projectiles/Poisonball/Follow/0.svg","/projectiles/Poisonball/Follow/1.svg","/projectiles/Poisonball/Follow/2.svg","/projectiles/Poisonball/Follow/3.svg","/projectiles/Thunderbolt/Die/0.svg","/projectiles/Thunderbolt/Die/1.svg","/projectiles/Thunderbolt/Die/2.svg","/projectiles/Thunderbolt/Follow/0.svg","/projectiles/Thunderbolt/Follow/1.svg","/projectiles/Thunderbolt/Follow/2.svg","/projectiles/Thunderbolt/Follow/3.svg","/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg","/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg","/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg","/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg","/towers/FireTower/Base0.svg","/towers/FireTower/Base1.svg","/towers/FireTower/Base2.svg","/towers/FireTower/Upgrade1.svg","/towers/FireTower/Upgrade2.svg","/towers/IceTower/Base0.svg","/towers/IceTower/Base1.svg","/towers/IceTower/Base2.svg","/towers/IceTower/Upgrade1.svg","/towers/IceTower/Upgrade2.svg","/towers/PoisonTower/Base0.svg","/towers/PoisonTower/Base1.svg","/towers/PoisonTower/Base2.svg","/towers/PoisonTower/Upgrade1.svg","/towers/PoisonTower/Upgrade2.svg","/towers/ThunderTower/Base0.svg","/towers/ThunderTower/Base1.svg","/towers/ThunderTower/Base2.svg","/towers/ThunderTower/Upgrade1.svg","/towers/ThunderTower/Upgrade2.svg","/towers/Base.svg","/towers/Upgrade0.svg","/castle/castle.png","/castle/castle-broken.png","/castle/castle-broken2.png","/castle/castle-broken3.png","/castle/castle-destroyed.png","/logos/knowledge-space2.png","/cursors/cursor-hammer.svg","/cursors/cursor-arrow.svg","/cursors/build0.svg","/cursors/build1.svg","/cursors/build2.svg"].map(X),jc=s=>{pe.spendLoot({type:"click",payload:{offset:new te(s.clientX,s.clientY)}})},$c=(s,e)=>{var t;M.play("clickMenu",!0),(t=a(e))==null||t.pause()};var qc=D('<link rel="preload" as="image">'),Nc=D('<div class="window-wrapper"><div class="wrapper svelte-dz30ag"><!> <!> <!> <button tabindex="-1" class="btn-pause svelte-dz30ag"><!></button> <div class="game-container svelte-dz30ag"><!></div></div></div>'),Uc=D("<!> <!> <!>",1);function Jc(s,e){Q(e,!0);const t=F(()=>ae.isStarted?R.get("questionManager"):void 0),i=F(()=>ae.isStarted?R.get("gameLoop"):void 0),o=F(()=>ae.isStarted?R.get("stageManager"):void 0),r=h=>{var v,u;h.key==="Escape"&&((v=a(i))!=null&&v.pauseState?a(i).resume():(u=a(i))==null||u.pause())};ei(()=>{M.preload()});var l=Uc();$e("keydown",La,r),qa(h=>{var v=he(),u=J(v);ne(u,17,()=>Rc,Es,(E,T)=>{var B=qc();$(()=>se(B,"href",a(T))),k(E,B)}),k(h,v)});var c=J(l);{var g=h=>{fl(h,{onStart:()=>ae.start()})},b=h=>{var v=he(),u=J(v);{var E=B=>{cl(B,{onRestart:()=>ae.restart()})},T=B=>{var I=he(),q=J(I);{var S=P=>{rc(P,{onResume:()=>{var Y;return(Y=a(i))==null?void 0:Y.resume()},onRestart:()=>ae.restart()})};W(q,P=>{var Y;(Y=a(i))!=null&&Y.pauseState&&P(S)},!0)}k(B,I)};W(u,B=>{a(o).stageResult?B(E):B(T,!1)},!0)}k(h,v)};W(c,h=>{ae.isStarted?h(b,!1):h(g)})}var p=A(c,2);{var w=h=>{var v=Nc();v.__click=[jc];const u=F(()=>Z.get("arrow"));$(()=>N(v,"cursor",a(u)));var E=_(v),T=_(E);{var B=z=>{vc(z,{get stageNumber(){return a(o).stageNumber}})};W(T,z=>{a(o)&&z(B)})}var I=A(T,2);pc(I,{});var q=A(I,2);Dc(q,{});var S=A(q,2);S.__click=[$c,i];const P=F(()=>Z.get("arrow"));$(()=>N(S,"cursor",a(P)));var Y=_(S);yc(Y),x(S);var U=A(S,2);N(U,"transform-origin","center");var H=_(U);Lc(H,{children:(z,K)=>{il(z,{})},$$slots:{default:!0}}),x(U),x(E),x(v),$(()=>{var z;return Ae(E,"bullet-time",(z=a(t))==null?void 0:z.isActive)}),$i(U,"offsetHeight",z=>L.gameAreaHeight=z),$i(U,"offsetWidth",z=>L.gameAreaWidth=z),k(h,v)};W(p,h=>{ae.isStarted&&M.preloaded&&h(w)})}var y=A(p,2);Ec(y,{}),qi("innerWidth",h=>L.width=h),qi("innerHeight",h=>L.height=h),k(s,l),G()}qe(["click"]);export{Jc as component};
