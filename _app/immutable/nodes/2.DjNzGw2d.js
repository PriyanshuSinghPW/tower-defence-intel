var Jo=Object.defineProperty;var fi=s=>{throw TypeError(s)};var Ko=(s,e,t)=>e in s?Jo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var R=(s,e,t)=>Ko(s,typeof e!="symbol"?e+"":e,t),Qs=(s,e,t)=>e.has(s)||fi("Cannot "+t);var a=(s,e,t)=>(Qs(s,e,"read from private field"),t?t.call(s):e.get(s)),d=(s,e,t)=>e.has(s)?fi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),Ws=(s,e,t,i)=>(Qs(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),wi=(s,e,t)=>(Qs(s,e,"access private method"),t);import{a as k,t as L,c as ae,n as bo}from"../chunks/disclose-version.Bt-woAVR.js";import{h as Q,i as To,av as er,aw as tr,s as sr,J as ni,ag as _o,X as Gs,A as ve,a8 as ir,B as vs,y as xo,ai as or,C as rr,I as ar,V as Fo,ad as nr,ae as yi,N as Vs,Q as lr,F as Bo,ax as ps,af as Ao,x as fs,$ as cr,a6 as Ci,ay as li,az as bi,aA as dr,U as hr,aB as ur,aC as Eo,aD as ci,aE as mr,M as gr,w as vr,aF as So,G as ko,aG as pr,ac as Mo,n as xe,aH as fr,ab as wr,aI as yr,aJ as Cr,aK as br,ah as Po,b as Do,aL as Tr,aM as _r,D as Ti,E as _i,aN as xr,aO as Fr,a2 as v,g as r,Y as m,f as B,p as H,a as ls,t as q,m as Y,o as F,q as C,l as Z,v as A,aP as di,a0 as hi,aQ as Io,aR as Br,aS as Ar}from"../chunks/index-client.D4abnD_M.js";import{a as Er,l as Sr,w as kr,e as Hs,r as $o,d as cs,s as oe,b as Mr}from"../chunks/render.DhmwPF1i.js";import{a as y,p as Ae,b as jo,i as W,c as Pr,s as Dr,d as Ir}from"../chunks/props.Drwp97hV.js";import"../chunks/legacy.Cbf8ABpe.js";import{w as $r}from"../chunks/index.BFP2c014.js";import{s as jr}from"../chunks/slot.ZbqjIyhM.js";function ei(s,e,t){Q&&To();var i=s,o=ir,n,l=er()?tr:sr;ni(()=>{l(o,o=e())&&(n&&_o(n),n=Gs(()=>t(i)))}),Q&&(i=ve)}function _e(s,e){Q&&vs(xo(s)),or(()=>{var t=e();for(var i in t){var o=t[i];o?s.style.setProperty(i,o):s.style.removeProperty(i)}}),rr(()=>{s.remove()})}function ws(s,e){return e}function Lr(s,e,t,i){for(var o=[],n=e.length,l=0;l<n;l++)dr(e[l].e,o,!0);var c=n>0&&o.length===0&&t!==null;if(c){var g=t.parentNode;hr(g),g.append(t),i.clear(),ce(s,e[0].prev,e[n-1].next)}ur(o,()=>{for(var _=0;_<n;_++){var h=e[_];c||(i.delete(h.k),ce(s,h.prev,h.next)),Eo(h.e,!c)}})}function se(s,e,t,i,o,n=null){var l=s,c={flags:e,items:new Map,first:null},g=(e&So)!==0;if(g){var _=s;l=Q?vs(xo(_)):_.appendChild(vr())}Q&&To();var h=null,p=!1;ni(()=>{var w=t(),u=ar(w)?w:w==null?[]:Fo(w),b=u.length;if(p&&b===0)return;p=b===0;let f=!1;if(Q){var E=l.data===nr;E!==(b===0)&&(l=yi(),vs(l),Vs(!1),f=!0)}if(Q){for(var T=null,x,P=0;P<b;P++){if(ve.nodeType===8&&ve.data===lr){l=ve,f=!0,Vs(!1);break}var D=u[P],S=i(D,P);x=Lo(ve,c,T,null,D,S,P,o,e),c.items.set(S,x),T=x}b>0&&vs(yi())}if(!Q){var I=Bo;Rr(u,c,l,o,e,(I.f&ps)!==0,i)}n!==null&&(b===0?h?Ao(h):h=Gs(()=>n(l)):h!==null&&_o(h,()=>{h=null})),f&&Vs(!0),t()}),Q&&(l=ve)}function Rr(s,e,t,i,o,n,l,c){var Ce,Se,ke,Me;var g=(o&pr)!==0,_=(o&(ci|li))!==0,h=s.length,p=e.items,w=e.first,u=w,b,f=null,E,T=[],x=[],P,D,S,I;if(g)for(I=0;I<h;I+=1)P=s[I],D=l(P,I),S=p.get(D),S!==void 0&&((Ce=S.a)==null||Ce.measure(),(E??(E=new Set)).add(S));for(I=0;I<h;I+=1){if(P=s[I],D=l(P,I),S=p.get(D),S===void 0){var O=u?u.e.nodes_start:t;f=Lo(O,e,f,f===null?e.first:f.next,P,D,I,i,o),p.set(D,f),T=[],x=[],u=f.next;continue}if(_&&qr(S,P,I,o),S.e.f&ps&&(Ao(S.e),g&&((Se=S.a)==null||Se.unfix(),(E??(E=new Set)).delete(S))),S!==u){if(b!==void 0&&b.has(S)){if(T.length<x.length){var z=x[0],N;f=z.prev;var he=T[0],ue=T[T.length-1];for(N=0;N<T.length;N+=1)xi(T[N],z,t);for(N=0;N<x.length;N+=1)b.delete(x[N]);ce(e,he.prev,ue.next),ce(e,f,he),ce(e,ue,z),u=z,f=ue,I-=1,T=[],x=[]}else b.delete(S),xi(S,u,t),ce(e,S.prev,S.next),ce(e,S,f===null?e.first:f.next),ce(e,f,S),f=S;continue}for(T=[],x=[];u!==null&&u.k!==D;)(n||!(u.e.f&ps))&&(b??(b=new Set)).add(u),x.push(u),u=u.next;if(u===null)continue;S=u}T.push(S),f=S,u=S.next}if(u!==null||b!==void 0){for(var me=b===void 0?[]:Fo(b);u!==null;)(n||!(u.e.f&ps))&&me.push(u),u=u.next;var Ee=me.length;if(Ee>0){var Ys=o&So&&h===0?t:null;if(g){for(I=0;I<Ee;I+=1)(ke=me[I].a)==null||ke.measure();for(I=0;I<Ee;I+=1)(Me=me[I].a)==null||Me.fix()}Lr(e,me,Ys,p)}}g&&ko(()=>{var ee;if(E!==void 0)for(S of E)(ee=S.a)==null||ee.apply()}),fs.first=e.first&&e.first.e,fs.last=f&&f.e}function qr(s,e,t,i){i&ci&&bi(s.v,e),i&li?bi(s.i,t):s.i=t}function Lo(s,e,t,i,o,n,l,c,g,_){var h=(g&ci)!==0,p=(g&mr)===0,w=h?p?cr(o):Ci(o):o,u=g&li?Ci(l):l,b={i:u,v:w,k:n,a:null,e:null,prev:t,next:i};try{return b.e=Gs(()=>c(s,w,u),Q),b.e.prev=t&&t.e,b.e.next=i&&i.e,t===null?e.first=b:(t.next=b,t.e.next=b.e),i!==null&&(i.prev=b,i.e.prev=b.e),b}finally{}}function xi(s,e,t){for(var i=s.next?s.next.e.nodes_start:t,o=e?e.e.nodes_start:t,n=s.e.nodes_start;n!==i;){var l=gr(n);o.before(n),n=l}}function ce(s,e,t){e===null?s.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ur(s,e,...t){var i=s,o=xe,n;ni(()=>{o!==(o=e())&&(n&&(Eo(n),n=null),n=Gs(()=>o(i,...t)))},Mo),Q&&(i=ve)}function we(s,e,t,i){var o=s.__attributes??(s.__attributes={});Q&&(o[e]=s.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&s.nodeName==="LINK")||o[e]!==(o[e]=t)&&(e==="style"&&"__styles"in s&&(s.__styles={}),e==="loading"&&(s[fr]=t),t==null?s.removeAttribute(e):typeof t!="string"&&Nr(s).includes(e)?s[e]=t:s.setAttribute(e,t))}var Fi=new Map;function Nr(s){var e=Fi.get(s.nodeName);if(e)return e;Fi.set(s.nodeName,e=[]);for(var t,i=s,o=Element.prototype;o!==i;){t=yr(i);for(var n in t)t[n].set&&e.push(n);i=wr(i)}return e}function Ro(s,e,t){var i=s.__className,o=zr(e);Q&&s.className===o?s.__className=o:(i!==o||Q&&s.className!==o)&&(e==null?s.removeAttribute("class"):s.className=o,s.__className=o)}function zr(s,e){return(s??"")+""}function pe(s,e,t){if(t){if(s.classList.contains(e))return;s.classList.add(e)}else{if(!s.classList.contains(e))return;s.classList.remove(e)}}function U(s,e,t,i){var o=s.__styles??(s.__styles={});o[e]!==t&&(o[e]=t,t==null?s.style.removeProperty(e):s.style.setProperty(e,t,""))}const Or=()=>performance.now(),ie={tick:s=>requestAnimationFrame(s),now:()=>Or(),tasks:new Set};function qo(){const s=ie.now();ie.tasks.forEach(e=>{e.c(s)||(ie.tasks.delete(e),e.f())}),ie.tasks.size!==0&&ie.tick(qo)}function Uo(s){let e;return ie.tasks.size===0&&ie.tick(qo),{promise:new Promise(t=>{ie.tasks.add(e={c:s,f:t})}),abort(){ie.tasks.delete(e)}}}function ds(s,e){s.dispatchEvent(new CustomEvent(e))}function Gr(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const e=s.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Bi(s){const e={},t=s.split(";");for(const i of t){const[o,n]=i.split(":");if(!o||n===void 0)break;const l=Gr(o.trim());e[l]=n.trim()}return e}const Hr=s=>s;function V(s,e,t,i){var o=(s&xr)!==0,n=(s&Fr)!==0,l=o&&n,c=(s&Tr)!==0,g=l?"both":o?"in":"out",_,h=e.inert,p,w;function u(){var x=Bo,P=fs;Ti(null),_i(null);try{return _??(_=t()(e,(i==null?void 0:i())??{},{direction:g}))}finally{Ti(x),_i(P)}}var b={is_global:c,in(){var x;if(e.inert=h,!o){w==null||w.abort(),(x=w==null?void 0:w.reset)==null||x.call(w);return}n||p==null||p.abort(),ds(e,"introstart"),p=ti(e,u(),w,1,()=>{ds(e,"introend"),p==null||p.abort(),p=_=void 0})},out(x){if(!n){x==null||x(),_=void 0;return}e.inert=!0,ds(e,"outrostart"),w=ti(e,u(),p,0,()=>{ds(e,"outroend"),x==null||x()})},stop:()=>{p==null||p.abort(),w==null||w.abort()}},f=fs;if((f.transitions??(f.transitions=[])).push(b),o&&Er){var E=c;if(!E){for(var T=f.parent;T&&T.f&Mo;)for(;(T=T.parent)&&!(T.f&Cr););E=!T||(T.f&br)!==0}E&&Po(()=>{Do(()=>b.in())})}}function ti(s,e,t,i,o){var n=i===1;if(_r(e)){var l,c=!1;return ko(()=>{if(!c){var E=e({direction:n?"in":"out"});l=ti(s,E,t,i,o)}}),{abort:()=>{c=!0,l==null||l.abort()},deactivate:()=>l.deactivate(),reset:()=>l.reset(),t:()=>l.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return o(),{abort:xe,deactivate:xe,reset:xe,t:()=>i};const{delay:g=0,css:_,tick:h,easing:p=Hr}=e;var w=[];if(n&&t===void 0&&(h&&h(0,1),_)){var u=Bi(_(0,1));w.push(u,u)}var b=()=>1-i,f=s.animate(w,{duration:g});return f.onfinish=()=>{var E=(t==null?void 0:t.t())??1-i;t==null||t.abort();var T=i-E,x=e.duration*Math.abs(T),P=[];if(x>0){if(_)for(var D=Math.ceil(x/16.666666666666668),S=0;S<=D;S+=1){var I=E+T*p(S/D),O=_(I,1-I);P.push(Bi(O))}b=()=>{var z=f.currentTime;return E+T*p(z/x)},h&&Uo(()=>{if(f.playState!=="running")return!1;var z=b();return h(z,1-z),!0})}f=s.animate(P,{duration:x,fill:"forwards"}),f.onfinish=()=>{b=()=>i,h==null||h(i,1-i),o()}},{abort:()=>{f&&(f.cancel(),f.effect=null,f.onfinish=xe)},deactivate:()=>{o=xe},reset:()=>{i===0&&(h==null||h(1,0))},t:()=>b()}}var de,Be,Ie,Cs,No;const bs=class bs{constructor(e){d(this,Cs);d(this,de,new WeakMap);d(this,Be);d(this,Ie);Ws(this,Ie,e)}observe(e,t){var i=a(this,de).get(e)||new Set;return i.add(t),a(this,de).set(e,i),wi(this,Cs,No).call(this).observe(e,a(this,Ie)),()=>{var o=a(this,de).get(e);o.delete(t),o.size===0&&(a(this,de).delete(e),a(this,Be).unobserve(e))}}};de=new WeakMap,Be=new WeakMap,Ie=new WeakMap,Cs=new WeakSet,No=function(){return a(this,Be)??Ws(this,Be,new ResizeObserver(e=>{for(var t of e){bs.entries.set(t.target,t);for(var i of a(this,de).get(t.target)||[])i(t)}}))},R(bs,"entries",new WeakMap);let si=bs;var Yr=new si({box:"border-box"});function Ai(s,e,t){var i=Yr.observe(s,()=>t(s[e]));Po(()=>(Do(()=>t(s[e])),i))}function Ei(s,e){Sr(window,["resize"],()=>kr(()=>e(window[s])))}var $e;class Qr{constructor(){d(this,$e,v(y({})));R(this,"setup",e=>{this.managers=e});R(this,"update",e=>{this.managers.stageManager.update(e),this.managers.entityManager.update(e),this.managers.collisionManager.update(),this.managers.questionManager&&this.managers.questionManager.update(e),this.managers.particleManager&&this.managers.particleManager.update(e)});R(this,"get",e=>typeof e=="string"?this.managers[e]:e.reduce((t,i)=>(t[i]=this.managers[i],t),{}))}get managers(){return r(a(this,$e))}set managers(e){m(a(this,$e),y(e))}}$e=new WeakMap;const M=new Qr,Si=["/enemies/BlueBlobElite/Die/0.svg","/enemies/BlueBlobElite/Die/1.svg","/enemies/BlueBlobElite/Die/2.svg"],Wr={name:"BlueBlobEliteDie",frames:Si,framesAmount:Si.length,frameRate:10,loop:!1},ki=["/enemies/BlueBlobElite/Follow/0.svg","/enemies/BlueBlobElite/Follow/1.svg","/enemies/BlueBlobElite/Follow/2.svg","/enemies/BlueBlobElite/Follow/3.svg"],Vr={name:"BlueBlobEliteFollow",frames:ki,framesAmount:ki.length,frameRate:10,loop:!0},Mi=["/enemies/BlueCircleElite/Die/0.svg","/enemies/BlueCircleElite/Die/1.svg","/enemies/BlueCircleElite/Die/2.svg"],Zr={name:"BlueCircleEliteDie",frames:Mi,framesAmount:Mi.length,frameRate:10,loop:!1},Pi=["/enemies/BlueCircleElite/Follow/0.svg","/enemies/BlueCircleElite/Follow/1.svg","/enemies/BlueCircleElite/Follow/2.svg","/enemies/BlueCircleElite/Follow/3.svg"],Xr={name:"BlueCircleEliteFollow",frames:Pi,framesAmount:Pi.length,frameRate:10,loop:!0},Di=["/enemies/GreenCircleElite/Die/0.svg","/enemies/GreenCircleElite/Die/1.svg","/enemies/GreenCircleElite/Die/2.svg"],Jr={name:"GreenCircleEliteDie",frames:Di,framesAmount:Di.length,frameRate:10,loop:!1},Ii=["/enemies/GreenCircleElite/Follow/0.svg","/enemies/GreenCircleElite/Follow/1.svg","/enemies/GreenCircleElite/Follow/2.svg","/enemies/GreenCircleElite/Follow/3.svg"],Kr={name:"GreenCircleEliteFollow",frames:Ii,framesAmount:Ii.length,frameRate:10,loop:!0},$i=["/enemies/RedBlobElite/Die/0.svg","/enemies/RedBlobElite/Die/1.svg","/enemies/RedBlobElite/Die/2.svg"],ea={name:"RedBlobEliteDie",frames:$i,framesAmount:$i.length,frameRate:10,loop:!1},ji=["/enemies/RedBlobElite/Follow/0.svg","/enemies/RedBlobElite/Follow/1.svg","/enemies/RedBlobElite/Follow/2.svg","/enemies/RedBlobElite/Follow/3.svg"],ta={name:"RedBlobEliteFollow",frames:ji,framesAmount:ji.length,frameRate:10,loop:!0},Li=["/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg"],sa={name:"BlueCommonDie",frames:Li,framesAmount:Li.length,frameRate:10,loop:!1},Ri=["/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg"],ia={name:"BlueCommonFollow",frames:Ri,framesAmount:Ri.length,frameRate:10,loop:!0},qi=["/enemies/PurpleCommon/Die/0.svg","/enemies/PurpleCommon/Die/1.svg","/enemies/PurpleCommon/Die/2.svg"],oa={name:"PurpleCommonDie",frames:qi,framesAmount:qi.length,frameRate:10,loop:!1},Ui=["/enemies/PurpleCommon/Follow/0.svg","/enemies/PurpleCommon/Follow/1.svg","/enemies/PurpleCommon/Follow/2.svg"],ra={name:"PurpleCommonFollow",frames:Ui,framesAmount:Ui.length,frameRate:10,loop:!0},Ni=["/enemies/YellowCommon/Die/0.svg","/enemies/YellowCommon/Die/1.svg","/enemies/YellowCommon/Die/2.svg"],aa={name:"YellowCommonDie",frames:Ni,framesAmount:Ni.length,frameRate:10,loop:!1},zi=["/enemies/YellowCommon/Follow/0.svg","/enemies/YellowCommon/Follow/1.svg","/enemies/YellowCommon/Follow/2.svg","/enemies/YellowCommon/Follow/3.svg"],na={name:"YellowCommonFollow",frames:zi,framesAmount:zi.length,frameRate:10,loop:!0},la=Object.freeze(Object.defineProperty({__proto__:null,BlueBlobEliteDie:Wr,BlueBlobEliteFollow:Vr,BlueCircleEliteDie:Zr,BlueCircleEliteFollow:Xr,BlueCommonDie:sa,BlueCommonFollow:ia,GreenCircleEliteDie:Jr,GreenCircleEliteFollow:Kr,PurpleCommonDie:oa,PurpleCommonFollow:ra,RedBlobEliteDie:ea,RedBlobEliteFollow:ta,YellowCommonDie:aa,YellowCommonFollow:na},Symbol.toStringTag,{value:"Module"})),ca=["/towers/Base.svg"],da={name:"TowerBase",frames:ca,framesAmount:1,frameRate:0,loop:!0},ha=["/towers/FireTower/Base0.svg"],ua={name:"FireTowerBase0",frames:ha,framesAmount:1,frameRate:0,loop:!0},ma=["/towers/FireTower/Base1.svg"],ga={name:"FireTowerBase1",frames:ma,framesAmount:1,frameRate:0,loop:!0},va=["/towers/FireTower/Base2.svg"],pa={name:"FireTowerBase2",frames:va,framesAmount:1,frameRate:0,loop:!0},Oi=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/FireTower/Base0.svg"],fa={name:"FireTowerUpgrade0",frames:Oi,framesAmount:Oi.length,frameRate:10,loop:!1},Gi=["/towers/FireTower/Base0.svg","/towers/FireTower/Upgrade1.svg","/towers/FireTower/Base1.svg"],wa={name:"FireTowerUpgrade1",frames:Gi,framesAmount:Gi.length,frameRate:10,loop:!1},Hi=["/towers/FireTower/Base1.svg","/towers/FireTower/Upgrade2.svg","/towers/FireTower/Base2.svg"],ya={name:"FireTowerUpgrade2",frames:Hi,framesAmount:Hi.length,frameRate:10,loop:!1},Ca=["/towers/IceTower/Base0.svg"],ba={name:"IceTowerBase0",frames:Ca,framesAmount:1,frameRate:0,loop:!0},Ta=["/towers/IceTower/Base1.svg"],_a={name:"IceTowerBase1",frames:Ta,framesAmount:1,frameRate:0,loop:!0},xa=["/towers/IceTower/Base2.svg"],Fa={name:"IceTowerBase2",frames:xa,framesAmount:1,frameRate:0,loop:!0},Yi=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/IceTower/Base0.svg"],Ba={name:"IceTowerUpgrade0",frames:Yi,framesAmount:Yi.length,frameRate:10,loop:!1},Qi=["/towers/IceTower/Base0.svg","/towers/IceTower/Upgrade1.svg","/towers/IceTower/Base1.svg"],Aa={name:"IceTowerUpgrade1",frames:Qi,framesAmount:Qi.length,frameRate:10,loop:!1},Wi=["/towers/IceTower/Base1.svg","/towers/IceTower/Upgrade2.svg","/towers/IceTower/Base2.svg"],Ea={name:"IceTowerUpgrade2",frames:Wi,framesAmount:Wi.length,frameRate:10,loop:!1},Sa=["/towers/PoisonTower/Base0.svg"],ka={name:"PoisonTowerBase0",frames:Sa,framesAmount:1,frameRate:0,loop:!0},Ma=["/towers/PoisonTower/Base1.svg"],Pa={name:"PoisonTowerBase1",frames:Ma,framesAmount:1,frameRate:0,loop:!0},Da=["/towers/PoisonTower/Base2.svg"],Ia={name:"PoisonTowerBase2",frames:Da,framesAmount:1,frameRate:0,loop:!0},Vi=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/PoisonTower/Base0.svg"],$a={name:"PoisonTowerUpgrade0",frames:Vi,framesAmount:Vi.length,frameRate:10,loop:!1},Zi=["/towers/PoisonTower/Base0.svg","/towers/PoisonTower/Upgrade1.svg","/towers/PoisonTower/Base1.svg"],ja={name:"PoisonTowerUpgrade1",frames:Zi,framesAmount:Zi.length,frameRate:10,loop:!1},Xi=["/towers/PoisonTower/Base1.svg","/towers/PoisonTower/Upgrade2.svg","/towers/PoisonTower/Base2.svg"],La={name:"PoisonTowerUpgrade2",frames:Xi,framesAmount:Xi.length,frameRate:10,loop:!1},Ra=["/towers/ThunderTower/Base0.svg"],qa={name:"ThunderTowerBase0",frames:Ra,framesAmount:1,frameRate:0,loop:!0},Ua=["/towers/ThunderTower/Base1.svg"],Na={name:"ThunderTowerBase1",frames:Ua,framesAmount:1,frameRate:0,loop:!0},za=["/towers/ThunderTower/Base2.svg"],Oa={name:"ThunderTowerBase2",frames:za,framesAmount:1,frameRate:0,loop:!0},Ji=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/ThunderTower/Base0.svg"],Ga={name:"ThunderTowerUpgrade0",frames:Ji,framesAmount:Ji.length,frameRate:10,loop:!1},Ki=["/towers/ThunderTower/Base0.svg","/towers/ThunderTower/Upgrade1.svg","/towers/ThunderTower/Base1.svg"],Ha={name:"ThunderTowerUpgrade1",frames:Ki,framesAmount:Ki.length,frameRate:10,loop:!1},eo=["/towers/ThunderTower/Base1.svg","/towers/ThunderTower/Upgrade2.svg","/towers/ThunderTower/Base2.svg"],Ya={name:"ThunderTowerUpgrade2",frames:eo,framesAmount:eo.length,frameRate:10,loop:!1},Qa=Object.freeze(Object.defineProperty({__proto__:null,FireTowerBase0:ua,FireTowerBase1:ga,FireTowerBase2:pa,FireTowerUpgrade0:fa,FireTowerUpgrade1:wa,FireTowerUpgrade2:ya,IceTowerBase0:ba,IceTowerBase1:_a,IceTowerBase2:Fa,IceTowerUpgrade0:Ba,IceTowerUpgrade1:Aa,IceTowerUpgrade2:Ea,PoisonTowerBase0:ka,PoisonTowerBase1:Pa,PoisonTowerBase2:Ia,PoisonTowerUpgrade0:$a,PoisonTowerUpgrade1:ja,PoisonTowerUpgrade2:La,ThunderTowerBase0:qa,ThunderTowerBase1:Na,ThunderTowerBase2:Oa,ThunderTowerUpgrade0:Ga,ThunderTowerUpgrade1:Ha,ThunderTowerUpgrade2:Ya,TowerBase:da},Symbol.toStringTag,{value:"Module"})),to=["/projectiles/Fireball/Die/0.svg","/projectiles/Fireball/Die/1.svg","/projectiles/Fireball/Die/2.svg"],Wa={name:"FireballDie",frames:to,framesAmount:to.length,frameRate:10,loop:!1},so=["/projectiles/Fireball/Follow/0.svg","/projectiles/Fireball/Follow/1.svg","/projectiles/Fireball/Follow/2.svg","/projectiles/Fireball/Follow/3.svg"],Va={name:"FireballFollow",frames:so,framesAmount:so.length,frameRate:10,loop:!0},io=["/projectiles/Icebolt/Die/0.svg","/projectiles/Icebolt/Die/1.svg","/projectiles/Icebolt/Die/2.svg"],Za={name:"IceboltDie",frames:io,framesAmount:io.length,frameRate:10,loop:!1},oo=["/projectiles/Icebolt/Follow/0.svg","/projectiles/Icebolt/Follow/1.svg"],Xa={name:"IceboltFollow",frames:oo,framesAmount:oo.length,frameRate:10,loop:!0},ro=["/projectiles/Poisonball/Die/0.svg","/projectiles/Poisonball/Die/1.svg","/projectiles/Poisonball/Die/2.svg"],Ja={name:"PoisonballDie",frames:ro,framesAmount:ro.length,frameRate:10,loop:!1},ao=["/projectiles/Poisonball/Follow/0.svg","/projectiles/Poisonball/Follow/1.svg","/projectiles/Poisonball/Follow/2.svg","/projectiles/Poisonball/Follow/3.svg"],Ka={name:"PoisonballFollow",frames:ao,framesAmount:ao.length,frameRate:10,loop:!0},no=["/projectiles/Thunderbolt/Die/0.svg","/projectiles/Thunderbolt/Die/1.svg","/projectiles/Thunderbolt/Die/2.svg"],en={name:"ThunderboltDie",frames:no,framesAmount:no.length,frameRate:10,loop:!1},lo=["/projectiles/Thunderbolt/Follow/0.svg","/projectiles/Thunderbolt/Follow/1.svg","/projectiles/Thunderbolt/Follow/2.svg","/projectiles/Thunderbolt/Follow/3.svg"],tn={name:"ThunderboltFollow",frames:lo,framesAmount:lo.length,frameRate:10,loop:!0},co=["/projectiles/Click/0.svg","/projectiles/Click/1.svg","/projectiles/Click/2.svg","/projectiles/Click/3.svg"],sn={name:"Click",frames:co,framesAmount:co.length,frameRate:10,loop:!1},on=Object.freeze(Object.defineProperty({__proto__:null,Click:sn,FireballDie:Wa,FireballFollow:Va,IceboltDie:Za,IceboltFollow:Xa,PoisonballDie:Ja,PoisonballFollow:Ka,ThunderboltDie:en,ThunderboltFollow:tn},Symbol.toStringTag,{value:"Module"})),ho=["/cursors/build0.svg","/cursors/build1.svg","/cursors/build2.svg"],rn={name:"TowerBuildCursor",frames:ho,framesAmount:ho.length,frameRate:7,loop:!1},an=Object.freeze(Object.defineProperty({__proto__:null,TowerBuildCursor:rn},Symbol.toStringTag,{value:"Module"})),nn=["/throne.svg"],ln={name:"Throne",frames:nn,framesAmount:1,frameRate:0,loop:!0},cn=["/loot.svg"],dn={name:"Loot",frames:cn,framesAmount:1,frameRate:0,loop:!0},uo={Throne:ln,Loot:dn,...la,...Qa,...on,...an},De=s=>{if(!uo[s])throw new Error(`Animation config not found for: ${s}`);return uo[s]};var je,Le,Re,qe,Ue,Ts,Ne;class zo{constructor({name:e,framesAmount:t,frameRate:i,loop:o=!1}){R(this,"name");d(this,je,v(0));d(this,Le,v(0));d(this,Re,v(!1));d(this,qe,v(0));d(this,Ue,v(0));d(this,Ts,B(()=>this.getIsAnimationComplete()));d(this,Ne,v(()=>{}));this.name=e,this.framesAmount=t,this.frameRate=i,this.loop=o}get framesAmount(){return r(a(this,je))}set framesAmount(e){m(a(this,je),y(e))}get frameRate(){return r(a(this,Le))}set frameRate(e){m(a(this,Le),y(e))}get loop(){return r(a(this,Re))}set loop(e){m(a(this,Re),y(e))}get currentFrame(){return r(a(this,qe))}set currentFrame(e){m(a(this,qe),y(e))}get currentFrameTime(){return r(a(this,Ue))}set currentFrameTime(e){m(a(this,Ue),y(e))}get isComplete(){return r(a(this,Ts))}get onFrameChange(){return r(a(this,Ne))}set onFrameChange(e){m(a(this,Ne),y(e))}update(e){this.frameRate!==0&&(this.currentFrameTime+=e,this.currentFrameTime>=1e3/this.frameRate&&(this.currentFrameTime=0,this.nextFrame()))}nextFrame(){this.onFrameChange(this.currentFrame),this.currentFrame>=this.framesAmount-1?this.loop?this.currentFrame=0:this.currentFrame=this.framesAmount-1:this.currentFrame+=1}getIsAnimationComplete(){return this.loop?!1:this.currentFrame===this.framesAmount-1}}je=new WeakMap,Le=new WeakMap,Re=new WeakMap,qe=new WeakMap,Ue=new WeakMap,Ts=new WeakMap,Ne=new WeakMap;const mo={arrow:"/cursors/cursor-arrow.svg",hammer:"/cursors/cursor-hammer.svg"};var ze,_s,xs,Fs,Bs;class hn{constructor(){d(this,ze,v());d(this,_s,B(()=>`url(${mo.arrow}), auto`));d(this,xs,B(()=>`url(${mo.hammer}), auto`));d(this,Fs,B(()=>this.animation&&!this.animation.isComplete));d(this,Bs,B(()=>this.getCurrentFrame()))}get animation(){return r(a(this,ze))}set animation(e){m(a(this,ze),y(e))}get arrow(){return r(a(this,_s))}get hammer(){return r(a(this,xs))}get inAnimation(){return r(a(this,Fs))}get currentFrame(){return r(a(this,Bs))}update(e){this.inAnimation&&this.animation.update(e)}get(e){return this.inAnimation?this.currentFrame:this[e]}setAnimation(e){if(!e){this.animation=null;return}const t=De(e);this.animation=new zo({...t})}getCurrentFrame(){const{frames:e}=De(this.animation.name);return`url(${e[this.animation.currentFrame]}), auto`}}ze=new WeakMap,_s=new WeakMap,xs=new WeakMap,Fs=new WeakMap,Bs=new WeakMap;const G=new hn;var Oe,Ge,He,Ye,Qe,We,As;class un{constructor(){d(this,Oe,v(0));d(this,Ge,v(0));d(this,He,v(0));d(this,Ye,v(0));d(this,Qe,v(0));d(this,We,v(0));d(this,As,B(()=>this.width<768))}get width(){return r(a(this,Oe))}set width(e){m(a(this,Oe),y(e))}get height(){return r(a(this,Ge))}set height(e){m(a(this,Ge),y(e))}get gameAreaWidth(){return r(a(this,He))}set gameAreaWidth(e){m(a(this,He),y(e))}get gameAreaHeight(){return r(a(this,Ye))}set gameAreaHeight(e){m(a(this,Ye),y(e))}get gameXOffset(){return r(a(this,Qe))}set gameXOffset(e){m(a(this,Qe),y(e))}get gameYOffset(){return r(a(this,We))}set gameYOffset(e){m(a(this,We),y(e))}get isMobile(){return r(a(this,As))}get screenBounds(){return{x1:0,y1:0,x2:this.width,y2:this.height}}get gameBoundingBox(){return{x1:this.gameXOffset,y1:this.gameYOffset,x2:this.width,y2:this.height}}isEntityInScreen(e){const{x1:t,y1:i,x2:o,y2:n}=this.screenBounds,{x:l,y:c}=e.position;return l+e.width/2>t&&l-e.width/2<o&&c+e.height>i&&c-e.height<n}}Oe=new WeakMap,Ge=new WeakMap,He=new WeakMap,Ye=new WeakMap,Qe=new WeakMap,We=new WeakMap,As=new WeakMap;const $=new un;var mn=L('<img alt="Enemy animation" class="svelte-94zyf5">');function Zs(s,e){H(e,!0);let t=Ae(e,"entity",7),i=v(void 0),o=B(()=>De(t().animation.name)),n=B(()=>r(o).frames[t().animation.currentFrame]),l=v(!1);function c(){m(l,!0)}const g=B(()=>$.isMobile?t().scale-.2:t().scale),_=B(()=>t().position.x),h=B(()=>t().position.y),p=B(()=>`translate(${r(_)}px, ${r(h)}px) rotate(${t().rotation}deg) scale(${r(g)})`);ls(()=>{if(!r(i)||!r(l))return;let b=r(i).getBoundingClientRect();t().width=b.width,t().height=b.height});var w=mn();const u=B(()=>G.get("arrow"));jo(w,b=>m(i,b),()=>r(i)),q(()=>{we(w,"src",r(n)),U(w,"left","0px"),U(w,"top","0px"),U(w,"transform",r(p)),U(w,"cursor",r(u))}),Hs("load",w,c),$o(w),k(s,w),Y()}var Ve,Ze;const re=class re{constructor(e=0,t=0){d(this,Ve,v(0));d(this,Ze,v(0));this.x=e,this.y=t}get x(){return r(a(this,Ve))}set x(e){m(a(this,Ve),y(e))}get y(){return r(a(this,Ze))}set y(e){m(a(this,Ze),y(e))}clone(){return new re(this.x,this.y)}isEqual(e){return this.x===e.x&&this.y===e.y}add(e){return new re(this.x+e.x,this.y+e.y)}subtract(e){return new re(this.x-e.x,this.y-e.y)}multiply(e){return new re(this.x*e,this.y*e)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return e?new re(this.x/e,this.y/e):new re}distance(e){return this.subtract(e).magnitude()}dot(e){return this.x*e.x+this.y*e.y}rotate(e){const t=Math.cos(e),i=Math.sin(e);return new re(this.x*t-this.y*i,this.x*i+this.y*t)}};Ve=new WeakMap,Ze=new WeakMap;let X=re;var gn=L('<img alt="Enemy animation" class="svelte-usgp6v">');function Xs(s,e){H(e,!0);let t=Ae(e,"entity",7),i=v(void 0),o=B(()=>De(t().animation.name)),n=B(()=>r(o).frames[t().animation.currentFrame]),l=v(!1);function c(){m(l,!0)}const g=B(()=>$.isMobile?t().scale-.2:t().scale),_=B(()=>`scale(${r(g)})`);ls(()=>{var u;if(!r(i)||!r(l))return;let p=r(i).getBoundingClientRect();const w=((u=r(i).offsetParent)==null?void 0:u.getBoundingClientRect())??{x:0,y:0};t().position=new X(p.x-w.x,p.y-w.y),t().width=p.width,t().height=p.height,console.log("entity.position",r(n),t().width,t().height,$.width)});var h=gn();h.__click=function(...p){var w;(w=e.onclick)==null||w.apply(this,p)},jo(h,p=>m(i,p),()=>r(i)),q(()=>{we(h,"src",r(n)),U(h,"transform",r(_))}),Hs("load",h,c),$o(h),k(s,h),Y()}cs(["click"]);var vn=L('<div class="particle svelte-17cbyeb"></div>'),pn=L('<div class="particle-layer svelte-17cbyeb"><!></div>');function fn(s,e){H(e,!0);const t=B(()=>M.get("particleManager"));var i=pn(),o=F(i);{var n=l=>{var c=ae(),g=Z(c);se(g,16,()=>r(t).particles,_=>_,(_,h)=>{var p=vn();q(()=>{U(p,"left",`${h.x??""}px`),U(p,"top",`${h.y??""}px`),U(p,"width",`${h.size??""}px`),U(p,"height",`${h.size??""}px`),U(p,"background-color",h.color),U(p,"opacity",h.life)}),k(_,p)}),k(l,c)};W(o,l=>{r(t)&&l(n)})}C(i),k(s,i),Y()}function Fe(s,e){return s.x1<=e.x2&&s.x2>=e.x1&&s.y1<=e.y2&&s.y2>=e.y1}function Oo(s,e){return Math.atan2(e.y-s.y,e.x-s.x)}function ui(s){return new X(Math.cos(s),Math.sin(s))}const mi=(s,e,t)=>({x1:s.x-e/2,y1:s.y-t/2,x2:s.x+e/2,y2:s.y+t/2,center:new X(s.x,s.y),topMiddle:new X(s.x+e/2,s.y)}),Js={bgSound:"/sound/bgSound.mp3",effects:{pickUp:"/sound/sfx/pickUp.m4a",towerUpgrade:"/sound/sfx/towerUpgrade.m4a",clickEnemy:"/sound/sfx/clickEnemy.m4a",towerShoot:"/sound/sfx/towerShoot.m4a",clickMenu:"/sound/sfx/clickMenu.m4a",lowResourse:"/sound/sfx/lowResourse.m4a",shine:"/sound/sfx/shine.mp3",magicBurst:"/sound/sfx/magic-burst.mp3"}},hs=.3,wn=.2;var Xe,Je,Ke,et,tt,st,it,ot,Es,Ss;class yn{constructor(){d(this,Xe,v({}));d(this,Je,v(!1));d(this,Ke,v(0));d(this,et,v(null));d(this,tt,v(null));d(this,st,v(null));d(this,it,v(!1));d(this,ot,v(0));d(this,Es,B(()=>Object.keys(Js.effects).length+1));d(this,Ss,B(()=>Math.min(Math.floor(this.loadedCount/this.totalResources*100),100)));R(this,"preload",async()=>{const e=(t,i)=>new Promise((o,n)=>{const l=new Audio(i),c=()=>{this.sounds[t]=l,this.sounds[t].volume=t==="bgSound"?hs:wn,this.sounds[t].loop=t==="bgSound",this.loadedCount+=1,l.removeEventListener("canplaythrough",c),o()},g=_=>{l.removeEventListener("error",g),n(_)};l.addEventListener("canplaythrough",c),l.addEventListener("error",g),l.load()});try{await e("bgSound",Js.bgSound);const t=Object.entries(Js.effects).map(([i,o])=>e(i,o));await Promise.all(t),this.preloaded=!0,console.log("Sounds preloaded successfully.")}catch(t){throw console.error("Error preloading sounds:",t),t}});R(this,"reduceBgVolume",()=>{this.sounds.bgSound.volume=hs-.2});R(this,"restoreBgVolume",()=>{this.sounds.bgSound.volume=hs});R(this,"initAudioContext",()=>{if(this.audioContext)return;const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e;const t=this.sounds.bgSound;t&&(this.bgNode=this.audioContext.createMediaElementSource(t),this.bgFilter=this.audioContext.createBiquadFilter(),this.bgFilter.type="lowpass",this.bgFilter.frequency.value=22050,this.bgNode.connect(this.bgFilter),this.bgFilter.connect(this.audioContext.destination))});R(this,"play",(e,t=!1)=>{if(this.isMuted)return;const i=this.sounds[e];if(i){if(e==="bgSound"){this.initAudioContext(),this.audioContext.state==="suspended"&&this.audioContext.resume(),i.currentTime=0,i.play();return}if(!(navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"))&&(t||this.playingEffectsCount<10)){i.currentTime=0,i.play();const o=()=>{this.playingEffectsCount-=1,i.removeEventListener("ended",o)};i.addEventListener("ended",o),this.playingEffectsCount+=1}}})}get sounds(){return r(a(this,Xe))}set sounds(e){m(a(this,Xe),e)}get isMuted(){return r(a(this,Je))}set isMuted(e){m(a(this,Je),y(e))}get playingEffectsCount(){return r(a(this,Ke))}set playingEffectsCount(e){m(a(this,Ke),y(e))}get audioContext(){return r(a(this,et))}set audioContext(e){m(a(this,et),e)}get bgNode(){return r(a(this,tt))}set bgNode(e){m(a(this,tt),e)}get bgFilter(){return r(a(this,st))}set bgFilter(e){m(a(this,st),e)}get preloaded(){return r(a(this,it))}set preloaded(e){m(a(this,it),y(e))}get loadedCount(){return r(a(this,ot))}set loadedCount(e){m(a(this,ot),y(e))}get totalResources(){return r(a(this,Es))}get preloadPercent(){return r(a(this,Ss))}pause(e){const t=this.sounds[e];t&&t.pause()}toggleMute(){this.isMuted=!this.isMuted,this.isMuted?this.pause("bgSound"):this.play("bgSound")}reset(){if(this.isMuted)return;const e=this.sounds.bgSound;e&&(e.currentTime=0,e.volume=hs,e.play())}setDistortion(e){if(!this.bgFilter||!this.audioContext)return;const t=this.audioContext.currentTime,i=e?600:22050;this.bgFilter.frequency.cancelScheduledValues(t),this.bgFilter.frequency.exponentialRampToValueAtTime(i,t+.5)}}Xe=new WeakMap,Je=new WeakMap,Ke=new WeakMap,et=new WeakMap,tt=new WeakMap,st=new WeakMap,it=new WeakMap,ot=new WeakMap,Es=new WeakMap,Ss=new WeakMap;const j=new yn,Cn={click:5,upgrade:35};var rt,at,nt,lt,ct,dt;class bn{constructor(){d(this,rt,v(100));d(this,at,v(!1));d(this,nt,v(!1));d(this,lt,v(!1));d(this,ct,v(100));d(this,dt,v(0))}get collectedLoot(){return r(a(this,rt))}set collectedLoot(e){m(a(this,rt),y(e))}get playLowLootAnimation(){return r(a(this,at))}set playLowLootAnimation(e){m(a(this,at),y(e))}get playTowerUpgradeAnimation(){return r(a(this,nt))}set playTowerUpgradeAnimation(e){m(a(this,nt),y(e))}get playEnemyClickAnimation(){return r(a(this,lt))}set playEnemyClickAnimation(e){m(a(this,lt),y(e))}get score(){return r(a(this,ct))}set score(e){m(a(this,ct),y(e))}get killsEnemy(){return r(a(this,dt))}set killsEnemy(e){m(a(this,dt),y(e))}spendLoot(e){const t=Cn[e.type];if(e.type==="upgrade"){const{questionManager:i}=M.get(["questionManager"]),{tower:o}=e.payload;if(o.state.currentState.name==="NotBuilt"){i.buildPoints>0?(i.buildPoints--,o.state.setState("Guard"),o.stats.health=o.stats.maxHealth||3):this.playAnimation("LowLoot");return}else{this.collectedLoot>=t?i.buildPoints>0?(this.collectedLoot-=t,i.buildPoints--,o.state.setState("Upgrade"),this.playAnimation("TowerUpgrade"),G.setAnimation("TowerBuildCursor")):this.playAnimation("LowLoot"):this.playAnimation("LowLoot");return}}if(this.collectedLoot<t){this.playAnimation("LowLoot");return}if(e.type==="click"){const{collisionManager:i,stageManager:o}=M.get(["collisionManager","stageManager"]),{offset:n}=e.payload,l=mi(n,60,60),c=i.filterEnemiesByBounds(l);o.spawnEntity("ClickExplode",n),j.play("clickEnemy",!0),c.forEach(g=>{g.state.setState("Die")}),c.length>0&&(this.collectedLoot-=t)}}receiveLoot(e){this.collectedLoot+=e,this.score+=e,this.killsEnemy++}reset(){this.collectedLoot=100,this.killsEnemy=0}getAnimation(e){return`play${e}Animation`}playAnimation(e){const t=this.getAnimation(e);this[t]=!0}unsetAnimation(e){const t=this.getAnimation(e);this[t]=!1}}rt=new WeakMap,at=new WeakMap,nt=new WeakMap,lt=new WeakMap,ct=new WeakMap,dt=new WeakMap;const ne=new bn;var Tn=L('<div class="segment-marker svelte-1syar9e"></div>'),_n=L('<div class="health-bar-container svelte-1syar9e"><div class="health-bar-background svelte-1syar9e"><!> <div class="health-bar-fill svelte-1syar9e"></div></div></div>');function xn(s,e){H(e,!0);const t=e.entity.stats.maxHealth||500,i=5,o=B(()=>Math.max(0,Math.min(100,e.entity.stats.health/t*100))),n=Array.from({length:i-1},(p,w)=>(w+1)*(100/i));var l=_n();const c=B(()=>G.get("arrow"));q(()=>U(l,"cursor",r(c)));var g=F(l),_=F(g);se(_,17,()=>n,ws,(p,w)=>{var u=Tn();q(()=>U(u,"left",`${r(w)??""}%`)),k(p,u)});var h=A(_,2);C(g),C(l),q(()=>{pe(h,"low",r(o)<=20),pe(h,"medium",r(o)>20&&r(o)<=60),pe(h,"high",r(o)>60),U(h,"width",`${r(o)??""}%`)}),k(s,l),Y()}var Fn=L('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Bn=L('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),An=L('<div class="tower-wrapper svelte-11at443"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div>'),En=L('<div class="tower-wrapper svelte-11at443"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div>'),Sn=L('<section class="svelte-11at443"><!> <!> <!> <div class="towers svelte-11at443"></div> <div class="throne svelte-11at443"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="towers svelte-11at443"></div> <!></section>');function kn(s,e){H(e,!0);const t=B(()=>M.get("entityManager")),i=f=>E=>{E.stopPropagation(),!(f.upgradeLevel===2||!f.isUpgradable||G.inAnimation)&&ne.spendLoot({type:"upgrade",payload:{tower:f}})};var o=Sn();const n=B(()=>G.get("arrow"));q(()=>U(o,"cursor",r(n)));var l=F(o);se(l,17,()=>r(t).loot,f=>f.id,(f,E)=>{var T=Fn(),x=Z(T);_e(x,()=>({"--z-index":11})),Zs(x.lastChild,{get entity(){return r(E)}}),C(x),k(f,T)});var c=A(l,2);se(c,17,()=>r(t).projectiles,f=>f.id,(f,E)=>{var T=Bn(),x=Z(T);_e(x,()=>({"--z-index":12})),Zs(x.lastChild,{get entity(){return r(E)}}),C(x),k(f,T)});var g=A(c,2);se(g,17,()=>r(t).enemies,f=>f.id,(f,E)=>{Zs(f,{get entity(){return r(E)}})});var _=A(g,2);se(_,23,()=>r(t).topTowers,f=>f.id,(f,E,T)=>{var x=An(),P=F(x),D=B(()=>i(r(E)));_e(P,()=>({"--cursor":G.get("hammer"),"--z-index":10,"--pointer-events":"auto","--margin-left":r(T)===0?"12px":"0","--margin-right":r(T)===1?"12px":"0"})),Xs(P.lastChild,{get entity(){return r(E)},get onclick(){return r(D)}}),C(P),C(x),k(f,x)}),C(_);var h=A(_,2),p=F(h);_e(p,()=>({"--cursor":G.get("arrow")})),Xs(p.lastChild,{get entity(){return r(t).throne}}),C(p);var w=A(p,2);_e(w,()=>({"--width":`${r(t).throne.width}px`})),xn(w.lastChild,{get entity(){return r(t).throne}}),C(w),C(h);var u=A(h,2);se(u,23,()=>r(t).bottomTowers,f=>f.id,(f,E,T)=>{var x=En(),P=F(x),D=B(()=>i(r(E)));_e(P,()=>({"--cursor":G.get("hammer"),"--z-index":10,"--pointer-events":"auto","--margin-left":r(T)===0?"12px":"0","--margin-right":r(T)===1?"12px":"0"})),Xs(P.lastChild,{get entity(){return r(E)},get onclick(){return r(D)}}),C(P),C(x),k(f,x)}),C(u);var b=A(u,2);fn(b,{}),C(o),k(s,o),Y()}const Mn=(s,e)=>{j!=null&&j.preloaded&&j.play("clickMenu",!0),e.onclick()};var Pn=L('<button class="btn svelte-11ulr"> <div class="tab svelte-11ulr"></div></button>');function fe(s,e){H(e,!0);const t=Ae(e,"disabled",3,!1),i=Ae(e,"text",3,"");var o=Pn();o.__click=[Mn,e];const n=B(()=>G.get("arrow"));var l=F(o);di(),C(o),q(()=>{o.disabled=t(),U(o,"cursor",r(n)),oe(l,`${i()??""} `)}),k(s,o),Y()}cs(["click"]);const Dn=s=>s;function Go(s){const e=s-1;return e*e*e+1}function le(s,{delay:e=0,duration:t=400,easing:i=Dn}={}){const o=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:i,css:n=>`opacity: ${n*o}`}}function In(s,{delay:e=0,duration:t=400,easing:i=Go,axis:o="y"}={}){const n=getComputedStyle(s),l=+n.opacity,c=o==="y"?"height":"width",g=parseFloat(n[c]),_=o==="y"?["top","bottom"]:["left","right"],h=_.map(T=>`${T[0].toUpperCase()}${T.slice(1)}`),p=parseFloat(n[`padding${h[0]}`]),w=parseFloat(n[`padding${h[1]}`]),u=parseFloat(n[`margin${h[0]}`]),b=parseFloat(n[`margin${h[1]}`]),f=parseFloat(n[`border${h[0]}Width`]),E=parseFloat(n[`border${h[1]}Width`]);return{delay:e,duration:t,easing:i,css:T=>`overflow: hidden;opacity: ${Math.min(T*20,1)*l};${c}: ${T*g}px;padding-${_[0]}: ${T*p}px;padding-${_[1]}: ${T*w}px;margin-${_[0]}: ${T*u}px;margin-${_[1]}: ${T*b}px;border-${_[0]}-width: ${T*f}px;border-${_[1]}-width: ${T*E}px;`}}function ys(s,{delay:e=0,duration:t=400,easing:i=Go,start:o=0,opacity:n=0}={}){const l=getComputedStyle(s),c=+l.opacity,g=l.transform==="none"?"":l.transform,_=1-o,h=c*(1-n);return{delay:e,duration:t,easing:i,css:(p,w)=>`
			transform: ${g} scale(${1-_*w});
			opacity: ${c-h*w}
		`}}var $n=L('<div class="menu-container svelte-n7rxky"><div class="grid-overlay svelte-n7rxky"></div> <div class="scan-line svelte-n7rxky"></div> <div class="menu-content svelte-n7rxky"><!></div></div>');function gi(s,e){H(e,!0);var t=$n();const i=B(()=>G.get("arrow"));q(()=>U(t,"cursor",r(i)));var o=A(F(t),4),n=F(o);Ur(n,()=>e.children),C(o),C(t),V(1,t,()=>le,()=>({duration:200})),V(2,t,()=>le,()=>({duration:200})),k(s,t),Y()}var jn=bo('<svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="25" cy="25" r="24.5" fill="#FFD700" stroke="white"></circle><circle cx="25" cy="25" r="18" fill="#FFAE00"></circle><path d="M43 25C43 20.2261 41.1036 15.6477 37.7279 12.2721C34.3523 8.89642 29.7739 7 25 7C20.2261 7 15.6477 8.89642 12.2721 12.2721C8.89642 15.6477 7 20.2261 7 25H7.72C7.72 20.4171 9.54057 16.0218 12.7812 12.7812C16.0218 9.54057 20.4171 7.72 25 7.72C29.5829 7.72 33.9782 9.54057 37.2188 12.7812C40.4594 16.0218 42.28 20.4171 42.28 25H43Z" fill="#E17100"></path><path d="M43 25C43 29.7739 41.1036 34.3523 37.7279 37.7279C34.3523 41.1036 29.7739 43 25 43C20.2261 43 15.6477 41.1036 12.2721 37.7279C8.89642 34.3523 7 29.7739 7 25H7.72C7.72 29.5829 9.54057 33.9782 12.7812 37.2188C16.0218 40.4594 20.4171 42.28 25 42.28C29.5829 42.28 33.9782 40.4594 37.2188 37.2188C40.4594 33.9782 42.28 29.5829 42.28 25H43Z" fill="#FFF4BA"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 32.712C27.4385 32.7173 29.256 32.7221 30.6708 32.1912C32.8572 34.0388 35.4701 34.3689 36.5404 32.9185C37.6236 31.4507 36.7166 28.7153 34.5147 26.8087C34.237 26.5683 33.9521 26.3526 33.6639 26.1621C33.6294 19.4369 29.6875 14 24.83 14C19.951 14 15.9959 19.4851 15.9959 26.2512C15.9959 26.5311 16.0026 26.7988 16.0159 27.055C13.6344 28.6054 12.4107 31.1356 13.2796 32.7392C14.1577 34.3598 16.8404 34.4205 19.2715 32.8748C19.4834 32.7401 19.6864 32.5977 19.8798 32.4487C21.1345 32.7202 22.6195 32.7163 24.2217 32.712C24.4227 32.7115 24.6255 32.7109 24.83 32.7109C25.0344 32.7109 25.2373 32.7115 25.4383 32.712Z" fill="#E17100"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 30.712C27.4385 30.7173 29.256 30.7221 30.6708 30.1912C32.8572 32.0388 35.4701 32.3689 36.5404 30.9185C37.6236 29.4507 36.7166 26.7153 34.5147 24.8087C34.237 24.5683 33.9521 24.3526 33.6639 24.1621C33.6294 17.4369 29.6875 12 24.83 12C19.951 12 15.9959 17.4851 15.9959 24.2512C15.9959 24.5311 16.0026 24.7988 16.0159 25.055C13.6344 26.6054 12.4107 29.1356 13.2796 30.7392C14.1577 32.3598 16.8404 32.4205 19.2715 30.8748C19.4834 30.7401 19.6864 30.5977 19.8798 30.4487C21.1345 30.7202 22.6195 30.7163 24.2217 30.712C24.4227 30.7115 24.6255 30.7109 24.83 30.7109C25.0344 30.7109 25.2373 30.7115 25.4383 30.712Z" fill="#FFF4BA"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 31.712C27.4385 31.7173 29.256 31.7221 30.6708 31.1912C32.8572 33.0388 35.4701 33.3689 36.5404 31.9185C37.6236 30.4507 36.7166 27.7153 34.5147 25.8087C34.237 25.5683 33.9521 25.3526 33.6639 25.1621C33.6294 18.4369 29.6875 13 24.83 13C19.951 13 15.9959 18.4851 15.9959 25.2512C15.9959 25.5311 16.0026 25.7988 16.0159 26.055C13.6344 27.6054 12.4107 30.1356 13.2796 31.7392C14.1577 33.3598 16.8404 33.4205 19.2715 31.8748C19.4834 31.7401 19.6864 31.5977 19.8798 31.4487C21.1345 31.7202 22.6195 31.7163 24.2217 31.712C24.4227 31.7115 24.6255 31.7109 24.83 31.7109C25.0344 31.7109 25.2373 31.7115 25.4383 31.712Z" fill="#FFD700"></path><ellipse cx="24.9976" cy="22.982" rx="4.14994" ry="4.14994" fill="#FFF4BA"></ellipse><ellipse cx="25.0038" cy="22.9862" rx="2.62101" ry="2.62102" fill="#E17100"></ellipse><circle cx="25.0068" cy="22.9873" r="1.97166" fill="#FFD700"></circle><circle cx="25.0015" cy="22.9801" r="0.997639" fill="#E17100"></circle><mask id="path-12-inside-1_2401_1913" fill="white"><path d="M29.4521 22.9805C29.7547 22.9805 30.0031 22.7344 29.97 22.4336C29.8463 21.3087 29.3434 20.2528 28.5355 19.4449C27.5979 18.5073 26.3261 17.9805 25 17.9805C23.6739 17.9805 22.4021 18.5073 21.4645 19.4449C20.6566 20.2528 20.1537 21.3087 20.03 22.4336C19.9969 22.7344 20.2453 22.9805 20.5479 22.9805C20.8506 22.9805 21.0919 22.7339 21.1343 22.4343C21.252 21.6007 21.6372 20.822 22.2394 20.2198C22.9715 19.4877 23.9646 19.0764 25 19.0764C26.0354 19.0764 27.0285 19.4877 27.7606 20.2198C28.3628 20.822 28.748 21.6007 28.8657 22.4343C28.9081 22.7339 29.1494 22.9805 29.4521 22.9805Z"></path></mask><path d="M29.4521 22.9805C29.7547 22.9805 30.0031 22.7344 29.97 22.4336C29.8463 21.3087 29.3434 20.2528 28.5355 19.4449C27.5979 18.5073 26.3261 17.9805 25 17.9805C23.6739 17.9805 22.4021 18.5073 21.4645 19.4449C20.6566 20.2528 20.1537 21.3087 20.03 22.4336C19.9969 22.7344 20.2453 22.9805 20.5479 22.9805C20.8506 22.9805 21.0919 22.7339 21.1343 22.4343C21.252 21.6007 21.6372 20.822 22.2394 20.2198C22.9715 19.4877 23.9646 19.0764 25 19.0764C26.0354 19.0764 27.0285 19.4877 27.7606 20.2198C28.3628 20.822 28.748 21.6007 28.8657 22.4343C28.9081 22.7339 29.1494 22.9805 29.4521 22.9805Z" stroke="#E17100" stroke-width="2" mask="url(#path-12-inside-1_2401_1913)"></path><circle cx="24.3913" cy="21.9831" r="0.613932" fill="white"></circle><ellipse cx="26.0021" cy="24.2619" rx="0.283353" ry="0.283353" fill="white"></ellipse></svg>');function ye(s,e){const t=Ae(e,"width",3,40),i=Ae(e,"height",3,40);var o=jn();q(()=>{we(o,"width",t()),we(o,"height",i())}),k(s,o)}var Ln=L('<div class="content svelte-1fxce1q"><h1 class="svelte-1fxce1q"> </h1> <div class="scores"><h2 class="svelte-1fxce1q"> </h2> <h2 class="svelte-1fxce1q"> </h2></div> <div class="hint svelte-1fxce1q"><h2 class="svelte-1fxce1q">Hint:</h2> <p>- Click on an Enemy to kill it</p> <p>- Click on a gray spot to build a Tower</p> <p>- Click on a Tower to upgrade</p> <div class="additional-hint svelte-1fxce1q"><div>Manage your resources carefully if you want to survive until the last wave!</div> <div class="cost svelte-1fxce1q"><div class="cost-item svelte-1fxce1q"><div>Upgrading towers costs 35</div> <div><!></div></div> <div class="cost-item svelte-1fxce1q"><div>Enemy click costs 5</div> <div><!></div></div></div></div></div> <!></div>');function Rn(s,e){H(e,!0);const t=B(()=>M.get("stageManager"));hi(()=>{j.reduceBgVolume()}),Io(()=>{j.restoreBgVolume()}),gi(s,{children:(i,o)=>{var n=Ln(),l=F(n),c=F(l,!0);C(l);var g=A(l,2),_=F(g),h=F(_);C(_);var p=A(_,2),w=F(p);C(p),C(g);var u=A(g,2),b=A(F(u),8),f=A(F(b),2),E=F(f),T=A(F(E),2),x=F(T);ye(x,{width:13,height:13}),C(T),C(E);var P=A(E,2),D=A(F(P),2),S=F(D);ye(S,{width:13,height:13}),C(D),C(P),C(f),C(b),C(u);var I=A(u,2);fe(I,{get onclick(){return e.onRestart},text:"Restart"}),C(n),q(()=>{oe(c,r(t).stageResult==="win"?"You win!":"You lose!"),oe(h,`Enemies killed: ${ne.killsEnemy??""}`),oe(w,`Score: ${ne.score??""}`)}),V(1,n,()=>In,()=>({duration:500})),V(2,n,()=>le,()=>({duration:300})),k(i,n)},$$slots:{default:!0}}),Y()}function qn(s){return s}function Un(s){const e=s-1;return e*e*e+1}function Ho(s){return Math.sin(-13*(s+1)*Math.PI/2)*Math.pow(2,-10*s)+1}var Nn=L(`<div class="overlay svelte-thh9az"><div class="backdrop svelte-thh9az"></div> <div class="hud-container svelte-thh9az"><div class="content svelte-thh9az"><button class="close-btn svelte-thh9az">&times;</button> <div class="header-section svelte-thh9az"><h2 class="modal-header svelte-thh9az">Combat Manual</h2> <div class="decoration-bar svelte-thh9az"></div></div> <div class="scroll-content svelte-thh9az"><section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">üëë</span> Defend the Throne</h3> <p class="svelte-thh9az">Enemies will attack immediately. If your Throne is destroyed, it's Game Over!</p></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">‚öîÔ∏è</span> Combat Protocol</h3> <p class="svelte-thh9az"><strong class="svelte-thh9az">Click Enemies</strong> to neutralize them directly.</p> <div class="cost-row svelte-thh9az"><span>Cost: 5 <!></span> <span class="separator svelte-thh9az">|</span> <span>Reward: Gold <!></span></div></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">‚ùì</span> The "Chance" Event</h3> <p class="svelte-thh9az">Time dilates. A query appears. Your knowledge is your weapon.</p> <ul class="svelte-thh9az"><li class="good svelte-thh9az"><strong class="svelte-thh9az">Correct:</strong> +1 Build Point (Construct Defenses).</li> <li class="bad svelte-thh9az"><strong class="svelte-thh9az">Incorrect:</strong> Strike recorded. 3 Strikes = Tower Destruction.</li></ul></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">üèóÔ∏è</span> Construction</h3> <div class="construction-grid svelte-thh9az"><div class="construction-item svelte-thh9az"><strong class="svelte-thh9az">Build</strong> <span>Click gray nodes.</span> <span class="highlight svelte-thh9az">Unlocks with Build Points</span></div> <div class="construction-item svelte-thh9az"><strong class="svelte-thh9az">Upgrade</strong> <span>Click towers.</span> <span class="highlight svelte-thh9az">Costs Gold + BP</span></div></div></section></div> <div class="footer svelte-thh9az"><!></div></div></div></div>`);function zn(s,e){var t=Nn(),i=F(t),o=A(i,2),n=F(o),l=F(n);l.__click=function(...E){var T;(T=e.onClose)==null||T.apply(this,E)};var c=A(l,4),g=A(F(c),2),_=A(F(g),4),h=F(_),p=A(F(h));ye(p,{width:12,height:12}),C(h);var w=A(h,4),u=A(F(w));ye(u,{width:12,height:12}),C(w),C(_),C(g),di(4),C(c);var b=A(c,2),f=F(b);fe(f,{text:"Initialize",get onclick(){return e.onClose}}),C(b),C(n),C(o),C(t),V(3,i,()=>le,()=>({duration:500})),V(3,o,()=>ys,()=>({duration:600,start:.8,easing:Ho})),V(3,t,()=>le,()=>({duration:200})),k(s,t)}cs(["click"]);var On=L('<div class="content svelte-pidkvq"><img src="/logos/knowledge-space2.png" alt="Knowledge Space" style="width: 80%; max-width: 500px;" class="svelte-pidkvq"> <div class="star-container svelte-pidkvq"><img src="/logos/shooting-star-realistic.png" alt="Shooting Star" class="shooting-star-art svelte-pidkvq"></div> <div class="svelte-pidkvq"><h2 class="svelte-pidkvq">Hint:</h2> <p class="svelte-pidkvq">- Click on an Enemy to kill it</p> <p class="svelte-pidkvq">- Click on a gray spot to build a Tower</p> <p class="svelte-pidkvq">- Click on a Tower to upgrade</p> <div class="additional-hint svelte-pidkvq"><div class="svelte-pidkvq">Manage your resources carefully if you want to survive until the last wave!</div> <div class="cost svelte-pidkvq"><div class="cost-item svelte-pidkvq"><div class="svelte-pidkvq">Upgrading towers costs 35</div> <div class="svelte-pidkvq"><!></div></div> <div class="cost-item svelte-pidkvq"><div class="svelte-pidkvq">Enemy click costs 5</div> <div class="svelte-pidkvq"><!></div></div></div></div></div> <div class="buttons-container svelte-pidkvq"><!> <div style="height: 10px;" class="svelte-pidkvq"></div> <!></div></div>'),Gn=L("<!> <!>",1);function Hn(s,e){H(e,!0);let t=v(!1);const i=B(()=>j.preloaded?"Start game":`${j.preloadPercent}%`);var o=Gn(),n=Z(o);gi(n,{children:(g,_)=>{var h=On(),p=A(F(h),4),w=A(F(p),8),u=A(F(w),2),b=F(u),f=A(F(b),2),E=F(f);ye(E,{width:13,height:13}),C(f),C(b);var T=A(b,2),x=A(F(T),2),P=F(x);ye(P,{width:13,height:13}),C(x),C(T),C(u),C(w),C(p);var D=A(p,2),S=F(D),I=B(()=>!j.preloaded);fe(S,{get disabled(){return r(I)},get text(){return r(i)},get onclick(){return e.onStart}});var O=A(S,4);fe(O,{text:"How to Play",onclick:()=>m(t,!0)}),C(D),C(h),V(2,h,()=>le,()=>({duration:300})),k(g,h)},$$slots:{default:!0}});var l=A(n,2);{var c=g=>{zn(g,{onClose:()=>m(t,!1)})};W(l,g=>{r(t)&&g(c)})}k(s,o),Y()}class Yn{constructor(){R(this,"filterEnemiesByBounds",e=>M.get("entityManager").livingEnemies.filter(i=>Fe(i.boundingBox,e)))}update(){const e=M.get("entityManager");this.handleEnemyCollisions(e.livingEnemies,e.livingProjectiles,e.throne),this.handleProjectileCollisions(e.livingProjectiles),this.handleLootCollisions(e.livingLoot,e.throne)}handleEnemyCollisions(e,t,i){for(const o of e){for(const n of t)this.checkCollision(n,o)&&(n.onCollide(o),o.onCollide(n));this.checkCollision(o,i)&&(o.onCollide(i),i.onCollide(o))}}handleProjectileCollisions(e){for(const t of e)if(!this.checkScreenBounds(t)){t.onCollide("OUT_OF_BOUNDS");continue}}handleLootCollisions(e,t){e.forEach(i=>{this.checkCollision(i,t)&&(i.onCollide(t),t.onCollide(i))})}checkCollision(e,t){return Fe(e.boundingBox,t.boundingBox)}checkBounds(e,t){return Fe(e.boundingBox,t)}checkScreenBounds(e){return Fe(e.boundingBox,$.screenBounds)}checkGameBounds(e){return Fe(e.boundingBox,$.gameBoundingBox)}}var ht,ks,Ms,Ps,Ds,Is,$s,js,Ls,Rs,qs;class Qn{constructor(){d(this,ht,v([]));d(this,ks,B(()=>this.entities.filter(e=>e.type==="enemy")));d(this,Ms,B(()=>this.enemies.filter(e=>e.isInteractable)));d(this,Ps,B(()=>this.entities.filter(e=>e.type==="tower")));d(this,Ds,B(()=>this.towers.filter((e,t)=>t<=1)));d(this,Is,B(()=>this.towers.filter((e,t)=>t>=2)));d(this,$s,B(()=>this.entities.filter(e=>e.type==="projectile")));d(this,js,B(()=>this.projectiles.filter(e=>e.isInteractable)));d(this,Ls,B(()=>this.entities.find(e=>e.type==="throne")));d(this,Rs,B(()=>this.entities.filter(e=>e.type==="loot")));d(this,qs,B(()=>this.loot.filter(e=>e.isInteractable)));R(this,"update",e=>{this.entities.forEach(t=>t.update(e))});R(this,"reset",()=>{this.entities=[]});R(this,"add",e=>{this.entities=[...this.entities,...Array.isArray(e)?e:[e]]});R(this,"destroy",e=>{this.entities=this.entities.filter(t=>t.id!==e)});R(this,"getByName",e=>this.entities.find(t=>t.name===e));R(this,"getById",e=>this.entities.find(t=>t.id===e))}get entities(){return r(a(this,ht))}set entities(e){m(a(this,ht),e)}get enemies(){return r(a(this,ks))}get livingEnemies(){return r(a(this,Ms))}get towers(){return r(a(this,Ps))}get topTowers(){return r(a(this,Ds))}get bottomTowers(){return r(a(this,Is))}get projectiles(){return r(a(this,$s))}get livingProjectiles(){return r(a(this,js))}get throne(){return r(a(this,Ls))}get loot(){return r(a(this,Rs))}get livingLoot(){return r(a(this,qs))}filterByName(e){return this.entities.filter(t=>Array.isArray(e)?e.includes(t.name):t.name===e)}findNearestEntity(e,t){const i=t.filter(c=>c.isInteractable);if(i.length===0)return;const o=i.map(c=>e.position.distance(c.position)),n=Math.min(...o),l=o.indexOf(n);return i[l]}findNearestEntities(e,t,i=3){const o=t.filter(c=>c.isInteractable);if(o.length===0)return;const n=o.map(c=>({target:c,distance:e.position.distance(c.position)}));n.sort((c,g)=>c.distance-g.distance);const l=Math.min(i,n.length);return n.slice(0,l).map(c=>c.target)}findByPosition(e){const t=mi(e,100,100);return this.entities.filter(i=>Fe(i.boundingBox,t))}}ht=new WeakMap,ks=new WeakMap,Ms=new WeakMap,Ps=new WeakMap,Ds=new WeakMap,Is=new WeakMap,$s=new WeakMap,js=new WeakMap,Ls=new WeakMap,Rs=new WeakMap,qs=new WeakMap;const go=[{commonEnemies:["PurpleCommon","YellowCommon"],time:6e4,eliteEnemies:["RedBlobElite"],spawnDelays:{common:900,elite:1400},statsAmplify:{health:1,speed:1,damage:1}},{commonEnemies:["YellowCommon","BlueCommon"],eliteEnemies:["GreenCircleElite","BlueCircleElite"],time:12e4,spawnDelays:{common:800,elite:1300},statsAmplify:{health:1.2,speed:1.2,damage:1.2}},{commonEnemies:["PurpleCommon","YellowCommon","BlueCommon"],eliteEnemies:["BlueBlobElite","GreenCircleElite","BlueCircleElite"],time:12e4,spawnDelays:{common:600,elite:1100},statsAmplify:{health:1.7,speed:1.4,damage:1.5}},{commonEnemies:["PurpleCommon","YellowCommon","BlueCommon"],eliteEnemies:["BlueCircleElite","GreenCircleElite","BlueBlobElite","RedBlobElite"],time:12e4,spawnDelays:{common:400,elite:800},statsAmplify:{health:2.2,speed:1.6,damage:1.8}}],ge=(s,e)=>{s.takeDamage(e.stats.damage)},us=(s,e)=>{s.state.setState("Explode")},Wn=(s,e)=>{e.type==="loot"?(ne.receiveLoot(1),j.play("pickUp")):e.type==="enemy"&&s.takeDamage(e.stats.damage)},ms=(s,e)=>{e.type==="enemy"&&(s.takeDamage(1),e.takeDamage(999))},Vn=(s,e)=>{s.stopInteractions(),M.get("entityManager").destroy(s.id)},Yo={PurpleCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.6,stateToAnimation:{FollowThrone:"PurpleCommonFollow",Die:"PurpleCommonDie"},stats:{health:20,speed:.03,damage:5},onCollide:ge},YellowCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.8,stateToAnimation:{FollowThrone:"YellowCommonFollow",Die:"YellowCommonDie"},stats:{health:15,speed:.025,damage:4},onCollide:ge},BlueCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.7,stateToAnimation:{FollowThrone:"BlueCommonFollow",Die:"BlueCommonDie"},stats:{health:25,speed:.02,damage:8},onCollide:ge},GreenCircleElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"GreenCircleEliteFollow",Die:"GreenCircleEliteDie"},stats:{health:80,speed:.01,damage:15},onCollide:ge},RedBlobElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.8,stateToAnimation:{FollowThrone:"RedBlobEliteFollow",Die:"RedBlobEliteDie"},stats:{health:30,speed:.015,damage:10},onCollide:ge},BlueBlobElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"BlueBlobEliteFollow",Die:"BlueBlobEliteDie"},stats:{health:60,speed:.04,damage:8},onCollide:ge},BlueCircleElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"BlueCircleEliteFollow",Die:"BlueCircleEliteDie"},stats:{health:70,speed:.02,damage:10},onCollide:ge}},Zn=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],Xn=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],Jn=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],Kn=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=30,s.stats.projectileNumber+=1}],J={questionInterval:8e3,initialQuestionDelay:2e3,bulletTimeFactor:.05,questionDuration:1e4,maxStrikes:3,mainTowerHP:1e3,subTowerHP:3},gs={health:J.subTowerHP,maxHealth:J.subTowerHP,attackSpeed:800,projectileNumber:1},vi={Throne:{type:"throne",stats:{health:J.mainTowerHP,maxHealth:J.mainTowerHP,damage:999,speed:0},scale:.6,stateToAnimation:{Idle:"Throne",Die:"Throne"},initialState:"Idle",onCollide:Wn},FireTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"FireTowerBase0",Shoot:"FireTowerBase0",NotBuilt:"TowerBase",Upgrade:"FireTowerUpgrade0"},effects:[],stats:{...gs,projectileType:"Fireball"},scale:.8,upgrades:Zn,onCollide:ms},ThunderTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"ThunderTowerBase0",Shoot:"ThunderTowerBase0",NotBuilt:"TowerBase",Upgrade:"ThunderTowerUpgrade0"},effects:[],stats:{...gs,attackSpeed:750,projectileType:"Thunderbolt"},scale:.8,upgrades:Jn,onCollide:ms},PoisonTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"PoisonTowerBase0",Shoot:"PoisonTowerBase0",NotBuilt:"TowerBase",Upgrade:"PoisonTowerUpgrade0"},effects:[],stats:{...gs,projectileType:"Poisonball"},scale:.8,upgrades:Xn,onCollide:ms},IceTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"IceTowerBase0",Shoot:"IceTowerBase0",NotBuilt:"TowerBase",Upgrade:"IceTowerUpgrade0"},effects:[],stats:{...gs,attackSpeed:850,projectileType:"Icebolt"},scale:.8,upgrades:Kn,onCollide:ms}},Qo={Fireball:{type:"projectile",width:20,height:22,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"FireballFollow",FollowAngle:"FireballFollow",Explode:"FireballDie"},scale:2,stats:{health:1,speed:.5,damage:11},onCollide:us},Icebolt:{type:"projectile",width:10,height:27,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"IceboltFollow",FollowAngle:"IceboltFollow",Explode:"IceboltDie"},scale:2,stats:{health:1,speed:.3,damage:11},onCollide:us},Poisonball:{type:"projectile",width:17,height:16,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"PoisonballFollow",FollowAngle:"PoisonballFollow",Explode:"PoisonballDie"},scale:2,stats:{health:1,speed:.4,damage:11},onCollide:us},Thunderbolt:{type:"projectile",width:17,height:31,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"ThunderboltFollow",FollowAngle:"ThunderboltFollow",Explode:"ThunderboltDie"},scale:2,stats:{health:1,speed:.4,damage:11},onCollide:us},Loot:{type:"loot",vfx:[],width:14,height:19,initialState:"FollowTarget",stateToAnimation:{FollowTarget:"Loot"},scale:1,stats:{health:1,damage:0,speed:.5},onCollide:Vn},ClickExplode:{type:"projectile",vfx:[],width:30,height:30,initialState:"Explode",stateToAnimation:{Explode:"Click"},scale:1,stats:{health:1,damage:10,speed:.5}}},ii={...Yo,...vi,...Qo},vo=Object.keys(Yo).length+Object.keys(vi).length+Object.keys(Qo).length,po=Object.keys(ii).length;if(vo!==po)throw new Error(`Entities defined and exported do not match. Check for duplicated Entity names : Total count: ${vo} / Exported count ${po}`);const el=s=>{if(!ii[s])throw new Error(`Entity config not found for: ${s}`);return ii[s]};var ut;class K{constructor(e){d(this,ut,v());this.stateMachine=e}get stateMachine(){return r(a(this,ut))}set stateMachine(e){m(a(this,ut),y(e))}update(e,t){}get name(){return this.constructor.name}get entity(){return this.stateMachine.owner}}ut=new WeakMap;let tl=class extends K{constructor(e){super(e),e.owner.stopInteractions(),this.entity.removeCollider()}update(){if(this.entity.animation.isComplete){const{entityManager:e,stageManager:t}=M.get(["entityManager","stageManager"]);e.destroy(this.entity.id),t.spawnLoot(this.entity)}}};class sl extends K{constructor(){super(...arguments);R(this,"lastAngle",0)}update(t){this.follow(t)}follow(t){const{throne:i}=this.stateMachine.context;if(!i.width||i.position.x===0&&i.position.y===0)return;const o=i.position;this.entity.rotation=Oo(this.entity.position,o);const l=ui(this.entity.rotation).multiply(this.entity.stats.speed*t);this.entity.position=this.entity.position.add(l)}}const il=Object.freeze(Object.defineProperty({__proto__:null,Die:tl,FollowThrone:sl},Symbol.toStringTag,{value:"Module"}));class ol extends K{constructor(){super(...arguments);R(this,"isSetup",!1)}update(t,i){this.isSetup||($.isMobile?this.entity.position.y+=30:this.entity.position.y+=35,this.isSetup=!0)}}const Wo=s=>s===1?"1":s===2?"2":"0",rl=(s,e)=>`${s.name}Upgrade${Wo(e)}`,fo=(s,e)=>`${s.name}Base${Wo(e)}`;class al extends K{constructor(e){super(e),this.entity.upgradeLevel+=1;const t=this.entity.upgrades[this.entity.upgradeLevel];t(this.entity),this.entity.animation.onFrameChange=i=>{},j.play("towerUpgrade")}update(e){this.entity.animation.isComplete&&(this.entity.stateToAnimation={...this.entity.stateToAnimation,Guard:fo(this.entity,this.entity.upgradeLevel),Shoot:fo(this.entity,this.entity.upgradeLevel),Upgrade:rl(this.entity,this.entity.upgradeLevel+1)},this.entity.state.setState("Guard"),this.entity.animation.onFrameChange=()=>{})}}class nl extends K{constructor(e){super(e);const t=M.get("gameLoop"),i=this.entity.stats.attackSpeed;this.cdId=t.setCD(i,!0)}update(){const{entityManager:e,gameLoop:t}=M.get(["entityManager","gameLoop"]),i=e.findNearestEntity(this.entity,e.enemies);t.isCDReady(this.cdId)&&i&&this.stateMachine.setState("Shoot",{spawner:this.entity,target:i})}}class ll extends K{update(){this.shoot(),this.entity.addVFX("TowerShoot"),this.entity.state.setState("Guard")}shoot(){const e=M.get("stageManager"),{spawner:t}=this.stateMachine.context,i=t.stats.projectileType,o=this.entity.stats.projectileNumber,n=t.position.add(new X(t.width/2,0)),l=M.get("entityManager");l.findNearestEntities(t,l.enemies,o).forEach(g=>{e.spawnEntity(i,n,{spawner:t,target:g})}),j.play("towerShoot")}}const cl=Object.freeze(Object.defineProperty({__proto__:null,Guard:nl,NotBuilt:ol,Shoot:ll,Upgrade:al},Symbol.toStringTag,{value:"Module"}));class dl extends K{update(e){this.follow(e)}follow(e){const{angle:t}=this.stateMachine.context,o=ui(t).multiply(this.entity.stats.speed*e);this.entity.position=this.entity.position.add(o),this.entity.rotation=t*180/Math.PI+90}}class hl extends K{constructor(){super(...arguments);R(this,"lastAngle",0);R(this,"rotationOffset",90)}update(t){const{target:i}=this.stateMachine.context;i!=null&&i.isInteractable?this.followTarget(t,i):this.stateMachine.setState("FollowAngle",{angle:this.lastAngle})}getTopMiddlePoint(t){return mi(t.position,t.width,t.height).topMiddle}followTarget(t,i){const o=this.entity.boundingBox.center;this.getTopMiddlePoint(i),this.lastAngle=Oo(o,i.boundingBox.center),this.entity.rotation=this.lastAngle*180/Math.PI+this.rotationOffset;const l=ui(this.lastAngle).multiply(this.entity.stats.speed*t);this.entity.position=this.entity.position.add(l)}}class ul extends K{constructor(e){super(e),this.entity.removeCollider(),this.entity.width=30,this.entity.height=30,this.entity.animation.onFrameChange=t=>{this.entity.scale+=.5},e.owner.stopInteractions()}update(){(!this.entity.animation||this.entity.animation&&this.entity.animation.isComplete)&&(M.get("entityManager").destroy(this.entity.id),this.entity.animation.onFrameChange=()=>{})}}const ml=Object.freeze(Object.defineProperty({__proto__:null,Explode:ul,FollowAngle:dl,FollowTarget:hl},Symbol.toStringTag,{value:"Module"}));class gl extends K{update(){}}class vl extends K{constructor(e){super(e),M.get("stageManager").gameOver("lose")}}const pl=Object.freeze(Object.defineProperty({__proto__:null,Die:vl,Idle:gl},Symbol.toStringTag,{value:"Module"})),wo=(s,e,t,i={})=>{let o={};e==="enemy"?o=il:e==="tower"?o=cl:["projectile","loot"].includes(e)?o=ml:e==="throne"&&(o=pl);const n=o[t];if(!n)throw new Error(`Invalid entity type: ${e} with name ${t}`);return new n(s,i)};var mt,gt;class fl{constructor({owner:e,initialState:t,onEnter:i,context:o={}}){d(this,mt,v());d(this,gt,v());this.owner=e,this.onEnter=i,this.context=o,this.onEnter(t),this.currentState=wo(this,e.type,t,o)}get currentState(){return r(a(this,mt))}set currentState(e){m(a(this,mt),y(e))}get context(){return r(a(this,gt))}set context(e){m(a(this,gt),y(e))}update(e,t){this.currentState.update(e,this.owner,t)}setState(e,t={}){e!==this.currentState.name&&(this.onEnter(e),this.context={...this.context,...t},this.currentState=wo(this,this.owner.type,e,t))}}mt=new WeakMap,gt=new WeakMap;var vt,pt,ft,wt,yt,Ct,bt,Tt,_t,xt,Ft,Bt,At,Et,St,kt,Mt,Pt,Dt,Us;const Ns=class Ns{constructor(e,t,{offsetPosition:i,staticSlot:o,width:n,height:l,scale:c,rotation:g,type:_,states:h,initialState:p,onCollide:w,stats:u,upgradeLevel:b,upgrades:f,vfx:E,effects:T,stateToAnimation:x},P){R(this,"id");d(this,vt,v(0));d(this,pt,v(0));d(this,ft,v(""));d(this,wt,v(""));d(this,yt,v(0));d(this,Ct,v(0));d(this,bt,v([]));d(this,Tt,v([]));d(this,_t,v());d(this,xt,v());d(this,Ft,v());d(this,Bt,v(y({})));d(this,At,v(0));d(this,Et,v(1));d(this,St,v(1));d(this,kt,v(!0));d(this,Mt,v(y({})));d(this,Pt,v(-1));d(this,Dt,v([]));d(this,Us,B(()=>this.upgrades.length&&this.upgradeLevel<this.upgrades.length));R(this,"setPosition",e=>{this.position=e});this.id=Ns.lastId++,this.name=e,this.type=_,this.width=n,this.height=l,this.scale=c||1,this.rotation=g||0,this.position=t,this.offsetPosition=i||null,this.staticSlot=o||null,this.stats={...u},this.upgradeLevel=b||-1,this.upgrades=f||[],this.vfx=E||[],this.effects=T||[],this.stateToAnimation=x||{},this.onCollide=S=>w(this,S);const D=S=>{this.stateToAnimation[S]&&this.setAnimation(S)};this.state=new fl({owner:this,states:h,initialState:p,onEnter:D,context:P})}get x(){return r(a(this,vt))}set x(e){m(a(this,vt),y(e))}get y(){return r(a(this,pt))}set y(e){m(a(this,pt),y(e))}get name(){return r(a(this,ft))}set name(e){m(a(this,ft),y(e))}get type(){return r(a(this,wt))}set type(e){m(a(this,wt),y(e))}get width(){return r(a(this,yt))}set width(e){m(a(this,yt),y(e))}get height(){return r(a(this,Ct))}set height(e){m(a(this,Ct),y(e))}get effects(){return r(a(this,bt))}set effects(e){m(a(this,bt),e)}get vfx(){return r(a(this,Tt))}set vfx(e){m(a(this,Tt),e)}get animation(){return r(a(this,_t))}set animation(e){m(a(this,_t),e)}get position(){return r(a(this,xt))}set position(e){m(a(this,xt),y(e))}get state(){return r(a(this,Ft))}set state(e){m(a(this,Ft),y(e))}get stats(){return r(a(this,Bt))}set stats(e){m(a(this,Bt),y(e))}get rotation(){return r(a(this,At))}set rotation(e){m(a(this,At),y(e))}get scale(){return r(a(this,Et))}set scale(e){m(a(this,Et),y(e))}get opacity(){return r(a(this,St))}set opacity(e){m(a(this,St),y(e))}get isInteractable(){return r(a(this,kt))}set isInteractable(e){m(a(this,kt),y(e))}get stateToAnimation(){return r(a(this,Mt))}set stateToAnimation(e){m(a(this,Mt),y(e))}get upgradeLevel(){return r(a(this,Pt))}set upgradeLevel(e){m(a(this,Pt),y(e))}get upgrades(){return r(a(this,Dt))}set upgrades(e){m(a(this,Dt),e)}get isUpgradable(){return r(a(this,Us))}get boundingBox(){const e=this.position.x,t=this.position.y,i=this.position.x+this.width,o=this.position.y+this.height;return{x1:e,y1:t,x2:i,y2:o,center:new X(e+this.width/2,t+this.height/2),topMiddle:new X(e+this.width/2,o)}}update(e){this.isDestroyed||(this.state.update(e),this.effects.forEach(t=>{t(this)}),this.animation&&this.animation.update(e))}setAnimation(e){const t=this.stateToAnimation[e],i=De(t);this.animation=new zo({...i,name:t})}addEffect(e){this.effects.includes(e)||(this.effects=[...this.effects,e])}removeEffect(e){this.effects=this.effects.filter(t=>t!==e)}cleanEffects(){this.effects=[]}addVFX(e){this.vfx.includes(e)||(this.vfx=[...this.vfx,e])}removeVFX(e){this.vfx=this.vfx.filter(t=>t!==e)}cleanVFX(){this.vfx=[]}takeDamage(e){this.stats.health-=e,this.stats.health<=0&&this.state.setState("Die")}stopInteractions(){this.isInteractable=!1}removeCollider(){this.onCollide=()=>{}}};vt=new WeakMap,pt=new WeakMap,ft=new WeakMap,wt=new WeakMap,yt=new WeakMap,Ct=new WeakMap,bt=new WeakMap,Tt=new WeakMap,_t=new WeakMap,xt=new WeakMap,Ft=new WeakMap,Bt=new WeakMap,At=new WeakMap,Et=new WeakMap,St=new WeakMap,kt=new WeakMap,Mt=new WeakMap,Pt=new WeakMap,Dt=new WeakMap,Us=new WeakMap,R(Ns,"lastId",0);let oi=Ns;const wl=(s,e,t={})=>{const{context:i={},...o}=el(s),{initialState:n,...l}=t;return n&&(o.initialState=n),new oi(s,e.clone(),o,{...i,...l})},yl=B(()=>({top:[{x:$.width*.1,y:20},{x:$.width*.3,y:20},{x:$.width*.5,y:20},{x:$.width*.7,y:20},{x:$.width*.9,y:20}],bottom:[{x:$.width*.1,y:$.height-20},{x:$.width*.3,y:$.height-20},{x:$.width*.5,y:$.height-20},{x:$.width*.7,y:$.height-20},{x:$.width*.9,y:$.height-20}],left:[{x:20,y:$.height*.1},{x:20,y:$.height*.3},{x:20,y:$.height*.5},{x:20,y:$.height*.7},{x:20,y:$.height*.9}],right:[{x:$.width-20,y:$.height*.1},{x:$.width-20,y:$.height*.3},{x:$.width-20,y:$.height*.5},{x:$.width-20,y:$.height*.7},{x:$.width-20,y:$.height*.9}]})),Cl=()=>{const s=$.isMobile?["top","bottom"]:["top","bottom","left","right"],e=s[Math.floor(Math.random()*s.length)],t=r(yl)[e];return t[Math.floor(Math.random()*t.length)]},bl=s=>s[Math.floor(Math.random()*s.length)];var It,zs,$t,jt;class Tl{constructor(){d(this,It,v(0));d(this,zs,B(()=>go[this.stageNumber]));d(this,$t,v(0));R(this,"commonSpawnCd");R(this,"eliteSpawnCd");d(this,jt,v(""));R(this,"init",()=>{const e=M.get("gameLoop");this.commonSpawnCd=e.setCD(this.stageConfig.spawnDelays.common,!0),this.eliteSpawnCd=e.setCD(this.stageConfig.spawnDelays.elite,!0),this.spawnTowers(),this.spawnEntity("Throne",new X(0,0))});R(this,"update",e=>{const t=M.get("gameLoop");t.isCDReady(this.commonSpawnCd)&&this.spawnEnemy("common"),t.isCDReady(this.eliteSpawnCd)&&this.spawnEnemy("elite"),this.checkStageTime()});R(this,"spawnEntity",(e,t,i={})=>{const o=M.get("entityManager"),n=wl(e,t,i);return o.add(n),n})}get stageNumber(){return r(a(this,It))}set stageNumber(e){m(a(this,It),y(e))}get stageConfig(){return r(a(this,zs))}get stageStartTime(){return r(a(this,$t))}set stageStartTime(e){m(a(this,$t),y(e))}get stageResult(){return r(a(this,jt))}set stageResult(e){m(a(this,jt),y(e))}reset(){this.commonSpawnCd=null,this.eliteSpawnCd=null,this.stageNumber=0,this.stageResult="",this.init()}spawnTowers(){["IceTower","FireTower","PoisonTower","ThunderTower"].forEach((e,t)=>{this.spawnEntity(e,new X(0,0))})}apllyAmlify(e){const{statsAmplify:t}=this.stageConfig;e.stats.health*=t.health,e.stats.damage*=t.damage,e.stats.speed*=t.speed}spawnEnemy(e){const t=M.get("entityManager"),i=e==="common"?this.stageConfig.commonEnemies:this.stageConfig.eliteEnemies,o=bl(i),n=Cl(),l=new X(n.x,n.y),c=this.spawnEntity(o,l,{throne:t.throne});return this.apllyAmlify(c),c}spawnLoot(e){const i=M.get("entityManager").throne;this.spawnEntity("Loot",e.boundingBox.center,{target:i})}gameOver(e){this.stageResult=e,M.get("gameLoop").pause()}checkStageTime(){const e=M.get("gameLoop");this.stageStartTime+this.stageConfig.time<e.elapsedTime&&this.nextStage()}nextStage(){if(this.stageNumber<go.length-1){const e=M.get("gameLoop");this.stageNumber++,this.stageStartTime=e.elapsedTime,this.commonSpawnCd=e.setCD(this.stageConfig.spawnDelays.common,!0),this.eliteSpawnCd=e.setCD(this.stageConfig.spawnDelays.elite,!0)}else this.gameOver("win")}}It=new WeakMap,zs=new WeakMap,$t=new WeakMap,jt=new WeakMap;const Ks=16.666;var Lt,Rt,qt,Ut,Nt,zt;const Os=class Os{constructor(){d(this,Lt,v(y(performance.now())));d(this,Rt,v(0));d(this,qt,v(0));d(this,Ut,v(1));d(this,Nt,v(null));d(this,zt,v(y({})));this.loop=this.loop.bind(this),this.previousTime=0,this.elapsedTime=0,this.accumulator=0}get previousTime(){return r(a(this,Lt))}set previousTime(e){m(a(this,Lt),y(e))}get accumulator(){return r(a(this,Rt))}set accumulator(e){m(a(this,Rt),y(e))}get elapsedTime(){return r(a(this,qt))}set elapsedTime(e){m(a(this,qt),y(e))}get timeScale(){return r(a(this,Ut))}set timeScale(e){m(a(this,Ut),y(e))}get pauseState(){return r(a(this,Nt))}set pauseState(e){m(a(this,Nt),y(e))}get cooldowns(){return r(a(this,zt))}set cooldowns(e){m(a(this,zt),y(e))}get elapsedInSeconds(){return this.elapsedTime/1e3}start(e){this.update=e,requestAnimationFrame(this.loop)}reset(){this.previousTime=0,this.elapsedTime=0,this.accumulator=0}loop(e){if(this.pauseState){this.previousTime=e,requestAnimationFrame(this.loop);return}let t=e-this.previousTime;for(t>250&&(t=250),this.previousTime=e,this.accumulator+=t*this.timeScale,this.elapsedTime+=t*this.timeScale;this.accumulator>=Ks;)this.update(Ks),this.accumulator-=Ks;requestAnimationFrame(this.loop)}setCD(e,t=!1){const i=Os.lastCDId++;return this.cooldowns[i]={waitTime:e,isInfinite:t,startTime:this.elapsedTime},i}isCDReady(e){const t=this.cooldowns[e];return!t||this.pauseState||this.elapsedTime-t.startTime<=t.waitTime?!1:t.isInfinite?(this.cooldowns[e]={...t,startTime:this.elapsedTime},!0):(delete this.cooldowns[e],!0)}pause(){this.pauseState?this.resume():this.pauseState={pausedTime:this.elapsedTime}}resume(){if(!this.pauseState)return;const e=performance.now();this.previousTime=e,this.pauseState=null}};Lt=new WeakMap,Rt=new WeakMap,qt=new WeakMap,Ut=new WeakMap,Nt=new WeakMap,zt=new WeakMap,R(Os,"lastCDId",0);let ri=Os;const _l=[{id:"q1",question:"What is the capital of France?",options:["London","Berlin","Paris","Madrid"],correctIndex:2,meta:{subject:"Geography",level:"Easy"}},{id:"q2",question:"What is 12 * 12?",options:["122","144","124","148"],correctIndex:1,meta:{subject:"Math",level:"Medium"}},{id:"q3",question:"Which planet is known as the Red Planet?",options:["Earth","Mars","Jupiter","Venus"],correctIndex:1,meta:{subject:"Astronomy",level:"Easy"}},{id:"q4",question:"What is the chemical symbol for Gold?",options:["Au","Ag","Fe","Cu"],correctIndex:0,meta:{subject:"Chemistry",level:"Medium"}},{id:"q5",question:"Who wrote 'Romeo and Juliet'?",options:["Charles Dickens","William Shakespeare","Mark Twain","Jane Austen"],correctIndex:1,meta:{subject:"Literature",level:"Easy"}},{id:"q6",question:"What is the square root of 64?",options:["6","7","8","9"],correctIndex:2,meta:{subject:"Math",level:"Easy"}},{id:"q7",question:"Physics: What is the unit of force?",options:["Joule","Watt","Newton","Pascal"],correctIndex:2,meta:{subject:"Physics",level:"Medium"}},{id:"q8",question:"Which element has the atomic number 1?",options:["Helium","Hydrogen","Lithium","Carbon"],correctIndex:1,meta:{subject:"Chemistry",level:"Easy"}},{id:"q9",question:"What year did World War II end?",options:["1942","1945","1948","1950"],correctIndex:1,meta:{subject:"History",level:"Hard"}},{id:"q10",question:"What is the largest ocean on Earth?",options:["Atlantic","Indian","Arctic","Pacific"],correctIndex:3,meta:{subject:"Geography",level:"Medium"}}];var Ot,Gt,Ht,Yt,Qt,Wt,Vt,Zt,Xt,Jt;class Vo{constructor(){d(this,Ot,v(y(_l)));d(this,Gt,v(null));d(this,Ht,v(!1));d(this,Yt,v(1));d(this,Qt,v(0));d(this,Wt,v(0));d(this,Vt,v(0));d(this,Zt,v(0));d(this,Xt,v(0));d(this,Jt,v(!1));this.reset()}get questions(){return r(a(this,Ot))}set questions(e){m(a(this,Ot),y(e))}get currentQuestion(){return r(a(this,Gt))}set currentQuestion(e){m(a(this,Gt),y(e))}get isActive(){return r(a(this,Ht))}set isActive(e){m(a(this,Ht),y(e))}get timeScale(){return r(a(this,Yt))}set timeScale(e){m(a(this,Yt),y(e))}get timer(){return r(a(this,Qt))}set timer(e){m(a(this,Qt),y(e))}get strikes(){return r(a(this,Wt))}set strikes(e){m(a(this,Wt),y(e))}get gameTimeSinceLastQuestion(){return r(a(this,Vt))}set gameTimeSinceLastQuestion(e){m(a(this,Vt),y(e))}get buildPoints(){return r(a(this,Zt))}set buildPoints(e){m(a(this,Zt),y(e))}get wrongAnswerTrigger(){return r(a(this,Xt))}set wrongAnswerTrigger(e){m(a(this,Xt),y(e))}get distortedAudio(){return r(a(this,Jt))}set distortedAudio(e){m(a(this,Jt),y(e))}reset(){this.isActive=!1,this.timeScale=1,this.strikes=0,this.buildPoints=0,this.gameTimeSinceLastQuestion=J.questionInterval-J.initialQuestionDelay,this.currentQuestion=null}update(e){if(!this.isActive)this.gameTimeSinceLastQuestion+=e,this.gameTimeSinceLastQuestion>=J.questionInterval&&this.triggerQuestion();else{const t=e/this.timeScale;this.timer-=t,this.timer<=0&&this.handleTimeout()}}triggerQuestion(){const e=Math.floor(Math.random()*this.questions.length);this.currentQuestion=this.questions[e],this.isActive=!0,this.timeScale=J.bulletTimeFactor,M.get("gameLoop").timeScale=this.timeScale,this.timer=J.questionDuration,this.gameTimeSinceLastQuestion=0,this.distortedAudio=!0,j.setDistortion(!0)}answer(e){if(!this.currentQuestion)return;e===this.currentQuestion.correctIndex?this.handleCorrect():this.handleIncorrect(),this.closeQuestion()}handleCorrect(){if(this.buildPoints>=8){console.log("Correct! Max Points Reached -> +10 Gold");const e=M.get("lootTracker");e&&e.receiveLoot(10),j.play("towerUpgrade")}else console.log("Correct! +1 Build Point"),this.buildPoints++,j.play("towerUpgrade")}handleIncorrect(){console.log("Wrong!"),this.wrongAnswerTrigger++,j.play("lowResourse"),this.strikes++,this.strikes>=J.maxStrikes&&(this.punishPlayer(),this.strikes=0)}handleTimeout(){this.handleIncorrect(),this.closeQuestion()}punishPlayer(){var o,n;console.log("PUNISHMENT: Destroying Tower");const{entityManager:e}=M.get(["entityManager"]),i=e.towers.filter(l=>l.state.currentState!=="NotBuilt"&&l.type!=="throne");if(i.length>0){const l=i[0];console.log(`Destroying tower: ${l.name}`);const c=vi[l.name];c&&(l.stats={...c.stats},l.stateToAnimation={...c.stateToAnimation}),l.upgradeLevel=-1,l.state.setState("NotBuilt");const g=M.get("particleManager"),_=((o=l.position)==null?void 0:o.x)??l.x,h=((n=l.position)==null?void 0:n.y)??l.y;g&&g.spawnExplosion(_+l.width/2,h+l.height/2,"#ff0000",30)}}closeQuestion(){this.isActive=!1,this.timeScale=1,M.get("gameLoop").timeScale=1,this.currentQuestion=null,this.distortedAudio=!1,j.setDistortion(!1)}}Ot=new WeakMap,Gt=new WeakMap,Ht=new WeakMap,Yt=new WeakMap,Qt=new WeakMap,Wt=new WeakMap,Vt=new WeakMap,Zt=new WeakMap,Xt=new WeakMap,Jt=new WeakMap;new Vo;var Kt,es,ts,ss,is,os,rs;class xl{constructor(e,t,i){d(this,Kt,v(0));d(this,es,v(0));d(this,ts,v(0));d(this,ss,v(0));d(this,is,v(1));d(this,os,v("#ff0000"));d(this,rs,v(5));R(this,"decay",.05);this.x=e,this.y=t,this.color=i;const o=Math.random()*Math.PI*2,n=Math.random()*5+2;this.vx=Math.cos(o)*n,this.vy=Math.sin(o)*n,this.size=Math.random()*6+4,this.decay=Math.random()*.03+.02}get x(){return r(a(this,Kt))}set x(e){m(a(this,Kt),y(e))}get y(){return r(a(this,es))}set y(e){m(a(this,es),y(e))}get vx(){return r(a(this,ts))}set vx(e){m(a(this,ts),y(e))}get vy(){return r(a(this,ss))}set vy(e){m(a(this,ss),y(e))}get life(){return r(a(this,is))}set life(e){m(a(this,is),y(e))}get color(){return r(a(this,os))}set color(e){m(a(this,os),y(e))}get size(){return r(a(this,rs))}set size(e){m(a(this,rs),y(e))}update(e){this.x+=this.vx,this.y+=this.vy,this.life-=this.decay,this.size*=.95}}Kt=new WeakMap,es=new WeakMap,ts=new WeakMap,ss=new WeakMap,is=new WeakMap,os=new WeakMap,rs=new WeakMap;var as;class Fl{constructor(){d(this,as,v(y([])))}get particles(){return r(a(this,as))}set particles(e){m(a(this,as),y(e))}update(e){this.particles=this.particles.filter(t=>t.life>0);for(const t of this.particles)t.update(e)}spawnExplosion(e,t,i="#ff4400",o=10){for(let n=0;n<o;n++)this.particles.push(new xl(e,t,i))}}as=new WeakMap;var ns;class Bl{constructor(){d(this,ns,v(!1));R(this,"update",async e=>{M.update(e),G.update(e)});R(this,"start",async()=>{M.setup(Al());const{gameLoop:e,stageManager:t,questionManager:i}=M.get(["gameLoop","stageManager","questionManager"]);t.init(),i.reset(),e.start(this.update),j.play("bgSound"),this.isStarted=!0});R(this,"restart",()=>{const{entityManager:e,gameLoop:t,stageManager:i,questionManager:o}=M.get(["entityManager","gameLoop","stageManager","questionManager"]);t.reset(),e.reset(),i.reset(),j.reset(),ne.reset(),o.reset(),t.resume()})}get isStarted(){return r(a(this,ns))}set isStarted(e){m(a(this,ns),y(e))}}ns=new WeakMap;const Al=()=>(M.collisionManager=new Yn,M.entityManager=new Qn,M.gameLoop=new ri,M.stageManager=new Tl,M.questionManager=new Vo,M.particleManager=new Fl,M),Pe=new Bl;var El=L('<div class="content svelte-tmojwr"><div class="title svelte-tmojwr"><h1>Paused</h1></div> <div class="buttons-container svelte-tmojwr"><!> <!> <!></div></div>'),Sl=L('<div class="pause-overlay svelte-tmojwr"><!></div>');function kl(s,e){H(e,!0);const t=()=>{j.toggleMute()};hi(()=>{j.reduceBgVolume()}),Io(()=>{j.restoreBgVolume()});var i=Sl(),o=F(i);gi(o,{children:(n,l)=>{var c=El(),g=A(F(c),2),_=F(g);fe(_,{text:"Resume Game",get onclick(){return e.onResume}});var h=A(_,2);fe(h,{text:"Restart Game",get onclick(){return e.onRestart}});var p=A(h,2),w=B(()=>j.isMuted?"Sound: OFF":"Sound: ON");fe(p,{get text(){return r(w)},onclick:t}),C(g),C(c),k(n,c)},$$slots:{default:!0}}),C(i),k(s,i),Y()}var Ml=L('<div class="bg-container svelte-11qp6pd"><div class="gradient-bg svelte-11qp6pd">‚Ä¶</div> <div class="stars svelte-11qp6pd"></div></div>');function yo(s){var e=Ml();k(s,e)}var Pl=L('<div class="bg-container svelte-1hdxkm"><div class="gradient-bg svelte-1hdxkm"></div> <div class="aurora svelte-1hdxkm"></div> <div class="stars svelte-1hdxkm"></div></div>');function Dl(s){var e=Pl();k(s,e)}var Il=L('<div class="bg-container svelte-7703io"><div class="gradient-bg svelte-7703io"></div> <div class="stars svelte-7703io"></div></div>');function $l(s){var e=Il();k(s,e)}var jl=L('<div class="bg-container svelte-10mh7j2"><div class="quantum-base svelte-10mh7j2"></div> <div class="energy-fields svelte-10mh7j2"></div> <div class="quantum-grid svelte-10mh7j2"></div> <div class="stars svelte-10mh7j2"></div></div>');function Ll(s){var e=jl();k(s,e)}var Rl=L('<div class="background-container svelte-5o0ex9"><!></div>');function ql(s,e){const t=[yo,Dl,$l,Ll];let i=B(()=>t[e.stageNumber]||yo);var o=ae(),n=Z(o);ei(n,()=>e.stageNumber,l=>{var c=Rl(),g=F(c);Pr(g,()=>r(i),(_,h)=>{h(_,{})}),C(c),V(1,c,()=>le,()=>({duration:400})),V(2,c,()=>le,()=>({duration:300})),k(l,c)}),k(s,o)}var Ul=L('<div class="loot svelte-bipu4"><!> <span class="svelte-bipu4"> </span></div>');function Nl(s,e){H(e,!0);let t=B(()=>ne.playLowLootAnimation);var i=Ul();const o=B(()=>G.get("arrow"));q(()=>U(i,"cursor",r(o)));var n=F(i);ye(n,{});var l=A(n,2);const c=B(()=>G.get("arrow"));q(()=>U(l,"cursor",r(c)));var g=F(l,!0);C(l),C(i),q(()=>{pe(i,"isAnimated",r(t)),oe(g,ne.collectedLoot)}),Hs("animationend",i,_=>{ne.unsetAnimation("LowLoot")}),k(s,i),Y()}var zl=bo('<svg width="54" height="54" viewBox="0 0 54 54" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="path-1-outside-1_0_1" maskUnits="userSpaceOnUse" x="0" y="0" width="54" height="54" fill="black"><rect fill="white" width="54" height="54"></rect><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z"></path></mask><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z" fill="#D685DA"></path><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z" stroke="white" stroke-width="2" mask="url(#path-1-outside-1_0_1)"></path><circle cx="27" cy="27" r="16.5" fill="#D685DA" stroke="white"></circle><circle cx="45" cy="44" r="4.5" fill="#D685DA" stroke="white"></circle><rect x="20.5" y="20.5" width="5" height="13" rx="2.5" fill="#FFDFFC" stroke="white"></rect><rect x="28.5" y="20.5" width="5" height="13" rx="2.5" fill="#FFDFFC" stroke="white"></rect></svg>');function Ol(s){var e=zl();k(s,e)}function Co(s){return Object.prototype.toString.call(s)==="[object Date]"}function ai(s,e){if(s===e||s!==s)return()=>s;const t=typeof s;if(t!==typeof e||Array.isArray(s)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(s)){const i=e.map((o,n)=>ai(s[n],o));return o=>i.map(n=>n(o))}if(t==="object"){if(!s||!e)throw new Error("Object cannot be null");if(Co(s)&&Co(e)){const n=s.getTime(),c=e.getTime()-n;return g=>new Date(n+g*c)}const i=Object.keys(e),o={};return i.forEach(n=>{o[n]=ai(s[n],e[n])}),n=>{const l={};return i.forEach(c=>{l[c]=o[c](n)}),l}}if(t==="number"){const i=e-s;return o=>s+o*i}throw new Error(`Cannot interpolate ${t} values`)}function Gl(s,e={}){const t=$r(s);let i,o=s;function n(l,c){if(o=l,s==null)return t.set(s=l),Promise.resolve();let g=i,_=!1,{delay:h=0,duration:p=400,easing:w=qn,interpolate:u=ai}={...e,...c};if(p===0)return g&&(g.abort(),g=null),t.set(s=o),Promise.resolve();const b=ie.now()+h;let f;return i=Uo(E=>{if(E<b)return!0;_||(f=u(s,l),typeof p=="function"&&(p=p(s,l)),_=!0),g&&(g.abort(),g=null);const T=E-b;return T>p?(t.set(s=l),!1):(t.set(s=f(w(T/p))),!0)}),i.promise}return{set:n,update:(l,c)=>n(l(o,s),c),subscribe:t.subscribe}}var Hl=L('<div class="star-wrapper svelte-p9wbfv"><div class="shooting-star svelte-p9wbfv"><div class="trail-lavender svelte-p9wbfv"></div> <div class="trail-cyan svelte-p9wbfv"></div> <div class="star-head svelte-p9wbfv"></div> <div class="sparkles svelte-p9wbfv"></div></div></div>'),Yl=L('<div class="meta-tag svelte-p9wbfv"><span class="meta-label svelte-p9wbfv">Subject:</span> <span class="meta-separator svelte-p9wbfv">|</span> <span class="meta-label svelte-p9wbfv">Level:</span> </div>'),Ql=L('<button class="sci-fi-btn svelte-p9wbfv"><span class="btn-text svelte-p9wbfv"> </span></button>'),Wl=L("<div></div>"),Vl=L('<div class="hud-container svelte-p9wbfv"><div class="content svelte-p9wbfv"><div class="header-section svelte-p9wbfv"><h2 class="question-header svelte-p9wbfv">Incoming Transmission</h2> <div class="timer-container svelte-p9wbfv"><div class="timer-bar svelte-p9wbfv"></div></div></div> <div class="question-box svelte-p9wbfv"><p class="question-text svelte-p9wbfv"> </p> <!></div> <div class="options-grid svelte-p9wbfv"></div> <div class="footer-section svelte-p9wbfv"><div class="status-indicator svelte-p9wbfv"><span class="status-label svelte-p9wbfv">Strikes</span> <div class="strikes-container svelte-p9wbfv"></div></div></div></div></div>'),Zl=L('<div class="overlay svelte-p9wbfv"><div class="backdrop svelte-p9wbfv"></div> <!> <!></div>');function Xl(s,e){H(e,!0);const t=Dr(),i=()=>Ir(l,"$progress",t),o=B(()=>M.get("questionManager")),n=B(()=>{var u;return(u=r(o))==null?void 0:u.currentQuestion}),l=Gl(100,{duration:400,easing:Un});let c=v("idle");ls(()=>{r(o)&&r(o).isActive?(l.set(r(o).timer/1e4*100),r(c)==="idle"&&(m(c,"incoming"),j!=null&&j.preloaded&&j.play("shine"),setTimeout(()=>{m(c,"impact"),j!=null&&j.preloaded&&j.play("magicBurst")},800),setTimeout(()=>{m(c,"active")},1100))):(l.set(100,{duration:0}),m(c,"idle"))});const g=B(()=>i()<30?"#ff3333":"#d685da");function _(u){j!=null&&j.preloaded&&j.play("clickMenu",!0),r(o).answer(u)}var h=ae(),p=Z(h);{var w=u=>{var b=Zl(),f=F(b),E=A(f,2);{var T=D=>{var S=Hl();q(()=>pe(S,"impacting",r(c)==="impact")),k(D,S)};W(E,D=>{(r(c)==="incoming"||r(c)==="impact")&&D(T)})}var x=A(E,2);{var P=D=>{var S=Vl(),I=F(S),O=F(I),z=A(F(O),2),N=F(z);C(z),C(O);var he=A(O,2),ue=F(he),me=F(ue,!0);C(ue);var Ee=A(ue,2);{var Ys=ee=>{var be=Yl(),Te=A(F(be)),te=A(Te,4);C(be),q(()=>{oe(Te,` ${r(n).meta.subject??""} `),oe(te,` ${r(n).meta.level??""}`)}),k(ee,be)};W(Ee,ee=>{r(n).meta&&ee(Ys)})}C(he);var Ce=A(he,2);se(Ce,21,()=>r(n).options,ws,(ee,be,Te)=>{var te=Ql();te.__click=()=>_(Te);const Zo=B(()=>G.get("arrow"));q(()=>U(te,"cursor",r(Zo)));var pi=F(te),Xo=F(pi,!0);C(pi),C(te),q(()=>oe(Xo,r(be))),k(ee,te)}),C(Ce);var Se=A(Ce,2),ke=F(Se),Me=A(F(ke),2);se(Me,20,()=>Array(3),ws,(ee,be,Te)=>{var te=Wl();q(()=>Ro(te,`strike-dot ${(Te<r(o).strikes?"active":"")??""} svelte-p9wbfv`)),k(ee,te)}),C(Me),C(ke),C(Se),C(I),C(S),q(()=>{we(N,"style",`width: ${i()??""}%; background: ${r(g)??""}; box-shadow: 0 0 10px ${r(g)??""}`),oe(me,r(n).question)}),V(1,S,()=>ys,()=>({duration:600,start:0,easing:Ho})),k(D,S)};W(x,D=>{r(c)==="active"&&D(P)})}C(b),V(3,f,()=>le,()=>({duration:500})),k(u,b)};W(p,u=>{r(o)&&r(o).isActive&&r(n)&&u(w)})}k(s,h),Y()}cs(["click"]);var Jl=L('<div class="floating-text svelte-10t94eg">+1 BP</div>'),Kl=L('<div class="points-badge svelte-10t94eg"><div class="badge-content svelte-10t94eg"><span class="icon svelte-10t94eg">üèóÔ∏è</span> <span class="count svelte-10t94eg"> </span> <span class="text svelte-10t94eg">Builds Available</span></div> <!></div>'),ec=L('<div class="indicator-container svelte-10t94eg"><div class="timer-section svelte-10t94eg"><div class="label svelte-10t94eg">Next Chance:</div> <div class="progress-bar-bg svelte-10t94eg"><div class="progress-bar-fill svelte-10t94eg"></div></div></div> <!></div>');function tc(s,e){H(e,!0);const t=B(()=>M.get("questionManager")),i=B(()=>r(t)?Math.min(100,r(t).gameTimeSinceLastQuestion/J.questionInterval*100):0),o=B(()=>{var h;return((h=r(t))==null?void 0:h.buildPoints)||0});let n=0,l=v(!1);ls(()=>{r(t)&&(r(t).buildPoints>n&&(m(l,!0),setTimeout(()=>m(l,!1),1500)),n=r(t).buildPoints)});var c=ae(),g=Z(c);{var _=h=>{var p=ec(),w=F(p),u=A(F(w),2),b=F(u);C(u),C(w);var f=A(w,2);{var E=T=>{var x=Kl(),P=F(x),D=A(F(P),2),S=F(D,!0);C(D),di(2),C(P);var I=A(P,2);{var O=z=>{var N=Jl();k(z,N)};W(I,z=>{r(l)&&z(O)})}C(x),q(()=>{pe(x,"has-points",r(o)>0),oe(S,r(o))}),V(1,x,()=>ys,()=>({duration:300,start:.5,opacity:0})),V(2,x,()=>ys,()=>({duration:200,start:.8,opacity:0})),k(T,x)};W(f,T=>{r(o)>0&&T(E)})}C(p),q(()=>we(b,"style",`width: ${r(i)??""}%`)),k(h,p)};W(g,h=>{r(t)&&!r(t).isActive&&h(_)})}k(s,c),Y()}var sc=L("<div><!> <!></div>");function ic(s,e){H(e,!0);let t=v(0),i=0,o=-1;ls(()=>{const c=M.get("questionManager");c&&c.wrongAnswerTrigger!==o&&(o!==-1&&Br(t),o=c.wrongAnswerTrigger);const g=M.get("entityManager");g&&g.throne});var n=ae(),l=Z(n);ei(l,()=>r(t),c=>{var g=sc(),_=F(g);jr(_,e,"default",{});var h=A(_,2);ei(h,()=>i,p=>{var w=ae(),u=Z(w);W(u,b=>{}),k(p,w)}),C(g),q(()=>Ro(g,`feedback-layer ${(r(t)>0?"shake-effect":"")??""} svelte-10dqr7b`)),k(c,g)}),k(s,n),Y()}const oc=["/projectiles/Click/0.svg","/projectiles/Click/1.svg","/projectiles/Click/2.svg","/projectiles/Click/3.svg","/projectiles/Fireball/Die/0.svg","/projectiles/Fireball/Die/1.svg","/projectiles/Fireball/Die/2.svg","/projectiles/Fireball/Follow/0.svg","/projectiles/Fireball/Follow/1.svg","/projectiles/Fireball/Follow/2.svg","/projectiles/Fireball/Follow/3.svg","/projectiles/Icebolt/Die/0.svg","/projectiles/Icebolt/Die/1.svg","/projectiles/Icebolt/Die/2.svg","/projectiles/Icebolt/Follow/0.svg","/projectiles/Icebolt/Follow/1.svg","/projectiles/Poisonball/Die/0.svg","/projectiles/Poisonball/Die/1.svg","/projectiles/Poisonball/Die/2.svg","/projectiles/Poisonball/Follow/0.svg","/projectiles/Poisonball/Follow/1.svg","/projectiles/Poisonball/Follow/2.svg","/projectiles/Poisonball/Follow/3.svg","/projectiles/Thunderbolt/Die/0.svg","/projectiles/Thunderbolt/Die/1.svg","/projectiles/Thunderbolt/Die/2.svg","/projectiles/Thunderbolt/Follow/0.svg","/projectiles/Thunderbolt/Follow/1.svg","/projectiles/Thunderbolt/Follow/2.svg","/projectiles/Thunderbolt/Follow/3.svg","/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg","/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg","/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg","/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg","/towers/FireTower/Base0.svg","/towers/FireTower/Base1.svg","/towers/FireTower/Base2.svg","/towers/FireTower/Upgrade1.svg","/towers/FireTower/Upgrade2.svg","/towers/IceTower/Base0.svg","/towers/IceTower/Base1.svg","/towers/IceTower/Base2.svg","/towers/IceTower/Upgrade1.svg","/towers/IceTower/Upgrade2.svg","/towers/PoisonTower/Base0.svg","/towers/PoisonTower/Base1.svg","/towers/PoisonTower/Base2.svg","/towers/PoisonTower/Upgrade1.svg","/towers/PoisonTower/Upgrade2.svg","/towers/ThunderTower/Base0.svg","/towers/ThunderTower/Base1.svg","/towers/ThunderTower/Base2.svg","/towers/ThunderTower/Upgrade1.svg","/towers/ThunderTower/Upgrade2.svg","/towers/Base.svg","/towers/Upgrade0.svg","/throne.svg","/logos/knowledge-space2.png","/cursors/cursor-hammer.svg","/cursors/cursor-arrow.svg","/cursors/build0.svg","/cursors/build1.svg","/cursors/build2.svg"],rc=s=>{ne.spendLoot({type:"click",payload:{offset:new X(s.clientX,s.clientY)}})},ac=(s,e)=>{j.play("clickMenu",!0),r(e).pause()};var nc=L('<link rel="preload" as="image">'),lc=L('<div class="window-wrapper"><div class="wrapper svelte-dz30ag"><!> <!> <!> <button tabindex="-1" class="btn-pause svelte-dz30ag"><!></button> <div class="game-container svelte-dz30ag"><!></div></div></div>'),cc=L("<!> <!> <!>",1);function yc(s,e){H(e,!0);const t=B(()=>M.get("questionManager")),i=B(()=>M.get("gameLoop")),o=B(()=>M.get("stageManager")),n=u=>{u.key==="Escape"&&(r(i).pauseState?r(i).resume():r(i).pause())};hi(()=>{j.preload()});var l=cc();Hs("keydown",Ar,n),Mr(u=>{var b=ae(),f=Z(b);se(f,17,()=>oc,ws,(E,T)=>{var x=nc();q(()=>we(x,"href",r(T))),k(E,x)}),k(u,b)});var c=Z(l);{var g=u=>{Hn(u,{onStart:()=>Pe.start()})},_=u=>{var b=ae(),f=Z(b);{var E=x=>{Rn(x,{onRestart:()=>Pe.restart()})},T=x=>{var P=ae(),D=Z(P);{var S=I=>{kl(I,{onResume:()=>r(i).resume(),onRestart:()=>Pe.restart()})};W(D,I=>{r(i).pauseState&&I(S)},!0)}k(x,P)};W(f,x=>{r(o).stageResult?x(E):x(T,!1)},!0)}k(u,b)};W(c,u=>{Pe.isStarted?u(_,!1):u(g)})}var h=A(c,2);{var p=u=>{var b=lc();b.__click=[rc];const f=B(()=>G.get("arrow"));q(()=>U(b,"cursor",r(f)));var E=F(b),T=F(E);ql(T,{get stageNumber(){return r(o).stageNumber}});var x=A(T,2);Nl(x,{});var P=A(x,2);tc(P,{});var D=A(P,2);D.__click=[ac,i];const S=B(()=>G.get("arrow"));q(()=>U(D,"cursor",r(S)));var I=F(D);Ol(I),C(D);var O=A(D,2);U(O,"transform-origin","center");var z=F(O);ic(z,{children:(N,he)=>{kn(N,{})},$$slots:{default:!0}}),C(O),C(E),C(b),q(()=>{var N;return pe(E,"bullet-time",(N=r(t))==null?void 0:N.isActive)}),Ai(O,"offsetHeight",N=>$.gameAreaHeight=N),Ai(O,"offsetWidth",N=>$.gameAreaWidth=N),k(u,b)};W(h,u=>{Pe.isStarted&&j.preloaded&&u(p)})}var w=A(h,2);Xl(w,{}),Ei("innerWidth",u=>$.width=u),Ei("innerHeight",u=>$.height=u),k(s,l),Y()}cs(["click"]);export{yc as component};
