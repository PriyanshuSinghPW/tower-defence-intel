var sa=Object.defineProperty;var _i=s=>{throw TypeError(s)};var ia=(s,e,t)=>e in s?sa(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var $=(s,e,t)=>ia(s,typeof e!="symbol"?e+"":e,t),Js=(s,e,t)=>e.has(s)||_i("Cannot "+t);var r=(s,e,t)=>(Js(s,e,"read from private field"),t?t.call(s):e.get(s)),h=(s,e,t)=>e.has(s)?_i("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),Ks=(s,e,t,i)=>(Js(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),Fi=(s,e,t)=>(Js(s,e,"access private method"),t);import{a as E,t as P,c as he,n as Qs}from"../chunks/disclose-version.CevxcIVZ.js";import{h as ee,a as ko,at as oa,au as aa,s as ra,J as mi,af as So,X as Vs,A as Ae,a7 as na,B as bs,y as Eo,ah as la,C as ca,I as da,V as Mo,ac as ua,ad as Bi,N as ei,Q as ha,F as Do,av as Cs,ae as Po,x as Ts,$ as ma,a5 as Ai,aw as gi,ax as ki,ay as ga,U as va,az as fa,aA as Io,aB as vi,aC as pa,M as wa,w as ya,aD as jo,G as Lo,aE as ba,ab as $o,n as Pe,aF as Ca,aa as Ta,aG as xa,aH as _a,aI as Fa,ag as Ro,b as qo,aJ as Ba,aK as Aa,D as Si,E as Ei,aL as ka,aM as Sa,a1 as p,g as o,Y as g,k as F,p as H,u as Se,t as R,m as G,aN as fi,f as J,v as k,o as _,q as x,aO as pi,aP as Ea}from"../chunks/runtime.BL11IQWW.js";import{a as Ma,l as Da,w as Pa,e as Re,r as Uo,d as qe,s as ne,b as Ia}from"../chunks/render.BWQL7xXt.js";import{a as C,p as Ce,b as No,i as W,c as ja,s as La,d as $a}from"../chunks/props.C_nab1LJ.js";import{o as Xs,a as zo}from"../chunks/index-client.C4s1iBsW.js";import{b as ai,w as Ra}from"../chunks/paths.Corf6RDR.js";import"../chunks/legacy.BwMg7t2V.js";import{s as qa}from"../chunks/slot.1_vvGQ04.js";function ri(s,e,t){ee&&ko();var i=s,a=na,n,l=oa()?aa:ra;mi(()=>{l(a,a=e())&&(n&&So(n),n=Vs(()=>t(i)))}),ee&&(i=Ae)}function De(s,e){ee&&bs(Eo(s)),la(()=>{var t=e();for(var i in t){var a=t[i];a?s.style.setProperty(i,a):s.style.removeProperty(i)}}),ca(()=>{s.remove()})}function xs(s,e){return e}function Ua(s,e,t,i){for(var a=[],n=e.length,l=0;l<n;l++)ga(e[l].e,a,!0);var c=n>0&&a.length===0&&t!==null;if(c){var m=t.parentNode;va(m),m.append(t),i.clear(),ye(s,e[0].prev,e[n-1].next)}fa(a,()=>{for(var b=0;b<n;b++){var f=e[b];c||(i.delete(f.k),ye(s,f.prev,f.next)),Io(f.e,!c)}})}function re(s,e,t,i,a,n=null){var l=s,c={flags:e,items:new Map,first:null},m=(e&jo)!==0;if(m){var b=s;l=ee?bs(Eo(b)):b.appendChild(ya())}ee&&ko();var f=null,w=!1;mi(()=>{var y=t(),u=da(y)?y:y==null?[]:Mo(y),v=u.length;if(w&&v===0)return;w=v===0;let d=!1;if(ee){var A=l.data===ua;A!==(v===0)&&(l=Bi(),bs(l),ei(!1),d=!0)}if(ee){for(var T=null,B,I=0;I<v;I++){if(Ae.nodeType===8&&Ae.data===ha){l=Ae,d=!0,ei(!1);break}var q=u[I],S=i(q,I);B=Oo(Ae,c,T,null,q,S,I,a,e),c.items.set(S,B),T=B}v>0&&bs(Bi())}if(!ee){var D=Do;Na(u,c,l,a,e,(D.f&Cs)!==0,i)}n!==null&&(v===0?f?Po(f):f=Vs(()=>n(l)):f!==null&&So(f,()=>{f=null})),d&&ei(!0),t()}),ee&&(l=Ae)}function Na(s,e,t,i,a,n,l,c){var xe,we,_e,Fe;var m=(a&ba)!==0,b=(a&(vi|gi))!==0,f=s.length,w=e.items,y=e.first,u=y,v,d=null,A,T=[],B=[],I,q,S,D;if(m)for(D=0;D<f;D+=1)I=s[D],q=l(I,D),S=w.get(q),S!==void 0&&((xe=S.a)==null||xe.measure(),(A??(A=new Set)).add(S));for(D=0;D<f;D+=1){if(I=s[D],q=l(I,D),S=w.get(q),S===void 0){var Q=u?u.e.nodes_start:t;d=Oo(Q,e,d,d===null?e.first:d.next,I,q,D,i,a),w.set(q,d),T=[],B=[],u=d.next;continue}if(b&&za(S,I,D,a),S.e.f&Cs&&(Po(S.e),m&&((we=S.a)==null||we.unfix(),(A??(A=new Set)).delete(S))),S!==u){if(v!==void 0&&v.has(S)){if(T.length<B.length){var N=B[0],Y;d=N.prev;var z=T[0],K=T[T.length-1];for(Y=0;Y<T.length;Y+=1)Mi(T[Y],N,t);for(Y=0;Y<B.length;Y+=1)v.delete(B[Y]);ye(e,z.prev,K.next),ye(e,d,z),ye(e,K,N),u=N,d=K,D-=1,T=[],B=[]}else v.delete(S),Mi(S,u,t),ye(e,S.prev,S.next),ye(e,S,d===null?e.first:d.next),ye(e,d,S),d=S;continue}for(T=[],B=[];u!==null&&u.k!==q;)(n||!(u.e.f&Cs))&&(v??(v=new Set)).add(u),B.push(u),u=u.next;if(u===null)continue;S=u}T.push(S),d=S,u=S.next}if(u!==null||v!==void 0){for(var V=v===void 0?[]:Mo(v);u!==null;)(n||!(u.e.f&Cs))&&V.push(u),u=u.next;var oe=V.length;if(oe>0){var Te=a&jo&&f===0?t:null;if(m){for(D=0;D<oe;D+=1)(_e=V[D].a)==null||_e.measure();for(D=0;D<oe;D+=1)(Fe=V[D].a)==null||Fe.fix()}Ua(e,V,Te,w)}}m&&Lo(()=>{var me;if(A!==void 0)for(S of A)(me=S.a)==null||me.apply()}),Ts.first=e.first&&e.first.e,Ts.last=d&&d.e}function za(s,e,t,i){i&vi&&ki(s.v,e),i&gi?ki(s.i,t):s.i=t}function Oo(s,e,t,i,a,n,l,c,m,b){var f=(m&vi)!==0,w=(m&pa)===0,y=f?w?ma(a):Ai(a):a,u=m&gi?Ai(l):l,v={i:u,v:y,k:n,a:null,e:null,prev:t,next:i};try{return v.e=Vs(()=>c(s,y,u),ee),v.e.prev=t&&t.e,v.e.next=i&&i.e,t===null?e.first=v:(t.next=v,t.e.next=v.e),i!==null&&(i.prev=v,i.e.prev=v.e),v}finally{}}function Mi(s,e,t){for(var i=s.next?s.next.e.nodes_start:t,a=e?e.e.nodes_start:t,n=s.e.nodes_start;n!==i;){var l=wa(n);a.before(n),n=l}}function ye(s,e,t){e===null?s.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Oa(s,e,...t){var i=s,a=Pe,n;mi(()=>{a!==(a=e())&&(n&&(Io(n),n=null),n=Vs(()=>a(i,...t)))},$o),ee&&(i=Ae)}function se(s,e,t,i){var a=s.__attributes??(s.__attributes={});ee&&(a[e]=s.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&s.nodeName==="LINK")||a[e]!==(a[e]=t)&&(e==="style"&&"__styles"in s&&(s.__styles={}),e==="loading"&&(s[Ca]=t),t==null?s.removeAttribute(e):typeof t!="string"&&Ha(s).includes(e)?s[e]=t:s.setAttribute(e,t))}var Di=new Map;function Ha(s){var e=Di.get(s.nodeName);if(e)return e;Di.set(s.nodeName,e=[]);for(var t,i=s,a=Element.prototype;a!==i;){t=xa(i);for(var n in t)t[n].set&&e.push(n);i=Ta(i)}return e}function Ho(s,e,t){var i=s.__className,a=Ga(e);ee&&s.className===a?s.__className=a:(i!==a||ee&&s.className!==a)&&(e==null?s.removeAttribute("class"):s.className=a,s.__className=a)}function Ga(s,e){return(s??"")+""}function ke(s,e,t){if(t){if(s.classList.contains(e))return;s.classList.add(e)}else{if(!s.classList.contains(e))return;s.classList.remove(e)}}function U(s,e,t,i){var a=s.__styles??(s.__styles={});a[e]!==t&&(a[e]=t,t==null?s.style.removeProperty(e):s.style.setProperty(e,t,""))}const Ya=()=>performance.now(),de={tick:s=>requestAnimationFrame(s),now:()=>Ya(),tasks:new Set};function Go(){const s=de.now();de.tasks.forEach(e=>{e.c(s)||(de.tasks.delete(e),e.f())}),de.tasks.size!==0&&de.tick(Go)}function Yo(s){let e;return de.tasks.size===0&&de.tick(Go),{promise:new Promise(t=>{de.tasks.add(e={c:s,f:t})}),abort(){de.tasks.delete(e)}}}function vs(s,e){s.dispatchEvent(new CustomEvent(e))}function Wa(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const e=s.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Pi(s){const e={},t=s.split(";");for(const i of t){const[a,n]=i.split(":");if(!a||n===void 0)break;const l=Wa(a.trim());e[l]=n.trim()}return e}const Qa=s=>s;function O(s,e,t,i){var a=(s&ka)!==0,n=(s&Sa)!==0,l=a&&n,c=(s&Ba)!==0,m=l?"both":a?"in":"out",b,f=e.inert,w,y;function u(){var B=Do,I=Ts;Si(null),Ei(null);try{return b??(b=t()(e,(i==null?void 0:i())??{},{direction:m}))}finally{Si(B),Ei(I)}}var v={is_global:c,in(){var B;if(e.inert=f,!a){y==null||y.abort(),(B=y==null?void 0:y.reset)==null||B.call(y);return}n||w==null||w.abort(),vs(e,"introstart"),w=ni(e,u(),y,1,()=>{vs(e,"introend"),w==null||w.abort(),w=b=void 0})},out(B){if(!n){B==null||B(),b=void 0;return}e.inert=!0,vs(e,"outrostart"),y=ni(e,u(),w,0,()=>{vs(e,"outroend"),B==null||B()})},stop:()=>{w==null||w.abort(),y==null||y.abort()}},d=Ts;if((d.transitions??(d.transitions=[])).push(v),a&&Ma){var A=c;if(!A){for(var T=d.parent;T&&T.f&$o;)for(;(T=T.parent)&&!(T.f&_a););A=!T||(T.f&Fa)!==0}A&&Ro(()=>{qo(()=>v.in())})}}function ni(s,e,t,i,a){var n=i===1;if(Aa(e)){var l,c=!1;return Lo(()=>{if(!c){var A=e({direction:n?"in":"out"});l=ni(s,A,t,i,a)}}),{abort:()=>{c=!0,l==null||l.abort()},deactivate:()=>l.deactivate(),reset:()=>l.reset(),t:()=>l.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return a(),{abort:Pe,deactivate:Pe,reset:Pe,t:()=>i};const{delay:m=0,css:b,tick:f,easing:w=Qa}=e;var y=[];if(n&&t===void 0&&(f&&f(0,1),b)){var u=Pi(b(0,1));y.push(u,u)}var v=()=>1-i,d=s.animate(y,{duration:m});return d.onfinish=()=>{var A=(t==null?void 0:t.t())??1-i;t==null||t.abort();var T=i-A,B=e.duration*Math.abs(T),I=[];if(B>0){if(b)for(var q=Math.ceil(B/16.666666666666668),S=0;S<=q;S+=1){var D=A+T*w(S/q),Q=b(D,1-D);I.push(Pi(Q))}v=()=>{var N=d.currentTime;return A+T*w(N/B)},f&&Yo(()=>{if(d.playState!=="running")return!1;var N=v();return f(N,1-N),!0})}d=s.animate(I,{duration:B,fill:"forwards"}),d.onfinish=()=>{v=()=>i,f==null||f(i,1-i),a()}},{abort:()=>{d&&(d.cancel(),d.effect=null,d.onfinish=Pe)},deactivate:()=>{a=Pe},reset:()=>{i===0&&(f==null||f(1,0))},t:()=>v()}}var be,je,Ne,_s,Wo;const Fs=class Fs{constructor(e){h(this,_s);h(this,be,new WeakMap);h(this,je);h(this,Ne);Ks(this,Ne,e)}observe(e,t){var i=r(this,be).get(e)||new Set;return i.add(t),r(this,be).set(e,i),Fi(this,_s,Wo).call(this).observe(e,r(this,Ne)),()=>{var a=r(this,be).get(e);a.delete(t),a.size===0&&(r(this,be).delete(e),r(this,je).unobserve(e))}}};be=new WeakMap,je=new WeakMap,Ne=new WeakMap,_s=new WeakSet,Wo=function(){return r(this,je)??Ks(this,je,new ResizeObserver(e=>{for(var t of e){Fs.entries.set(t.target,t);for(var i of r(this,be).get(t.target)||[])i(t)}}))},$(Fs,"entries",new WeakMap);let li=Fs;var Va=new li({box:"border-box"});function Ii(s,e,t){var i=Va.observe(s,()=>t(s[e]));Ro(()=>(qo(()=>t(s[e])),i))}function ji(s,e){Da(window,["resize"],()=>Pa(()=>e(window[s])))}var ze;class Xa{constructor(){h(this,ze,p(C({})));$(this,"setup",e=>{this.managers=e});$(this,"update",e=>{this.managers.stageManager.update(e),this.managers.entityManager.update(e),this.managers.collisionManager.update(),this.managers.questionManager&&this.managers.questionManager.update(e),this.managers.particleManager&&this.managers.particleManager.update(e)});$(this,"get",e=>typeof e=="string"?this.managers[e]:e.reduce((t,i)=>(t[i]=this.managers[i],t),{}))}get managers(){return o(r(this,ze))}set managers(e){g(r(this,ze),C(e))}}ze=new WeakMap;const L=new Xa,X=s=>`${ai}${s}`,Li=["/enemies/BlueBlobElite/Die/0.svg","/enemies/BlueBlobElite/Die/1.svg","/enemies/BlueBlobElite/Die/2.svg"],Za={name:"BlueBlobEliteDie",frames:Li,framesAmount:Li.length,frameRate:10,loop:!1},$i=["/enemies/BlueBlobElite/Follow/0.svg","/enemies/BlueBlobElite/Follow/1.svg","/enemies/BlueBlobElite/Follow/2.svg","/enemies/BlueBlobElite/Follow/3.svg"],Ja={name:"BlueBlobEliteFollow",frames:$i,framesAmount:$i.length,frameRate:10,loop:!0},Ri=["/enemies/BlueCircleElite/Die/0.svg","/enemies/BlueCircleElite/Die/1.svg","/enemies/BlueCircleElite/Die/2.svg"],Ka={name:"BlueCircleEliteDie",frames:Ri,framesAmount:Ri.length,frameRate:10,loop:!1},qi=["/enemies/BlueCircleElite/Follow/0.svg","/enemies/BlueCircleElite/Follow/1.svg","/enemies/BlueCircleElite/Follow/2.svg","/enemies/BlueCircleElite/Follow/3.svg"],er={name:"BlueCircleEliteFollow",frames:qi,framesAmount:qi.length,frameRate:10,loop:!0},Ui=["/enemies/GreenCircleElite/Die/0.svg","/enemies/GreenCircleElite/Die/1.svg","/enemies/GreenCircleElite/Die/2.svg"],tr={name:"GreenCircleEliteDie",frames:Ui,framesAmount:Ui.length,frameRate:10,loop:!1},Ni=["/enemies/GreenCircleElite/Follow/0.svg","/enemies/GreenCircleElite/Follow/1.svg","/enemies/GreenCircleElite/Follow/2.svg","/enemies/GreenCircleElite/Follow/3.svg"],sr={name:"GreenCircleEliteFollow",frames:Ni,framesAmount:Ni.length,frameRate:10,loop:!0},zi=["/enemies/RedBlobElite/Die/0.svg","/enemies/RedBlobElite/Die/1.svg","/enemies/RedBlobElite/Die/2.svg"],ir={name:"RedBlobEliteDie",frames:zi,framesAmount:zi.length,frameRate:10,loop:!1},Oi=["/enemies/RedBlobElite/Follow/0.svg","/enemies/RedBlobElite/Follow/1.svg","/enemies/RedBlobElite/Follow/2.svg","/enemies/RedBlobElite/Follow/3.svg"],or={name:"RedBlobEliteFollow",frames:Oi,framesAmount:Oi.length,frameRate:10,loop:!0},Hi=["/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg"],ar={name:"BlueCommonDie",frames:Hi,framesAmount:Hi.length,frameRate:10,loop:!1},Gi=["/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg"],rr={name:"BlueCommonFollow",frames:Gi,framesAmount:Gi.length,frameRate:10,loop:!0},Yi=["/enemies/PurpleCommon/Die/0.svg","/enemies/PurpleCommon/Die/1.svg","/enemies/PurpleCommon/Die/2.svg"],nr={name:"PurpleCommonDie",frames:Yi,framesAmount:Yi.length,frameRate:10,loop:!1},Wi=["/enemies/PurpleCommon/Follow/0.svg","/enemies/PurpleCommon/Follow/1.svg","/enemies/PurpleCommon/Follow/2.svg"],lr={name:"PurpleCommonFollow",frames:Wi,framesAmount:Wi.length,frameRate:10,loop:!0},Qi=["/enemies/YellowCommon/Die/0.svg","/enemies/YellowCommon/Die/1.svg","/enemies/YellowCommon/Die/2.svg"],cr={name:"YellowCommonDie",frames:Qi,framesAmount:Qi.length,frameRate:10,loop:!1},Vi=["/enemies/YellowCommon/Follow/0.svg","/enemies/YellowCommon/Follow/1.svg","/enemies/YellowCommon/Follow/2.svg","/enemies/YellowCommon/Follow/3.svg"],dr={name:"YellowCommonFollow",frames:Vi,framesAmount:Vi.length,frameRate:10,loop:!0},ur=Object.freeze(Object.defineProperty({__proto__:null,BlueBlobEliteDie:Za,BlueBlobEliteFollow:Ja,BlueCircleEliteDie:Ka,BlueCircleEliteFollow:er,BlueCommonDie:ar,BlueCommonFollow:rr,GreenCircleEliteDie:tr,GreenCircleEliteFollow:sr,PurpleCommonDie:nr,PurpleCommonFollow:lr,RedBlobEliteDie:ir,RedBlobEliteFollow:or,YellowCommonDie:cr,YellowCommonFollow:dr},Symbol.toStringTag,{value:"Module"})),hr=["/towers/Base.svg"],mr={name:"TowerBase",frames:hr,framesAmount:1,frameRate:0,loop:!0},gr=["/towers/FireTower/Base0.svg"],vr={name:"FireTowerBase0",frames:gr,framesAmount:1,frameRate:0,loop:!0},fr=["/towers/FireTower/Base1.svg"],pr={name:"FireTowerBase1",frames:fr,framesAmount:1,frameRate:0,loop:!0},wr=["/towers/FireTower/Base2.svg"],yr={name:"FireTowerBase2",frames:wr,framesAmount:1,frameRate:0,loop:!0},Xi=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/FireTower/Base0.svg"],br={name:"FireTowerUpgrade0",frames:Xi,framesAmount:Xi.length,frameRate:10,loop:!1},Zi=["/towers/FireTower/Base0.svg","/towers/FireTower/Upgrade1.svg","/towers/FireTower/Base1.svg"],Cr={name:"FireTowerUpgrade1",frames:Zi,framesAmount:Zi.length,frameRate:10,loop:!1},Ji=["/towers/FireTower/Base1.svg","/towers/FireTower/Upgrade2.svg","/towers/FireTower/Base2.svg"],Tr={name:"FireTowerUpgrade2",frames:Ji,framesAmount:Ji.length,frameRate:10,loop:!1},xr=["/towers/IceTower/Base0.svg"],_r={name:"IceTowerBase0",frames:xr,framesAmount:1,frameRate:0,loop:!0},Fr=["/towers/IceTower/Base1.svg"],Br={name:"IceTowerBase1",frames:Fr,framesAmount:1,frameRate:0,loop:!0},Ar=["/towers/IceTower/Base2.svg"],kr={name:"IceTowerBase2",frames:Ar,framesAmount:1,frameRate:0,loop:!0},Ki=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/IceTower/Base0.svg"],Sr={name:"IceTowerUpgrade0",frames:Ki,framesAmount:Ki.length,frameRate:10,loop:!1},eo=["/towers/IceTower/Base0.svg","/towers/IceTower/Upgrade1.svg","/towers/IceTower/Base1.svg"],Er={name:"IceTowerUpgrade1",frames:eo,framesAmount:eo.length,frameRate:10,loop:!1},to=["/towers/IceTower/Base1.svg","/towers/IceTower/Upgrade2.svg","/towers/IceTower/Base2.svg"],Mr={name:"IceTowerUpgrade2",frames:to,framesAmount:to.length,frameRate:10,loop:!1},Dr=["/towers/PoisonTower/Base0.svg"],Pr={name:"PoisonTowerBase0",frames:Dr,framesAmount:1,frameRate:0,loop:!0},Ir=["/towers/PoisonTower/Base1.svg"],jr={name:"PoisonTowerBase1",frames:Ir,framesAmount:1,frameRate:0,loop:!0},Lr=["/towers/PoisonTower/Base2.svg"],$r={name:"PoisonTowerBase2",frames:Lr,framesAmount:1,frameRate:0,loop:!0},so=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/PoisonTower/Base0.svg"],Rr={name:"PoisonTowerUpgrade0",frames:so,framesAmount:so.length,frameRate:10,loop:!1},io=["/towers/PoisonTower/Base0.svg","/towers/PoisonTower/Upgrade1.svg","/towers/PoisonTower/Base1.svg"],qr={name:"PoisonTowerUpgrade1",frames:io,framesAmount:io.length,frameRate:10,loop:!1},oo=["/towers/PoisonTower/Base1.svg","/towers/PoisonTower/Upgrade2.svg","/towers/PoisonTower/Base2.svg"],Ur={name:"PoisonTowerUpgrade2",frames:oo,framesAmount:oo.length,frameRate:10,loop:!1},Nr=["/towers/ThunderTower/Base0.svg"],zr={name:"ThunderTowerBase0",frames:Nr,framesAmount:1,frameRate:0,loop:!0},Or=["/towers/ThunderTower/Base1.svg"],Hr={name:"ThunderTowerBase1",frames:Or,framesAmount:1,frameRate:0,loop:!0},Gr=["/towers/ThunderTower/Base2.svg"],Yr={name:"ThunderTowerBase2",frames:Gr,framesAmount:1,frameRate:0,loop:!0},ao=["/towers/Base.svg","/towers/Upgrade0.svg","/towers/ThunderTower/Base0.svg"],Wr={name:"ThunderTowerUpgrade0",frames:ao,framesAmount:ao.length,frameRate:10,loop:!1},ro=["/towers/ThunderTower/Base0.svg","/towers/ThunderTower/Upgrade1.svg","/towers/ThunderTower/Base1.svg"],Qr={name:"ThunderTowerUpgrade1",frames:ro,framesAmount:ro.length,frameRate:10,loop:!1},no=["/towers/ThunderTower/Base1.svg","/towers/ThunderTower/Upgrade2.svg","/towers/ThunderTower/Base2.svg"],Vr={name:"ThunderTowerUpgrade2",frames:no,framesAmount:no.length,frameRate:10,loop:!1},Xr=Object.freeze(Object.defineProperty({__proto__:null,FireTowerBase0:vr,FireTowerBase1:pr,FireTowerBase2:yr,FireTowerUpgrade0:br,FireTowerUpgrade1:Cr,FireTowerUpgrade2:Tr,IceTowerBase0:_r,IceTowerBase1:Br,IceTowerBase2:kr,IceTowerUpgrade0:Sr,IceTowerUpgrade1:Er,IceTowerUpgrade2:Mr,PoisonTowerBase0:Pr,PoisonTowerBase1:jr,PoisonTowerBase2:$r,PoisonTowerUpgrade0:Rr,PoisonTowerUpgrade1:qr,PoisonTowerUpgrade2:Ur,ThunderTowerBase0:zr,ThunderTowerBase1:Hr,ThunderTowerBase2:Yr,ThunderTowerUpgrade0:Wr,ThunderTowerUpgrade1:Qr,ThunderTowerUpgrade2:Vr,TowerBase:mr},Symbol.toStringTag,{value:"Module"})),lo=["/projectiles/Fireball/Die/0.svg","/projectiles/Fireball/Die/1.svg","/projectiles/Fireball/Die/2.svg"],Zr={name:"FireballDie",frames:lo,framesAmount:lo.length,frameRate:10,loop:!1},co=["/projectiles/Fireball/Follow/0.svg","/projectiles/Fireball/Follow/1.svg","/projectiles/Fireball/Follow/2.svg","/projectiles/Fireball/Follow/3.svg"],Jr={name:"FireballFollow",frames:co,framesAmount:co.length,frameRate:10,loop:!0},uo=["/projectiles/Icebolt/Die/0.svg","/projectiles/Icebolt/Die/1.svg","/projectiles/Icebolt/Die/2.svg"],Kr={name:"IceboltDie",frames:uo,framesAmount:uo.length,frameRate:10,loop:!1},ho=["/projectiles/Icebolt/Follow/0.svg","/projectiles/Icebolt/Follow/1.svg"],en={name:"IceboltFollow",frames:ho,framesAmount:ho.length,frameRate:10,loop:!0},mo=["/projectiles/Poisonball/Die/0.svg","/projectiles/Poisonball/Die/1.svg","/projectiles/Poisonball/Die/2.svg"],tn={name:"PoisonballDie",frames:mo,framesAmount:mo.length,frameRate:10,loop:!1},go=["/projectiles/Poisonball/Follow/0.svg","/projectiles/Poisonball/Follow/1.svg","/projectiles/Poisonball/Follow/2.svg","/projectiles/Poisonball/Follow/3.svg"],sn={name:"PoisonballFollow",frames:go,framesAmount:go.length,frameRate:10,loop:!0},vo=["/projectiles/Thunderbolt/Die/0.svg","/projectiles/Thunderbolt/Die/1.svg","/projectiles/Thunderbolt/Die/2.svg"],on={name:"ThunderboltDie",frames:vo,framesAmount:vo.length,frameRate:10,loop:!1},fo=["/projectiles/Thunderbolt/Follow/0.svg","/projectiles/Thunderbolt/Follow/1.svg","/projectiles/Thunderbolt/Follow/2.svg","/projectiles/Thunderbolt/Follow/3.svg"],an={name:"ThunderboltFollow",frames:fo,framesAmount:fo.length,frameRate:10,loop:!0},po=["/projectiles/Click/0.svg","/projectiles/Click/1.svg","/projectiles/Click/2.svg","/projectiles/Click/3.svg"],rn={name:"Click",frames:po,framesAmount:po.length,frameRate:10,loop:!1},nn=Object.freeze(Object.defineProperty({__proto__:null,Click:rn,FireballDie:Zr,FireballFollow:Jr,IceboltDie:Kr,IceboltFollow:en,PoisonballDie:tn,PoisonballFollow:sn,ThunderboltDie:on,ThunderboltFollow:an},Symbol.toStringTag,{value:"Module"})),wo=["/cursors/build0.svg","/cursors/build1.svg","/cursors/build2.svg"],ln={name:"TowerBuildCursor",frames:wo,framesAmount:wo.length,frameRate:7,loop:!1},cn=Object.freeze(Object.defineProperty({__proto__:null,TowerBuildCursor:ln},Symbol.toStringTag,{value:"Module"})),dn=["/castle/castle.png"],un={name:"Throne",frames:dn,framesAmount:1,frameRate:0,loop:!0},hn=["/castle/castle-broken.png"],mn={name:"ThroneDamaged1",frames:hn,framesAmount:1,frameRate:0,loop:!0},gn=["/castle/castle-broken2.png"],vn={name:"ThroneDamaged2",frames:gn,framesAmount:1,frameRate:0,loop:!0},fn=["/castle/castle-broken3.png"],pn={name:"ThroneDamaged3",frames:fn,framesAmount:1,frameRate:0,loop:!0},wn=["/castle/castle-destroyed.png"],yn={name:"ThroneDestroyed",frames:wn,framesAmount:1,frameRate:0,loop:!1},bn=Object.freeze(Object.defineProperty({__proto__:null,Throne:un,ThroneDamaged1:mn,ThroneDamaged2:vn,ThroneDamaged3:pn,ThroneDestroyed:yn},Symbol.toStringTag,{value:"Module"})),Cn=["/loot.svg"],Tn={name:"Loot",frames:Cn,framesAmount:1,frameRate:0,loop:!0},yo={...bn,Loot:Tn,...ur,...Xr,...nn,...cn},Le=s=>{if(!yo[s])throw new Error(`Animation config not found for: ${s}`);const e=yo[s];return{...e,frames:e.frames.map(t=>X(t))}};var Oe,He,Ge,Ye,We,Bs,Qe;class wi{constructor({name:e,framesAmount:t,frameRate:i,loop:a=!1}){$(this,"name");h(this,Oe,p(0));h(this,He,p(0));h(this,Ge,p(!1));h(this,Ye,p(0));h(this,We,p(0));h(this,Bs,F(()=>this.getIsAnimationComplete()));h(this,Qe,p(()=>{}));this.name=e,this.framesAmount=t,this.frameRate=i,this.loop=a}get framesAmount(){return o(r(this,Oe))}set framesAmount(e){g(r(this,Oe),C(e))}get frameRate(){return o(r(this,He))}set frameRate(e){g(r(this,He),C(e))}get loop(){return o(r(this,Ge))}set loop(e){g(r(this,Ge),C(e))}get currentFrame(){return o(r(this,Ye))}set currentFrame(e){g(r(this,Ye),C(e))}get currentFrameTime(){return o(r(this,We))}set currentFrameTime(e){g(r(this,We),C(e))}get isComplete(){return o(r(this,Bs))}get onFrameChange(){return o(r(this,Qe))}set onFrameChange(e){g(r(this,Qe),C(e))}update(e){this.frameRate!==0&&(this.currentFrameTime+=e,this.currentFrameTime>=1e3/this.frameRate&&(this.currentFrameTime=0,this.nextFrame()))}nextFrame(){this.onFrameChange(this.currentFrame),this.currentFrame>=this.framesAmount-1?this.loop?this.currentFrame=0:this.currentFrame=this.framesAmount-1:this.currentFrame+=1}getIsAnimationComplete(){return this.loop?!1:this.currentFrame===this.framesAmount-1}}Oe=new WeakMap,He=new WeakMap,Ge=new WeakMap,Ye=new WeakMap,We=new WeakMap,Bs=new WeakMap,Qe=new WeakMap;const bo={arrow:X("/cursors/cursor-arrow.svg"),hammer:X("/cursors/cursor-hammer.svg")};var Ve,As,ks,Ss,Es;class xn{constructor(){h(this,Ve,p());h(this,As,F(()=>`url(${bo.arrow}), auto`));h(this,ks,F(()=>`url(${bo.hammer}), auto`));h(this,Ss,F(()=>this.animation&&!this.animation.isComplete));h(this,Es,F(()=>this.getCurrentFrame()))}get animation(){return o(r(this,Ve))}set animation(e){g(r(this,Ve),C(e))}get arrow(){return o(r(this,As))}get hammer(){return o(r(this,ks))}get inAnimation(){return o(r(this,Ss))}get currentFrame(){return o(r(this,Es))}update(e){this.inAnimation&&this.animation.update(e)}get(e){return this.inAnimation?this.currentFrame:this[e]}setAnimation(e){if(!e){this.animation=null;return}const t=Le(e);this.animation=new wi({...t})}getCurrentFrame(){const{frames:e}=Le(this.animation.name);return`url(${e[this.animation.currentFrame]}), auto`}}Ve=new WeakMap,As=new WeakMap,ks=new WeakMap,Ss=new WeakMap,Es=new WeakMap;const Z=new xn;var Xe,Ze,Je,Ke,et,tt,Ms;class _n{constructor(){h(this,Xe,p(0));h(this,Ze,p(0));h(this,Je,p(0));h(this,Ke,p(0));h(this,et,p(0));h(this,tt,p(0));h(this,Ms,F(()=>this.width<768))}get width(){return o(r(this,Xe))}set width(e){g(r(this,Xe),C(e))}get height(){return o(r(this,Ze))}set height(e){g(r(this,Ze),C(e))}get gameAreaWidth(){return o(r(this,Je))}set gameAreaWidth(e){g(r(this,Je),C(e))}get gameAreaHeight(){return o(r(this,Ke))}set gameAreaHeight(e){g(r(this,Ke),C(e))}get gameXOffset(){return o(r(this,et))}set gameXOffset(e){g(r(this,et),C(e))}get gameYOffset(){return o(r(this,tt))}set gameYOffset(e){g(r(this,tt),C(e))}get isMobile(){return o(r(this,Ms))}get screenBounds(){return{x1:0,y1:0,x2:this.width,y2:this.height}}get gameBoundingBox(){return{x1:this.gameXOffset,y1:this.gameYOffset,x2:this.width,y2:this.height}}isEntityInScreen(e){const{x1:t,y1:i,x2:a,y2:n}=this.screenBounds,{x:l,y:c}=e.position;return l+e.width/2>t&&l-e.width/2<a&&c+e.height>i&&c-e.height<n}}Xe=new WeakMap,Ze=new WeakMap,Je=new WeakMap,Ke=new WeakMap,et=new WeakMap,tt=new WeakMap,Ms=new WeakMap;const j=new _n;var Fn=P('<img alt="Enemy animation" class="svelte-94zyf5">');function ti(s,e){H(e,!0);let t=Ce(e,"entity",7),i=p(void 0),a=F(()=>Le(t().animation.name)),n=F(()=>o(a).frames[t().animation.currentFrame]),l=p(!1);function c(){g(l,!0)}const m=F(()=>j.isMobile?t().scale-.2:t().scale),b=F(()=>t().position.x),f=F(()=>t().position.y),w=F(()=>`translate(${o(b)}px, ${o(f)}px) rotate(${t().rotation}deg) scale(${o(m)})`);Se(()=>{if(!o(i)||!o(l))return;let v=o(i).getBoundingClientRect();t().width=v.width,t().height=v.height});var y=Fn();const u=F(()=>Z.get("arrow"));No(y,v=>g(i,v),()=>o(i)),R(()=>{se(y,"src",o(n)),U(y,"left","0px"),U(y,"top","0px"),U(y,"transform",o(w)),U(y,"cursor",o(u))}),Re("load",y,c),Uo(y),E(s,y),G()}var st,it;const ve=class ve{constructor(e=0,t=0){h(this,st,p(0));h(this,it,p(0));this.x=e,this.y=t}get x(){return o(r(this,st))}set x(e){g(r(this,st),C(e))}get y(){return o(r(this,it))}set y(e){g(r(this,it),C(e))}clone(){return new ve(this.x,this.y)}isEqual(e){return this.x===e.x&&this.y===e.y}add(e){return new ve(this.x+e.x,this.y+e.y)}subtract(e){return new ve(this.x-e.x,this.y-e.y)}multiply(e){return new ve(this.x*e,this.y*e)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return e?new ve(this.x/e,this.y/e):new ve}distance(e){return this.subtract(e).magnitude()}dot(e){return this.x*e.x+this.y*e.y}rotate(e){const t=Math.cos(e),i=Math.sin(e);return new ve(this.x*t-this.y*i,this.x*i+this.y*t)}};st=new WeakMap,it=new WeakMap;let te=ve;const Bn=s=>s;function Qo(s){const e=s-1;return e*e*e+1}function ie(s,{delay:e=0,duration:t=400,easing:i=Bn}={}){const a=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:i,css:n=>`opacity: ${n*a}`}}function An(s,{delay:e=0,duration:t=400,easing:i=Qo,axis:a="y"}={}){const n=getComputedStyle(s),l=+n.opacity,c=a==="y"?"height":"width",m=parseFloat(n[c]),b=a==="y"?["top","bottom"]:["left","right"],f=b.map(T=>`${T[0].toUpperCase()}${T.slice(1)}`),w=parseFloat(n[`padding${f[0]}`]),y=parseFloat(n[`padding${f[1]}`]),u=parseFloat(n[`margin${f[0]}`]),v=parseFloat(n[`margin${f[1]}`]),d=parseFloat(n[`border${f[0]}Width`]),A=parseFloat(n[`border${f[1]}Width`]);return{delay:e,duration:t,easing:i,css:T=>`overflow: hidden;opacity: ${Math.min(T*20,1)*l};${c}: ${T*m}px;padding-${b[0]}: ${T*w}px;padding-${b[1]}: ${T*y}px;margin-${b[0]}: ${T*u}px;margin-${b[1]}: ${T*v}px;border-${b[0]}-width: ${T*d}px;border-${b[1]}-width: ${T*A}px;`}}function $e(s,{delay:e=0,duration:t=400,easing:i=Qo,start:a=0,opacity:n=0}={}){const l=getComputedStyle(s),c=+l.opacity,m=l.transform==="none"?"":l.transform,b=1-a,f=c*(1-n);return{delay:e,duration:t,easing:i,css:(w,y)=>`
			transform: ${m} scale(${1-b*y});
			opacity: ${c-f*y}
		`}}var kn=P('<div class="shoot-effect svelte-1yv4put"></div>');function Sn(s,e){H(e,!0);let i=F(()=>{switch(e.entity.name){case"IceTower":return"#9AD5FF";case"FireTower":return"#E45F01";case"ThunderTower":return"#FFF263";case"PoisonTower":return"#6CE966";default:return"#ffffff"}}),n=F(()=>e.entity.upgradeLevel===0?{x:e.entity.width/2,y:22}:e.entity.upgradeLevel===1?{x:e.entity.width/2,y:23}:{x:e.entity.width/2,y:24});var l=kn();R(()=>{U(l,"--effect-color",o(i)),U(l,"left",`${o(n).x}px`),U(l,"top",`${o(n).y}px`)}),Re("animationend",l,()=>{e.entity.removeVFX("TowerShoot")}),O(2,l,()=>ie,()=>({duration:40})),E(s,l),G()}var En=P('<div class="smoke-effect svelte-1pfktwp"></div>');function Mn(s,e){H(e,!0);const t=174,i=249.5,a=7,n=14,c=1e3/n;let m=p(0),b=F(()=>o(m)%a*t),f=F(()=>Math.floor(o(m)/a)*i);Se(()=>{const y=setInterval(()=>{o(m)<n-1?fi(m):(clearInterval(y),e.entity.removeVFX("Smoke"))},c);return()=>clearInterval(y)});var w=En();U(w,"width",`${t}px`),U(w,"height",`${i}px`),R(()=>U(w,"background-position",`-${o(b)}px -${o(f)}px`)),E(s,w),G()}var Dn=P('<div class="explosion-effect svelte-6va1lc"></div>');function Pn(s,e){H(e,!0);const t=320,i=344,a=4,n=8,c=1e3/n;let m=p(0),b=F(()=>o(m)%a*t),f=F(()=>Math.floor(o(m)/a)*i);Se(()=>{const y=setInterval(()=>{o(m)<n-1?fi(m):(clearInterval(y),e.entity.removeVFX("Explosion"))},c);return()=>clearInterval(y)});var w=Dn();U(w,"width",`${t}px`),U(w,"height",`${i}px`),R(()=>U(w,"background-position",`-${o(b)}px -${o(f)}px`)),E(s,w),G()}const In=Object.freeze(Object.defineProperty({__proto__:null,Explosion:Pn,Smoke:Mn,TowerShoot:Sn},Symbol.toStringTag,{value:"Module"}));function jn(s,e){H(e,!0);const t=In[e.name];if(!t)throw new Error(`Effect with name ${e.name} not found for entity ${e.entity.name}`);t(s,{get entity(){return e.entity}}),G()}var Ln=P('<img alt="Enemy animation" class="svelte-usgp6v"> <!>',1);function si(s,e){H(e,!0);let t=Ce(e,"entity",7),i=p(void 0),a=F(()=>Le(t().animation.name)),n=F(()=>o(a).frames[t().animation.currentFrame]),l=p(!1);function c(){g(l,!0)}const m=F(()=>j.isMobile?t().scale-.2:t().scale),b=F(()=>`scale(${o(m)})`);Se(()=>{var d;if(!o(i)||!o(l))return;let u=o(i).getBoundingClientRect();const v=((d=o(i).offsetParent)==null?void 0:d.getBoundingClientRect())??{x:0,y:0};t().position=new te(u.x-v.x,u.y-v.y),t().width=u.width,t().height=u.height,console.log("entity.position",o(n),t().width,t().height,j.width)});var f=Ln(),w=J(f);w.__click=function(...u){var v;(v=e.onclick)==null||v.apply(this,u)},No(w,u=>g(i,u),()=>o(i));var y=k(w,2);re(y,17,()=>t().vfx,u=>u+t().vfx.length,(u,v)=>{jn(u,{get name(){return o(v)},get entity(){return t()}})}),R(()=>{se(w,"src",o(n)),U(w,"transform",o(b))}),Re("load",w,c),Uo(w),E(s,f),G()}qe(["click"]);var $n=P('<div class="particle svelte-17cbyeb"></div>'),Rn=P('<div class="particle-layer svelte-17cbyeb"><!></div>');function qn(s,e){H(e,!0);const t=F(()=>L.get("particleManager"));var i=Rn(),a=_(i);{var n=l=>{var c=he(),m=J(c);re(m,16,()=>o(t).particles,b=>b,(b,f)=>{var w=$n();R(()=>{U(w,"left",`${f.x??""}px`),U(w,"top",`${f.y??""}px`),U(w,"width",`${f.size??""}px`),U(w,"height",`${f.size??""}px`),U(w,"background-color",f.color),U(w,"opacity",f.life)}),E(b,w)}),E(l,c)};W(a,l=>{o(t)&&l(n)})}x(i),E(s,i),G()}function Ie(s,e){return s.x1<=e.x2&&s.x2>=e.x1&&s.y1<=e.y2&&s.y2>=e.y1}function Vo(s,e){return Math.atan2(e.y-s.y,e.x-s.x)}function yi(s){return new te(Math.cos(s),Math.sin(s))}const bi=(s,e,t)=>({x1:s.x-e/2,y1:s.y-t/2,x2:s.x+e/2,y2:s.y+t/2,center:new te(s.x,s.y),topMiddle:new te(s.x+e/2,s.y)}),ii={bgSound:X("/sound/bgSound.mp3"),effects:{pickUp:X("/sound/sfx/pickUp.m4a"),towerUpgrade:X("/sound/sfx/towerUpgrade.m4a"),clickEnemy:X("/sound/sfx/clickEnemy.m4a"),towerShoot:X("/sound/sfx/towerShoot.m4a"),clickMenu:X("/sound/sfx/clickMenu.m4a"),lowResourse:X("/sound/sfx/lowResourse.m4a"),shine:X("/sound/sfx/shine.mp3"),chime:X("/sound/sfx/chime.mp3"),magicBurst:X("/sound/sfx/magic-burst.mp3"),break:X("/sound/sfx/break-sound.mp3"),destruction:X("/sound/sfx/destruction-sound.mp3")}},fs=.2,Un=.3;var ot,at,rt,nt,lt,ct,dt,ut,Ds,Ps;class Nn{constructor(){h(this,ot,p({}));h(this,at,p(!1));h(this,rt,p(0));h(this,nt,p(null));h(this,lt,p(null));h(this,ct,p(null));h(this,dt,p(!1));h(this,ut,p(0));h(this,Ds,F(()=>Object.keys(ii.effects).length+1));h(this,Ps,F(()=>Math.min(Math.floor(this.loadedCount/this.totalResources*100),100)));$(this,"preload",async()=>{const e=(t,i)=>new Promise((a,n)=>{const l=new Audio(i),c=()=>{this.sounds[t]=l,this.sounds[t].volume=t==="bgSound"?fs:Un,this.sounds[t].loop=t==="bgSound",this.loadedCount+=1,l.removeEventListener("canplaythrough",c),a()},m=b=>{l.removeEventListener("error",m),n(b)};l.addEventListener("canplaythrough",c),l.addEventListener("error",m),l.load()});try{await e("bgSound",ii.bgSound);const t=Object.entries(ii.effects).map(([i,a])=>e(i,a));await Promise.all(t),this.preloaded=!0,console.log("Sounds preloaded successfully.")}catch(t){throw console.error("Error preloading sounds:",t),t}});$(this,"reduceBgVolume",()=>{this.sounds.bgSound.volume=fs-.2});$(this,"restoreBgVolume",()=>{this.sounds.bgSound.volume=fs});$(this,"initAudioContext",()=>{if(this.audioContext)return;const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e;const t=this.sounds.bgSound;t&&(this.bgNode=this.audioContext.createMediaElementSource(t),this.bgFilter=this.audioContext.createBiquadFilter(),this.bgFilter.type="lowpass",this.bgFilter.frequency.value=22050,this.bgNode.connect(this.bgFilter),this.bgFilter.connect(this.audioContext.destination))});$(this,"play",(e,t=!1)=>{if(this.isMuted)return;const i=this.sounds[e];if(i){if(e==="bgSound"){this.initAudioContext(),this.audioContext.state==="suspended"&&this.audioContext.resume(),i.currentTime=0,i.play();return}if(!(navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"))&&(t||this.playingEffectsCount<10)){i.currentTime=0,i.play();const a=()=>{this.playingEffectsCount-=1,i.removeEventListener("ended",a)};i.addEventListener("ended",a),this.playingEffectsCount+=1}}})}get sounds(){return o(r(this,ot))}set sounds(e){g(r(this,ot),e)}get isMuted(){return o(r(this,at))}set isMuted(e){g(r(this,at),C(e))}get playingEffectsCount(){return o(r(this,rt))}set playingEffectsCount(e){g(r(this,rt),C(e))}get audioContext(){return o(r(this,nt))}set audioContext(e){g(r(this,nt),e)}get bgNode(){return o(r(this,lt))}set bgNode(e){g(r(this,lt),e)}get bgFilter(){return o(r(this,ct))}set bgFilter(e){g(r(this,ct),e)}get preloaded(){return o(r(this,dt))}set preloaded(e){g(r(this,dt),C(e))}get loadedCount(){return o(r(this,ut))}set loadedCount(e){g(r(this,ut),C(e))}get totalResources(){return o(r(this,Ds))}get preloadPercent(){return o(r(this,Ps))}pause(e){const t=this.sounds[e];t&&t.pause()}toggleMute(){this.isMuted=!this.isMuted,this.isMuted?this.pause("bgSound"):this.play("bgSound")}reset(){if(this.isMuted)return;const e=this.sounds.bgSound;e&&(e.currentTime=0,e.volume=fs,e.play())}setDistortion(e){if(!this.bgFilter||!this.audioContext)return;const t=this.audioContext.currentTime,i=e?600:22050;this.bgFilter.frequency.cancelScheduledValues(t),this.bgFilter.frequency.exponentialRampToValueAtTime(i,t+.5)}}ot=new WeakMap,at=new WeakMap,rt=new WeakMap,nt=new WeakMap,lt=new WeakMap,ct=new WeakMap,dt=new WeakMap,ut=new WeakMap,Ds=new WeakMap,Ps=new WeakMap;const M=new Nn,zn={click:5,upgrade:35};var ht,mt,gt,vt,ft,pt;class On{constructor(){h(this,ht,p(100));h(this,mt,p(!1));h(this,gt,p(!1));h(this,vt,p(!1));h(this,ft,p(100));h(this,pt,p(0))}get collectedLoot(){return o(r(this,ht))}set collectedLoot(e){g(r(this,ht),C(e))}get playLowLootAnimation(){return o(r(this,mt))}set playLowLootAnimation(e){g(r(this,mt),C(e))}get playTowerUpgradeAnimation(){return o(r(this,gt))}set playTowerUpgradeAnimation(e){g(r(this,gt),C(e))}get playEnemyClickAnimation(){return o(r(this,vt))}set playEnemyClickAnimation(e){g(r(this,vt),C(e))}get score(){return o(r(this,ft))}set score(e){g(r(this,ft),C(e))}get killsEnemy(){return o(r(this,pt))}set killsEnemy(e){g(r(this,pt),C(e))}spendLoot(e){const t=zn[e.type];if(e.type==="upgrade"){const{questionManager:i}=L.get(["questionManager"]),{tower:a}=e.payload;if(a.state.currentState.name==="NotBuilt"){i.buildPoints>0?(i.buildPoints--,a.state.setState("Guard"),a.stats.health=a.stats.maxHealth||3):this.playAnimation("LowLoot");return}else{this.collectedLoot>=t?i.buildPoints>0?(this.collectedLoot-=t,i.buildPoints--,a.state.setState("Upgrade"),this.playAnimation("TowerUpgrade"),Z.setAnimation("TowerBuildCursor")):this.playAnimation("LowLoot"):this.playAnimation("LowLoot");return}}if(this.collectedLoot<t){this.playAnimation("LowLoot");return}if(e.type==="click"){const{collisionManager:i,stageManager:a}=L.get(["collisionManager","stageManager"]),{offset:n}=e.payload,l=bi(n,60,60),c=i.filterEnemiesByBounds(l);a.spawnEntity("ClickExplode",n),M.play("clickEnemy",!0),c.forEach(m=>{m.state.setState("Die")}),c.length>0&&(this.collectedLoot-=t)}}receiveLoot(e){this.collectedLoot+=e,this.score+=e,this.killsEnemy++}reset(){this.collectedLoot=100,this.killsEnemy=0}getAnimation(e){return`play${e}Animation`}playAnimation(e){const t=this.getAnimation(e);this[t]=!0}unsetAnimation(e){const t=this.getAnimation(e);this[t]=!1}}ht=new WeakMap,mt=new WeakMap,gt=new WeakMap,vt=new WeakMap,ft=new WeakMap,pt=new WeakMap;const pe=new On;var Hn=P('<div class="segment-marker svelte-1syar9e"></div>'),Gn=P('<div class="health-bar-container svelte-1syar9e"><div class="health-bar-background svelte-1syar9e"><!> <div class="health-bar-fill svelte-1syar9e"></div></div></div>');function Yn(s,e){H(e,!0);const t=e.entity.stats.maxHealth||500,i=5,a=F(()=>Math.max(0,Math.min(100,e.entity.stats.health/t*100))),n=Array.from({length:i-1},(w,y)=>(y+1)*(100/i));var l=Gn();const c=F(()=>Z.get("arrow"));R(()=>U(l,"cursor",o(c)));var m=_(l),b=_(m);re(b,17,()=>n,xs,(w,y)=>{var u=Hn();R(()=>U(u,"left",`${o(y)??""}%`)),E(w,u)});var f=k(b,2);x(m),x(l),R(()=>{ke(f,"low",o(a)<=20),ke(f,"medium",o(a)>20&&o(a)<=60),ke(f,"high",o(a)>60),U(f,"width",`${o(a)??""}%`)}),E(s,l),G()}var Wn=P('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Qn=P('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Vn=P('<div class="tower-wrapper svelte-1u5gm4i"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div>'),Xn=P('<div class="tower-wrapper svelte-1u5gm4i"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div>'),Zn=P('<section class="svelte-1u5gm4i"><div class="grid-plane svelte-1u5gm4i"></div> <!> <!> <!> <div class="towers svelte-1u5gm4i"></div> <div class="throne svelte-1u5gm4i"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div> <div class="towers svelte-1u5gm4i"></div> <!></section>');function Jn(s,e){H(e,!0);const t=F(()=>L.get("entityManager")),i=d=>A=>{A.stopPropagation(),!(d.upgradeLevel===2||!d.isUpgradable||Z.inAnimation)&&pe.spendLoot({type:"upgrade",payload:{tower:d}})};var a=Zn();const n=F(()=>Z.get("arrow"));R(()=>U(a,"cursor",o(n)));var l=k(_(a),2);re(l,17,()=>o(t).loot,d=>d.id,(d,A)=>{var T=Wn(),B=J(T);De(B,()=>({"--z-index":11})),ti(B.lastChild,{get entity(){return o(A)}}),x(B),E(d,T)});var c=k(l,2);re(c,17,()=>o(t).projectiles,d=>d.id,(d,A)=>{var T=Qn(),B=J(T);De(B,()=>({"--z-index":12})),ti(B.lastChild,{get entity(){return o(A)}}),x(B),E(d,T)});var m=k(c,2);re(m,17,()=>o(t).enemies,d=>d.id,(d,A)=>{ti(d,{get entity(){return o(A)}})});var b=k(m,2);re(b,23,()=>o(t).topTowers,d=>d.id,(d,A,T)=>{var B=Vn(),I=_(B),q=F(()=>i(o(A)));De(I,()=>({"--cursor":Z.get("hammer"),"--z-index":10,"--pointer-events":"auto","--margin-left":o(T)===0?"12px":"0","--margin-right":o(T)===1?"12px":"0"})),si(I.lastChild,{get entity(){return o(A)},get onclick(){return o(q)}}),x(I),x(B),E(d,B)}),x(b);var f=k(b,2),w=_(f);De(w,()=>({"--cursor":Z.get("arrow")})),si(w.lastChild,{get entity(){return o(t).throne}}),x(w);var y=k(w,2);De(y,()=>({"--width":`${o(t).throne.width}px`})),Yn(y.lastChild,{get entity(){return o(t).throne}}),x(y),x(f);var u=k(f,2);re(u,23,()=>o(t).bottomTowers,d=>d.id,(d,A,T)=>{var B=Xn(),I=_(B),q=F(()=>i(o(A)));De(I,()=>({"--cursor":Z.get("hammer"),"--z-index":10,"--pointer-events":"auto","--margin-left":o(T)===0?"12px":"0","--margin-right":o(T)===1?"12px":"0"})),si(I.lastChild,{get entity(){return o(A)},get onclick(){return o(q)}}),x(I),x(B),E(d,B)}),x(u);var v=k(u,2);qn(v,{}),x(a),E(s,a),G()}const Kn=(s,e)=>{M!=null&&M.preloaded&&M.play("clickMenu",!0),e.onclick()};var el=P('<button class="btn svelte-11ulr"> <div class="tab svelte-11ulr"></div></button>');function fe(s,e){H(e,!0);const t=Ce(e,"disabled",3,!1),i=Ce(e,"text",3,"");var a=el();a.__click=[Kn,e];const n=F(()=>Z.get("arrow"));var l=_(a);pi(),x(a),R(()=>{a.disabled=t(),U(a,"cursor",o(n)),ne(l,`${i()??""} `)}),E(s,a),G()}qe(["click"]);var tl=P('<div class="menu-container svelte-n7rxky"><div class="grid-overlay svelte-n7rxky"></div> <div class="scan-line svelte-n7rxky"></div> <div class="menu-content svelte-n7rxky"><!></div></div>');function Ci(s,e){H(e,!0);var t=tl();const i=F(()=>Z.get("arrow"));R(()=>U(t,"cursor",o(i)));var a=k(_(t),4),n=_(a);Oa(n,()=>e.children),x(a),x(t),O(1,t,()=>ie,()=>({duration:200})),O(2,t,()=>ie,()=>({duration:200})),E(s,t),G()}var sl=Qs('<svg viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="25" cy="25" r="24.5" fill="#FFD700" stroke="white"></circle><circle cx="25" cy="25" r="18" fill="#FFAE00"></circle><path d="M43 25C43 20.2261 41.1036 15.6477 37.7279 12.2721C34.3523 8.89642 29.7739 7 25 7C20.2261 7 15.6477 8.89642 12.2721 12.2721C8.89642 15.6477 7 20.2261 7 25H7.72C7.72 20.4171 9.54057 16.0218 12.7812 12.7812C16.0218 9.54057 20.4171 7.72 25 7.72C29.5829 7.72 33.9782 9.54057 37.2188 12.7812C40.4594 16.0218 42.28 20.4171 42.28 25H43Z" fill="#E17100"></path><path d="M43 25C43 29.7739 41.1036 34.3523 37.7279 37.7279C34.3523 41.1036 29.7739 43 25 43C20.2261 43 15.6477 41.1036 12.2721 37.7279C8.89642 34.3523 7 29.7739 7 25H7.72C7.72 29.5829 9.54057 33.9782 12.7812 37.2188C16.0218 40.4594 20.4171 42.28 25 42.28C29.5829 42.28 33.9782 40.4594 37.2188 37.2188C40.4594 33.9782 42.28 29.5829 42.28 25H43Z" fill="#FFF4BA"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 32.712C27.4385 32.7173 29.256 32.7221 30.6708 32.1912C32.8572 34.0388 35.4701 34.3689 36.5404 32.9185C37.6236 31.4507 36.7166 28.7153 34.5147 26.8087C34.237 26.5683 33.9521 26.3526 33.6639 26.1621C33.6294 19.4369 29.6875 14 24.83 14C19.951 14 15.9959 19.4851 15.9959 26.2512C15.9959 26.5311 16.0026 26.7988 16.0159 27.055C13.6344 28.6054 12.4107 31.1356 13.2796 32.7392C14.1577 34.3598 16.8404 34.4205 19.2715 32.8748C19.4834 32.7401 19.6864 32.5977 19.8798 32.4487C21.1345 32.7202 22.6195 32.7163 24.2217 32.712C24.4227 32.7115 24.6255 32.7109 24.83 32.7109C25.0344 32.7109 25.2373 32.7115 25.4383 32.712Z" fill="#E17100"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 30.712C27.4385 30.7173 29.256 30.7221 30.6708 30.1912C32.8572 32.0388 35.4701 32.3689 36.5404 30.9185C37.6236 29.4507 36.7166 26.7153 34.5147 24.8087C34.237 24.5683 33.9521 24.3526 33.6639 24.1621C33.6294 17.4369 29.6875 12 24.83 12C19.951 12 15.9959 17.4851 15.9959 24.2512C15.9959 24.5311 16.0026 24.7988 16.0159 25.055C13.6344 26.6054 12.4107 29.1356 13.2796 30.7392C14.1577 32.3598 16.8404 32.4205 19.2715 30.8748C19.4834 30.7401 19.6864 30.5977 19.8798 30.4487C21.1345 30.7202 22.6195 30.7163 24.2217 30.712C24.4227 30.7115 24.6255 30.7109 24.83 30.7109C25.0344 30.7109 25.2373 30.7115 25.4383 30.712Z" fill="#FFF4BA"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M25.4383 31.712C27.4385 31.7173 29.256 31.7221 30.6708 31.1912C32.8572 33.0388 35.4701 33.3689 36.5404 31.9185C37.6236 30.4507 36.7166 27.7153 34.5147 25.8087C34.237 25.5683 33.9521 25.3526 33.6639 25.1621C33.6294 18.4369 29.6875 13 24.83 13C19.951 13 15.9959 18.4851 15.9959 25.2512C15.9959 25.5311 16.0026 25.7988 16.0159 26.055C13.6344 27.6054 12.4107 30.1356 13.2796 31.7392C14.1577 33.3598 16.8404 33.4205 19.2715 31.8748C19.4834 31.7401 19.6864 31.5977 19.8798 31.4487C21.1345 31.7202 22.6195 31.7163 24.2217 31.712C24.4227 31.7115 24.6255 31.7109 24.83 31.7109C25.0344 31.7109 25.2373 31.7115 25.4383 31.712Z" fill="#FFD700"></path><ellipse cx="24.9976" cy="22.982" rx="4.14994" ry="4.14994" fill="#FFF4BA"></ellipse><ellipse cx="25.0038" cy="22.9862" rx="2.62101" ry="2.62102" fill="#E17100"></ellipse><circle cx="25.0068" cy="22.9873" r="1.97166" fill="#FFD700"></circle><circle cx="25.0015" cy="22.9801" r="0.997639" fill="#E17100"></circle><mask id="path-12-inside-1_2401_1913" fill="white"><path d="M29.4521 22.9805C29.7547 22.9805 30.0031 22.7344 29.97 22.4336C29.8463 21.3087 29.3434 20.2528 28.5355 19.4449C27.5979 18.5073 26.3261 17.9805 25 17.9805C23.6739 17.9805 22.4021 18.5073 21.4645 19.4449C20.6566 20.2528 20.1537 21.3087 20.03 22.4336C19.9969 22.7344 20.2453 22.9805 20.5479 22.9805C20.8506 22.9805 21.0919 22.7339 21.1343 22.4343C21.252 21.6007 21.6372 20.822 22.2394 20.2198C22.9715 19.4877 23.9646 19.0764 25 19.0764C26.0354 19.0764 27.0285 19.4877 27.7606 20.2198C28.3628 20.822 28.748 21.6007 28.8657 22.4343C28.9081 22.7339 29.1494 22.9805 29.4521 22.9805Z"></path></mask><path d="M29.4521 22.9805C29.7547 22.9805 30.0031 22.7344 29.97 22.4336C29.8463 21.3087 29.3434 20.2528 28.5355 19.4449C27.5979 18.5073 26.3261 17.9805 25 17.9805C23.6739 17.9805 22.4021 18.5073 21.4645 19.4449C20.6566 20.2528 20.1537 21.3087 20.03 22.4336C19.9969 22.7344 20.2453 22.9805 20.5479 22.9805C20.8506 22.9805 21.0919 22.7339 21.1343 22.4343C21.252 21.6007 21.6372 20.822 22.2394 20.2198C22.9715 19.4877 23.9646 19.0764 25 19.0764C26.0354 19.0764 27.0285 19.4877 27.7606 20.2198C28.3628 20.822 28.748 21.6007 28.8657 22.4343C28.9081 22.7339 29.1494 22.9805 29.4521 22.9805Z" stroke="#E17100" stroke-width="2" mask="url(#path-12-inside-1_2401_1913)"></path><circle cx="24.3913" cy="21.9831" r="0.613932" fill="white"></circle><ellipse cx="26.0021" cy="24.2619" rx="0.283353" ry="0.283353" fill="white"></ellipse></svg>');function Ue(s,e){const t=Ce(e,"width",3,40),i=Ce(e,"height",3,40);var a=sl();R(()=>{se(a,"width",t()),se(a,"height",i())}),E(s,a)}var il=P('<div class="content svelte-1fxce1q"><h1 class="svelte-1fxce1q"> </h1> <div class="scores"><h2 class="svelte-1fxce1q"> </h2> <h2 class="svelte-1fxce1q"> </h2></div> <div class="hint svelte-1fxce1q"><h2 class="svelte-1fxce1q">Hint:</h2> <p>- Click on an Enemy to kill it</p> <p>- Click on a gray spot to build a Tower</p> <p>- Click on a Tower to upgrade</p> <div class="additional-hint svelte-1fxce1q"><div>Manage your resources carefully if you want to survive until the last wave!</div> <div class="cost svelte-1fxce1q"><div class="cost-item svelte-1fxce1q"><div>Upgrading towers costs 35</div> <div><!></div></div> <div class="cost-item svelte-1fxce1q"><div>Enemy click costs 5</div> <div><!></div></div></div></div></div> <!></div>');function ol(s,e){H(e,!0);const t=F(()=>L.get("stageManager"));Xs(()=>{M.reduceBgVolume()}),zo(()=>{M.restoreBgVolume()}),Ci(s,{children:(i,a)=>{var n=il(),l=_(n),c=_(l,!0);x(l);var m=k(l,2),b=_(m),f=_(b);x(b);var w=k(b,2),y=_(w);x(w),x(m);var u=k(m,2),v=k(_(u),8),d=k(_(v),2),A=_(d),T=k(_(A),2),B=_(T);Ue(B,{width:13,height:13}),x(T),x(A);var I=k(A,2),q=k(_(I),2),S=_(q);Ue(S,{width:13,height:13}),x(q),x(I),x(d),x(v),x(u);var D=k(u,2);fe(D,{get onclick(){return e.onRestart},text:"Restart"}),x(n),R(()=>{ne(c,o(t).stageResult==="win"?"You win!":"You lose!"),ne(f,`Enemies killed: ${pe.killsEnemy??""}`),ne(y,`Score: ${pe.score??""}`)}),O(1,n,()=>An,()=>({duration:500})),O(2,n,()=>ie,()=>({duration:300})),E(i,n)},$$slots:{default:!0}}),G()}function al(s){return s}function rl(s){const e=s-1;return e*e*e+1}function Zs(s){return Math.sin(-13*(s+1)*Math.PI/2)*Math.pow(2,-10*s)+1}var nl=P(`<div class="overlay svelte-thh9az"><div class="backdrop svelte-thh9az"></div> <div class="hud-container svelte-thh9az"><div class="content svelte-thh9az"><button class="close-btn svelte-thh9az">&times;</button> <div class="header-section svelte-thh9az"><h2 class="modal-header svelte-thh9az">Combat Manual</h2> <div class="decoration-bar svelte-thh9az"></div></div> <div class="scroll-content svelte-thh9az"><section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">üëë</span> Defend the Throne</h3> <p class="svelte-thh9az">Enemies will attack immediately. If your Throne is destroyed, it's Game Over!</p></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">‚öîÔ∏è</span> Combat Protocol</h3> <p class="svelte-thh9az"><strong class="svelte-thh9az">Click Enemies</strong> to neutralize them directly.</p> <div class="cost-row svelte-thh9az"><span>Cost: 5 <!></span> <span class="separator svelte-thh9az">|</span> <span>Reward: Gold <!></span></div></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">‚ùì</span> The "Chance" Event</h3> <p class="svelte-thh9az">Time dilates. A query appears. Your knowledge is your weapon.</p> <ul class="svelte-thh9az"><li class="good svelte-thh9az"><strong class="svelte-thh9az">Correct:</strong> +1 Build Point (Construct Defenses).</li> <li class="bad svelte-thh9az"><strong class="svelte-thh9az">Incorrect:</strong> Strike recorded. 3 Strikes = Tower Destruction.</li></ul></section> <section class="svelte-thh9az"><h3 class="svelte-thh9az"><span class="icon svelte-thh9az">üèóÔ∏è</span> Construction</h3> <div class="construction-grid svelte-thh9az"><div class="construction-item svelte-thh9az"><strong class="svelte-thh9az">Build</strong> <span>Click gray nodes.</span> <span class="highlight svelte-thh9az">Unlocks with Build Points</span></div> <div class="construction-item svelte-thh9az"><strong class="svelte-thh9az">Upgrade</strong> <span>Click towers.</span> <span class="highlight svelte-thh9az">Costs Gold + BP</span></div></div></section></div> <div class="footer svelte-thh9az"><!></div></div></div></div>`);function ll(s,e){var t=nl(),i=_(t),a=k(i,2),n=_(a),l=_(n);l.__click=function(...A){var T;(T=e.onClose)==null||T.apply(this,A)};var c=k(l,4),m=k(_(c),2),b=k(_(m),4),f=_(b),w=k(_(f));Ue(w,{width:12,height:12}),x(f);var y=k(f,4),u=k(_(y));Ue(u,{width:12,height:12}),x(y),x(b),x(m),pi(4),x(c);var v=k(c,2),d=_(v);fe(d,{text:"Initialize",get onclick(){return e.onClose}}),x(v),x(n),x(a),x(t),O(3,i,()=>ie,()=>({duration:500})),O(3,a,()=>$e,()=>({duration:600,start:.8,easing:Zs})),O(3,t,()=>ie,()=>({duration:200})),E(s,t)}qe(["click"]);var cl=P('<div class="content svelte-p6vcf4"><img alt="Knowledge Space" style="width: 80%; max-width: 500px;" class="svelte-p6vcf4"> <div class="star-container svelte-p6vcf4"><img alt="Shooting Star" class="shooting-star-art svelte-p6vcf4"></div> <div class="svelte-p6vcf4"><h2 class="svelte-p6vcf4">Hint:</h2> <p class="svelte-p6vcf4">- Click on an Enemy to kill it</p> <p class="svelte-p6vcf4">- Click on a gray spot to build a Tower</p> <p class="svelte-p6vcf4">- Click on a Tower to upgrade</p></div> <div class="buttons-container svelte-p6vcf4"><!> <div style="height: 10px;" class="svelte-p6vcf4"></div> <!></div></div>'),dl=P("<!> <!>",1);function ul(s,e){H(e,!0);let t=p(!1);const i=F(()=>M.preloaded?"Start game":`${M.preloadPercent}%`);var a=dl(),n=J(a);Ci(n,{children:(m,b)=>{var f=cl(),w=_(f);se(w,"src",`${ai??""}/logos/knowledge-space2.png`);var y=k(w,2),u=_(y);se(u,"src",`${ai??""}/enemies/enemies-riding-art.png`),x(y);var v=k(y,4),d=_(v),A=F(()=>!M.preloaded);fe(d,{get disabled(){return o(A)},get text(){return o(i)},get onclick(){return e.onStart}});var T=k(d,4);fe(T,{text:"How to Play",onclick:()=>g(t,!0)}),x(v),x(f),O(2,f,()=>ie,()=>({duration:300})),E(m,f)},$$slots:{default:!0}});var l=k(n,2);{var c=m=>{ll(m,{onClose:()=>g(t,!1)})};W(l,m=>{o(t)&&m(c)})}E(s,a),G()}class hl{constructor(){$(this,"filterEnemiesByBounds",e=>L.get("entityManager").livingEnemies.filter(i=>Ie(i.boundingBox,e)))}update(){const e=L.get("entityManager");this.handleEnemyCollisions(e.livingEnemies,e.livingProjectiles,e.throne),this.handleProjectileCollisions(e.livingProjectiles),this.handleLootCollisions(e.livingLoot,e.throne)}handleEnemyCollisions(e,t,i){for(const a of e){for(const n of t)this.checkCollision(n,a)&&(n.onCollide(a),a.onCollide(n));this.checkCollision(a,i)&&(a.onCollide(i),i.onCollide(a))}}handleProjectileCollisions(e){for(const t of e)if(!this.checkScreenBounds(t)){t.onCollide("OUT_OF_BOUNDS");continue}}handleLootCollisions(e,t){e.forEach(i=>{this.checkCollision(i,t)&&(i.onCollide(t),t.onCollide(i))})}checkCollision(e,t){return Ie(e.boundingBox,t.boundingBox)}checkBounds(e,t){return Ie(e.boundingBox,t)}checkScreenBounds(e){return Ie(e.boundingBox,j.screenBounds)}checkGameBounds(e){return Ie(e.boundingBox,j.gameBoundingBox)}}var wt,Is,js,Ls,$s,Rs,qs,Us,Ns,zs,Os;class ml{constructor(){h(this,wt,p([]));h(this,Is,F(()=>this.entities.filter(e=>e.type==="enemy")));h(this,js,F(()=>this.enemies.filter(e=>e.isInteractable)));h(this,Ls,F(()=>this.entities.filter(e=>e.type==="tower")));h(this,$s,F(()=>this.towers.filter((e,t)=>t<=1)));h(this,Rs,F(()=>this.towers.filter((e,t)=>t>=2)));h(this,qs,F(()=>this.entities.filter(e=>e.type==="projectile")));h(this,Us,F(()=>this.projectiles.filter(e=>e.isInteractable)));h(this,Ns,F(()=>this.entities.find(e=>e.type==="throne")));h(this,zs,F(()=>this.entities.filter(e=>e.type==="loot")));h(this,Os,F(()=>this.loot.filter(e=>e.isInteractable)));$(this,"update",e=>{this.entities.forEach(t=>t.update(e))});$(this,"reset",()=>{this.entities=[]});$(this,"add",e=>{this.entities=[...this.entities,...Array.isArray(e)?e:[e]]});$(this,"destroy",e=>{this.entities=this.entities.filter(t=>t.id!==e)});$(this,"getByName",e=>this.entities.find(t=>t.name===e));$(this,"getById",e=>this.entities.find(t=>t.id===e))}get entities(){return o(r(this,wt))}set entities(e){g(r(this,wt),e)}get enemies(){return o(r(this,Is))}get livingEnemies(){return o(r(this,js))}get towers(){return o(r(this,Ls))}get topTowers(){return o(r(this,$s))}get bottomTowers(){return o(r(this,Rs))}get projectiles(){return o(r(this,qs))}get livingProjectiles(){return o(r(this,Us))}get throne(){return o(r(this,Ns))}get loot(){return o(r(this,zs))}get livingLoot(){return o(r(this,Os))}filterByName(e){return this.entities.filter(t=>Array.isArray(e)?e.includes(t.name):t.name===e)}findNearestEntity(e,t){const i=t.filter(c=>c.isInteractable);if(i.length===0)return;const a=i.map(c=>e.position.distance(c.position)),n=Math.min(...a),l=a.indexOf(n);return i[l]}findNearestEntities(e,t,i=3){const a=t.filter(c=>c.isInteractable);if(a.length===0)return;const n=a.map(c=>({target:c,distance:e.position.distance(c.position)}));n.sort((c,m)=>c.distance-m.distance);const l=Math.min(i,n.length);return n.slice(0,l).map(c=>c.target)}findByPosition(e){const t=bi(e,100,100);return this.entities.filter(i=>Ie(i.boundingBox,t))}}wt=new WeakMap,Is=new WeakMap,js=new WeakMap,Ls=new WeakMap,$s=new WeakMap,Rs=new WeakMap,qs=new WeakMap,Us=new WeakMap,Ns=new WeakMap,zs=new WeakMap,Os=new WeakMap;const Co=[{commonEnemies:["PurpleCommon","YellowCommon"],time:6e4,eliteEnemies:["RedBlobElite"],spawnDelays:{common:900,elite:1400},statsAmplify:{health:1,speed:1,damage:1}},{commonEnemies:["YellowCommon","BlueCommon"],eliteEnemies:["GreenCircleElite","BlueCircleElite"],time:12e4,spawnDelays:{common:800,elite:1300},statsAmplify:{health:1.2,speed:1.2,damage:1.2}},{commonEnemies:["PurpleCommon","YellowCommon","BlueCommon"],eliteEnemies:["BlueBlobElite","GreenCircleElite","BlueCircleElite"],time:12e4,spawnDelays:{common:600,elite:1100},statsAmplify:{health:1.7,speed:1.4,damage:1.5}},{commonEnemies:["PurpleCommon","YellowCommon","BlueCommon"],eliteEnemies:["BlueCircleElite","GreenCircleElite","BlueBlobElite","RedBlobElite"],time:12e4,spawnDelays:{common:400,elite:800},statsAmplify:{health:2.2,speed:1.6,damage:1.8}}],Be=(s,e)=>{s.takeDamage(e.stats.damage)},ps=(s,e)=>{s.state.setState("Explode")},gl=(s,e)=>{e.type==="loot"?(pe.receiveLoot(1),M.play("pickUp")):e.type==="enemy"&&s.takeDamage(e.stats.damage)},ws=(s,e)=>{e.type==="enemy"&&(s.takeDamage(1),e.takeDamage(999))},vl=(s,e)=>{s.stopInteractions(),L.get("entityManager").destroy(s.id)},Xo={PurpleCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.6,stateToAnimation:{FollowThrone:"PurpleCommonFollow",Die:"PurpleCommonDie"},stats:{health:20,speed:.03,damage:5},onCollide:Be},YellowCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.8,stateToAnimation:{FollowThrone:"YellowCommonFollow",Die:"YellowCommonDie"},stats:{health:15,speed:.025,damage:4},onCollide:Be},BlueCommon:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.7,stateToAnimation:{FollowThrone:"BlueCommonFollow",Die:"BlueCommonDie"},stats:{health:25,speed:.02,damage:8},onCollide:Be},GreenCircleElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"GreenCircleEliteFollow",Die:"GreenCircleEliteDie"},stats:{health:80,speed:.01,damage:15},onCollide:Be},RedBlobElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:.8,stateToAnimation:{FollowThrone:"RedBlobEliteFollow",Die:"RedBlobEliteDie"},stats:{health:30,speed:.015,damage:10},onCollide:Be},BlueBlobElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"BlueBlobEliteFollow",Die:"BlueBlobEliteDie"},stats:{health:60,speed:.04,damage:8},onCollide:Be},BlueCircleElite:{type:"enemy",initialState:"FollowThrone",vfx:[],scale:1,stateToAnimation:{FollowThrone:"BlueCircleEliteFollow",Die:"BlueCircleEliteDie"},stats:{health:70,speed:.02,damage:10},onCollide:Be}},fl=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],pl=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],wl=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1}],yl=[s=>{},s=>{s.stats.attackSpeed-=50,s.stats.projectileNumber+=1},s=>{s.stats.attackSpeed-=30,s.stats.projectileNumber+=1}],ue={questionInterval:15e3,bulletTimeFactor:.05,questionDuration:1e4,maxStrikes:3,mainTowerHP:1e3,subTowerHP:3},ys={health:ue.subTowerHP,maxHealth:ue.subTowerHP,attackSpeed:800,projectileNumber:1},Ti={Throne:{type:"throne",stats:{health:ue.mainTowerHP,maxHealth:ue.mainTowerHP,damage:999,speed:0},scale:.6,stateToAnimation:{Idle:"Throne",Die:"ThroneDestroyed"},initialState:"Idle",onCollide:gl},FireTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"FireTowerBase0",Shoot:"FireTowerBase0",NotBuilt:"TowerBase",Upgrade:"FireTowerUpgrade0"},effects:[],stats:{...ys,projectileType:"Fireball"},scale:.8,upgrades:fl,onCollide:ws},ThunderTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"ThunderTowerBase0",Shoot:"ThunderTowerBase0",NotBuilt:"TowerBase",Upgrade:"ThunderTowerUpgrade0"},effects:[],stats:{...ys,attackSpeed:750,projectileType:"Thunderbolt"},scale:.8,upgrades:wl,onCollide:ws},PoisonTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"PoisonTowerBase0",Shoot:"PoisonTowerBase0",NotBuilt:"TowerBase",Upgrade:"PoisonTowerUpgrade0"},effects:[],stats:{...ys,projectileType:"Poisonball"},scale:.8,upgrades:pl,onCollide:ws},IceTower:{type:"tower",initialState:"NotBuilt",stateToAnimation:{Guard:"IceTowerBase0",Shoot:"IceTowerBase0",NotBuilt:"TowerBase",Upgrade:"IceTowerUpgrade0"},effects:[],stats:{...ys,attackSpeed:850,projectileType:"Icebolt"},scale:.8,upgrades:yl,onCollide:ws}},Zo={Fireball:{type:"projectile",width:20,height:22,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"FireballFollow",FollowAngle:"FireballFollow",Explode:"FireballDie"},scale:2,stats:{health:1,speed:.5,damage:11},onCollide:ps},Icebolt:{type:"projectile",width:10,height:27,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"IceboltFollow",FollowAngle:"IceboltFollow",Explode:"IceboltDie"},scale:2,stats:{health:1,speed:.3,damage:11},onCollide:ps},Poisonball:{type:"projectile",width:17,height:16,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"PoisonballFollow",FollowAngle:"PoisonballFollow",Explode:"PoisonballDie"},scale:2,stats:{health:1,speed:.4,damage:11},onCollide:ps},Thunderbolt:{type:"projectile",width:17,height:31,vfx:[],initialState:"FollowTarget",stateToAnimation:{FollowTarget:"ThunderboltFollow",FollowAngle:"ThunderboltFollow",Explode:"ThunderboltDie"},scale:2,stats:{health:1,speed:.4,damage:11},onCollide:ps},Loot:{type:"loot",vfx:[],width:14,height:19,initialState:"FollowTarget",stateToAnimation:{FollowTarget:"Loot"},scale:1,stats:{health:1,damage:0,speed:.5},onCollide:vl},ClickExplode:{type:"projectile",vfx:[],width:30,height:30,initialState:"Explode",stateToAnimation:{Explode:"Click"},scale:1,stats:{health:1,damage:10,speed:.5}}},ci={...Xo,...Ti,...Zo},To=Object.keys(Xo).length+Object.keys(Ti).length+Object.keys(Zo).length,xo=Object.keys(ci).length;if(To!==xo)throw new Error(`Entities defined and exported do not match. Check for duplicated Entity names : Total count: ${To} / Exported count ${xo}`);const bl=s=>{if(!ci[s])throw new Error(`Entity config not found for: ${s}`);return ci[s]};var yt;class le{constructor(e){h(this,yt,p());this.stateMachine=e}get stateMachine(){return o(r(this,yt))}set stateMachine(e){g(r(this,yt),C(e))}update(e,t){}get name(){return this.constructor.name}get entity(){return this.stateMachine.owner}}yt=new WeakMap;let Cl=class extends le{constructor(e){super(e),e.owner.stopInteractions(),this.entity.removeCollider()}update(){if(this.entity.animation.isComplete){const{entityManager:e,stageManager:t}=L.get(["entityManager","stageManager"]);e.destroy(this.entity.id),t.spawnLoot(this.entity)}}};class Tl extends le{constructor(){super(...arguments);$(this,"lastAngle",0)}update(t){this.follow(t)}follow(t){const{throne:i}=this.stateMachine.context;if(!i.width||i.position.x===0&&i.position.y===0)return;const a=i.position;this.entity.rotation=Vo(this.entity.position,a);const l=yi(this.entity.rotation).multiply(this.entity.stats.speed*t);this.entity.position=this.entity.position.add(l)}}const xl=Object.freeze(Object.defineProperty({__proto__:null,Die:Cl,FollowThrone:Tl},Symbol.toStringTag,{value:"Module"}));class _l extends le{constructor(){super(...arguments);$(this,"isSetup",!1)}update(t,i){this.isSetup||(j.isMobile?this.entity.position.y+=30:this.entity.position.y+=35,this.isSetup=!0)}}const Jo=s=>s===1?"1":s===2?"2":"0",Fl=(s,e)=>`${s.name}Upgrade${Jo(e)}`,_o=(s,e)=>`${s.name}Base${Jo(e)}`;class Bl extends le{constructor(e){super(e),this.entity.upgradeLevel+=1;const t=this.entity.upgrades[this.entity.upgradeLevel];t(this.entity),this.entity.animation.onFrameChange=i=>{},M.play("towerUpgrade")}update(e){this.entity.animation.isComplete&&(this.entity.stateToAnimation={...this.entity.stateToAnimation,Guard:_o(this.entity,this.entity.upgradeLevel),Shoot:_o(this.entity,this.entity.upgradeLevel),Upgrade:Fl(this.entity,this.entity.upgradeLevel+1)},this.entity.state.setState("Guard"),this.entity.animation.onFrameChange=()=>{})}}class Al extends le{constructor(e){super(e);const t=L.get("gameLoop"),i=this.entity.stats.attackSpeed;this.cdId=t.setCD(i,!0)}update(){const{entityManager:e,gameLoop:t}=L.get(["entityManager","gameLoop"]),i=e.findNearestEntity(this.entity,e.enemies);t.isCDReady(this.cdId)&&i&&this.stateMachine.setState("Shoot",{spawner:this.entity,target:i})}}class kl extends le{update(){this.shoot(),this.entity.addVFX("TowerShoot"),this.entity.state.setState("Guard")}shoot(){const e=L.get("stageManager"),{spawner:t}=this.stateMachine.context,i=t.stats.projectileType,a=this.entity.stats.projectileNumber,n=t.position.add(new te(t.width/2,0)),l=L.get("entityManager");l.findNearestEntities(t,l.enemies,a).forEach(m=>{e.spawnEntity(i,n,{spawner:t,target:m})}),M.play("towerShoot")}}const Sl=Object.freeze(Object.defineProperty({__proto__:null,Guard:Al,NotBuilt:_l,Shoot:kl,Upgrade:Bl},Symbol.toStringTag,{value:"Module"}));class El extends le{update(e){this.follow(e)}follow(e){const{angle:t}=this.stateMachine.context,a=yi(t).multiply(this.entity.stats.speed*e);this.entity.position=this.entity.position.add(a),this.entity.rotation=t*180/Math.PI+90}}class Ml extends le{constructor(){super(...arguments);$(this,"lastAngle",0);$(this,"rotationOffset",90)}update(t){const{target:i}=this.stateMachine.context;i!=null&&i.isInteractable?this.followTarget(t,i):this.stateMachine.setState("FollowAngle",{angle:this.lastAngle})}getTopMiddlePoint(t){return bi(t.position,t.width,t.height).topMiddle}followTarget(t,i){const a=this.entity.boundingBox.center;this.getTopMiddlePoint(i),this.lastAngle=Vo(a,i.boundingBox.center),this.entity.rotation=this.lastAngle*180/Math.PI+this.rotationOffset;const l=yi(this.lastAngle).multiply(this.entity.stats.speed*t);this.entity.position=this.entity.position.add(l)}}class Dl extends le{constructor(e){super(e),this.entity.removeCollider(),this.entity.width=30,this.entity.height=30,this.entity.animation.onFrameChange=t=>{this.entity.scale+=.5},e.owner.stopInteractions()}update(){(!this.entity.animation||this.entity.animation&&this.entity.animation.isComplete)&&(L.get("entityManager").destroy(this.entity.id),this.entity.animation.onFrameChange=()=>{})}}const Pl=Object.freeze(Object.defineProperty({__proto__:null,Explode:Dl,FollowAngle:El,FollowTarget:Ml},Symbol.toStringTag,{value:"Module"}));class Il extends le{constructor(){super(...arguments);$(this,"lastAnimName","")}update(t,i){if(!i||!i.stats)return;const a=i.stats.health/i.stats.maxHealth;let n="Throne";if(a<=0?n="ThroneDestroyed":a<.25?n="ThroneDamaged3":a<.5?n="ThroneDamaged2":a<.75&&(n="ThroneDamaged1"),i.animation&&i.animation.name!==n){this.lastAnimName&&this.lastAnimName!==n&&(i.removeVFX("Smoke"),i.addVFX("Smoke"),M.play("break"));const l=Le(n);i.animation=new wi(l),this.lastAnimName=n}else!this.lastAnimName&&i.animation&&(this.lastAnimName=i.animation.name)}}class jl extends le{constructor(e){super(e),this.entity.stopInteractions(),this.entity.addVFX("Explosion"),M.play("destruction"),setTimeout(()=>{L.get("stageManager").gameOver("lose")},2e3)}}const Ll=Object.freeze(Object.defineProperty({__proto__:null,Die:jl,Idle:Il},Symbol.toStringTag,{value:"Module"})),Fo=(s,e,t,i={})=>{let a={};e==="enemy"?a=xl:e==="tower"?a=Sl:["projectile","loot"].includes(e)?a=Pl:e==="throne"&&(a=Ll);const n=a[t];if(!n)throw new Error(`Invalid entity type: ${e} with name ${t}`);return new n(s,i)};var bt,Ct;class $l{constructor({owner:e,initialState:t,onEnter:i,context:a={}}){h(this,bt,p());h(this,Ct,p());this.owner=e,this.onEnter=i,this.context=a,this.onEnter(t),this.currentState=Fo(this,e.type,t,a)}get currentState(){return o(r(this,bt))}set currentState(e){g(r(this,bt),C(e))}get context(){return o(r(this,Ct))}set context(e){g(r(this,Ct),C(e))}update(e,t){this.currentState.update(e,this.owner,t)}setState(e,t={}){e!==this.currentState.name&&(this.onEnter(e),this.context={...this.context,...t},this.currentState=Fo(this,this.owner.type,e,t))}}bt=new WeakMap,Ct=new WeakMap;var Tt,xt,_t,Ft,Bt,At,kt,St,Et,Mt,Dt,Pt,It,jt,Lt,$t,Rt,qt,Ut,Hs;const Gs=class Gs{constructor(e,t,{offsetPosition:i,staticSlot:a,width:n,height:l,scale:c,rotation:m,type:b,states:f,initialState:w,onCollide:y,stats:u,upgradeLevel:v,upgrades:d,vfx:A,effects:T,stateToAnimation:B},I){$(this,"id");h(this,Tt,p(0));h(this,xt,p(0));h(this,_t,p(""));h(this,Ft,p(""));h(this,Bt,p(0));h(this,At,p(0));h(this,kt,p([]));h(this,St,p([]));h(this,Et,p());h(this,Mt,p());h(this,Dt,p());h(this,Pt,p(C({})));h(this,It,p(0));h(this,jt,p(1));h(this,Lt,p(1));h(this,$t,p(!0));h(this,Rt,p(C({})));h(this,qt,p(-1));h(this,Ut,p([]));h(this,Hs,F(()=>this.upgrades.length&&this.upgradeLevel<this.upgrades.length));$(this,"setPosition",e=>{this.position=e});this.id=Gs.lastId++,this.name=e,this.type=b,this.width=n,this.height=l,this.scale=c||1,this.rotation=m||0,this.position=t,this.offsetPosition=i||null,this.staticSlot=a||null,this.stats={...u},this.upgradeLevel=v||-1,this.upgrades=d||[],this.vfx=A||[],this.effects=T||[],this.stateToAnimation=B||{},this.onCollide=S=>y(this,S);const q=S=>{this.stateToAnimation[S]&&this.setAnimation(S)};this.state=new $l({owner:this,states:f,initialState:w,onEnter:q,context:I})}get x(){return o(r(this,Tt))}set x(e){g(r(this,Tt),C(e))}get y(){return o(r(this,xt))}set y(e){g(r(this,xt),C(e))}get name(){return o(r(this,_t))}set name(e){g(r(this,_t),C(e))}get type(){return o(r(this,Ft))}set type(e){g(r(this,Ft),C(e))}get width(){return o(r(this,Bt))}set width(e){g(r(this,Bt),C(e))}get height(){return o(r(this,At))}set height(e){g(r(this,At),C(e))}get effects(){return o(r(this,kt))}set effects(e){g(r(this,kt),e)}get vfx(){return o(r(this,St))}set vfx(e){g(r(this,St),e)}get animation(){return o(r(this,Et))}set animation(e){g(r(this,Et),e)}get position(){return o(r(this,Mt))}set position(e){g(r(this,Mt),C(e))}get state(){return o(r(this,Dt))}set state(e){g(r(this,Dt),C(e))}get stats(){return o(r(this,Pt))}set stats(e){g(r(this,Pt),C(e))}get rotation(){return o(r(this,It))}set rotation(e){g(r(this,It),C(e))}get scale(){return o(r(this,jt))}set scale(e){g(r(this,jt),C(e))}get opacity(){return o(r(this,Lt))}set opacity(e){g(r(this,Lt),C(e))}get isInteractable(){return o(r(this,$t))}set isInteractable(e){g(r(this,$t),C(e))}get stateToAnimation(){return o(r(this,Rt))}set stateToAnimation(e){g(r(this,Rt),C(e))}get upgradeLevel(){return o(r(this,qt))}set upgradeLevel(e){g(r(this,qt),C(e))}get upgrades(){return o(r(this,Ut))}set upgrades(e){g(r(this,Ut),e)}get isUpgradable(){return o(r(this,Hs))}get boundingBox(){const e=this.position.x,t=this.position.y,i=this.position.x+this.width,a=this.position.y+this.height;return{x1:e,y1:t,x2:i,y2:a,center:new te(e+this.width/2,t+this.height/2),topMiddle:new te(e+this.width/2,a)}}update(e){this.isDestroyed||(this.state.update(e),this.effects.forEach(t=>{t(this)}),this.animation&&this.animation.update(e))}setAnimation(e){const t=this.stateToAnimation[e],i=Le(t);this.animation=new wi({...i,name:t})}addEffect(e){this.effects.includes(e)||(this.effects=[...this.effects,e])}removeEffect(e){this.effects=this.effects.filter(t=>t!==e)}cleanEffects(){this.effects=[]}addVFX(e){this.vfx.includes(e)||(this.vfx=[...this.vfx,e])}removeVFX(e){this.vfx=this.vfx.filter(t=>t!==e)}cleanVFX(){this.vfx=[]}takeDamage(e){this.stats.health-=e,this.stats.health<=0&&this.state.setState("Die")}stopInteractions(){this.isInteractable=!1}removeCollider(){this.onCollide=()=>{}}};Tt=new WeakMap,xt=new WeakMap,_t=new WeakMap,Ft=new WeakMap,Bt=new WeakMap,At=new WeakMap,kt=new WeakMap,St=new WeakMap,Et=new WeakMap,Mt=new WeakMap,Dt=new WeakMap,Pt=new WeakMap,It=new WeakMap,jt=new WeakMap,Lt=new WeakMap,$t=new WeakMap,Rt=new WeakMap,qt=new WeakMap,Ut=new WeakMap,Hs=new WeakMap,$(Gs,"lastId",0);let di=Gs;const Rl=(s,e,t={})=>{const{context:i={},...a}=bl(s),{initialState:n,...l}=t;return n&&(a.initialState=n),new di(s,e.clone(),a,{...i,...l})},ql=F(()=>({top:[{x:j.width*.1,y:20},{x:j.width*.3,y:20},{x:j.width*.5,y:20},{x:j.width*.7,y:20},{x:j.width*.9,y:20}],bottom:[{x:j.width*.1,y:j.height-20},{x:j.width*.3,y:j.height-20},{x:j.width*.5,y:j.height-20},{x:j.width*.7,y:j.height-20},{x:j.width*.9,y:j.height-20}],left:[{x:20,y:j.height*.1},{x:20,y:j.height*.3},{x:20,y:j.height*.5},{x:20,y:j.height*.7},{x:20,y:j.height*.9}],right:[{x:j.width-20,y:j.height*.1},{x:j.width-20,y:j.height*.3},{x:j.width-20,y:j.height*.5},{x:j.width-20,y:j.height*.7},{x:j.width-20,y:j.height*.9}]})),Ul=()=>{const s=j.isMobile?["top","bottom"]:["top","bottom","left","right"],e=s[Math.floor(Math.random()*s.length)],t=o(ql)[e];return t[Math.floor(Math.random()*t.length)]},Nl=s=>s[Math.floor(Math.random()*s.length)];var Nt,Ys,zt,Ot;class zl{constructor(){h(this,Nt,p(0));h(this,Ys,F(()=>Co[this.stageNumber]));h(this,zt,p(0));$(this,"commonSpawnCd");$(this,"eliteSpawnCd");h(this,Ot,p(""));$(this,"init",()=>{const e=L.get("gameLoop");this.commonSpawnCd=e.setCD(this.stageConfig.spawnDelays.common,!0),this.eliteSpawnCd=e.setCD(this.stageConfig.spawnDelays.elite,!0),this.spawnTowers(),this.spawnEntity("Throne",new te(0,0))});$(this,"update",e=>{const t=L.get("gameLoop");t.isCDReady(this.commonSpawnCd)&&this.spawnEnemy("common"),t.isCDReady(this.eliteSpawnCd)&&this.spawnEnemy("elite"),this.checkStageTime()});$(this,"spawnEntity",(e,t,i={})=>{const a=L.get("entityManager"),n=Rl(e,t,i);return a.add(n),n})}get stageNumber(){return o(r(this,Nt))}set stageNumber(e){g(r(this,Nt),C(e))}get stageConfig(){return o(r(this,Ys))}get stageStartTime(){return o(r(this,zt))}set stageStartTime(e){g(r(this,zt),C(e))}get stageResult(){return o(r(this,Ot))}set stageResult(e){g(r(this,Ot),C(e))}reset(){this.commonSpawnCd=null,this.eliteSpawnCd=null,this.stageNumber=0,this.stageResult="",this.init()}spawnTowers(){["IceTower","FireTower","PoisonTower","ThunderTower"].forEach((e,t)=>{this.spawnEntity(e,new te(0,0))})}apllyAmlify(e){const{statsAmplify:t}=this.stageConfig;e.stats.health*=t.health,e.stats.damage*=t.damage,e.stats.speed*=t.speed}spawnEnemy(e){const t=L.get("entityManager"),i=e==="common"?this.stageConfig.commonEnemies:this.stageConfig.eliteEnemies,a=Nl(i),n=Ul(),l=new te(n.x,n.y),c=this.spawnEntity(a,l,{throne:t.throne});return this.apllyAmlify(c),c}spawnLoot(e){const i=L.get("entityManager").throne;this.spawnEntity("Loot",e.boundingBox.center,{target:i})}gameOver(e){this.stageResult=e,L.get("gameLoop").pause()}checkStageTime(){const e=L.get("gameLoop");this.stageStartTime+this.stageConfig.time<e.elapsedTime&&this.nextStage()}nextStage(){if(this.stageNumber<Co.length-1){const e=L.get("gameLoop");this.stageNumber++,this.stageStartTime=e.elapsedTime,this.commonSpawnCd=e.setCD(this.stageConfig.spawnDelays.common,!0),this.eliteSpawnCd=e.setCD(this.stageConfig.spawnDelays.elite,!0)}else this.gameOver("win")}}Nt=new WeakMap,Ys=new WeakMap,zt=new WeakMap,Ot=new WeakMap;const oi=16.666;var Ht,Gt,Yt,Wt,Qt,Vt;const Ws=class Ws{constructor(){h(this,Ht,p(C(performance.now())));h(this,Gt,p(0));h(this,Yt,p(0));h(this,Wt,p(1));h(this,Qt,p(null));$(this,"isStopped",!1);h(this,Vt,p(C({})));this.loop=this.loop.bind(this),this.previousTime=0,this.elapsedTime=0,this.accumulator=0}get previousTime(){return o(r(this,Ht))}set previousTime(e){g(r(this,Ht),C(e))}get accumulator(){return o(r(this,Gt))}set accumulator(e){g(r(this,Gt),C(e))}get elapsedTime(){return o(r(this,Yt))}set elapsedTime(e){g(r(this,Yt),C(e))}get timeScale(){return o(r(this,Wt))}set timeScale(e){g(r(this,Wt),C(e))}get pauseState(){return o(r(this,Qt))}set pauseState(e){g(r(this,Qt),C(e))}get cooldowns(){return o(r(this,Vt))}set cooldowns(e){g(r(this,Vt),C(e))}get elapsedInSeconds(){return this.elapsedTime/1e3}start(e){this.isStopped=!1,this.pauseState=null,this.timeScale=1,this.update=e,this.previousTime=performance.now(),requestAnimationFrame(this.loop)}stop(){this.isStopped=!0,this.pauseState=null}reset(){this.previousTime=0,this.elapsedTime=0,this.accumulator=0}loop(e){if(this.isStopped)return;if(this.pauseState){this.previousTime=e,requestAnimationFrame(this.loop);return}let t=e-this.previousTime;for(t>250&&(t=250),this.previousTime=e,this.accumulator+=t*this.timeScale,this.elapsedTime+=t*this.timeScale;this.accumulator>=oi;)this.update(oi),this.accumulator-=oi;requestAnimationFrame(this.loop)}setCD(e,t=!1){const i=Ws.lastCDId++;return this.cooldowns[i]={waitTime:e,isInfinite:t,startTime:this.elapsedTime},i}isCDReady(e){const t=this.cooldowns[e];return!t||this.pauseState||this.elapsedTime-t.startTime<=t.waitTime?!1:t.isInfinite?(this.cooldowns[e]={...t,startTime:this.elapsedTime},!0):(delete this.cooldowns[e],!0)}pause(){this.pauseState?this.resume():this.pauseState={pausedTime:this.elapsedTime}}resume(){if(!this.pauseState)return;const e=performance.now();this.previousTime=e,this.pauseState=null}};Ht=new WeakMap,Gt=new WeakMap,Yt=new WeakMap,Wt=new WeakMap,Qt=new WeakMap,Vt=new WeakMap,$(Ws,"lastCDId",0);let ui=Ws;const Ol=[{id:"q1",question:"What is the capital of France?",options:["London","Berlin","Paris","Madrid"],correctIndex:2,meta:{subject:"Geography",level:"Easy"}},{id:"q2",question:"What is 12 * 12?",options:["122","144","124","148"],correctIndex:1,meta:{subject:"Math",level:"Medium"}},{id:"q3",question:"Which planet is known as the Red Planet?",options:["Earth","Mars","Jupiter","Venus"],correctIndex:1,meta:{subject:"Astronomy",level:"Easy"}},{id:"q4",question:"What is the chemical symbol for Gold?",options:["Au","Ag","Fe","Cu"],correctIndex:0,meta:{subject:"Chemistry",level:"Medium"}},{id:"q5",question:"Who wrote 'Romeo and Juliet'?",options:["Charles Dickens","William Shakespeare","Mark Twain","Jane Austen"],correctIndex:1,meta:{subject:"Literature",level:"Easy"}},{id:"q6",question:"What is the square root of 64?",options:["6","7","8","9"],correctIndex:2,meta:{subject:"Math",level:"Easy"}},{id:"q7",question:"Physics: What is the unit of force?",options:["Joule","Watt","Newton","Pascal"],correctIndex:2,meta:{subject:"Physics",level:"Medium"}},{id:"q8",question:"Which element has the atomic number 1?",options:["Helium","Hydrogen","Lithium","Carbon"],correctIndex:1,meta:{subject:"Chemistry",level:"Easy"}},{id:"q9",question:"What year did World War II end?",options:["1942","1945","1948","1950"],correctIndex:1,meta:{subject:"History",level:"Hard"}},{id:"q10",question:"What is the largest ocean on Earth?",options:["Atlantic","Indian","Arctic","Pacific"],correctIndex:3,meta:{subject:"Geography",level:"Medium"}}];var Xt,Zt,Jt,Kt,es,ts,ss,is,os,as;class Ko{constructor(){h(this,Xt,p(C(Ol)));h(this,Zt,p(null));h(this,Jt,p(!1));h(this,Kt,p(1));h(this,es,p(0));h(this,ts,p(0));h(this,ss,p(0));h(this,is,p(0));h(this,os,p(0));h(this,as,p(!1));this.reset()}get questions(){return o(r(this,Xt))}set questions(e){g(r(this,Xt),C(e))}get currentQuestion(){return o(r(this,Zt))}set currentQuestion(e){g(r(this,Zt),C(e))}get isActive(){return o(r(this,Jt))}set isActive(e){g(r(this,Jt),C(e))}get timeScale(){return o(r(this,Kt))}set timeScale(e){g(r(this,Kt),C(e))}get timer(){return o(r(this,es))}set timer(e){g(r(this,es),C(e))}get strikes(){return o(r(this,ts))}set strikes(e){g(r(this,ts),C(e))}get gameTimeSinceLastQuestion(){return o(r(this,ss))}set gameTimeSinceLastQuestion(e){g(r(this,ss),C(e))}get buildPoints(){return o(r(this,is))}set buildPoints(e){g(r(this,is),C(e))}get wrongAnswerTrigger(){return o(r(this,os))}set wrongAnswerTrigger(e){g(r(this,os),C(e))}get distortedAudio(){return o(r(this,as))}set distortedAudio(e){g(r(this,as),C(e))}reset(){this.isActive=!1,this.timeScale=1,this.strikes=0,this.buildPoints=0,this.gameTimeSinceLastQuestion=ue.questionInterval*.75,this.currentQuestion=null}update(e){if(!this.isActive)this.gameTimeSinceLastQuestion+=e,this.gameTimeSinceLastQuestion>=ue.questionInterval&&this.triggerQuestion();else{const t=e/this.timeScale;this.timer-=t,this.timer<=0&&this.handleTimeout()}}triggerQuestion(){const e=Math.floor(Math.random()*this.questions.length);this.currentQuestion=this.questions[e],this.isActive=!0,this.timeScale=ue.bulletTimeFactor,L.get("gameLoop").timeScale=this.timeScale,this.timer=ue.questionDuration,this.gameTimeSinceLastQuestion=0,this.distortedAudio=!0,M.setDistortion(!0)}answer(e){if(!this.currentQuestion)return;e===this.currentQuestion.correctIndex?this.handleCorrect():this.handleIncorrect(),this.closeQuestion()}handleCorrect(){if(this.buildPoints>=8){console.log("Correct! Max Points Reached -> +10 Gold");const e=L.get("lootTracker");e&&e.receiveLoot(10),M.play("towerUpgrade")}else console.log("Correct! +1 Build Point"),this.buildPoints++,M.play("towerUpgrade")}handleIncorrect(){console.log("Wrong!"),this.wrongAnswerTrigger++,M.play("lowResourse"),this.strikes++,this.strikes>=ue.maxStrikes&&(this.punishPlayer(),this.strikes=0)}handleTimeout(){this.handleIncorrect(),this.closeQuestion()}punishPlayer(){var a,n;console.log("PUNISHMENT: Destroying Tower");const{entityManager:e}=L.get(["entityManager"]),i=e.towers.filter(l=>l.state.currentState!=="NotBuilt"&&l.type!=="throne");if(i.length>0){const l=i[0];console.log(`Destroying tower: ${l.name}`);const c=Ti[l.name];c&&(l.stats={...c.stats},l.stateToAnimation={...c.stateToAnimation}),l.upgradeLevel=-1,l.state.setState("NotBuilt");const m=L.get("particleManager"),b=((a=l.position)==null?void 0:a.x)??l.x,f=((n=l.position)==null?void 0:n.y)??l.y;m&&m.spawnExplosion(b+l.width/2,f+l.height/2,"#ff0000",30)}}closeQuestion(){this.isActive=!1,this.timeScale=1,L.get("gameLoop").timeScale=1,this.currentQuestion=null,this.distortedAudio=!1,M.setDistortion(!1)}}Xt=new WeakMap,Zt=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,es=new WeakMap,ts=new WeakMap,ss=new WeakMap,is=new WeakMap,os=new WeakMap,as=new WeakMap;new Ko;var rs,ns,ls,cs,ds,us,hs;class Hl{constructor(e,t,i){h(this,rs,p(0));h(this,ns,p(0));h(this,ls,p(0));h(this,cs,p(0));h(this,ds,p(1));h(this,us,p("#ff0000"));h(this,hs,p(5));$(this,"decay",.05);this.x=e,this.y=t,this.color=i;const a=Math.random()*Math.PI*2,n=Math.random()*5+2;this.vx=Math.cos(a)*n,this.vy=Math.sin(a)*n,this.size=Math.random()*6+4,this.decay=Math.random()*.03+.02}get x(){return o(r(this,rs))}set x(e){g(r(this,rs),C(e))}get y(){return o(r(this,ns))}set y(e){g(r(this,ns),C(e))}get vx(){return o(r(this,ls))}set vx(e){g(r(this,ls),C(e))}get vy(){return o(r(this,cs))}set vy(e){g(r(this,cs),C(e))}get life(){return o(r(this,ds))}set life(e){g(r(this,ds),C(e))}get color(){return o(r(this,us))}set color(e){g(r(this,us),C(e))}get size(){return o(r(this,hs))}set size(e){g(r(this,hs),C(e))}update(e){this.x+=this.vx,this.y+=this.vy,this.life-=this.decay,this.size*=.95}}rs=new WeakMap,ns=new WeakMap,ls=new WeakMap,cs=new WeakMap,ds=new WeakMap,us=new WeakMap,hs=new WeakMap;var ms;class Gl{constructor(){h(this,ms,p(C([])))}get particles(){return o(r(this,ms))}set particles(e){g(r(this,ms),C(e))}update(e){this.particles=this.particles.filter(t=>t.life>0);for(const t of this.particles)t.update(e)}spawnExplosion(e,t,i="#ff4400",a=10){for(let n=0;n<a;n++)this.particles.push(new Hl(e,t,i))}}ms=new WeakMap;var gs;class Yl{constructor(){h(this,gs,p(!1));$(this,"update",async e=>{L.update(e),Z.update(e)});$(this,"start",async()=>{L.setup(Wl());const{gameLoop:e,stageManager:t,questionManager:i}=L.get(["gameLoop","stageManager","questionManager"]);t.init(),i.reset(),e.start(this.update),M.play("bgSound"),this.isStarted=!0});$(this,"restart",()=>{const{entityManager:e,gameLoop:t,stageManager:i,questionManager:a}=L.get(["entityManager","gameLoop","stageManager","questionManager"]);t.reset(),e.reset(),i.reset(),M.reset(),pe.reset(),a.reset(),t.resume()});$(this,"cleanup",async()=>{if(this.isStarted){M.pause("bgSound");try{const e=L.get("gameLoop");e&&e.stop()}catch{}this.isStarted=!1}})}get isStarted(){return o(r(this,gs))}set isStarted(e){g(r(this,gs),C(e))}}gs=new WeakMap;const Wl=()=>({collisionManager:new hl,entityManager:new ml,gameLoop:new ui,stageManager:new zl,questionManager:new Ko,particleManager:new Gl}),ae=new Yl,Ql=()=>{M.toggleMute()};var Vl=Qs('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zm-4 0h-2.5l-5 5H1.5v7.5h5l5 5v-17.5zM16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"></path></svg>'),Xl=Qs('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></svg>'),Zl=P('<div class="content svelte-2dge9i"><div class="title svelte-2dge9i"><h1 class="svelte-2dge9i">Paused</h1></div> <div class="buttons-container svelte-2dge9i"><!> <!> <!></div></div>'),Jl=P('<div class="confirm-overlay svelte-2dge9i"><div class="backdrop svelte-2dge9i"></div> <div class="confirm-box svelte-2dge9i"><div class="confirm-headers svelte-2dge9i"><h2 class="confirm-title svelte-2dge9i">Exit Protocol</h2> <div class="decoration-bar svelte-2dge9i"></div></div> <div class="confirm-body svelte-2dge9i"><p>Are you sure you want to abort mission?</p> <p class="warning svelte-2dge9i">Current progress will be lost.</p></div> <div class="confirm-actions svelte-2dge9i"><!> <!></div></div></div>'),Kl=P('<div class="pause-overlay svelte-2dge9i"><button class="sound-toggle svelte-2dge9i"><!></button> <!> <!></div>');function ec(s,e){H(e,!0);let t=p(!1);const i=async()=>{ae.cleanup?await ae.cleanup():ae.isStarted=!1,g(t,!1)};Xs(()=>{M.reduceBgVolume()}),zo(()=>{M.restoreBgVolume()});var a=Kl(),n=_(a);n.__click=[Ql];var l=_(n);{var c=y=>{var u=Vl();E(y,u)},m=y=>{var u=Xl();E(y,u)};W(l,y=>{M.isMuted?y(m,!1):y(c)})}x(n);var b=k(n,2);Ci(b,{children:(y,u)=>{var v=Zl(),d=k(_(v),2),A=_(d);fe(A,{text:"Resume Game",get onclick(){return e.onResume}});var T=k(A,2);fe(T,{text:"Restart Game",get onclick(){return e.onRestart}});var B=k(T,2);fe(B,{text:"Exit to Menu",onclick:()=>g(t,!0)}),x(d),x(v),E(y,v)},$$slots:{default:!0}});var f=k(b,2);{var w=y=>{var u=Jl(),v=k(_(u),2),d=k(_(v),4),A=_(d);fe(A,{text:"Yes",onclick:i});var T=k(A,2);fe(T,{text:"No",onclick:()=>g(t,!1)}),x(d),x(v),x(u),O(3,v,()=>$e,()=>({duration:400,start:.8,easing:Zs})),O(3,u,()=>ie,()=>({duration:200})),E(y,u)};W(f,y=>{o(t)&&y(w)})}x(a),R(()=>{se(n,"aria-label",M.isMuted?"Unmute":"Mute"),se(n,"title",M.isMuted?"Unmute":"Mute")}),E(s,a),G()}qe(["click"]);var tc=P('<div class="bg-container svelte-11qp6pd"><div class="gradient-bg svelte-11qp6pd">‚Ä¶</div> <div class="stars svelte-11qp6pd"></div></div>');function Bo(s){var e=tc();E(s,e)}var sc=P('<div class="bg-container svelte-1hdxkm"><div class="gradient-bg svelte-1hdxkm"></div> <div class="aurora svelte-1hdxkm"></div> <div class="stars svelte-1hdxkm"></div></div>');function ic(s){var e=sc();E(s,e)}var oc=P('<div class="bg-container svelte-7703io"><div class="gradient-bg svelte-7703io"></div> <div class="stars svelte-7703io"></div></div>');function ac(s){var e=oc();E(s,e)}var rc=P('<div class="bg-container svelte-10mh7j2"><div class="quantum-base svelte-10mh7j2"></div> <div class="energy-fields svelte-10mh7j2"></div> <div class="quantum-grid svelte-10mh7j2"></div> <div class="stars svelte-10mh7j2"></div></div>');function nc(s){var e=rc();E(s,e)}var lc=P('<div class="background-container svelte-5o0ex9"><!></div>');function cc(s,e){const t=[Bo,ic,ac,nc];let i=F(()=>t[e.stageNumber]||Bo);var a=he(),n=J(a);ri(n,()=>e.stageNumber,l=>{var c=lc(),m=_(c);ja(m,()=>o(i),(b,f)=>{f(b,{})}),x(c),O(1,c,()=>ie,()=>({duration:400})),O(2,c,()=>ie,()=>({duration:300})),E(l,c)}),E(s,a)}var dc=P('<div class="loot svelte-bipu4"><!> <span class="svelte-bipu4"> </span></div>');function uc(s,e){H(e,!0);let t=F(()=>pe.playLowLootAnimation);var i=dc();const a=F(()=>Z.get("arrow"));R(()=>U(i,"cursor",o(a)));var n=_(i);Ue(n,{});var l=k(n,2);const c=F(()=>Z.get("arrow"));R(()=>U(l,"cursor",o(c)));var m=_(l,!0);x(l),x(i),R(()=>{ke(i,"isAnimated",o(t)),ne(m,pe.collectedLoot)}),Re("animationend",i,b=>{pe.unsetAnimation("LowLoot")}),E(s,i),G()}var hc=Qs('<svg width="54" height="54" viewBox="0 0 54 54" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="path-1-outside-1_0_1" maskUnits="userSpaceOnUse" x="0" y="0" width="54" height="54" fill="black"><rect fill="white" width="54" height="54"></rect><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z"></path></mask><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z" fill="#D685DA"></path><path d="M50.0898 37.7747C50.35 37.8961 50.66 37.7837 50.7762 37.5211C53.2068 32.0286 53.6627 25.8578 52.0564 20.0591C50.4038 14.0933 46.6768 8.91281 41.5457 5.44952C36.4146 1.98623 30.2161 0.467392 24.0651 1.16617C17.9142 1.86495 12.2144 4.7355 7.99089 9.26151C3.76741 13.7875 1.29741 19.672 1.02516 25.8565C0.7529 32.0411 2.69625 38.1198 6.50568 42.9995C10.3151 47.8791 15.7406 51.2394 21.8064 52.476C27.7021 53.6779 33.8267 52.7968 39.1382 49.9927C39.3922 49.8586 39.4829 49.5416 39.3438 49.2904C39.2047 49.0392 38.8884 48.9488 38.6343 49.0827C33.5395 51.767 27.6672 52.6094 22.0141 51.457C16.191 50.2698 10.9825 47.0439 7.32545 42.3595C3.6684 37.675 1.80279 31.8394 2.06415 25.9023C2.32552 19.9651 4.69671 14.316 8.75126 9.97105C12.8058 5.62608 18.2776 2.87036 24.1825 2.19953C30.0875 1.5287 36.038 2.98679 40.9639 6.31154C45.8897 9.6363 49.4677 14.6095 51.0542 20.3368C52.5943 25.8968 52.1595 31.8132 49.8335 37.0813C49.7175 37.344 49.8295 37.6532 50.0898 37.7747Z" stroke="white" stroke-width="2" mask="url(#path-1-outside-1_0_1)"></path><circle cx="27" cy="27" r="16.5" fill="#D685DA" stroke="white"></circle><circle cx="45" cy="44" r="4.5" fill="#D685DA" stroke="white"></circle><rect x="20.5" y="20.5" width="5" height="13" rx="2.5" fill="#FFDFFC" stroke="white"></rect><rect x="28.5" y="20.5" width="5" height="13" rx="2.5" fill="#FFDFFC" stroke="white"></rect></svg>');function mc(s){var e=hc();E(s,e)}function Ao(s){return Object.prototype.toString.call(s)==="[object Date]"}function hi(s,e){if(s===e||s!==s)return()=>s;const t=typeof s;if(t!==typeof e||Array.isArray(s)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(s)){const i=e.map((a,n)=>hi(s[n],a));return a=>i.map(n=>n(a))}if(t==="object"){if(!s||!e)throw new Error("Object cannot be null");if(Ao(s)&&Ao(e)){const n=s.getTime(),c=e.getTime()-n;return m=>new Date(n+m*c)}const i=Object.keys(e),a={};return i.forEach(n=>{a[n]=hi(s[n],e[n])}),n=>{const l={};return i.forEach(c=>{l[c]=a[c](n)}),l}}if(t==="number"){const i=e-s;return a=>s+a*i}throw new Error(`Cannot interpolate ${t} values`)}function gc(s,e={}){const t=Ra(s);let i,a=s;function n(l,c){if(a=l,s==null)return t.set(s=l),Promise.resolve();let m=i,b=!1,{delay:f=0,duration:w=400,easing:y=al,interpolate:u=hi}={...e,...c};if(w===0)return m&&(m.abort(),m=null),t.set(s=a),Promise.resolve();const v=de.now()+f;let d;return i=Yo(A=>{if(A<v)return!0;b||(d=u(s,l),typeof w=="function"&&(w=w(s,l)),b=!0),m&&(m.abort(),m=null);const T=A-v;return T>w?(t.set(s=l),!1):(t.set(s=d(y(T/w))),!0)}),i.promise}return{set:n,update:(l,c)=>n(l(a,s),c),subscribe:t.subscribe}}var vc=P('<div class="video-container svelte-bkv8uq"><video autoplay playsinline="" class="star-video svelte-bkv8uq"><track kind="captions" class="svelte-bkv8uq"></video></div>',2),fc=P('<div class="meta-tag svelte-bkv8uq"><span class="meta-label svelte-bkv8uq">Subject:</span> <span class="meta-separator svelte-bkv8uq">|</span> <span class="meta-label svelte-bkv8uq">Level:</span> </div>'),pc=P('<button class="sci-fi-btn svelte-bkv8uq"><span class="btn-text svelte-bkv8uq"> </span></button>'),wc=P("<div></div>"),yc=P('<div class="hud-container svelte-bkv8uq"><div class="content svelte-bkv8uq"><div class="header-section svelte-bkv8uq"><h2 class="question-header svelte-bkv8uq">Incoming Transmission</h2> <div class="timer-container svelte-bkv8uq"><div class="timer-bar svelte-bkv8uq"></div></div></div> <div class="question-box svelte-bkv8uq"><p class="question-text svelte-bkv8uq"> </p> <!></div> <div class="options-grid svelte-bkv8uq"></div> <div class="footer-section svelte-bkv8uq"><div class="status-indicator svelte-bkv8uq"><span class="status-label svelte-bkv8uq">Strikes</span> <div class="strikes-container svelte-bkv8uq"></div></div></div></div></div>'),bc=P('<div class="overlay svelte-bkv8uq"><div class="backdrop svelte-bkv8uq"></div> <!> <!></div>');function Cc(s,e){H(e,!0);const t=La(),i=()=>$a(l,"$progress",t),a=F(()=>L.get("questionManager")),n=F(()=>{var v;return(v=o(a))==null?void 0:v.currentQuestion}),l=gc(100,{duration:400,easing:rl});let c=p("idle"),m=p(!1);Se(()=>{if(o(a)&&o(a).isActive){if(l.set(o(a).timer/1e4*100),o(c)==="idle"){g(c,"incoming"),g(m,!1),M!=null&&M.preloaded&&M.play("shine");const v=1600,d=1900;setTimeout(()=>{g(c,"impact"),M!=null&&M.preloaded&&M.play("magicBurst")},v),setTimeout(()=>{g(c,"active")},d)}}else l.set(100,{duration:0}),g(c,"idle")});const b=F(()=>i()<30?"#ff3333":"#d685da");function f(v){M!=null&&M.preloaded&&M.play("clickMenu",!0),o(a).answer(v)}var w=he(),y=J(w);{var u=v=>{var d=bc(),A=_(d),T=k(A,2);{var B=S=>{var D=he(),Q=J(D);{var N=Y=>{var z=vc(),K=_(z);R(()=>se(K,"src",X("/videos/star-video.mp4"))),K.muted=!0,x(z),R(()=>ke(K,"visible",o(m))),Re("canplay",K,()=>g(m,!0)),O(2,z,()=>ie,()=>({duration:500})),E(Y,z)};W(Q,Y=>{Y(N)})}E(S,D)};W(T,S=>{(o(c)==="incoming"||o(c)==="impact")&&S(B)})}var I=k(T,2);{var q=S=>{var D=yc(),Q=_(D),N=_(Q),Y=k(_(N),2),z=_(Y);x(Y),x(N);var K=k(N,2),V=_(K),oe=_(V,!0);x(V);var Te=k(V,2);{var xe=ge=>{var Ee=fc(),Me=k(_(Ee)),ce=k(Me,4);x(Ee),R(()=>{ne(Me,` ${o(n).meta.subject??""} `),ne(ce,` ${o(n).meta.level??""}`)}),E(ge,Ee)};W(Te,ge=>{o(n).meta&&ge(xe)})}x(K);var we=k(K,2);re(we,21,()=>o(n).options,xs,(ge,Ee,Me)=>{var ce=pc();ce.__click=()=>f(Me);const ea=F(()=>Z.get("arrow"));R(()=>U(ce,"cursor",o(ea)));var xi=_(ce),ta=_(xi,!0);x(xi),x(ce),R(()=>ne(ta,o(Ee))),E(ge,ce)}),x(we);var _e=k(we,2),Fe=_(_e),me=k(_(Fe),2);re(me,20,()=>Array(3),xs,(ge,Ee,Me)=>{var ce=wc();R(()=>Ho(ce,`strike-dot ${(Me<o(a).strikes?"active":"")??""} svelte-bkv8uq`)),E(ge,ce)}),x(me),x(Fe),x(_e),x(Q),x(D),R(()=>{se(z,"style",`width: ${i()??""}%; background: ${o(b)??""}; box-shadow: 0 0 10px ${o(b)??""}`),ne(oe,o(n).question)}),O(1,D,()=>$e,()=>({duration:600,start:0,easing:Zs})),E(S,D)};W(I,S=>{o(c)==="active"&&S(q)})}x(d),O(3,A,()=>ie,()=>({duration:500})),E(v,d)};W(y,v=>{o(a)&&o(a).isActive&&o(n)&&v(u)})}E(s,w),G()}qe(["click"]);var Tc=P('<div class="star-container svelte-1w5pxei"><div class="star-core svelte-1w5pxei"></div> <div class="star-rays svelte-1w5pxei"></div> <div class="star-glow svelte-1w5pxei"></div></div>');function xc(s,e){H(e,!0);const t=Ce(e,"x",3,50),i=Ce(e,"y",3,50);Xs(()=>{M!=null&&M.preloaded&&M.play("chime")});var a=Tc();R(()=>se(a,"style",`left: ${t()??""}%; top: ${i()??""}%;`)),O(1,a,()=>$e,()=>({duration:600,start:0,easing:Zs})),O(2,a,()=>ie,()=>({duration:300})),E(s,a),G()}var _c=P('<div class="floating-text svelte-ut1t50">+1 BP</div>'),Fc=P('<div class="points-badge svelte-ut1t50"><div class="badge-content svelte-ut1t50"><span class="icon svelte-ut1t50">üõ†Ô∏è</span> <span class="count svelte-ut1t50"> </span> <div class="text svelte-ut1t50"><span class="svelte-ut1t50">Builds</span> <small class="svelte-ut1t50">Available</small></div></div> <!></div>'),Bc=P('<!> <div class="indicator-container svelte-ut1t50"><div class="timer-section svelte-ut1t50"><div class="label-row svelte-ut1t50"><span class="label svelte-ut1t50">Star Transmit</span> <span class="status-text svelte-ut1t50"> </span></div> <div class="progress-bar-bg svelte-ut1t50"><div class="progress-bar-fill svelte-ut1t50"></div></div></div> <!></div>',1);function Ac(s,e){H(e,!0);const t=F(()=>L.get("questionManager")),i=F(()=>L.get("stageManager")),a=F(()=>o(t)?Math.min(100,o(t).gameTimeSinceLastQuestion/ue.questionInterval*100):0),n=F(()=>{var d;return((d=o(t))==null?void 0:d.buildPoints)||0}),l=F(()=>{var d;return(d=o(i))==null?void 0:d.stageResult});let c=0,m=p(!1),b=p(!1),f=p(C({x:50,y:50})),w=p(!1);Se(()=>{o(t)&&o(a)&&(o(a)>=92&&!o(w)&&!o(t).isActive&&(g(w,!0),g(b,!0),g(f,C({x:15+Math.random()*70,y:15+Math.random()*70}))),o(a)<50&&(g(w,!1),g(b,!1)),o(t).buildPoints>c&&(g(m,!0),setTimeout(()=>g(m,!1),1500)),c=o(t).buildPoints)});var y=he(),u=J(y);{var v=d=>{var A=Bc(),T=J(A);{var B=V=>{xc(V,{get x(){return o(f).x},get y(){return o(f).y}})};W(T,V=>{o(b)&&V(B)})}var I=k(T,2),q=_(I),S=_(q),D=k(_(S),2),Q=_(D);R(()=>ne(Q,`${Math.floor(o(a))??""}%`)),x(D),x(S);var N=k(S,2),Y=_(N);x(N),x(q);var z=k(q,2);{var K=V=>{var oe=Fc(),Te=_(oe),xe=k(_(Te),2),we=_(xe,!0);x(xe),pi(2),x(Te);var _e=k(Te,2);{var Fe=me=>{var ge=_c();E(me,ge)};W(_e,me=>{o(m)&&me(Fe)})}x(oe),R(()=>{ke(oe,"has-points",o(n)>0),ne(we,o(n))}),O(1,oe,()=>$e,()=>({duration:300,start:.5,opacity:0})),O(2,oe,()=>$e,()=>({duration:200,start:.8,opacity:0})),E(V,oe)};W(z,V=>{o(n)>0&&V(K)})}x(I),R(()=>se(Y,"style",`width: ${o(a)??""}%`)),E(d,A)};W(u,d=>{o(t)&&!o(t).isActive&&!o(l)&&d(v)})}E(s,y),G()}var kc=P("<div><!> <!></div>");function Sc(s,e){H(e,!0);let t=p(0),i=0,a=-1;Se(()=>{const c=L.get("questionManager");c&&c.wrongAnswerTrigger!==a&&(a!==-1&&fi(t),a=c.wrongAnswerTrigger);const m=L.get("entityManager");m&&m.throne});var n=he(),l=J(n);ri(l,()=>o(t),c=>{var m=kc(),b=_(m);qa(b,e,"default",{});var f=k(b,2);ri(f,()=>i,w=>{var y=he(),u=J(y);W(u,v=>{}),E(w,y)}),x(m),R(()=>Ho(m,`feedback-layer ${(o(t)>0?"shake-effect":"")??""} svelte-10dqr7b`)),E(c,m)}),E(s,n),G()}const Ec=["/projectiles/Click/0.svg","/projectiles/Click/1.svg","/projectiles/Click/2.svg","/projectiles/Click/3.svg","/projectiles/Fireball/Die/0.svg","/projectiles/Fireball/Die/1.svg","/projectiles/Fireball/Die/2.svg","/projectiles/Fireball/Follow/0.svg","/projectiles/Fireball/Follow/1.svg","/projectiles/Fireball/Follow/2.svg","/projectiles/Fireball/Follow/3.svg","/projectiles/Icebolt/Die/0.svg","/projectiles/Icebolt/Die/1.svg","/projectiles/Icebolt/Die/2.svg","/projectiles/Icebolt/Follow/0.svg","/projectiles/Icebolt/Follow/1.svg","/projectiles/Poisonball/Die/0.svg","/projectiles/Poisonball/Die/1.svg","/projectiles/Poisonball/Die/2.svg","/projectiles/Poisonball/Follow/0.svg","/projectiles/Poisonball/Follow/1.svg","/projectiles/Poisonball/Follow/2.svg","/projectiles/Poisonball/Follow/3.svg","/projectiles/Thunderbolt/Die/0.svg","/projectiles/Thunderbolt/Die/1.svg","/projectiles/Thunderbolt/Die/2.svg","/projectiles/Thunderbolt/Follow/0.svg","/projectiles/Thunderbolt/Follow/1.svg","/projectiles/Thunderbolt/Follow/2.svg","/projectiles/Thunderbolt/Follow/3.svg","/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg","/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg","/enemies/BlueCommon/Follow/0.svg","/enemies/BlueCommon/Follow/1.svg","/enemies/BlueCommon/Follow/2.svg","/enemies/BlueCommon/Die/0.svg","/enemies/BlueCommon/Die/1.svg","/enemies/BlueCommon/Die/2.svg","/towers/FireTower/Base0.svg","/towers/FireTower/Base1.svg","/towers/FireTower/Base2.svg","/towers/FireTower/Upgrade1.svg","/towers/FireTower/Upgrade2.svg","/towers/IceTower/Base0.svg","/towers/IceTower/Base1.svg","/towers/IceTower/Base2.svg","/towers/IceTower/Upgrade1.svg","/towers/IceTower/Upgrade2.svg","/towers/PoisonTower/Base0.svg","/towers/PoisonTower/Base1.svg","/towers/PoisonTower/Base2.svg","/towers/PoisonTower/Upgrade1.svg","/towers/PoisonTower/Upgrade2.svg","/towers/ThunderTower/Base0.svg","/towers/ThunderTower/Base1.svg","/towers/ThunderTower/Base2.svg","/towers/ThunderTower/Upgrade1.svg","/towers/ThunderTower/Upgrade2.svg","/towers/Base.svg","/towers/Upgrade0.svg","/castle/castle.png","/castle/castle-broken.png","/castle/castle-broken2.png","/castle/castle-broken3.png","/castle/castle-destroyed.png","/logos/knowledge-space2.png","/cursors/cursor-hammer.svg","/cursors/cursor-arrow.svg","/cursors/build0.svg","/cursors/build1.svg","/cursors/build2.svg"].map(X),Mc=s=>{pe.spendLoot({type:"click",payload:{offset:new te(s.clientX,s.clientY)}})},Dc=(s,e)=>{var t;M.play("clickMenu",!0),(t=o(e))==null||t.pause()};var Pc=P('<link rel="preload" as="image">'),Ic=P('<div class="window-wrapper"><div class="wrapper svelte-dz30ag"><!> <!> <!> <button tabindex="-1" class="btn-pause svelte-dz30ag"><!></button> <div class="game-container svelte-dz30ag"><!></div></div></div>'),jc=P("<!> <!> <!>",1);function Yc(s,e){H(e,!0);const t=F(()=>ae.isStarted?L.get("questionManager"):void 0),i=F(()=>ae.isStarted?L.get("gameLoop"):void 0),a=F(()=>ae.isStarted?L.get("stageManager"):void 0),n=u=>{var v,d;u.key==="Escape"&&((v=o(i))!=null&&v.pauseState?o(i).resume():(d=o(i))==null||d.pause())};Xs(()=>{M.preload()});var l=jc();Re("keydown",Ea,n),Ia(u=>{var v=he(),d=J(v);re(d,17,()=>Ec,xs,(A,T)=>{var B=Pc();R(()=>se(B,"href",o(T))),E(A,B)}),E(u,v)});var c=J(l);{var m=u=>{ul(u,{onStart:()=>ae.start()})},b=u=>{var v=he(),d=J(v);{var A=B=>{ol(B,{onRestart:()=>ae.restart()})},T=B=>{var I=he(),q=J(I);{var S=D=>{ec(D,{onResume:()=>{var Q;return(Q=o(i))==null?void 0:Q.resume()},onRestart:()=>ae.restart()})};W(q,D=>{var Q;(Q=o(i))!=null&&Q.pauseState&&D(S)},!0)}E(B,I)};W(d,B=>{o(a).stageResult?B(A):B(T,!1)},!0)}E(u,v)};W(c,u=>{ae.isStarted?u(b,!1):u(m)})}var f=k(c,2);{var w=u=>{var v=Ic();v.__click=[Mc];const d=F(()=>Z.get("arrow"));R(()=>U(v,"cursor",o(d)));var A=_(v),T=_(A);{var B=z=>{cc(z,{get stageNumber(){return o(a).stageNumber}})};W(T,z=>{o(a)&&z(B)})}var I=k(T,2);uc(I,{});var q=k(I,2);Ac(q,{});var S=k(q,2);S.__click=[Dc,i];const D=F(()=>Z.get("arrow"));R(()=>U(S,"cursor",o(D)));var Q=_(S);mc(Q),x(S);var N=k(S,2);U(N,"transform-origin","center");var Y=_(N);Sc(Y,{children:(z,K)=>{Jn(z,{})},$$slots:{default:!0}}),x(N),x(A),x(v),R(()=>{var z;return ke(A,"bullet-time",(z=o(t))==null?void 0:z.isActive)}),Ii(N,"offsetHeight",z=>j.gameAreaHeight=z),Ii(N,"offsetWidth",z=>j.gameAreaWidth=z),E(u,v)};W(f,u=>{ae.isStarted&&M.preloaded&&u(w)})}var y=k(f,2);Cc(y,{}),ji("innerWidth",u=>j.width=u),ji("innerHeight",u=>j.height=u),E(s,l),G()}qe(["click"]);export{Yc as component};
